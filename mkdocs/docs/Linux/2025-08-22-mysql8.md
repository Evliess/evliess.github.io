---
layout: index
title: "Ubuntu 22.04 Mysql8"
category: linux
date: 2025-08-21 15:17:55
---

### Install

```bash
sudo apt update
sudo apt upgrade

sudo apt install mysql-server
sudo systemctl status mysql
sudo mysql_secure_installation

# Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 1
# Remove anonymous users? (Press y|Y for Yes, any other key for No) : y
# Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y
# Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y
# Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
```

### Security configuration

```bash
sudo ss -tlnp | grep mysql

#sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf #允许内网其他服务器访问

# disable LOCAL INFILE
sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf

###
[mysqld]
# ... 其他配置 ...
local-infile = 0
###

sudo systemctl restart mysql
sudo ufw status numbered
sudo ufw delete 4
sudo mysql #go into command line

CREATE DATABASE <NAME>_db;
CREATE USER '<NAME>_user'@'<IP_ADDR>' IDENTIFIED BY '<PWD';
GRANT CREATE, SELECT, INSERT, UPDATE, DELETE ON <NAME>_db.* TO '<NAME>_user'@'<IP_ADDR>';
FLUSH PRIVILEGES;
EXIT;
```

### BackUp

```bash
# mysql> SHOW VARIABLES LIKE 'datadir';
# +---------------+-----------------+
# | Variable_name | Value           |
# +---------------+-----------------+
# | datadir       | /var/lib/mysql/ |
# +---------------+-----------------+
# 1 row in set (0.04 sec)

# MySQL 版本完全一致：主版本、次版本甚至修订版本号都必须完全相同（例如，都是 8.0.36）。任何细微的版本差异都可能导致失败。

# 操作系统和架构相同：例如，都是从 Ubuntu 22.04 (x86_64) 复制到 Ubuntu 22.04 (x86_64)。

# 配置文件相似：特别是与 InnoDB 相关的核心配置，如 innodb_page_size、innodb_log_file_size 等必须完全一致。

# 权限必须正确：复制到新服务器后，所有文件和目录的属主和属组必须是 mysql

sudo systemctl stop mysql
sudo chown -R mysql:mysql /var/lib/mysql

## mysqldump 推荐

# 导出一个名为 myapp_db 的数据库
sudo mysqldump -u root -p myapp_db > myapp_db_backup.sql
# 导出所有数据库
sudo mysqldump -u root -p --all-databases > all_databases_backup.sql

scp myapp_db_backup.sql user@your_new_server_ip:/path/to/destination

# 登录 MySQL
sudo mysql -u root -p

# 在 MySQL 提示符下执行
CREATE DATABASE myapp_db;
EXIT;

sudo mysql -u root -p myapp_db < /path/to/destination/myapp_db_backup.sql
```