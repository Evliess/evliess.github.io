{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome!","text":""},{"location":"Database/2018-03-14-basic-database/","title":"Database basic knowledge","text":""},{"location":"Database/2018-03-14-basic-database/#mysql-common-commands","title":"Mysql Common Commands","text":"<pre><code>// Add a column\nALTER TABLE `stage` ADD `subpipeline_id` bigint(20) DEFAULT NULL;\n// Add a constraint\nALTER TABLE `build_stage` ADD CONSTRAINT `BUILD_STAGE_SUBPIPELINE_FK` FOREIGN KEY (`subpipeline_id`) REFERENCES `pipeline` (`id`);\n// Drop a constraint\nALTER TABLE `build_stage` DROP FOREIGN KEY `BUILD_STAGE_SUBPIPELINE_FK`;\n</code></pre>"},{"location":"Database/2018-03-14-basic-database/#oracle-common-commands","title":"Oracle Common Commands","text":""},{"location":"Database/2018-03-14-basic-database/#install-sqlplus-instantclient-to-connect-oracle","title":"Install sqlplus instantclient to connect oracle.","text":"<ol> <li>Download instantclient-basic-windows.x64-19.3.0.0.0dbru.zip</li> <li>Download instantclient-sqlplus-windows.x64-19.3.0.0.0dbru.zip</li> <li>Extract them to current folder.</li> <li>Set Env Path C:\\Users\\\\Downloads\\oracle\\instantclient_19_3 <li>win + r cmd <code>sqlplus idaDbAdmin/idaDbAdmin@127.0.0.1:32778/ORCLCDB.localdomain</code></li>"},{"location":"Database/2018-03-14-basic-database/#common-scripts","title":"Common scripts","text":"<pre><code>// login vm\nssh &lt;YOUR_IP&gt;\n\n// open sqlplus client\ndocker exec -it oracle12c bash -c \"source /home/oracle/.bashrc; sqlplus /nolog\"\n\nSQL&gt; connect / as sysdba\n// search service names\nSQL&gt; select value from v$parameter where name='service_names'\nSQL&gt; grant create procedure to idaDbAdmin;\nSQL&gt; grant execute on sys.dbms_crypto to idaDbAdmin;\nSQL&gt; connect idaDbAdmin/idaDbAdmin\nSQL&gt; set serveroutput on\n\n// md5\n// https://docs.oracle.com/database/121/DBSEG/data_encryption.htm#DBSEG335\n</code></pre>"},{"location":"Database/2018-03-14-basic-database/#create-procedure-with-md5","title":"Create procedure with md5","text":"<pre><code>create or replace procedure addUser (u_pass in varchar2, u_key in varchar2) is \norg_id number;\nraw_input RAW(128) := UTL_RAW.CAST_TO_RAW(u_pass);\nraw_key RAW(128) := UTL_RAW.CAST_TO_RAW(u_key);\nencrypted_raw    RAW(2048);\nencrypted_pass varchar2(100);\nbegin \n    select id into org_id from organization where company_name = 'IDA';\n    dbms_output.put_line(org_id);\n    encrypted_raw := dbms_crypto.Mac(src =&gt; raw_input, typ =&gt; DBMS_CRYPTO.HMAC_MD5, key =&gt; raw_key);\n    dbms_output.put_line('&gt; Result      : ' || rawtohex(encrypted_raw));\nend;\n/\n\ncall addUser('idaAdmin', 'idaAdmin');\n</code></pre>"},{"location":"Database/2018-03-14-basic-database/#db2-common-commands","title":"DB2 Common Commands","text":"<pre><code>// Add a column\nALTER TABLE &lt;table-name&gt; ADD SUBPIPELINE_ID BIGINT;\n// Add a constraint\nALTER TABLE &lt;table-name&gt; ADD CONSTRAINT &lt;constraint-name&gt; FOREIGN KEY (SUBPIPELINE_ID) REFERENCES &lt;table-name&gt; (ID);\n// Drop a foreign key constraint\nALTER TABLE &lt;table-name&gt; DROP FOREIGN KEY &lt;constraint-name&gt;;\n// Drop a primary key constraint\nALTER TABLE &lt;table-name&gt;  DROP PRIMARY KEY\n// Drop unique constraint\nALTER TABLE &lt;table-name&gt; DROP UNIQUE &lt;constraint-name&gt;\n\n\n\ndb2start\n\ndb2 force application all\ndb2stop\n\ndb2 create database YOUR_DB automatic storage yes using codeset UTF-8 territory US pagesize 32768\ndb2 connect to YOUR_DB\ndb2 CREATE BUFFERPOOL BP32K IMMEDIATE ALL DBPARTITIONNUMS SIZE AUTOMATIC NUMBLOCKPAGES 0 PAGESIZE 32 K\n\ndb2 drop database\n\ndb2 list db directory\ndb2 list active databases\n\ndb2 list tables \n\ndb2 -stvf scripts.sql\n</code></pre> <p>Query below returns foreign key constrants defined in a database.</p> <pre><code>select \n    ref.tabschema  concat '.' concat ref.tabname as foreign_table,\n    '&gt;-' as rel,\n    ref.reftabschema concat '.' concat ref.reftabname as primary_table,\n    ref.constname as fk_constraint_name\nfrom syscat.references ref\norder by foreign_table, primary_table\n</code></pre> <p>\u6570\u636e\u5e93\u5de6\u8fde\u63a5\u548c\u53f3\u8fde\u63a5\u7684\u533a\u522b\uff1f  </p> <pre><code>/\u5de6\u8fde\u63a5\u540e\u7684\u68c0\u7d22\u7ed3\u679c\u662f\u663e\u793at1\u7684\u6240\u6709\u6570\u636e\u548ct2\u4e2d\u6ee1\u8db3where\u6761\u4ef6\u7684\u6570\u636e/\nselect * from t1 left join t2 where t1.id = t2.sid;\n</code></pre> <p>\u6570\u636e\u5e93\u76844\u4e2a\u9694\u79bb\u7ea7\u522b  </p> <ul> <li>ISOLATION_DEFAULT  </li> <li>ISOLATION_READ_UNCOMMITTED \u53ef\u80fd\u4f1a\u53d1\u751f\u8bfb\u810f\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb</li> <li>ISOLATION_READ_COMMITTED \u963b\u6b62\u8bfb\u810f\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb  </li> <li>ISOLATION_REPEATABLE_READ \u963b\u6b62\u8bfb\u810f\u548c\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u5e7b\u8bfb  </li> <li>ISOLATION_SERIALIZABLE \u963b\u6b62\u53d1\u751f\u8bfb\u810f\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb  </li> </ul> <p>\u6570\u636e\u5e93\u7684\u8bfb\u810f\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u7684\u533a\u522b  </p> <ul> <li>\u8bfb\u810f \u8bfb\u810f\u53c8\u79f0\u65e0\u6548\u6570\u636e\u7684\u8bfb\u53d6\uff0c\u4e3e\u4f8b\u8bf4\u660e\uff1a  </li> </ul> <p><pre><code>begin transaction1\n/\u4fee\u6539\u524d\u5de5\u8d44\u4e3a500/\nupdate employee set salary = 1000 where id = 1;\n\n\nbegin transaction2\n/\u4e8b\u52a12 \u53d1\u73b0\u5de5\u8d44\u5df2\u7ecf\u53d8\u4e3a1000/\nselect * from employee where id =1;  \n\ntransaction1\nrollback\n/\u73b0\u5728\u5de5\u8d44\u53c8\u53d8\u4e3a\u4fee\u6539\u524d\u7684500\uff0c\u56e0\u6b64\u4e8b\u52a12\u8bfb\u7684\u5c31\u662f\u810f\u6570\u636e/  \n</code></pre> - \u4e0d\u53ef\u91cd\u590d\u8bfb  \u9488\u5bf9\u66f4\u65b0\u67d0\u4e00\u884c\u7684\u6570\u636e \u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\uff0c\u4e24\u4e2a\u76f8\u540c\u7684\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u4e0d\u540c\uff0c\u4e3e\u4f8b\u8bf4\u660e\uff1a  </p> <p><pre><code>begin transaction1\nselect * from employee where id =1;\n\n/\u4e8b\u52a12\u66f4\u65b0\u4e86\u8fd9\u6761\u6570\u636e/  \nbegin transaction2\nupdate employee set salary = 1000 where id = 1;\ncommit\n\ntransaction1\nselect * from employee where id =1;\n/\u53d1\u73b0\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u4e0d\u4e00\u81f4/  \n</code></pre> - \u5e7b\u8bfb  \u9488\u5bf9\u65b0\u589e\u6216\u8005\u5220\u9664\u6570\u636e \u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\uff0c\u4e24\u4e2a\u76f8\u540c\u7684\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u4e0d\u540c\uff0c\u4e3e\u4f8b\u8bf4\u660e:  </p> <pre><code>begin transaction1\nselect * from employ where salary = 1000; /\u5047\u5982\u8fd4\u56de10\u6761\u6570\u636e/\n\nbegin transaction2\ninsert into employ(,salary,) values(,1000,);\ncommit\n\ntransaction1\nselect * from employ where salary = 1000; /\u6b64\u65f6\u8fd4\u56de11\u6761\u6570\u636e/\n</code></pre> <p>\u6570\u636e\u5e93\u76847\u79cd\u4f20\u64ad\u884c\u4e3a  </p> <ul> <li>PROPAGATION_MANDATORY \u652f\u6301\u5f53\u524d\u4e8b\u52a1\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u4e8b\u52a1\uff0c\u629b\u5f02\u5e38  </li> <li>PROPAGATION_NESTED \u5982\u679c\u5b58\u5728\u4e8b\u52a1\uff0c\u5219\u5728\u4e00\u4e2a\u5d4c\u5957\u7684\u4e8b\u52a1\u4e2d\u8fd0\u884c\uff0c\u5426\u5219\u884c\u4e3a\u548cPROPAGATION_REQUIRED\u4e00\u6837  </li> <li>PROPAGATION_NEVER \u4ee5\u975e\u4e8b\u52a1\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u5982\u679c\u6709\u4e8b\u52a1\uff0c\u629b\u5f02\u5e38  </li> <li>PROPAGATION_NOT_SUPPORTED \u4ee5\u975e\u4e8b\u52a1\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u6302\u8d77\u5f53\u524d\u4e8b\u52a1  </li> <li>PROPAGATION_REQUIRED \u652f\u6301\u5f53\u524d\u4e8b\u52a1\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u4e8b\u52a1\uff0c\u5c31\u65b0\u5efa\u4e00\u4e2a\u4e8b\u52a1  </li> <li>PROPAGATION_REQUIRES_NEW \u521b\u5efa\u4e00\u4e2a\u65b0\u662f\u4e8b\u52a1\uff0c\u6302\u8d77\u5f53\u524d\u4e8b\u52a1  </li> <li>PROPAGATION_SUPPORTS \u652f\u6301\u5f53\u524d\u4e8b\u52a1\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u4e8b\u52a1\uff0c\u5c31\u4ee5\u975e\u4e8b\u52a1\u65b9\u5f0f\u6267\u884c  </li> </ul>"},{"location":"Database/2018-03-14-common_migration_script%20-database/","title":"Migration Scripts Sample","text":"<p>To check that a table exists</p> <pre><code>-- does a particular table exist\nIF EXISTS ( SELECT  1\n        FROM    information_schema.Tables\n        WHERE   table_schema = 'MySchema'\n                AND TABLE_NAME = 'MyTableName' )\nPRINT 'the table exists' \nELSE\nPRINT 'The table isn''t there'\n</code></pre> <p>To check that a function exists</p> <pre><code>-- does a particular function exist\nIF EXISTS ( SELECT  1\n        FROM    information_schema.Routines\n        WHERE   ROUTINE_NAME = 'MyFunctionName'\n                AND ROUTINE_TYPE = 'FUNCTION'\n                AND ROUTINE_SCHEMA = 'MySchema' )\nPRINT 'the function exists' \nELSE\nPRINT 'The function isn''t there'\n</code></pre> <p>To check that a procedure exists</p> <pre><code>-- does a particular procedure  exist\nIF EXISTS ( SELECT  1\n        FROM    information_schema.Routines\n        WHERE   ROUTINE_NAME = 'MyProcedureName'\n                AND ROUTINE_TYPE = 'PROCEDURE'\n                AND ROUTINE_SCHEMA = 'MySchema' )\nPRINT 'the procedure exists' \nELSE\nPRINT 'The procedure isn''t there'\n</code></pre> <p>To check that a particular column exists in a table exists</p> <pre><code>-- does a particular column exist in a table\nIF EXISTS ( SELECT  1\n        FROM    information_schema.COLUMNS\n        WHERE   table_schema = 'MySchema'\n                AND TABLE_NAME = 'MyTableName'\n                AND column_Name = 'MyColumnName' )\nPRINT 'the colmun exists' \nELSE\nPRINT 'The column isn''t there'\n</code></pre> <p>To check whether a column has any sort of constraint</p> <pre><code>IF EXISTS ( SELECT  1\n        FROM    information_schema.CONSTRAINT_column_USAGE\n        WHERE   table_schema = 'MySchema'\n                AND TABLE_NAME = 'MyTableName'\n                AND column_Name = 'MyColumnName' )\nPRINT 'there is a constraint on the column' \nELSE\nPRINT 'no constraint'\n</code></pre> <p>To check that a column has a check constraint</p> <pre><code>IF EXISTS ( SELECT  1\n        FROM    information_schema.CONSTRAINT_column_USAGE CCU\n                INNER JOIN information_schema.CHECK_CONSTRAINTS CC ON CC.constraint_name = CCU.constraint_NAME\n        WHERE   table_schema = 'MySchema'\n                AND TABLE_NAME = 'MyTableNames'\n                AND column_Name = 'MyColumnName' )\nPRINT 'there is a check constraint on the column' \nELSE\nPRINT 'no check constraint'\n</code></pre> <p>To check that a column has a foreign key constraint</p> <pre><code>--is there a foreign key constraint on the column   \nIF EXISTS ( SELECT  1\n    FROM    information_schema.CONSTRAINT_column_USAGE CCU\n            INNER JOIN information_schema.REFERENTIAL_CONSTRAINTS CC ON CC.constraint_name = CCU.constraint_NAME\n    WHERE   table_schema = 'MySchema'\n            AND TABLE_NAME = 'MyTableName'\n            AND column_Name = 'MyColumnName' )\nPRINT 'there is a referential constraint on the column' \nELSE\nPRINT 'no referential constraint'\n</code></pre> <p>To check that a column participates in a primary key</p> <pre><code>--is the column (part of ) a primary key?   \n    IF EXISTS ( SELECT  1\n        FROM    information_schema.CONSTRAINT_column_USAGE CCU\n                INNER JOIN information_schema.TABLE_CONSTRAINTS CC ON CC.constraint_name = CCU.constraint_NAME\n        WHERE   CCU.table_schema = 'MySchema'\n                AND CCU.TABLE_NAME = 'MyTableName'\n                AND column_Name = 'MyColumnName'\n                AND constraint_Type = 'PRIMARY KEY' )\nPRINT 'the column is involved in a primary key' \nELSE\nPRINT 'not involved in a primary key'\n</code></pre> <p>Reference Link  </p> <ul> <li>https://www.red-gate.com/simple-talk/sql/database-administration/using-migration-scripts-in-database-deployments/</li> </ul>"},{"location":"Database/2018-04-06-redis-database/","title":"Redis overriew","text":"<p>Redis\u4e0e\u5176\u4ed6\u5185\u5b58\u6570\u636e\u5e93\u4e0e\u4f17\u4e0d\u540c\uff0c\u662f\u56e0\u4e3a\u4ee5\u4e0b\u4e09\u4e2a\u539f\u56e0\uff1a - Redis\u5c06\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u6570\u636e\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u78c1\u76d8\u53ea\u662f\u7528\u6765\u5b58\u50a8\u6570\u636e\u3002 - Redis\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\u7684\u6570\u636e\u7ed3\u6784\u3002 - Redis\u53ef\u4ee5\u5c06\u6570\u636e\u5907\u4efd\u5230\u4efb\u610f\u591a\u4e2aslave\u4e0a\u3002</p> <p>Redis\u7684\u4f18\u52bf - \u975e\u5e38\u5feb \u53ef\u4ee5\u6bcf\u79d2\u6267\u884c110000\u6b21SET\u64cd\u4f5c\uff0c81000\u6b21GET\u64cd\u4f5c\u3002 - \u652f\u6301\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b list, set, sorted set, and hashes \u3002 - \u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027  - \u7528\u9014\u5e7f\u6cdb \u53ef\u4ee5\u7528\u4f5c\u7f13\u5b58\uff0c\u6d88\u606f\u961f\u5217\uff08Redis\u5929\u751f\u652f\u6301Publish/Subscribe\uff09\uff0c\u5b58\u50a8Web\u5e94\u7528\u4e2d\u7684session\uff0c\u7f51\u9875\u547d\u4e2d\u8ba1\u6570\u7b49\u3002</p>"},{"location":"Database/2018-04-06-redis-database/#redis-installation","title":"Redis Installation","text":"<pre><code>$ wget http://download.redis.io/releases/redis-4.0.9.tar.gz\n$ tar xzf redis-4.0.9.tar.gz\n$ cd redis-4.0.9\n$ make\n</code></pre>"},{"location":"Database/2018-04-06-redis-database/#startup-redis","title":"Startup Redis","text":"<pre><code>. src/redis-server\n</code></pre>"},{"location":"Database/2018-04-06-redis-database/#use-cmd-line","title":"Use CMD Line","text":"<pre><code>./redis-cli\n127.0.0.1:6379&gt;\n\n/**\u5728\u8fdc\u7a0bRedis Server\u4e0a\u8fd0\u884credis\u547d\u4ee4\n* -h \u540e\u9762\u6307\u5b9a\u8fdc\u7a0bserver\u7684\u5730\u5740\n* -p \u540e\u9762\u6307\u5b9a\u8fdc\u7a0bRedis server\u7684\u7aef\u53e3\n* -a \u6307\u5b9a\u8bbf\u95ee\u6240\u9700\u7684\u5bc6\u7801\n*/\n$ redis-cli -h host -p port -a password\n</code></pre>"},{"location":"Database/2018-04-06-redis-database/#stop-redis","title":"Stop redis","text":"<pre><code>//\u67e5\u627e\u6b63\u5728\u8fd0\u884credis\u7684\u8fdb\u7a0b\u4ee5\u53ca\u7aef\u53e3\u53f7\nps -ef |grep redis\n\n//\u4f7f\u7528redis-cli\u5173\u95edredis\u670d\u52a1\n./redis-cli -p 6379 shutdown\n</code></pre>"},{"location":"Database/2018-04-06-redis-database/#redis-commands","title":"Redis Commands","text":""},{"location":"Database/2018-04-06-redis-database/#keys","title":"Keys","text":"<ul> <li> <p>DEL key [key ...] \u5220\u9664\u4e00\u4e2a\u6216\u8005\u591a\u4e2akey <pre><code>set key1 \"Hello\" \nset key2 \"World\" \n//\u5220\u9664\u6210\u529f\u8fd4\u56de1\uff0c\u5426\u5219\u8fd4\u56de0\uff0c \u5220\u9664\u591a\u4e2akey\u8fd4\u56de\u7ed3\u679c\u7684\u603b\u6570\ndel key1 key2 key3\n</code></pre></p> </li> <li> <p>EXISTS key [key ...] \u5224\u65ad\u4e00\u4e2akey\u6216\u8005\u591a\u4e2akey\u662f\u5426\u5b58\u5728 <pre><code>set key1 \"Hello\" \nset key2 \"World\" \n//\u6210\u529f\u8fd4\u56de1\uff0c\u5426\u5219\u8fd4\u56de0\uff0c \u5224\u65ad\u591a\u4e2akey\u8fd4\u56de\u7ed3\u679c\u7684\u603b\u6570\nexists key1 key2 key3\n</code></pre></p> </li> <li> <p>EXPIRE key seconds \u8bbe\u7f6e\u4e00\u4e2akey\u8fc7\u671f\u7684\u65f6\u95f4 <pre><code>set key1 \"Hello\" \n//\u8bbe\u7f6ekey1 10\u79d2\u8fc7\u671f\nexpire key1 10 \n</code></pre></p> </li> <li>KEYS pattern \u8fd4\u56de\u6ee1\u8db3\u6a21\u5f0f\u7684key <pre><code>set key1 \"Hello\" \nset key2 \"World\" \n//\u8fd4\u56de\u4ee5key\u5f00\u5934\u7684\u6240\u6709\u7684keys\nkeys key*\n</code></pre></li> <li> <p>OBJECT subcommand [arguments [arguments ...]] \u6839\u636eredis\u6570\u636e\u4e2d\u7684key\u6765\u67e5\u770b\u4fdd\u5b58\u8fd9\u4e2akey\u7684Redis\u5bf9\u8c61\u7684\u4fe1\u606f <pre><code>lpush mylist \"Hello World\"\nobject refcount mylist\nobject encoding mylist\nobject idletime mylist\n</code></pre></p> </li> <li> <p>PERSIST key \u79fb\u9664\u4e00\u4e2akey\u4e0a\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4f7f\u4e4b\u6c38\u8fdc\u4e0d\u8fc7\u671f <pre><code>SET mykey \"Hello\"\n//\u8bbe\u7f6e10\u79d2\u8fc7\u671f\nEXPIRE mykey 10\n//\u79fb\u966410\u79d2\u8fc7\u671f\u7684\u8bbe\u7f6e\nPERSIST mykey\n</code></pre></p> </li> <li> <p>TTL \u67e5\u770b\u4e00\u4e2akey\u8fd8\u6709\u591a\u4e45\u8fc7\u671f</p> </li> <li> <p>RENAME key newkey \u91cd\u547d\u540d\u4e00\u4e2akey <pre><code>set mykey1 \"Hello\"\nrename mykey1 mykey\nget mykey\n</code></pre></p> </li> <li> <p>SORT key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern ...]] [ASC|DESC] [ALPHA] [STORE destination] \u5bf9\u83b7\u53d6\u7684\u7ed3\u679c\u8fdb\u884c\u6392\u5e8f <pre><code>SORT mylist LIMIT 0 5 ALPHA DESC\n</code></pre></p> </li> <li> <p>TYPE key \u8fd4\u56dekey\u7684\u7c7b\u578b  </p> </li> <li> <p>RESTORE key ttl serialized-value [REPLACE] \u53cd\u5e8f\u5217\u5316\u7ed9\u5b9a\u7684\u5e8f\u5217\u5316\u7684\u5e8f\u5217\u5316\u503c\uff0c\u5e76\u5c06\u8be5\u503c\u4e0e\u7ed9\u5b9a\u7684key\u5173\u8054 <pre><code>set mykey0 \"Hello\"\ndump mykey0 \nrestore mykey 0 \"\\x00\\x05Hello\\b\\x00\\x05\\xe4\\x1bW\\x94\\x1cu\\xbb\"\nget mykey\n</code></pre></p> </li> </ul>"},{"location":"Database/2018-04-06-redis-database/#strings","title":"Strings","text":"<ul> <li> <p>APPEND key value \u5982\u679ckey\u5df2\u7ecf\u5b58\u5728\u5e76\u4e14\u5b83\u7684value\u662fString\u7c7b\u578b\uff0c\u90a3\u4e48\u5c06value\u8ffd\u52a0\u5230value\u7684\u7ed3\u5c3e\u3002 \u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u76f8\u5f53\u4e8e\u6267\u884cset\u547d\u4ee4\u3002  </p> </li> <li> <p>SET key value [EX seconds] [PX milliseconds] [NX|XX] \u8bbe\u7f6ekey\u548cvalue\uff0c\u540c\u65f6\u8bbe\u7f6e\u8be5key\u7684\u8fc7\u671f\u65f6\u95f4\u3002  </p> </li> <li> <p>GET key \u83b7\u53d6key\u5bf9\u5e94\u7684value  </p> </li> <li> <p>MGET key [key ...] \u83b7\u53d6\u591a\u4e2akey\u7684\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8fd4\u56denil  </p> </li> <li> <p>MSET key value [key value ...] \u8bbe\u7f6e\u591a\u4e2akey\u7684\u503c  </p> </li> <li> <p>SETRANGE key offset value  \u4eceoffset\u4f4d\u7f6e\u66ff\u6362\u5bf9\u5e94\u7684key\u7684value\u90e8\u5206\uff0c\u66ff\u6362\u7684\u957f\u5ea6\u4e3avalue\u7684\u957f\u5ea6 <pre><code>SET key1 \"Hello World\"\n//'W'\u5904\u5f00\u59cb\u5f00\u59cb\u66ff\u6362\nSETRANGE key1 6 \"Redis\"\n//\u8fd4\u56de \"Hello Redis\"\nGET key1\n</code></pre></p> </li> <li> <p>STRLEN key \u8fd4\u56dekey\u7684value\u7684\u957f\u5ea6  </p> </li> </ul>"},{"location":"Database/2018-04-06-redis-database/#hashes","title":"Hashes","text":"<p>\u6570\u636e\u7ed3\u6784\u548cmap\u7c7b\u4f3c\uff0ckey\u548cvalue\u90fd\u662fstring\u7c7b\u578b\u3002  </p> <ul> <li>HSET key field value \u5728\u540d\u5b57\u4e3akey\u7684map\u4e2d\u6dfb\u52a0\u4e00\u6761key\u4e3afield\uff0c\u503c\u4e3avalue\u7684\u8bb0\u5f55 <pre><code>hset people name zhangsan\nhset people age 12\n</code></pre></li> <li>HGET key field \u5728\u540d\u5b57\u4e3akey\u7684map\u4e2d\u83b7\u53d6field\u7684\u503c <pre><code>hget people name\n</code></pre></li> <li> <p>HLEN key \u8fd4\u56demap\u7684\u957f\u5ea6  </p> </li> <li> <p>HMGET key field [field ...]  \u8fd4\u56demap\u4e2d\u591a\u4e2akey\u7684value  </p> </li> <li> <p>HMSET key field value [field value ...] \u8bbe\u7f6emap\u4e2d\u7684\u591a\u4e2a\u5b57\u6bb5  </p> </li> <li> <p>HKEYS key \u8fd4\u56demap\u4e2d\u6240\u6709\u7684field  </p> </li> <li> <p>HVALS key \u8fd4\u56demap\u4e2d\u6240\u6709\u7684value  </p> </li> </ul>"},{"location":"Database/2018-04-06-redis-database/#lists","title":"Lists","text":"<ul> <li> <p>LPUSH key value [value ...] \u5728list\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20 <pre><code>lpush mylist zhangsan\n</code></pre></p> </li> <li> <p>LINDEX key index \u8fd4\u56de\u4e0b\u6807\u4e3aindex\u7684\u5143\u7d20 <pre><code>lindex mylist 0\n</code></pre></p> </li> <li> <p>LINSERT key BEFORE|AFTER pivot value \u5728\u6307\u5b9a\u7684\u5143\u7d20\u4f4d\u7f6e\u524d\u6216\u8005\u540e\u9762\u63d2\u5165\u5143\u7d20 <pre><code>//\u5728zhangsan\u524d\u9762\u63d2\u5165lisi\nLINSERT mylist BEFORE \"zhangsan\" \"lisi\"\n</code></pre></p> </li> <li> <p>LLEN key \u8fd4\u56delist\u7684\u957f\u5ea6  </p> </li> <li> <p>LPOP key \u5220\u9664\u5e76\u8fd4\u56de\u7b2c\u4e00\u4e2a\u5143\u7d20  </p> </li> <li> <p>LRANGE key start stop \u8fd4\u56de\u5217\u8868 key \u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u533a\u95f4\u4ee5\u504f\u79fb\u91cf start \u548c stop \u6307\u5b9a\u3002start\u548cstop\u90fd\u662f\u4ee50\u4e3a\u57fa\u51c6\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u8d1f\u503c\uff0c\u8868\u793a\u4ecelist\u7684\u5c3e\u90e8\u5f00\u59cb\u7b97\u8d77\u3002 \u5982\u679cstart &gt; stop ,\u8fd4\u56de\u4e00\u4e2a\u7a7a\u5217\u8868\u3002\u5982\u679cstop\u4e0b\u8868\u5927\u4e8eend\uff0c\u5219Redis\u4f1a\u628aend\u7684\u503c\u8d4b\u7ed9stop\u3002 <pre><code>//pis\uff1a\u6b64\u65f6\u8fd4\u56de6\u4e2a\u5143\u7d20\uff0c\u548c\u7f16\u7a0b\u4e2d\u7684\u754c\u9650\u4e0d\u4e00\u6837\nlrange mylist 0 5\n</code></pre></p> </li> <li> <p>LREM key count value \u5220\u9664list\u4e2dcount\u4e2a\u6570\u7684\u7b49\u4e8evalue\u7684\u5143\u7d20 <pre><code>lrem mylist 1 zhangsan\n</code></pre></p> </li> <li>LSET key index value \u5c06\u5217\u8868 key\u4e0b\u6807\u4e3aindex\u7684\u5143\u7d20\u7684\u503c\u8bbe\u7f6e\u4e3avalue <pre><code>lset mylist 0 wangwu\n</code></pre></li> <li> <p>RPUSH key value [value ...] \u5c06\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u503c\u63d2\u5165list\u7684\u672b\u5c3e  </p> </li> <li> <p>RPOP key \u79fb\u9664\u5e76\u8fd4\u56delist\u7684\u5c3e\u5143\u7d20  </p> </li> </ul>"},{"location":"Database/2018-04-06-redis-database/#sets","title":"Sets","text":"<ul> <li> <p>SADD key member [member ...] \u5728set\u4e2d\u6dfb\u52a0\u4e00\u6761\u6216\u8005\u591a\u6761\u8bb0\u5f55\uff0cset\u4e2d\u7684\u5143\u7d20\u4e0d\u91cd\u590d  </p> </li> <li> <p>SCARD key \u8fd4\u56deset\u7684\u957f\u5ea6  </p> </li> <li> <p>SDIFF key [key ...] \u8ba1\u7b97\u96c6\u5408\u4e4b\u95f4\u7684\u5dee\u96c6 <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nkey3 = {a,c,e}\nSDIFF key1 key2 key3 = {b,d}\n</code></pre></p> </li> <li> <p>SDIFFSTORE destination key [key ...] \u5c06\u96c6\u5408\u7684\u5dee\u96c6\u4fdd\u5b58\u5728\u952e\u4e3akey\u7684\u96c6\u5408\u4e2d <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nSDIFFSTORE key1 key2 key3\nkeys = {b,d}\n</code></pre></p> </li> <li> <p>SINTER key [key ...] \u8ba1\u7b97\u96c6\u5408\u7684\u4ea4\u96c6 <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nkey3 = {a,c,e}\nSINTER key1 key2 key3 = {c}\n</code></pre></p> </li> <li>SINTERSTORE destination key [key ...] \u5c06\u96c6\u5408\u7684\u4ea4\u96c6\u4fdd\u5b58\u5728\u952e\u4e3akey\u7684\u96c6\u5408\u4e2d <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nkey3 = {a,c,e}\nSINTERSTORE key1 key2 key3 key4\nkey4 = {c}\n</code></pre></li> <li>SUNION key [key ...] \u8ba1\u7b97\u96c6\u5408\u7684\u5e76\u96c6 <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nkey3 = {a,c,e}\nSUNION key1 key2 key3 = {a,b,c,d,e}\n</code></pre></li> <li> <p>SUNIONSTORE destination key [key ...] \u8ba1\u7b97\u96c6\u5408\u7684\u5e76\u96c6\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u96c6\u5408 <pre><code>key1 = {a,b,c,d}\nkey2 = {c}\nkey3 = {a,c,e}\nSUNION key1 key2 key3 key4\nkey4 = {a,b,c,d,e}\n</code></pre></p> </li> <li> <p>SISMEMBER key member \u5224\u65adset\u4e2d\u662f\u5426\u5305\u542bmember,\u5305\u542b\u8fd4\u56de1\uff0c\u4e0d\u5305\u542b\u8fd4\u56de0 <pre><code>SADD myset \"one\"\n//\u8fd4\u56de1\nSISMEMBER myset \"one\"\n//\u8fd4\u56de0\nSISMEMBER myset \"two\"\n</code></pre></p> </li> <li> <p>SMEMBERS key \u8fd4\u56deset\u4e2d\u6240\u6709\u7684value  </p> </li> <li> <p>SMOVE source destination member \u5c06\u5143\u7d20\u4ece\u6e90set\u79fb\u52a8\u5230\u76ee\u7684\u5730set\uff0c\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c  </p> </li> <li> <p>SPOP key [count] \u968f\u673a\u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20  </p> </li> <li> <p>SRANDMEMBER key [count] \u968f\u673a\u83b7\u5f97\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20  </p> </li> <li> <p>SREM key member [member ...] \u5220\u9664\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20  </p> </li> </ul>"},{"location":"Database/2018-04-06-redis-database/#sorted-sets","title":"Sorted Sets","text":"<p>\u6709\u5e8f\u96c6\u5408\u91cc\u9762\u7684\u6210\u5458\u662f\u4e0d\u80fd\u91cd\u590d\u7684\u90fd\u662f\u552f\u4e00\u7684\uff0c\u4f46\u662f\uff0c\u4e0d\u540c\u6210\u5458\u95f4\u6709\u53ef\u80fd\u6709\u76f8\u540c\u7684\u5206\u6570  </p> <ul> <li>ZADD key [NX|XX] [CH] [INCR] score member [score member ...] <pre><code>/**\n*ZADD options (Redis 3.0.2 \u53ca\u4ee5\u4e0a\u7248\u672c\u652f\u6301)\n*NX : \u4e0d\u66f4\u65b0\u5df2\u7ecf\u5b58\u5728\u7684\u5143\u7d20\uff0c\u53ea\u589e\u52a0\u65b0\u7684\u5143\u7d20\u3002  \n*XX \uff1a\u53ea\u66f4\u65b0\u5df2\u7ecf\u5b58\u5728\u7684\u5143\u7d20\uff0c\u4e0d\u589e\u52a0\u5143\u7d20\u3002  \n*CH \uff1a\u4fee\u6539\u8fd4\u56de\u503c\u4e3a\u53d1\u751f\u53d8\u5316\u7684\u6210\u5458\u603b\u6570\uff0c\u539f\u59cb\u662f\u8fd4\u56de\u65b0\u6dfb\u52a0\u6210\u5458\u7684\u603b\u6570 (CH \u662f changed \u7684\u610f\u601d)\u3002\u66f4\u6539\u7684\u5143\u7d20\u662f\u65b0\u6dfb\u52a0\u7684\u6210\u5458\uff0c\u5df2\u7ecf\u5b58\u5728\u7684\u6210\u5458\u66f4\u65b0\u5206\u6570\u3002 \u6240\u4ee5\u5728\u547d\u4ee4\u4e2d\u6307\u5b9a\u7684\u6210\u5458\u6709\u76f8\u540c\u7684\u5206\u6570\u5c06\u4e0d\u88ab\u8ba1\u7b97\u5728\u5185\u3002\u6ce8\uff1a\u5728\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cZADD\u8fd4\u56de\u503c\u53ea\u8ba1\u7b97\u65b0\u6dfb\u52a0\u6210\u5458\u7684\u6570\u91cf\u3002  \n*INCH \uff1a\u5f53ZADD\u6307\u5b9a\u8fd9\u4e2a\u9009\u9879\u65f6\uff0c\u6210\u5458\u7684\u64cd\u4f5c\u5c31\u7b49\u540cZINCRBY\u547d\u4ee4\uff0c\u5bf9\u6210\u5458\u7684\u5206\u6570\u8fdb\u884c\u9012\u589e\u64cd\u4f5c  \n*/\nZADD myzset 1 \"one\"\nZADD myzset 2 \"two\" 3 \"three\"\n</code></pre></li> <li> <p>ZCARD key \u8fd4\u56de\u96c6\u5408\u7684\u957f\u5ea6  </p> </li> <li> <p>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count] \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u6570\u5728min\u548cmax\u4e4b\u95f4\u7684\u6240\u6709\u5143\u7d20 <pre><code>/**\n*min\u548cmax\u53ef\u4ee5\u662f-inf\u548c+inf  \n*min \u8868\u793a \u5927\u4e8e\u7b49\u4e8e;  (min \u8868\u793a\u5927\u4e8e  \n*max \u8868\u793a \u5c0f\u4e8e\u7b49\u4e8e;  (max \u8868\u793a\u5c0f\u4e8e  \n*/\nZRANGEBYSCORE myzset -inf +inf\nZRANGEBYSCORE myzset (1 2\nZRANGEBYSCORE myzset (1 (2\n</code></pre></p> </li> <li> <p>ZRANGE key start stop [WITHSCORES]  \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u8303\u56f4(start,stop)\u5185\u7684\u5143\u7d20  </p> </li> <li> <p>ZCOUNT key min max \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2dscore\u5728min\u548cmax\u4e4b\u95f4\u5143\u7d20\u7684\u4e2a\u6570  </p> </li> <li> <p>ZINCRBY key increment member \u5c06\u6709\u5e8f\u96c6\u5408\u4e2dmember\u7684score\u589e\u52a0increment\uff1b\u5982\u679cmember\u4e0d\u5b58\u5728\uff0c\u5c31\u589e\u52a0\u4e00\u4e2amember\uff1bscore\u662fincrement\uff0c\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u53ea\u5305\u542bmember\u7684\u6709\u5e8f\u96c6\u5408\u3002 <pre><code>ZADD myzset 1 \"one\"\nZADD myzset 2 \"two\"\n//\"one\"\u7684score\u53d8\u4e3a3  \nZINCRBY myzset 2 \"one\"\nZRANGE myzset 0 -1 WITHSCORES\n</code></pre></p> </li> <li> <p>ZRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u5143\u7d20\u7684\u6392\u540d\uff0c\u6392\u540d\u9ed8\u8ba4\u4ece0\u5f00\u59cb  </p> </li> <li> <p>ZREM key member [member ...] \u5220\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5143\u7d20  </p> </li> <li> <p>ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX] \u8ba1\u7b97\u591a\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u4ea4\u96c6\u3002WEIGHT\u662f\u8ba1\u7b97\u56e0\u5b50\uff0c\u9ed8\u8ba4\u662f1. \u6307\u5b9aWEIGHT\u5c31\u662f score = score*WEIGHT;\u805a\u7c07\u51fd\u6570AGGREGATE \u9009\u9879\u9ed8\u8ba4\u662fSUM <pre><code>zadd Q1 88 \"apple\"\nzadd Q1 92 \"orange\"\nzadd Q1 100 \"peach\"\nzadd Q2 27 \"apple\"\nzadd Q2 34 \"orange\"\nzadd Q2 80 \"peach\"\nzadd Q2 100 \"grape\"\nzinterstore Q1Q2 2 Q1 Q2\n/**\n*apple(115) = Q1(88) + Q2(27)\n*Q1 \u4e2d\u4e0d\u5305\u542bgrape\uff0cQ1Q2\u4e2d\u4e5f\u6ca1\u6709\n*/\nzrange Q1Q2 0 -1 withscores\n1) \"apple\"\n2) \"115\"\n3) \"orange\"\n4) \"126\"\n5) \"peach\"\n6) \"180\"\n/**\n*apple(115) = Q1(88*1) + Q2(27*2)\n*Q1 \u4e2d\u4e0d\u5305\u542bgrape\uff0cQ1Q2\u4e2d\u4e5f\u6ca1\u6709\n*/\nzinterstore Q1Q2 2 Q1 Q2 WEIGHTS 1 2\nzrange Q1Q2 0 -1 withscores\n1) \"apple\"\n2) \"142\"\n3) \"orange\"\n4) \"160\"\n5) \"peach\"\n6) \"260\"\nzinterstore Q1Q2 2 Q1 Q2 WEIGHTS 1 2 AGGREGATE SUM\nzrange Q1Q2 0 -1 withscores\n1) \"apple\"\n2) \"142\"\n3) \"orange\"\n4) \"160\"\n5) \"peach\"\n6) \"260\"\n/**\n*apple(54) = min(Q1(88*1), Q2(27*2))\n*orange(68) = min(Q1(92*1), Q2(34*2))\n*peach(68) = min(Q1(100*1), Q2(80*2))\n*Q1 \u4e2d\u4e0d\u5305\u542bgrape\uff0cQ1Q2\u4e2d\u4e5f\u6ca1\u6709\n*/\nzinterstore Q1Q2 2 Q1 Q2 WEIGHTS 1 2 AGGREGATE MIN\nzrange Q1Q2 0 -1 withscores\n1) \"apple\"\n2) \"54\"\n3) \"orange\"\n4) \"68\"\n5) \"peach\"\n6) \"100\"\n/**\n*apple(54) = max(Q1(88*1), Q2(27*2))\n*orange(68) = max(Q1(92*1), Q2(34*2))\n*peach(68) = max(Q1(100*1), Q2(80*2))\n*Q1 \u4e2d\u4e0d\u5305\u542bgrape\uff0cQ1Q2\u4e2d\u4e5f\u6ca1\u6709\n*/\nzinterstore Q1Q2 2 Q1 Q2 WEIGHTS 1 2 AGGREGATE MAX\nzrange Q1Q2 0 -1 withscores\n1) \"apple\"\n2) \"88\"\n3) \"orange\"\n4) \"92\"\n5) \"peach\"\n6) \"160\"\n</code></pre></p> </li> <li>ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX] \u8ba1\u7b97\u591a\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u5e76\u96c6\u3002WEIGHT\u662f\u8ba1\u7b97\u56e0\u5b50\uff0c\u9ed8\u8ba4\u662f1. \u6307\u5b9aWEIGHT\u5c31\u662f score = score*WEIGHT;\u805a\u7c07\u51fd\u6570AGGREGATE \u9009\u9879\u9ed8\u8ba4\u662fSUM <pre><code>zunionstore Q1Q2 2 Q1 Q2 WEIGHTS 1 2 AGGREGATE MAX\nzrange Q1Q2 0 -1 withscores\n/**\n*apple(54) = max(Q1(88*1), Q2(27*2))\n*orange(68) = max(Q1(92*1), Q2(34*2))\n*peach(68) = max(Q1(100*1), Q2(80*2))\n*Q1\u4e0d\u5305\u542bgrape\uff0cQ2\u5305\u542bgrape\uff0cQ1Q2\u4e2d\u5305\u542bgrape\n*/\n1) \"apple\"\n2) \"88\"\n3) \"orange\"\n4) \"92\"\n5) \"peach\"\n6) \"160\"\n7) \"grape\"\n8) \"200\"\n</code></pre></li> </ul>"},{"location":"Database/2018-04-06-redis-database/#_1","title":"\u5f15\u7528","text":"<p>\u53c2\u8003\u94fe\u63a51 \u53c2\u8003\u94fe\u63a52 </p>"},{"location":"Devops/2018-11-21-gitusage-devops/","title":"git handbook","text":"<ul> <li>Usage link</li> </ul> <p>Git patch</p> <pre><code>git branch A\ngit checkout A\ngit diff A B &gt; diff\n// Apply the difference to A\ngit apply diff\n</code></pre> <p>View current branch was created based which branch</p> <pre><code> git reflog --date=local | grep &lt;branch-name&gt;\n</code></pre> <p>Cherry pick</p> <pre><code>dd2e86 - 946992 - 9143a9 - a6fd86 - 5a6057 [master]\n           \\\n            76cada - 62ecb3 - b886a0 [feature]\n\ngit checkout master\ngit cherry-pick 62ecb3\n\n#That\u2019s all. 62ecb3 is now applied to the master branch and commited (as a new commit) in master.\n</code></pre> <p>\u4e00\u53f0\u7535\u8111\u914d\u7f6e\u591a\u4e2agit\u8d26\u6237</p> <pre><code># \u5982\u679c\u6267\u884cssh-add\u547d\u4ee4\u62a5\u9519\uff1a Could not open a connection to your authentication agent\nssh-agent bash\n\n# \u5220\u9664\u73b0\u5728\u7684agent\u5217\u8868\nssh-add -D\n\n# \u5411agent\u6dfb\u52a0\u8ba4\u8bc1\nssh-add id_rsa\n\n# \u67e5\u770bagent\u5217\u8868\nssh-add -l\n\n# \u6d4b\u8bd5\u8d26\u53f7\u662f\u5426\u8fde\u63a5\u5230\u4ed3\u5e93\nssh -T git@github.com\n\n# \u67e5\u770b\u73b0\u5728\u7684remote\u4fe1\u606f\ngit remote -v\n\ngit@github.com:Evliess/evliess.github.io.git\n# \u5220\u9664\u73b0\u5728\u7684remote\u4fe1\u606f\ngit remote rm origin\n\n# \u518d\u6b21\u6dfb\u52a0remote\u4fe1\u606f\uff0c\u5c06hostName\u66ff\u6362\u4e3a.ssh/config\u4e2d\u5bf9\u5e94\u7684\u503c\ngit remote add origin git@jiajia126.github.com:Evliess/evliess.github.io.git\n\n\n# config template\n\n#### start #### \n## Host\u7684\u540d\u5b57\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\n\n#jiajia_yuwei@126.com\nHost jiajia126.github.com\nHostName github.com\nUser jiajia_yuwei@126.com\nIdentityFile C:\\\\Users\\\\JiaJiaGui\\\\.ssh\\\\jiajia126\n\n#jiajia_yuwei@126.com - github.com\nHost github.com\nHostName github.com\nUser jiajia_yuwei@126.com\nIdentityFile C:\\\\Users\\\\JiaJiaGui\\\\.ssh\\\\id_rsa\n\n#### end #### \n</code></pre> <p>Git proxy setting</p> <pre><code># \u8bbe\u7f6ess\ngit config --global http.proxy 'socks5://127.0.0.1:1080'\n\ngit config --global https.proxy 'socks5://127.0.0.1:1080'\n\n# \u8bbe\u7f6e\u4ee3\u7406\ngit config --global https.proxy http://127.0.0.1:1080\n\ngit config --global https.proxy https://127.0.0.1:1080\n\n# \u53d6\u6d88\u4ee3\u7406\ngit config --global --unset http.proxy\ngit config --global --unset https.proxy\n</code></pre> <p>git \u6bd4\u8f83\u672c\u5730\u4fee\u6539\u7684\u6587\u4ef6\u4e0emaster\u5dee\u5f02</p> <pre><code>git diff --cached file\ngit diff --staged file\n</code></pre> <p>git \u64a4\u9500\u672apush\u7684commit</p> <pre><code>git log\n\n# \u5b8c\u6210\u64a4\u9500, \u540c\u65f6\u5c06\u4ee3\u7801\u6062\u590d\u5230\u524d\u4e00\u4e2acommit_id \u5bf9\u5e94\u7684\u7248\u672c\ngit reset --hard commit_id\n\n# \u5b8c\u6210Commit\u547d\u4ee4\u7684\u64a4\u9500\uff0c\u4f46\u662f\u4e0d\u5bf9\u4ee3\u7801\u4fee\u6539\u8fdb\u884c\u64a4\u9500\ngit reset commit_id\n</code></pre> <p>Migrate reposityA to reposityB</p> <pre><code>git clone --bare reposityA\ngit remote rm origin &lt;!--optional --&gt;\ngit remote add origin reposityB\ngit push --mirror origin\n</code></pre> <p>Git revert </p> <pre><code>git revert 47900454c18cca36f66f7832fbb1617797b52708\ngit commit\n</code></pre> <p>Switch branch</p> <pre><code>git branch branch-name\n</code></pre> <p>Create branch from commit</p> <pre><code>git branch branchName &lt;sha1-of-commit&gt;\nor\ngit checkout -b branchName &lt;sha1-of-commit&gt;\n</code></pre> <p>Create branch from tag</p> <pre><code>git tag v1.0\ngit checkout -b branch1 v1.0   &lt;!-- branchName:branch1 tagName:v1.0 --&gt;\ngit push origin branch1\n</code></pre> <p>Replace the master branch with another branch</p> <pre><code>git checkout another_branch\ngit merge -s ours --no-commit master\ngit commit\ngit checkout master\ngit merge another_branch\ngit push origin master\n</code></pre> <p>Jenkins + Ant + Java8 ant version 1.10.X \u5426\u5219\u4f1a\u51fa\u73b0javac1.8 error \u6216\u8005 ant script\u627e\u4e0d\u5230\u7cfb\u7edf\u914d\u7f6e\u7684java_home  </p> <p>Generate ssh-key - C:\\Users\\XXX.ssh\\id_rsa.pub</p> <pre><code>ssh-keygen -t rsa -b 4096 -C \"your_email@example.com\" \ngit add \ngit commit -m \"comment\"\ngit pull\ngit push origin master \n</code></pre>"},{"location":"Devops/2019-09-20-docker-jenkins-devops/","title":"How to config jenkins using host JDK and Maven","text":"<p>1. Download jenkins image  </p> <p><pre><code>docker pull jenkins/jenkins:lts\n</code></pre> 2. Custom dockerfile</p> <p><pre><code>FROM jenkins/jenkins:lts\n# if we want to install via apt\nUSER root\nRUN apt-get update &amp;&amp; apt-get install -y openjdk-8-jdk maven make &amp;&amp; rm -rf /var/lib/apt/lists/*\n# drop back to the regular jenkins user - good practice\nUSER jenkins\n</code></pre> 3. Build a new image</p> <p><pre><code>docker build -t waitplay/jenkins:lst .\n</code></pre> 4. Start a contain to run jenkins</p> <p><pre><code>docker run -u root -d -p 8080:8080 -p 50000:50000 -v $(which kubectl):/usr/bin/kubectl -v $(which oc):/usr/bin/oc -v /var/jenkins_home:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -v $(which docker):/usr/bin/docker -v /etc/localtime:/etc/localtime -v $(which docker-compose):/usr/local/bin/docker-compose -e JAVA_OPTS=-Duser.timezone=Asia/Shanghai --name jenkins waitplay/jenkins:latest\n</code></pre> 5. Download jdk-8u221-linux-x64.tar.gz . Download maven</p> <p>6. unzip</p> <p><pre><code>mkdir -p /var/jenkins_home/globalEnvi\nchown -R 1000:1000 jenkins_home\n\ncd /var/jenkins_home/globalEnvi\ntar -zxvf jdk-8u221-linux-x64.tar.gz\ntar -zxvf apache-maven-3.6.2-bin.tar.gz\n</code></pre> 7. Set Jenkins -&gt; configuration -&gt; add Environment variables</p> <p><pre><code>JAVA_HOME=/var/jenkins_home/globalEnvi/jdk1.8.0_221\nCLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH\nM2_HOME=/var/jenkins_home/globalEnvi/apache-maven-3.6.2\nPATH=$JAVA_HOME/bin:$PATH\n</code></pre> 8. Global Tool Configuration</p> <ul> <li>Maven Configuration   xxx/conf/setting.xml</li> <li>JDK</li> <li>MAVEN</li> </ul> <p>9. Test shell script</p> <pre><code>java -version\nmvn -version\ndocker -v\n</code></pre>"},{"location":"Devops/2019-12-12-nginx-proxy-dockerapi/","title":"How to reverse proxy docker api with nginx","text":"<p>1. Vi openssl.cnf <pre><code>[ v3_ca ]\nbasicConstraints = CA:true\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid\n</code></pre></p> <p>2. Generate certification <pre><code>[openssl](https://www.cnblogs.com/lsdb/p/9391979.html)\n#CA\u8bc1\u4e66\u53ca\u5bc6\u94a5\u751f\u6210\u65b9\u6cd5\u4e00----\u76f4\u63a5\u751f\u6210CA\u5bc6\u94a5\u53ca\u5176\u81ea\u7b7e\u540d\u8bc1\u4e66\nopenssl req -newkey rsa:2048 -nodes -keyout ca-key.pem -x509 -days 365 -out ca.pem -subj \"/C=ch/ST=ch/L=ch/O=ch/OU=ch/CN=0.0.0.1/emailAddress=test@test.com\"\n\n#\u670d\u52a1\u5668\u8bc1\u4e66\u53ca\u5bc6\u94a5\u751f\u6210\u65b9\u6cd5\u4e00----\u76f4\u63a5\u751f\u6210\u670d\u52a1\u5668\u5bc6\u94a5\u53ca\u5f85\u7b7e\u540d\u8bc1\u4e66\nopenssl req -newkey rsa:2048 -nodes -keyout server-key.pem  -out server.csr -subj \"/C=ch/ST=ch/L=ch/O=ch/OU=ch/CN=0.0.0.1/emailAddress=test@test.com\"\n#\u4f7f\u7528CA\u8bc1\u4e66\u53ca\u5bc6\u94a5\u5bf9\u670d\u52a1\u5668\u8bc1\u4e66\u8fdb\u884c\u7b7e\u540d\uff1a\nopenssl x509 -req -days 365 -in server.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out server-cert.pem -extfile ./openssl.cnf -extensions v3_ca\n\n#\u5ba2\u6237\u7aef\u8bc1\u4e66\u53ca\u5bc6\u94a5\u751f\u6210\u65b9\u6cd5\u4e00----\u76f4\u63a5\u751f\u6210\u5ba2\u6237\u7aef\u5bc6\u94a5\u53ca\u5f85\u7b7e\u540d\u8bc1\u4e66\nopenssl req -newkey rsa:2048 -nodes -keyout client-key.pem -out client.csr -subj \"/C=ch/ST=ch/L=ch/O=ch/OU=ch/CN=0.0.0.1/emailAddress=test@test.com\"\n#\u4f7f\u7528CA\u8bc1\u4e66\u53ca\u5bc6\u94a5\u5bf9\u5ba2\u6237\u7aef\u8bc1\u4e66\u8fdb\u884c\u7b7e\u540d\nopenssl x509 -req -days 365 -in client.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out client-cert.pem -extfile ./openssl.cnf -extensions v3_ca\n</code></pre></p> <p>3. Verify vertification  <pre><code>openssl x509 -in client-cert.pem -noout -purpose | grep SSL\nopenssl x509 -in server-cert.pem -noout -purpose | grep SSL\n</code></pre></p> <p>4. vi ssl.conf for nginx <pre><code>upstream docker-ssl {\n  server unix:/var/run/docker.sock fail_timeout=0;\n}\nserver {\n    listen      443 ssl;\n    server_name   localhost;\n    ssl_certificate         /etc/nginx/certs/server-cert.pem;\n    ssl_certificate_key     /etc/nginx/certs/server-key.pem;\n    ssl_client_certificate  /etc/nginx/certs/ca.pem;\n    ssl_verify_client              on;\n#   ssl_verify_depth 3;\n\n   location / {\n      proxy_pass                 http://docker-ssl;\n      proxy_redirect             off;\n\n      proxy_set_header           Host             $host;\n      proxy_set_header           X-Real-IP        $remote_addr;\n      proxy_set_header           X-Forwarded-For  $proxy_add_x_forwarded_for;\n\n      client_max_body_size       10m;\n      client_body_buffer_size    128k;\n\n      proxy_connect_timeout      90;\n      proxy_send_timeout         120;\n      proxy_read_timeout         120;\n\n      proxy_buffer_size          4k;\n      proxy_buffers              4 32k;\n      proxy_busy_buffers_size    64k;\n      proxy_temp_file_write_size 64k;\n   }\n}\n</code></pre></p> <p>5. Vi dockerfile <pre><code>FROM nginx\nVOLUME [\"/var/run\", \"/etc/nginx/certs\"]\n</code></pre></p> <p>6. Build image <pre><code>docker rmi -f docker-api-nginx\ndocker build -t docker-api-nginx .\n</code></pre></p> <p>7. Run with docker <pre><code>docker run --rm --name docker-api-nginx -d -p 7443:443 -p 4080:80 \\\n-v /var/run/docker.sock:/var/run/docker.sock \\\n-v /root/nginx-ca/ssl.conf:/etc/nginx/conf.d/ssl.conf \\\n-v /root/nginx-ca/certs:/etc/nginx/certs docker-api-nginx\n</code></pre></p> <p>8. Used scripts <pre><code>nginx -t -c /etc/nginx/nginx.conf\nsudo systemctl restart nginx\ntail /var/log/nginx/error.log \nusermod -a -G www-data,docker $USER\ndocker rmi -f docker-api-nginx\n</code></pre></p>"},{"location":"Devops/2019-12-12-nginx-proxy-dockerapi/#references","title":"References","text":"<p>Protect the Docker daemon socket</p>"},{"location":"Devops/2020-05-01-solve-problems/","title":"How to solve problems","text":""},{"location":"Devops/2020-05-01-solve-problems/#personas","title":"Personas","text":"<ol> <li>Identifying the right problem to slove is the single most important factor for success.</li> <li>Identifying the right problem to slove for your users is finding your team's intent.</li> <li>Focus the outcomes and the experience you want the user to have.</li> </ol> <p>Key Takeaways:</p> <ol> <li>We use personas to help us design for the user's wants and needs. </li> <li>Focus on outcomes and the experience you want the user to have.</li> <li>Dive into the user's world.</li> <li>Identify User Types based on market research.</li> <li>Create Personas for the most common User Type.</li> <li>Focus on the Persona's wants and needs, and build empathy</li> <li>Encourage all team members to contribute ideas to Persona development.</li> <li>Use simple term / words to describe persona dimensions</li> <li>Make your personas realistic!</li> </ol>"},{"location":"Devops/2020-05-01-solve-problems/#empathy-maps-diving-into-the-users-world","title":"Empathy Maps - Diving into the User's World","text":"<p>Key Takeaways:</p> <ol> <li>Get inside the head and heart of the Persona to understand their concerns, and what's important to them.</li> <li>The quadrants of the Empathy Map are \"Says, Thinks, Feels and Does\".</li> <li>Feels identifies emotions. Thinks is what goes on in someone's mind.</li> <li>A Persona may say something, but think something else.</li> <li>When doing an Emapthy Map, remember quantity over quality.</li> <li>Quantities of information help you identify opportunities to create delight or remove friction\uff08\u6469\u64e6\uff09 for the Persona.</li> <li>Diverge to contribute lots of ideas individually, and then coverage to discuss and group similiar ideas into themes.</li> <li>When diverging. write. don't speak! Every idea counts!</li> </ol>"},{"location":"Devops/2020-05-01-solve-problems/#as-is-scenario","title":"As-Is Scenario","text":"<p>Key Takeaways:</p> <ol> <li>The As-Is Scenario logically follows the Empathy Maps</li> <li>When mapping the As-Is steps, focus on the broader view of the experience</li> <li>Teams will typically work through serval As-Is Scenarios</li> <li>Focus on The persona pain points when identifying the steps taken in their current experience.</li> <li>There are three dimensions used for As-Is scenario mapping (Doing, Thinking, Feeling)</li> <li>Diverge to map out ideas the current experience, then coverage to identify key themes and opportunities</li> <li>Use the As-Is scenario map to create delightful future experiences.</li> </ol>"},{"location":"Devops/2020-05-01-solve-problems/#brainstorming-ideas","title":"Brainstorming Ideas","text":"<p>Key Takeaways:</p> <ol> <li>The As-Is Scenario uncovered pain points and opportunities as input for unique ways to create a better experience.</li> <li>Resist the urge to get into solutioning during the Ideaation exercise. Ideation is really about imaging what new outcomes are possible for your Persona.</li> <li>Absurd ideas help lead team towards the realization of brilliant ideas</li> <li>When Ideating, think about the current experience in terms of other industries, and from personal experience.</li> </ol> <p>General tips when Ideating: - Build on the ideas of others - Use the \"Yes, AND ...\" technique (don't judge ideas) - Encourage wild ideas (haveeach team member offer at least one ABSURD idea) - Review ideas later - Stay on topic - Be visual - Quantity over quality</p>"},{"location":"Devops/2020-05-01-solve-problems/#hills","title":"Hills","text":"<p>Key Takeaways:</p> <ul> <li>Hills statements always contain a WHO, a WHAT, and a WOW</li> <li>Teams should come up with no more than three Hills per project goal.</li> <li>Aothough defining them may more complex. Hills statements should end up being very simple</li> <li>Understanding the project goal will allow teams to align to a single vision and to make the appropariate vhoices when defining the future experience.</li> <li>Use the Persona's pain point help define the Hills.</li> <li>Resist the urge to get into solutioning while crafting Hills.</li> <li>Focus on the outcomes of the user's experience. What is the problem the team is trying to solve?</li> <li>Hills are focused on where do we want to go? versus(\u4e0e\u4e4b\u76f8\u5bf9) ... how are we going to get there?</li> </ul>"},{"location":"Devops/2020-05-01-solve-problems/#playbacks","title":"Playbacks","text":"<p>Key Takeaways:</p> <ul> <li>Align your team, stakeholders and clients around the user value you will deliver </li> <li>Get real! Show your design intention. Make it a concrete(\u5177\u4f53\u7684) representation. for example, exptessed as a Persona, the Hills, a storyboard, or a wireframe Being concrete helps avoid misinterpretation(\u8bef\u89e3), and leads to more effective feedback.</li> <li>Make it compelling. Use compelling stories to draw attention and gain feedback. Stories that are easy to remember leads to long term alignment.</li> </ul>"},{"location":"Devops/2020-05-01-solve-problems/#prototypes","title":"Prototypes","text":"<p>Key Takeaways:</p> <ul> <li> <p>When starting with Prototypes:</p> <ul> <li>Tell a stroy</li> <li>Show how the future experience can happen</li> <li>Don't worry about the technical side yet</li> <li>Do a playback with sponsor users and technical stakeholders</li> </ul> </li> <li> <p>The goal of Prototyping is to elicit(\u5f15\u51fa) feedback(technical, usability, and business etc.)</p> </li> <li>When sketching a Prototype, avoid getting to detailed. Keep the WOW front and center</li> <li>Teams should share their sketches to iterate and refine their initial Prototypes</li> </ul>"},{"location":"Devops/2020-05-01-solve-problems/#to-be-scenario","title":"To-Be Scenario","text":"<p>Key Takeaways:</p> <ul> <li>To map the To_Be Scenario experience, teams will walk through the same process (i.e mapping the Doing, Thinking, and Felling steps) as was done in the As-Is Scenario</li> <li>COntinue empathizing with the Persona as you work through the To-Be Scenario steps</li> <li>As you work through the To-Be steps, you should see more of the pain points and concerns that your Persona expericenced in the As-Is Scenario change, to become experiences of excitement and the Wow factor</li> <li>One reason for conducting the To-Be Scenario map is to refine the experience to make it even better</li> <li>If points of friction arise during the To-Be Scenario mapping exercise, continue empathizing wirh the Persona to achieve a more delightful outcome</li> <li> <p>When in doubt about ant step in the To-Be Scenario, do more research.</p> </li> <li> <p>Use your understanding of a Persona\u2019s current state (i.e. pain points and opportunities) to create a To-Be Scenario map</p> </li> <li>Use a To-Be Scenario map to refine a new experience ( or concept) and address any points of friction in the To-Be Scenario map</li> <li>Implement techniques to ensure the Wow factor is included in the new experience</li> </ul>"},{"location":"Devops/2020-05-01-solve-problems/#sponsor-users","title":"Sponsor Users","text":"<p>Key Takeaways:</p> <ul> <li>Sponsor Users are users or potential(\u6f5c\u5728\u7684) users who have experience in the domain required by your design team</li> <li>When discussing early stage prototypes with Sponsor Users, design teams may hear signs of recognition and deligh from the Sponsor User. This means their new game day experience design is likely to create a delightful experience for the Persona, but there is still need to playback often and gather more user research, especially as Prototypes become more high-level</li> <li>All ideas from Sponsor Users are valid, given their likeness to the Persona!</li> <li>You should probe(\u63a2\u6d4b) for more details whrn a Sponsor User shares ideas and particulary if any issue arise with the new design</li> <li>Use a low-fidelity prototype to walk through in detail with a Sponsor User</li> <li>Use techniques to identify signs of delight and recognition from Sponsor Users -Use techniques to probe for more prototype feedback from a Sponsor User</li> </ul>"},{"location":"Devops/2023-09-05-tekton/","title":"Tekton usage","text":""},{"location":"Devops/2023-09-05-tekton/#install","title":"Install","text":"<pre><code>#required\ncurl -k https://raw.githubusercontent.com/drriguz/knative-dockerhub-mirror/master/output/tektoncd-pipeline-v0.47.3-release.yaml -o tektoncd-pipeline-v0.47.3-release.yaml\ncurl -k https://raw.githubusercontent.com/drriguz/knative-dockerhub-mirror/master/output/tektoncd-dashboard-v0.37.0-release.yaml -o tektoncd-dashboard-v0.37.0-release.yaml\n\n# triggers\ncurl -k https://raw.githubusercontent.com/drriguz/knative-dockerhub-mirror/master/output/tektoncd-triggers-v0.24.1-release.yaml -o tektoncd-triggers-v0.24.1-release.yaml\ncurl -k https://raw.githubusercontent.com/drriguz/knative-dockerhub-mirror/master/output/tektoncd-triggers-v0.24.1-interceptors.yaml -o tektoncd-triggers-v0.24.1-interceptors.yaml\n\n\nkubectl apply -f tektoncd-pipeline-v0.47.3-release.yaml\nkubectl apply -f tektoncd-dashboard-v0.37.0-release.yaml\nkubectl apply -f tektoncd-triggers-v0.24.1-release.yaml\nkubectl apply -f tektoncd-triggers-v0.24.1-interceptors.yaml\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#minikube-enable-dashboard","title":"Minikube enable dashboard","text":"<pre><code># minikube dashboard --url &amp;\n\nkubectl proxy --port=8001 --address='0.0.0.0' --accept-hosts='^.*' &amp;\nhttp://192.168.0.222:8001/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/customresourcedefinition?namespace=_all\n\n#unset kubectl proxy\nps -ef | grep kubectl\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#tekton-dashboard","title":"Tekton dashboard","text":"<pre><code>http://192.168.0.222:8001/api/v1/namespaces/tekton-pipelines/services/tekton-dashboard:http/proxy/ \n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#create-a-task-git-clone","title":"create a task -- git clone","text":"<pre><code>apiVersion: tekton.dev/v1beta1\nkind: Task\nmetadata:\n  name: git-clone\nspec:\n  workspaces:\n  - name: output\n    description: The git repo will be cloned onto the volume backing this workspace\n  params:\n  - name: repo-url\n    description: git url to clone\n    type: string\n    default: git@github.com:Evliess/image-syncer.git\n  - name: revision\n    description: git revision to checkout (branch, tag, sha, ref\ufffd)\n    type: string\n    default: master\n  - name: submodules\n    description: defines if the resource should initialize and fetch the submodules\n    type: string\n    default: \"true\"\n  - name: depth\n    description: performs a shallow clone where only the most recent commit(s) will be fetched\n    type: string\n    default: \"1\"\n  - name: subdirectory\n    description: subdirectory inside the \"output\" workspace to clone the git repo into\n    type: string\n    default: \"src\"\n  - name: deleteExisting\n    description: clean out the contents of the repo's destination directory (if it already exists) before trying to clone the repo there\n    type: string\n    default: \"false\"\n  results:\n  - name: commit\n    description: The precise commit SHA that was fetched by this Task\n  steps:\n  - name: clone\n    image: gcr.io/tekton-releases/github.com/tektoncd/pipeline/cmd/git-init:latest\n    script: |\n      CHECKOUT_DIR=\"$(workspaces.output.path)/$(params.subdirectory)\"\n\n      cleandir() {\n        # Delete any existing contents of the repo directory if it exists.\n        #\n        # We don't just \"rm -rf $CHECKOUT_DIR\" because $CHECKOUT_DIR might be \"/\"\n        # or the root of a mounted volume.\n        if [[ -d \"$CHECKOUT_DIR\" ]] ; then\n          # Delete non-hidden files and directories\n          rm -rf \"$CHECKOUT_DIR\"/*\n          # Delete files and directories starting with . but excluding ..\n          rm -rf \"$CHECKOUT_DIR\"/.[!.]*\n          # Delete files and directories starting with .. plus any other character\n          rm -rf \"$CHECKOUT_DIR\"/..?*\n        fi\n      }\n\n      if [[ \"$(params.deleteExisting)\" == \"true\" ]] ; then\n        cleandir\n      fi\n\n      /ko-app/git-init \\\n        -url \"$(params.repo-url)\" \\\n        -revision \"$(params.revision)\" \\\n        -path \"$CHECKOUT_DIR\" \\\n        -depth=\"$(params.depth)\"\n      cd \"$CHECKOUT_DIR\"\n      RESULT_SHA=\"$(git rev-parse HEAD | tr -d '\\n')\"\n      EXIT_CODE=\"$?\"\n      if [ \"$EXIT_CODE\" != 0 ]\n      then\n        exit $EXIT_CODE\n      fi\n      # Make sure we don't add a trailing newline to the result!\n      echo -n \"$RESULT_SHA\" &gt; $(results.commit.path)\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#create-a-task-show-readme","title":"create a task  -- show-readme","text":"<pre><code>apiVersion: tekton.dev/v1beta1\nkind: Task\nmetadata:\n  name: show-readme\nspec:\n  description: Read and display README file.\n  workspaces:\n  - name: source\n  steps:\n  - name: read\n    image: alpine:latest\n    script: | \n      #!/usr/bin/env sh\n      cat $(workspaces.source.path)/README.md\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#create-a-pipeline","title":"create a pipeline","text":"<p>pipeline.yaml <pre><code>apiVersion: tekton.dev/v1beta1\nkind: Pipeline\nmetadata:\n  name: clone-read\nspec:\n  description: | \n    This pipeline clones a git repo, then echoes the README file to the stout.\n  params:\n  - name: repo-url\n    type: string\n    description: The git repo URL to clone from.\n  workspaces:\n  - name: shared-data\n    description: | \n      This workspace contains the cloned repo files, so they can be read by the\n      next task.\n  tasks:\n  - name: fetch-source\n    taskRef:\n      name: git-clone\n    workspaces:\n    - name: output\n      workspace: shared-data\n    params:\n    - name: url\n      value: $(params.repo-url)\n  - name: show-readme\n    runAfter: [\"fetch-source\"]\n    taskRef:\n      name: show-readme\n    workspaces:\n    - name: source\n      workspace: shared-data\n</code></pre></p>"},{"location":"Devops/2023-09-05-tekton/#create-a-git-clone-secret","title":"Create a git clone secret","text":"<pre><code>kind: Secret\napiVersion: v1\nmetadata:\n  name: my-ssh-credentials\ndata:\n  id_rsa: \n  known_hosts: # ... base64-encoded known_hosts file ...\n  config: # ... base64-encoded ssh config file ...\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#create-a-pipeline-run","title":"Create a pipeline run","text":"<pre><code>apiVersion: tekton.dev/v1beta1\nkind: PipelineRun\nmetadata:\n  generateName: clone-read-run-\nspec:\n  pipelineRef:\n    name: clone-read\n  podTemplate:\n    securityContext:\n      fsGroup: 65532\n  workspaces:\n  - name: shared-data\n    volumeClaimTemplate:\n      spec:\n        accessModes:\n        - ReadWriteOnce\n        resources:\n          requests:\n            storage: 100Mi\n  - name: ssh-creds\n    secret:\n      secretName: my-ssh-credentials\n  params:\n  - name: repo-url\n    value: https://github.com/Evliess/image-syncer.git\n</code></pre>"},{"location":"Devops/2023-09-05-tekton/#references","title":"References","text":"<ul> <li>knative-dockerhub-mirror</li> <li>https://mp.weixin.qq.com/s/0STtKrlgYqpoqwMgb0QnoA</li> <li>https://developer.ibm.com/tutorials/build-and-deploy-a-docker-image-on-kubernetes-using-tekton-pipelines/</li> <li>https://github.com/drriguz/knative-dockerhub-mirror/blob/master/releases.txt</li> <li>https://zhuanlan.zhihu.com/p/562869904</li> </ul>"},{"location":"Devops/2025-09-12-github/","title":"GitHub Actions","text":""},{"location":"Devops/2025-09-12-github/#1","title":"1. \u5728\u4e91\u670d\u52a1\u5668\u4e0a\u751f\u6210\u516c\u94a5\u4e0e\u79c1\u94a5","text":"<pre><code>ssh-keygen -t rsa -f ./vmsshkey -P ''\ncat vmsshkey.pub &gt;&gt; ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/authorized_keys\n</code></pre>"},{"location":"Devops/2025-09-12-github/#2-github-secret","title":"2. \u5c06\u79c1\u94a5\u6587\u4ef6\u6dfb\u52a0\u5230Github\u7684 Secret \u4e2d","text":""},{"location":"Devops/2025-09-12-github/#3-wrokflow","title":"3. \u521b\u5efa\u4e00\u4e2awrokflow","text":"<pre><code>name: Run Long-Running Docker Container\n\non:\n  workflow_dispatch: # \u5141\u8bb8\u624b\u52a8\u89e6\u53d1\n  push:\n    branches: [ main ]\n  pull_request:\n    branches: [ main ]\n\n# \u8bbe\u7f6e\u6574\u4e2a\u5de5\u4f5c\u6d41\u7684\u8d85\u65f6\uff08\u53ef\u9009\uff0c\u4f46\u5efa\u8bae\uff09\n# \u5b83\u5e94\u8be5\u5927\u4e8e job \u7684\u8d85\u65f6\u65f6\u95f4\n\njobs:\n  run-docker-long-job:\n    # \u6307\u5b9a\u8fd0\u884c\u73af\u5883\uff08\u6839\u636e\u60c5\u51b5\u9009\u62e9\uff09\n    runs-on: ubuntu-latest # \u4f7f\u7528 GitHub \u6258\u7ba1\u7684 Ubuntu \u8fd0\u884c\u5668\n    # runs-on: self-hosted # \u5982\u679c\u4f7f\u7528\u81ea\u6258\u7ba1\u8fd0\u884c\u5668\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6807\u7b7e\n\n    # \u4e3a\u8fd9\u4e2a job \u8bbe\u7f6e 250 \u5206\u949f\uff084\u5c0f\u65f610\u5206\u949f\uff09\u7684\u8d85\u65f6\n    timeout-minutes: 250\n\n    steps:\n      - name: Run long-running Docker container\n        run: |\n          ssh-keygen  -t rsa -f ./newsshkey -P ''\n          mkdir -p  ~/.ssh\n          cat newsshkey.pub &gt;&gt; ~/.ssh/authorized_keys\n          chmod 600 ~/.ssh/authorized_keys\n          ssh  -N -f -g -o ServerAliveInterval=60 -o \"StrictHostKeyChecking=no\" -o \"UserKnownHostsFile=/dev/null\" -i ./newsshkey -D 9999 localhost \n          echo \"${{ secrets.VM_SSH }}\" &gt; ./vmsshkey\n          chmod 400 ./vmsshkey\n          ssh -p 22 -i ./vmsshkey  -N -f -g -o ServerAliveInterval=60 -o \"StrictHostKeyChecking=no\" -o \"UserKnownHostsFile=/dev/null\" -R 9999:localhost:9999  &lt;user&gt;@&lt;IP&gt;\n          num=3600\n          for i in `seq $num`\n          do\n            echo $i\n            sleep 1\n          done\n          exit 0\n\n      - name: Setup tmate session\n        uses: mxschmitt/action-tmate@v3\n        # \u53ef\u4ee5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u907f\u514d\u5fd8\u8bb0\u65ad\u5f00\u8fde\u63a5\u5bfc\u81f4\u8d44\u6e90\u6d6a\u8d39\n        timeout-minutes: 15\n        with:\n            detached: true\n</code></pre>"},{"location":"Devops/2025-09-12-github/#4","title":"4. \u5728\u672c\u5730\u5f00\u542f\u7aef\u53e3\u8f6c\u53d1","text":"<pre><code>ssh -N -f -g -o ServerAliveInterval=60  -L 9999:localhost:9999 &lt;user&gt;@&lt;IP&gt;\n##\u53d6\u6d88\u8f6c\u53d1\nnetstat -ano | findstr :9999\ntaskkill /PID 12345 /F\n</code></pre>"},{"location":"Devops/2025-09-12-github/#github-workflow-secret","title":"\u521b\u5efa\u4e00\u4e2a\u7528\u4e8egithub workflow \u7684 secret","text":"<ol> <li>Personal profile -&gt; Settings</li> <li>Developer settings -&gt; Personal access tokens -&gt; Tokens(classic)</li> <li>Generate new token -&gt; Generate new token(classic)</li> <li>Checked 'repo' and 'workflow' </li> </ol>"},{"location":"Devops/2025-09-12-github/#references","title":"References","text":"<ul> <li>https://zhuanlan.zhihu.com/p/1907806046501729107</li> </ul>"},{"location":"Docker/2018-04-08-docker-compose-docker/","title":"1. Docker Compose Installation","text":"<p>Environment: Ubuntu 16.04.4 LTS  X86_64bit  </p>"},{"location":"Docker/2018-04-08-docker-compose-docker/#11-install-docker-compose","title":"1.1 Install docker-compose","text":"<ol> <li> <p>Download the latest version of Docker Compose: <pre><code>sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose\n</code></pre></p> </li> <li> <p>Apply executable permissions to the binary: <pre><code>sudo chmod +x /usr/local/bin/docker-compose\n</code></pre></p> </li> <li> <p>Install command completion: <pre><code>sudo curl -L https://raw.githubusercontent.com/docker/compose/1.21.2/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose\n</code></pre></p> </li> <li> <p>Test the installation: <pre><code>docker-compose --version\n</code></pre></p> </li> </ol>"},{"location":"Docker/2018-04-08-docker-compose-docker/#2-docker-compose-useful-command","title":"2. Docker Compose Useful Command","text":"<pre><code>//Starts the containers in the background and leaves them running\ndocker-compose up -d\n\n//Stops containers and removes containers, networks, volumes, and images created by up\ndocker-compose down\n\n//Stops running containers without removing them. They can be started again with docker-compose start\ndocker-compose stop\n\n//Starts existing containers for a service.\ndocker-compose start\n</code></pre>"},{"location":"Docker/2018-04-08-docker-compose-docker/#3-example-docker-compose-file","title":"3. Example Docker Compose File","text":"<p>3.1 Configure container network and ip</p> <pre><code>version: '3'\nservices:\n  eureka-server-1:\n    image: waitplay/eureka-server:latest\n    environment:\n      spring.profiles.active: srv1\n      eureka.client.serviceUrl.defaultZone: http://172.16.238.12:8762/eureka/\n      spring.application.name: Eureka-Server\n#preferIpAddress makes sure that Microservices register with their IP address and not with their host name. In a Docker environment host names are unfortunately not easily resolvable by other hosts. This problem is circumvented by the use of IP addresses.\n      eureka.instance.preferIpAddress: \"true\"\n      eureka.instance.hostname: eureka-server-1\n    ports:\n      - \"8761:8761\"\n    container_name: eureka-server-1\n    networks:\n      app_net:\n        ipv4_address: 172.16.238.11\n\n\n  networks:\n  app_net:\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n      - subnet: 172.16.238.0/24\n</code></pre>"},{"location":"Docker/2018-04-08-installation-docker/","title":"1. Docker Installation","text":"<p>Environment: Ubuntu 16.04.4 LTS  X86_64bit  </p>"},{"location":"Docker/2018-04-08-installation-docker/#11-install-docker-docker-compose","title":"1.1 Install docker, docker-compose","text":"<ol> <li> <p>First, add the GPG key for the official Docker repository to the system: <pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n</code></pre></p> </li> <li> <p>Add the Docker repository to APT sources: <pre><code>sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"\n</code></pre></p> </li> <li> <p>Next, update the package database with the Docker packages from the newly added repo: <pre><code>sudo apt-get update\n</code></pre></p> </li> <li> <p>Make sure you are about to install from the Docker repo instead of the default Ubuntu 16.04 repo: <pre><code>apt-cache policy docker-ce\n</code></pre></p> </li> <li> <p>Finally, install Docker: <pre><code>sudo apt-get install -y docker-ce\n</code></pre></p> </li> <li> <p>Check that it's running: <pre><code>sudo systemctl status docker\n</code></pre> Active: active (running) since Fri 2018-05-11 12:26:54 CST;</p> </li> <li> <p>Install docker-compose: <pre><code>sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose &amp;&amp; sudo chmod +x /usr/local/bin/docker-compose\n</code></pre></p> </li> </ol>"},{"location":"Docker/2018-04-08-installation-docker/#12-install-docker-machine-optional","title":"1.2 Install docker-machine (Optional)","text":"<ol> <li> <p>Install docker-machine: <pre><code>base=https://github.com/docker/machine/releases/download/v0.14.0 &amp;&amp;\ncurl -L $base/docker-machine-$(uname -s)-$(uname -m) &gt;/tmp/docker-machine &amp;&amp; sudo install /tmp/docker-machine /usr/local/bin/docker-machine\n</code></pre></p> </li> <li> <p>Install required linux headers <pre><code>sudo apt-get -y install gcc make linux-headers-$(uname -r) dkms\n</code></pre></p> </li> <li> <p>Add virtualbox repository and key <pre><code>wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -\nwget -q https://www.virtualbox.org/download/oracle_vbox.asc -O- | sudo apt-key add -\nsudo sh -c 'echo \"deb http://download.virtualbox.org/virtualbox/debian $(lsb_release -sc) contrib\" &gt;&gt; /etc/apt/sources.list'\n</code></pre></p> </li> <li> <p>Install virtual box <pre><code>sudo apt-get update\nsudo apt-get install virtualbox-5.2\n</code></pre></p> </li> <li> <p>Verify installation <pre><code>VBoxManage -v\n</code></pre></p> </li> <li> <p>Install virtualbox extension package <pre><code>curl -O http://download.virtualbox.org/virtualbox/5.2.4/Oracle_VM_VirtualBox_Extension_Pack-5.2.4-119785.vbox-extpack\nsudo VBoxManage extpack install Oracle_VM_VirtualBox_Extension_Pack-5.2.4-119785.vbox-extpack\n</code></pre></p> </li> <li> <p>VBoxManage list extpacks <pre><code>VBoxManage list extpacks\n</code></pre></p> </li> <li> <p>Uninstall virtualbox <pre><code>sudo apt-get remove --purge virtualbox \n</code></pre></p> </li> <li> <p>Uninstall virtualbox extension <pre><code>sudo VBoxManage extpack uninstall \"Oracle VM VirtualBox Extension Pack\"\nvboxmanage list extpacks\n</code></pre></p> </li> </ol> <p>Docker\u6280\u672f\u5165\u95e8\u4e0e\u5b9e\u8df5</p>"},{"location":"Docker/2018-05-23-storage-docker/","title":"Storage overview","text":"<p>Docker \u652f\u6301\u4e09\u79cd\u5f62\u5f0f\u7684mount\u7c7b\u578b\uff0c\u5206\u522b\u662f\uff1aVolumes, Bind mounts \u548c tmpfs.</p> <p></p> <p>\u7279\u522b\u7559\u610f: 1. \u5982\u679cmount\u4e00\u4e2a\u7a7a\u7684volume\u5230\u5bb9\u5668\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u6216\u8005\u6587\u4ef6\uff0c\u8fd9\u4e9b\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u5c06\u88ab\u540c\u6b65\u590d\u5236\u5230\u7a7a\u7684\u6570\u636e\u5377\u4e2d\u3002\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\u6307\u5b9a\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6570\u636e\u5377\uff0c\u4e00\u4e2a\u7a7a\u7684\u6570\u636e\u5377\u5efa\u4f1a\u88ab\u521b\u5efa\u3002 2. \u5982\u679cmount\u4e00\u4e2abind mount \u7c7b\u578b\u7684\u6570\u636e\u5377\u6216\u8005\u975e\u7a7a\u7684 volume \u5230\u5bb9\u5668\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u76ee\u5f55\u4e2d\u5df2\u7ecf\u5b58\u5728\u4e00\u4e9b\u6587\u4ef6\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6587\u4ef6\u5728\u6302\u8f7d\u5916\u90e8\u6570\u636e\u5377\u671f\u95f4\u5c06\u4e0d\u53ef\u89c1\uff0c\u4e5f\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u9664\u975e\u79fb\u9664\u6302\u8f7d\u7684\u6570\u636e\u5377\u3002</p>"},{"location":"Docker/2018-05-23-storage-docker/#volumes","title":"Volumes","text":"<p>Volumes \u5b58\u50a8\u5728\u5bbf\u4e3b\u673a\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u4e00\u5757\u533a\u57df\uff0c\u8fd9\u5757\u533a\u57df <code>(/var/lib/docker/volumes)</code>\u88abDocker\u7ba1\u7406\uff0c\u975eDocker\u7684\u8fdb\u7a0b\u4e0d\u80fd\u4fee\u6539\u8fd9\u5757\u533a\u57df\u3002\u5b98\u65b9\u63a8\u8350\u7684\u4e00\u79cd\u5b58\u50a8\u65b9\u5f0f\u3002 \u5178\u578b\u7684\u7528\u4f8b\uff1a - \u5728\u591a\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u6570\u636e - When the Docker host is not guaranteed to have a given directory or file structure. - \u8fdc\u7a0b\u5b58\u50a8\u5bb9\u5668\u7684\u6570\u636e\uff0c\u6bd4\u5982\u4e91\u63d0\u4f9b\u5546 - \u5907\u4efd\uff0c\u6062\u590d\uff0c\u8fc1\u79fb\u6570\u636e\u4ece\u4e00\u4e2aDocker\u4e3b\u673a\u5230\u53e6\u5916\u4e00\u4e2a\u4e3b\u673a</p>"},{"location":"Docker/2018-05-23-storage-docker/#bind-mounts","title":"Bind mounts","text":"<p>Bind mounts \u53ef\u4ee5\u5b58\u50a8\u5728\u5bbf\u4e3b\u673a\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u4efb\u4f55\u4f4d\u7f6e\u3002\u975eDocker\u7ebf\u7a0b\u53ef\u4ee5\u6216\u8005\u4efb\u610f\u4e00\u4e2aDocker \u5bb9\u5668\u53ef\u4ee5\u968f\u610f\u4fee\u6539\u3002\u4e00\u822c\u63a8\u8350\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u8fd9\u4e2dmount \u65b9\u5f0f\u3002 \u5178\u578b\u7684\u7528\u4f8b\uff1a - \u5bbf\u4e3b\u673a\u5668\u4e0e\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u914d\u7f6e\u6587\u4ef6 - \u5728\u5f00\u53d1\u73af\u5883\u5bbf\u4e3b\u673a\u5668\u4e0e\u5bb9\u5668\u5171\u4eabsource code\uff0c\u6216\u8005build artifacts - When the file or directory structure of the Docker host is guaranteed to be consistent with the bind mounts the containers require  </p> <pre><code>docker run -dt --name tomcat --mount type=bind,source=\"$(pwd)\"/app,target=/usr/local/tomcat/webapps/app -p 8080:8080 tomcat:7.0-alpine\n</code></pre>"},{"location":"Docker/2018-05-23-storage-docker/#tmpfs","title":"tmpfs","text":"<p>\u5b58\u50a8\u5728\u5bbf\u4e3b\u673a\u5668\u7684\u5185\u5b58\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5199\u5165\u5bbf\u4e3b\u7684\u6587\u4ef6\u7cfb\u7edf\u3002 \u5178\u578b\u7684\u7528\u4f8b\uff1a - \u57fa\u4e8e\u5b89\u5168\u8003\u8651\u6216\u8005\u6548\u7387\u7684\u56e0\u7d20\uff0c\u4e0d\u5e0c\u671b\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u5bbf\u4e3b\u673a\u5668\u6216\u8005\u5bb9\u5668\u4e2d  </p>"},{"location":"Docker/2018-05-23-storage-docker/#userful-commands","title":"Userful Commands","text":"<pre><code>//\u8fdb\u5165\u5bb9\u5668\u7684\u5185\u90e8\u67e5\u770b\u5bb9\u5668\ndocker exec -it &lt;container-name&gt; /bin/bash\n//\u5220\u9664\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684container\ndocker rm $(docker stop $(docker ps -aq))\n//\u6784\u5efa\u955c\u50cf\ndocker build -t &lt;image-name&gt; .\n//\u5220\u9664none\u533f\u540d\u955c\u50cf\ndocker rmi -f $(docker images | grep \"none\" | awk '{print$3}')\n//\u5220\u9664\u4ee5test\u5f00\u5934\u7684\u955c\u50cf\ndocker rmi -f $(docker images | grep \"^test\" | awk '{print$3}')\n//\u5220\u9664\u6240\u6709\u7684\u6570\u636e\u5377\ndocker volume prune\n//\u67e5\u770b\u5bb9\u5668\u7684log\ndocker logs -f -t YOUR_CONTAINER_NAME\n\n //Remove local unused volume\n docker volume prune -f\n\n\ndocker run -e PASSWORD=passw0rd123 -e METHOD=chacha20-ietf-poly1305 -p 9388:8388 -p 9388:8388/udp -d --rm --restart always --name fgw shadowsocks/shadowsocks-libev:latest\n</code></pre>"},{"location":"Docker/2021-11-14-docker-taraining/","title":"Docker Training","text":""},{"location":"Docker/2021-11-14-docker-taraining/#objectives","title":"Objectives","text":""},{"location":"Docker/2021-11-14-docker-taraining/#what-containers-are-and-their-benefits","title":"What containers are and their benefits","text":""},{"location":"Docker/2021-11-14-docker-taraining/#how-to-find-and-run-docker-containers-from-the-docker-hub","title":"How to find and run Docker containers from the Docker Hub","text":""},{"location":"Docker/2021-11-14-docker-taraining/#how-to-create-your-first-docker-container-and-understand-the-layering-and-union-file-system","title":"How to create your first Docker container and understand the layering and union file system","text":""},{"location":"Docker/2021-11-14-docker-taraining/#the-best-practices-when-developing-dockerfiles","title":"The best practices when developing Dockerfiles","text":""},{"location":"Docker/2021-11-14-docker-taraining/#how-to-solve-problems-of-orchestration-reconciliation-scaling-high-availability-and-service-discovery","title":"How to solve problems of orchestration: reconciliation, scaling, high availability, and service discovery","text":""},{"location":"Docker/2021-11-14-docker-taraining/#some-of-the-tools-that-can-help-you-run-highly-available-applications-in-production-such-as-the-ibm-container-service","title":"Some of the tools that can help you run highly available applications in production, such as the IBM Container service","text":""},{"location":"Docker/2021-11-14-docker-taraining/#prerequisites","title":"Prerequisites","text":"<p>You don't need to know anything about containers to take this course, and no extensive programming experience is required. However, you must know how to run command-line tools from your workstation.</p>"},{"location":"Docker/2021-11-14-docker-taraining/#course-labs","title":"Course labs","text":""},{"location":"Docker/2021-11-14-docker-taraining/#install-docker-or-use-play-with-docker","title":"Install Docker or use Play-With-Docker","text":""},{"location":"Docker/2021-11-14-docker-taraining/#install-docker","title":"Install Docker","text":"<ol> <li>Navigate to http://store.docker.com.</li> <li>Select Community Edition.</li> <li>Select the filters for your operating system or platform and install Docker.</li> </ol>"},{"location":"Docker/2021-11-14-docker-taraining/#play-with-docker","title":"Play-With-Docker","text":"<p>-- slide </p>"},{"location":"Docker/2021-11-14-docker-taraining/#what-are-containers","title":"What are Containers","text":"<ul> <li>A group of processes run in isolate</li> <li> <p>All processes MUST be able to run on the shared keenel</p> </li> <li> <p>Each container has it own set of 'namespaces' (isolate view)</p> </li> <li>PID - process ids</li> <li>USER - user and group IDs</li> <li>UTS - hostname and domain name</li> <li>NS - mount points</li> <li>NET - Network devices, stacks, ports</li> <li>IPC - inter-process communications, message queues</li> <li>cgroups - controls limits and monitoring of resources</li> </ul> <p>-- slide</p> <p>VM vs Container</p> <p></p> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#what-is-docker","title":"What is Docker","text":"<ul> <li>At its core, Docker is tooling to manage contains</li> <li>Simplified existing technology to enable it for the masses</li> <li>Ebable developers to use the containers for their application<ul> <li>Package dependencies with containers: \"build once, run anywhere\"</li> </ul> </li> </ul> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#what-containers-are-appealing-to-users","title":"What Containers are Appealing to Users","text":"<p>Containers are just a process (or a group of processes) running in isolation, which is achieved with Linux namespaces and control groups. Linux namespaces and control groups are features that are built into the Linux kernel. Other than the Linux kernel itself, there is nothing special about containers.</p> <ul> <li>No more \"Works on my machine\"</li> <li>Lightweight and fast</li> <li>Better resources utilization</li> <li>Can fit far more containers than VMs into a host</li> <li>Standard developer to operations interface</li> <li>Ecosystem and tooling</li> </ul> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#run-a-container","title":"Run a Container","text":"<p>Use the Docker CLI to run your first container.</p> <ol> <li>Open a terminal on your local computer and run this command:</li> </ol> <pre><code>docker run -t ubuntu top\n</code></pre> <p>You use the docker container run command to run a container with the Ubuntu image by using the top command. The -t flag allocates a pseudo-TTY, which you need for the top command to work correctly. The docker run command first starts a docker pull to download the Ubuntu image onto your host. After it is downloaded, it will start the container. </p> <p>top is a Linux utility that prints the processes on a system and orders them by resource consumption. Notice that there is only a single process in this output: it is the top process itself. You don't see other processes from the host in this list because of the PID namespace isolation.</p> <p>Containers use Linux namespaces to provide isolation of system resources from other containers or the host. The PID namespace provides isolation for process IDs. If you run top while inside the container, you will notice that it shows the processes within the PID namespace of the container, which is much different than what you can see if you ran top on the host.</p> <p>Even though we are using the Ubuntu image, it is important to note that the container does not have its own kernel. It uses the kernel of the host and the Ubuntu image is used only to provide the file system and tools available on an Ubuntu system.</p> <ol> <li>Inspect the container:</li> </ol> <pre><code>docker ps \ndocker exec -it &lt;container_id&gt; bash\n\nps -ef\n</code></pre> <p>PID is just one of the Linux namespaces that provides containers with isolation to system resources. Other Linux namespaces include:</p> <p>MNT: Mount and unmount directories without affecting other namespaces. NET: Containers have their own network stack. IPC: Isolated interprocess communication mechanisms such as message queues. User: Isolated view of users on the system. UTC: Set hostname and domain name per container. These namespaces provide the isolation for containers that allow them to run together securely and without conflict with other containers running on the same system.</p> <p>-- slide</p> <ol> <li>Run an NGINX server by using the official NGINX image from the Docker Store:</li> </ol> <p><pre><code>docker run --detach --publish 8080:80 --name nginx nginx\n\ndocker run -d -p 8080:80 --name nginx nginx\n</code></pre> Tip:  The --detach flag will run this container in the background, Specifying your own name makes it easier to run subsequent commands on your container because you can reference the name instead of the id of the container</p> <ol> <li>Access the NGINX server on http://localhost:8080.</li> <li>Run a MongoDB server. </li> </ol> <pre><code>docker run -d -p 8081:27017 --name mongo mongo:3.4\n</code></pre> <ol> <li> <p>Access http://localhost:8081 to see some output from Mongo.</p> </li> <li> <p>Check your running containers:</p> </li> </ol> <pre><code>ps \n</code></pre> <p>--slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#remove-containers","title":"Remove containers","text":"<pre><code>docker stop &lt;container_id/container_name&gt;\ndocker rm &lt;container_id/container_name&gt;\n\ndocker volume prune -f\ndocker network prune -f\ndocker system prune -f\n</code></pre> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#docker-registry","title":"Docker Registry","text":"<ul> <li>Push and pull images from registry</li> <li>Default registry: Docker hub</li> <li>Public and free for public images</li> <li>Many pre-packaged images available</li> <li>Private registry</li> <li>Self-host or cloud provider options</li> </ul> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#creating-a-docker-image-with-docker-build","title":"Creating a Docker image - with Docker build","text":"<ul> <li>Create a \"Dockerfile\"</li> <li> <p>List of instructions for how to construct the container</p> </li> <li> <p>Build a image from a Docker file</p> </li> </ul> <pre><code>docker build -f &lt;docker_file&gt;\n</code></pre> <ul> <li>cat Dockerfile</li> </ul> <pre><code>FROM ubuntu\nADD myapp /\nEXPOSE 80\nENTRYPOINT /myapp\n</code></pre> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#docker-image-layers","title":"Docker image layers","text":"<ul> <li>union file system</li> <li>Merge image layers into single file system for each container</li> <li>copy-on-write</li> <li> <p>copies files that are edited up to top writable layer</p> </li> <li> <p>advantages</p> </li> <li>More containers per host(save $$ on infrastructure)</li> <li>Faster start-up/download time - base layers are cached</li> </ul> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#create-a-python-app-without-using-docker","title":"Create a Python app (without using Docker)","text":"<ol> <li>Write the python app <pre><code>cat &gt; app.py &lt;&lt;-EOF\nfrom flask import Flask\napp = Flask(__name__)\n@app.route(\"/\")\ndef hello():\n    return \"hello world!\"\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\")\nEOF\n</code></pre></li> </ol> <p>Tip: This is a simple Python app that uses Flask to expose an HTTP web server on port 5000.</p> <ol> <li>Create the docker image from a Docker file</li> </ol> <pre><code>cat &gt; Dockerfile &lt;&lt;-EOF\n&gt; FROM python:3.6.1-alpine\n&gt; RUN pip install flask\n&gt; CMD [\"python\",\"app.py\"]\n&gt; COPY app.py /app.py\n&gt; EOF\n</code></pre> <ol> <li>Build the Docker image. Pass in the -t parameter to name your image python-hello-world.</li> </ol> <pre><code>docker build -t python-hello-world .\n</code></pre> <ol> <li>Verify that your image shows in your image list:</li> </ol> <pre><code>docker image ls\n</code></pre> <ol> <li>Run the Docker image</li> </ol> <pre><code>docker run -p 5001:5000 -d python-hello-world\n</code></pre> <ol> <li> <p>Navigate to http://localhost:5001 in a browser to see the results.</p> </li> <li> <p>Check the log output of the container.</p> </li> </ol> <pre><code>docker logs &lt;container_id&gt;\n</code></pre> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#push-to-a-centry-registry","title":"Push to a centry registry","text":"<ol> <li>Log in to the Docker registry account by entering docker login on your terminal:</li> </ol> <pre><code>docker login\n</code></pre> <ol> <li>Tag the image with your username.</li> </ol> <pre><code>docker tag python-hello-world [dockerhub username]/python-hello-world\n</code></pre> <ol> <li>After you properly tag the image, use the docker push command to push your image to the registry:</li> </ol> <pre><code>docker push &lt;image_name:tag&gt;\n</code></pre> <p>--slide </p>"},{"location":"Docker/2021-11-14-docker-taraining/#deploy-a-change","title":"Deploy a change","text":"<ol> <li>Update the python app</li> </ol> <pre><code>cat &gt; app.py &lt;&lt;-EOF\nfrom flask import Flask\napp = Flask(__name__)\n@app.route(\"/\")\ndef hello():\n    return \"hello Python world!\"\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\")\nEOF\n</code></pre> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#understand-image-layers","title":"Understand image layers","text":"<p>Each of these lines is a layer. Each layer contains only the delta, or changes from the layers before it. To put these layers together into a single running container, Docker uses the union file system to overlay layers transparently into a single view.</p> <p>Each layer of the image is read-only except for the top layer, which is created for the container. The read/write container layer implements \"copy-on-write,\" which means that files that are stored in lower image layers are pulled up to the read/write container layer only when edits are being made to those files. Those changes are then stored in the container layer.</p> <p>The \"copy-on-write\" function is very fast and in almost all cases, does not have a noticeable effect on performance. You can inspect which files have been pulled up to the container level with the docker diff command. For more information, see the command-line reference on the docker diff command.</p> <p>Because image layers are read-only, they can be shared by images and by running containers.</p> <p>To look more closely at layers, you can use the docker image history command of the Python image you created.</p> <pre><code>docker diff &lt;container_id/container_name&gt;\ndocker image history python-hello-world\n</code></pre> <p>-- slide</p> <ul> <li>Use the Dockerfile to create reproducible builds for your application and to integrate your application with Docker into the CI/CD pipeline.</li> <li>Docker images can be made available to all of your environments through a central registry. The Docker Hub is one example of a registry, but you can deploy your own registry on servers you control.</li> <li>A Docker image contains all the dependencies that it needs to run an application within the image. This is useful because you no longer need to deal with environment drift (version differences) when you rely on dependencies that are installed on every environment you deploy to.</li> <li>Docker uses of the union file system and \"copy-on-write\" to reuse layers of images. This lowers the footprint of storing images and significantly increases the performance of starting containers.</li> <li>Image layers are cached by the Docker build and push system. There's no need to rebuild or repush image layers that are already present on a system.</li> <li>Each line in a Dockerfile creates a new layer, and because of the layer cache, the lines that change more frequently, for example, adding source code to an image, should be listed near the bottom of the file.</li> </ul> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#container-orchestration-overview","title":"Container orchestration overview","text":""},{"location":"Docker/2021-11-14-docker-taraining/#what-about-production","title":"What about production?","text":"<ul> <li>Automated scheduling and scaling</li> <li>Service discovery</li> <li>Zero downtime deployments</li> <li>High availability and fault tolerance</li> <li>A/B deployments</li> <li>Logging</li> <li>Implementing reconciliation</li> </ul> <p>Docker Swarm is the orchestration tool that is built in to the Docker Engine.</p> <p>https://docs.docker.com/engine/swarm/ </p> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#what-is-container-orchestration","title":"What is container orchestration?","text":"<p> - Cluster management - Scheduling - Service discovery - Replication - Health management  - Declare desired state   - Active reconciliation</p> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#container-ecosystem-layers","title":"Container ecosystem layers","text":"<p>-- slide Dockerfile refernece - EXEC Vs CMD</p> <ol> <li>Dockerfile should specify at least one of CMD or ENTRYPOINT commands.</li> <li>ENTRYPOINT should be defined when using the container as an executable.</li> <li>CMD should be used as a way of defining default arguments for an ENTRYPOINT command or for executing an ad-hoc command in a container.</li> <li>CMD will be overridden when running the container with alternative arguments.</li> </ol> <p>Example\uff1a <pre><code>FROM ubuntu\nENTRYPOINT [\"top\", \"-b\"]\nCMD [\"-c\"]\n\n# docker run without other args will result: top -b -c\n# docker run -it --rm --name test  top -H  This will results top -H\n</code></pre></p> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#dockerfile-refernece-add","title":"Dockerfile refernece - ADD","text":"<pre><code>ADD [OPTIONS] &lt;src&gt; ... &lt;dest&gt;\nADD [OPTIONS] [\"&lt;src&gt;\", ... \"&lt;dest&gt;\"]\n\n1. If &lt;src&gt; is a local file or directory, the contents of the directory are copied to the specified destination.\n2. If &lt;src&gt; is a local tar archive, it is decompressed and extracted to the specified destination. \n3. If &lt;src&gt; is a URL, the contents of the URL are downloaded and placed at the specified destination.\n4. If &lt;src&gt; is a Git repository, the repository is cloned to the specified destination.\n</code></pre> <p>-- slide</p>"},{"location":"Docker/2021-11-14-docker-taraining/#build-images-tools","title":"Build Images Tools","text":"<ul> <li>Docker\uff08BuildKit, BuildX\uff09</li> </ul>"},{"location":"Docker/2021-11-14-docker-taraining/#daemon-less","title":"Daemon-less","text":"<ul> <li>Buildah</li> <li>Kaniko</li> <li>Podman</li> </ul>"},{"location":"Docker/2021-11-14-docker-taraining/#container-runtime-high-level","title":"Container Runtime \uff08High-Level\uff09","text":"<ul> <li>containerd</li> <li>CRI-O</li> <li>Podman</li> </ul>"},{"location":"Docker/2021-11-14-docker-taraining/#container-runtime-low-level","title":"Container Runtime \uff08Low-Level\uff09","text":"<ul> <li>runC</li> <li>crun</li> </ul>"},{"location":"Docker/2021-11-14-docker-taraining/#container-runtime-virtual","title":"Container Runtime \uff08Virtual\uff09","text":"<ul> <li>kata Containers</li> <li>gVisor</li> </ul>"},{"location":"Java/2018-01-21-springboot-java/","title":"Springboot handbook","text":""},{"location":"Java/2018-01-21-springboot-java/#how-to-add-custom-logic-when-login-success","title":"How to add custom logic when login success","text":"<pre><code>// Implements the ApplicationListener\npublic class MyApplicationListener implements ApplicationListener&lt;AuthenticationSuccessEvent&gt; {\n\n// Write your own logic\n@Override\n  public void onApplicationEvent(AuthenticationSuccessEvent event) {\n  //TODO\n  }\n\n}\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#how-to-custom-a-authenticationprovider","title":"How to custom a AuthenticationProvider","text":"<pre><code>@Component\npublic class StaticAuthenticationProvider implements AuthenticationProvider {\n\n  private static final Logger logger = LoggerFactory.getLogger(StaticAuthenticationProvider.class);\n\n  @Autowired\n  private MyUserDetailService userDetailService;\n\n  // Override the authenticate function.\n  @Override\n  public Authentication authenticate(Authentication authentication)\n      throws AuthenticationException {\n    String name = authentication.getName();\n    UserDetails userDetails = userDetailService.loadUserByUsername(name);\n    if (Constants.IDA_ADMIN_USER_NAME.equals(name) &amp;&amp; userDetails.isEnabled()) {\n      UsernamePasswordAuthenticationToken result = new UsernamePasswordAuthenticationToken(\n          userDetails, authentication.getCredentials(), userDetails.getAuthorities());\n      result.setDetails(authentication.getDetails());\n      return result;\n    } else {\n      return null;\n    }\n  }\n\n  // Override the supports function\n  @Override\n  public boolean supports(Class&lt;?&gt; authentication) {\n    return authentication.equals(UsernamePasswordAuthenticationToken.class);\n  }\n}\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#spring-junit-testcase-clear-context-after-each-test-method","title":"Spring Junit TestCase Clear Context after each test method","text":"<pre><code>//put the annotation to class level\n@DirtiesContext(classMode = ClassMode.AFTER_EACH_TEST_METHOD)\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#spring","title":"Spring","text":""},{"location":"Java/2018-01-21-springboot-java/#springboot-mockitoannotations-example","title":"Springboot MockitoAnnotations example","text":"<pre><code>  @Mock\n  private TeamService teamService;\n\n  @Mock\n  private UserService userService;\n\n  @Before\n  public void setUp() {\n    MockitoAnnotations.initMocks(this);\n    this.mockMvc = MockMvcBuilders.standaloneSetup(userController).build();\n  }\n\n  \u00b7\u00b7\u00b7\n  when(teamService.findTeamById(1L)).thenReturn(team);\n  when(userService.checkUserExist(team, 1L)).thenReturn(\"error\");\n  \u00b7\u00b7\u00b7\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot-mock","title":"Springboot mock\u8868\u5355\u7ed1\u5b9a\u7684\u5bf9\u8c61","text":"<pre><code>//\u7ed1\u5b9a\u7684\u8868\u5355\u5bf9\u8c61\nUserViewObject userViewObject = new UserViewObject();\n    userViewObject.setType(\"teacher\");\n    MvcResult result = mockMvc\n        .perform(MockMvcRequestBuilderUtils\n            .postForm(\"/users/\" + user.getId() + \"/type\", userViewObject))\n        .andExpect(status().is2xxSuccessful()).andReturn();\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot-mockmvc-httpsession","title":"Springboot mockMvc \u4f7f\u7528HttpSession","text":"<pre><code>MockHttpSession httpSession = new MockHttpSession();\nhttpSession.setAttribute();\n\nMvcResult result = mockMvc.perform(\n        put(\"/aaa/bbb\").contentType(MediaType.APPLICATION_JSON_UTF8).session(httpSession)\n            .content(json))\n        .andExpect(status().is2xxSuccessful()).andReturn();\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot-requestbody-ajax-body","title":"Springboot \u4f7f\u7528 @RequestBody \u63a5\u53d7 Ajax Body\u4e2d\u7684\u590d\u6742\u7c7b\u578b\u53c2\u6570","text":"<pre><code>//\u5b9a\u4e49Controller\u4e2d\u7684@RequestBody\u7684\u53c2\u6570\u7c7b\u578b\npublic class User {\n  private String name;\n  private List&lt;String&gt; cars;\n  ...\n}\n\n//Js\u4e2d\u7684Ajax\nvar data = {\n  \"cars\": [\"car1\", \"car2\"]\uff0c\n  \"name\": \"tom\"\n};\n\n$.ajax({\n  url: \"xxx\",\n  dataType: \"json\",\n  data: JSON.stringify(data),\n  contentType: \"application/json\",\n  headers: {\n    Accept: \"application/json\"\n  },\n  success: function(){}\n});\n\n//3 Controller\u4e2d\u53d6\u5f97Ajax Body\u4e2d\u7684\u6570\u636e\n\npublic String test(HttpSession httpSession,\n      @RequestBody User payload) {\n        payload.getCars();\n}\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#bootstrap-modal","title":"Bootstrap Modal \u9047\u5230\u7684\u95ee\u9898","text":"<p>\u5f53\u5173\u95edmodal\u7684\u65f6\u5019\uff0c\u6e05\u9664modal\u4e0a\u7684\u6570\u636e  </p> <pre><code>$(\"#uploadTestData\").on('hidden.bs.modal' , function(e) {\n    $(this).removeData();\n    $(\"#input#file\").val(\"\")\n});\n</code></pre> <p>\u5f53Modal\u663e\u793a\u7684\u65f6\u5019\uff0c\u7ed9Modal\u4e0a\u7684\u5143\u7d20\u7ed1\u5b9a\u4e8b\u4ef6  </p> <pre><code>$(\"#uploadTestData\").on('shown.bs.modal' , function(e) {\n    //\n});\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot","title":"Springboot \u56db\u79cd\u5e38\u7528\u7684\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f","text":"<p>@PathVariable </p> <pre><code>@RequestMapping(value=\"/{user}\", method=RequestMethod.GET)\n    public User getUser(@PathVariable Long user) {\n        // ...\n    }\n</code></pre> <p>@RequestParam </p> <pre><code>// GET /pets?color=red&amp;&amp;weight=10\n@RequestMapping(value=\"/pets\", method=RequestMethod.GET)\n    public User getUser(@RequestParam String color, @RequestParam(required = false) int weight) {\n        // ...\n    }\n</code></pre> <p>@MatrixVariable </p> <pre><code>// GET GET /pets/42;q=11;r=22\n@RequestMapping(value=\"/cars\", method=RequestMethod.GET)\n    public void findPet(@PathVariable String petId, @MatrixVariable int q) {\n    // petId == 42\n    // q == 11\n}\n</code></pre> <p>@RequestHeader </p> <pre><code>//Given request with headers:\nHost                    localhost:8080\nAccept                  text/html,application/xhtml+xml,application/xml;q=0.9\nAccept-Language         fr,en-gb;q=0.7,en;q=0.3\nAccept-Encoding         gzip,deflate\nAccept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7\nKeep-Alive              300\n\n@GetMapping(\"/demo\")\npublic void handle(\n        @RequestHeader(\"Accept-Encoding\") String encoding,\n        @RequestHeader(\"Keep-Alive\") long keepAlive) {\n    //...\n}\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot-fileupload","title":"Springboot FileUpload\u914d\u7f6e","text":"<ul> <li>\u914d\u7f6eMultipartConfigElement  </li> </ul> <pre><code>@Bean\n  public MultipartConfigElement multipartConfigElement() {\n    MultipartConfigFactory factory = new MultipartConfigFactory();\n    return factory.createMultipartConfig();\n  }\n</code></pre> <ul> <li>\u5728profile\u4e2d\u914d\u7f6e\u4e0a\u4f20\u6587\u4ef6\u7684\u5927\u5c0f  </li> </ul> <pre><code>spring.servlet.multipart.max-file-size: 50M\nspring.servlet.multipart.max-request-size: 50M\n</code></pre> <ul> <li>\u53ef\u4ee5\u5728\u9875\u9762\u7aef\u9650\u5236\u4e0a\u4f20\u6587\u4ef6\u7684\u683c\u5f0f  </li> </ul> <pre><code>//\u914d\u7f6e\u6587\u4ef6\u4e0a\u4f20\u7684\u683c\u5f0f\u662fcsv\n&lt;input type=\"file\" accept=\".csv,application/vnd.ms-excel\" id=\"uploadfile\"/&gt;\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#springboot-with-docker","title":"Springboot with Docker","text":""},{"location":"Java/2018-01-21-springboot-java/#1-write-a-docker-file","title":"1. Write a docker file:","text":"<pre><code>FROM java:8u111-jdk-alpine\nCOPY spring-cloud-eureka-0.0.1-SNAPSHOT.jar /usr/src/myapp/app.jar\nWORKDIR /usr/src/myapp\nCMD [\"java\", \"-jar\", \"app.jar\"]\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#2-build-an-image","title":"2. Build an image","text":"<pre><code>docker build -f dockerfile -t waitplay/myImage:latest\n</code></pre>"},{"location":"Java/2018-01-21-springboot-java/#3-run-the-image","title":"3. Run the image","text":"<pre><code>//-e option \u8bbe\u7f6e\u8fd0\u884c\u65f6\u73af\u5883\u53d8\u91cf\ndocker run -dt --name waitplay-server-1 -e \"spring.profiles.active=srv1\" -p 8761:8761 waitplay/eureka-server\n</code></pre>"},{"location":"Java/2018-02-22-basicknowledge-java/","title":"Java common knowledge","text":""},{"location":"Java/2018-02-22-basicknowledge-java/#understanding-jvm","title":"Understanding JVM","text":"<p>\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u7684\u7ed3\u6784</p> <ul> <li> <p>\u5bf9\u8c61\u5934(Header): \u5305\u542bHashCode\uff0cGC\u5206\u4ee3\u5e74\u9f84\uff0c\u9501\u72b6\u6001\u6807\u5fd7\uff0c\u7ebf\u7a0b\u6301\u6709\u7684\u9501\uff0c\u504f\u5411\u7ebf\u7a0bID\uff0c\u504f\u5411\u65f6\u95f4\u6233\uff0c\u7c7b\u578b\u6307\u9488\uff08\u6307\u5411\u7c7b\u5143\u6570\u636e\u7684\u6307\u9488\uff09\u3002</p> </li> <li> <p>\u5b9e\u4f8b\u6570\u636e(Instance data)</p> </li> <li> <p>\u5bf9\u9f50\u586b\u5145(Padding)</p> </li> </ul> <p>String.intern() </p> <p>\u8be5\u65b9\u6cd5\u662f\u4e00\u4e2anative\u65b9\u6cd5\u3002\u5b83\u7684\u4f5c\u7528\u662f\uff1a\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5df2\u7ecf\u5305\u542b\u4e00\u4e2a\u7b49\u4e8e\u6b64String\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u8fd4\u56de\u4ee3\u8868\u6c60\u4e2d\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684String\u5bf9\u8c61\uff1b\u5426\u5219\uff0c\u5c06\u6b64String\u5bf9\u8c61\u5305\u542b\u7684\u5b57\u7b26\u4e32\u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u5e76\u4e14\u8fd4\u56de\u6b64String\u5bf9\u8c61\u7684\u5f15\u7528\u3002</p>"},{"location":"Java/2018-02-22-basicknowledge-java/#jvm-tuning","title":"JVM tuning","text":"<p>Tools: Arthas https://arthas.aliyun.com/doc/quick-start.html</p>"},{"location":"Java/2018-02-22-basicknowledge-java/#java-secure-coding-rules","title":"Java secure coding rules","text":"<p>Injection attacks</p> <p>Leaking sensitive data</p> <ul> <li> <p>Sensitive data</p> <ul> <li>Credit Card or Payment Card Industry (PCI) Information</li> <li>Private Personal Information (PPI)</li> <li>Protected Healthy Information (HIPAA)</li> </ul> </li> <li> <p>Private/Confidential data</p> </li> <li>Public data</li> </ul> <p>Denial-of-service Attacks (DoS)</p> <ul> <li> <p>Resource-exhaustion attacks</p> <ul> <li>Remove temporary files before termination</li> <li>Release resources when they are no longer needed</li> <li>Don't let external processes block on IO buffers</li> <li>Perform proper cleanup at program termination</li> <li>Safely extract files from ZipInputStream</li> <li>Don't use finalizers</li> <li>Don't leak memory</li> <li>Don't exhaust heap space</li> <li>Avoid memory and resource leaks during serialization</li> <li>Use thread pool to enable graceful degradation of service during traffic bursts</li> <li>Don't execute interdependent tasks in a bounded thread pool</li> </ul> </li> <li> <p>Concurrency-related attacks that include thread deadlock, thread starvation, and race conditions.</p> <ul> <li>Use private final lock objects to synchronize classes that may interact with untrusted code.</li> <li>Don't synchronize on objects that may be reused.</li> <li>Avoid deadlock by requesting and releasing locks in the same order</li> <li>Ensure actively held locks are released on exceptional conditions</li> <li>Don't perform operations that can block while holding a lock</li> <li>Avoid client-side locking when using classed that don't commit to their locking strategy</li> <li>Ensure that threads performing blocking operations can be terminated</li> <li>Ensure that tasks submitted to a thread pool are interruptible</li> </ul> </li> <li> <p>Algorthmic attacks (such as hash function) inject values that force worst-case conditions to exit</p> </li> <li>Bandwith-consumption attacks that consume all available network bandwith.</li> <li>Prevent XML Injection</li> </ul>"},{"location":"Java/2018-02-22-basicknowledge-java/#basic-in-small-words","title":"Basic in small words","text":"<p>CountDownLatch, Semaphore VS CyclicBarrier </p> <ul> <li>CountDownLatch \u7ef4\u62a4\u4e00\u4e2a\u539f\u5b50\u7684\u8ba1\u6570\u5668\uff0c\u8be5\u8ba1\u6570\u5668\u53ea\u80fd\u51cf\uff0c\u4e0d\u80fd\u88ab\u91cd\u7f6e\u3002\u901a\u8fc7\u5b83\u53ef\u4ee5\u4f7f\u5f53\u524d\u7684\u7ebf\u7a0b\u5904\u4e8eawait\u72b6\u6001\u3002\u76f4\u5230\u5176\u4ed6\u7684\u7ebf\u7a0b\u8c03\u7528countDown\u65b9\u6cd5\u4f7f\u8ba1\u6570\u5668\u53d8\u4e3a0.\u6b64\u65f6\u88ab\u963b\u585e\u7684\u65b9\u6cd5\u4f1a\u7ee7\u7eed\u8fd0\u884c\u3002  </li> <li>CyclicBarrier \u548c CountDownLatch\u7c7b\u4f3c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8eCyclicBarrier\u7684\u503c\u88ab\u83b7\u53d6\u4e4b\u540e\u53ef\u4ee5\u91ca\u653e\uff0c\u5e76\u4e0d\u50cfCountDownLatch\u4e00\u6837\u53ea\u80fd\u51cf\u3002\u4e00\u822c\u7528\u4e8e\u9650\u5236\u67d0\u4e9b\u8d44\u6e90\u6700\u591a\u540c\u65f6\u88ab\u591a\u5c11\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u3002  </li> <li>CyclicBarrier \u548c CountDownLatch\u7c7b\u4f3c\uff0c\u53ea\u662f\u5b83\u7684\u8ba1\u6570\u5668\u53ef\u4ee5\u88ab\u91cd\u7f6e\u3002  </li> </ul> <p>Java semaphores - Control and maintain the number of access the thread.</p> <p>Java volatile \u5b9e\u73b0\u539f\u7406 \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae(MESI)\u3002\u5f53CPU\u5728\u5199\u6570\u636e\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u64cd\u4f5c\u7684\u53d8\u91cf\u662f\u5171\u4eab\u53d8\u91cf\uff0c\u5219\u4f1a\u901a\u77e5\u5176\u4ed6\u7684CPU\u8be5\u53d8\u91cf\u7684\u7f13\u5b58\u5df2\u7ecf\u65e0\u6548\u3002\u5176\u4ed6\u7684CPU\u6536\u5230\u8be5\u901a\u77e5\u540e\u5c31\u4f1a\u518d\u6b21\u4ece\u4e3b\u5b58\u540c\u6b65\u6539\u53d8\u91cf\u7684\u503c\u5230\u81ea\u5df1\u7684\u7f13\u5b58\u3002</p> <p>Display curency NumberFormat Class</p> <pre><code>//Format currency\nLocale loc = Locale.UK;\nNumberFormat nf = NumberFormat.getCurrencyInstance(loc);\ndouble money = 1_000_000.00d;\nnf.format(money);\n</code></pre> <p>Deadlock, Livelock, Starvation</p> <ul> <li>Deaklock: A situation where one thread is blocked while waiting for a conditon in a second thread that is waiting on the first thread</li> <li>Livelock: A condition where a thread is locked because of an operation that is continuously failing</li> <li>Starvation: A situation where a thread cann't access a resource because higher priority threads are continually accessing the resource</li> </ul> <p>java.util.concurrent collections</p> <ul> <li>ConcurrentHashMap -- HashMap</li> <li>ConcurrentSkipListMap -- TreeMap</li> <li>CopyOnWriteArrayList -- ArrayList</li> </ul> <p>Deque \u7c7b</p> <ul> <li>As is a double-end Queue  FIFO (add() and remove())</li> <li>As is a Stack LIFO (push() and pop())</li> </ul> <p>Comparable \u63a5\u53e3</p> <ul> <li>\u8986\u5199compareTo\u65b9\u6cd5</li> <li>\u53ea\u80fd\u5305\u542b\u4e00\u79cd\u6bd4\u8f83\u7b56\u7565</li> </ul> <p>Comparator \u63a5\u53e3</p> <ul> <li>\u4f7f\u7528compare\u6765\u6bd4\u8f83</li> <li>\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aComparator\u7c7b</li> <li>\u521b\u5efa\u591a\u4e2a\u6392\u5e8f\u7684\u9009\u9879</li> </ul> <p>\u63a5\u53e3</p> <ul> <li>\u548c\u62bd\u8c61\u7c7b\u7c7b\u4f3c\uff0c\u53ea\u5305\u542bpublic abstract \u65b9\u6cd5</li> <li>\u62bd\u8c61\u7684\u65b9\u6cd5\u5fc5\u987b\u88ab\u5b9e\u73b0</li> <li>\u53ef\u4ee5\u5305\u542bconstant \u5b57\u6bb5</li> <li>\u53ef\u4ee5\u6307\u5411\u4e00\u4e2a\u5f15\u7528</li> <li>\u5305\u542bdefault \u65b9\u6cd5 \uff08form java8\uff09</li> <li>\u63a5\u53e3\u53ef\u4ee5extends\u63a5\u53e3</li> </ul> <p>default \u65b9\u6cd5 in \u63a5\u53e3</p> <ul> <li>\u88abdefault\u4fee\u9970</li> <li>\u5177\u6709\u65b9\u6cd5\u4f53</li> </ul> <p>static \u65b9\u6cd5 in \u63a5\u53e3</p> <p>functional \u63a5\u53e3</p> <ul> <li>\u53ea\u5305\u542b\u4e00\u4e2a\u62bd\u8c61\u65b9\u6cd5\u7684\u63a5\u53e3</li> </ul> <p>\u62bd\u8c61\u7c7b</p> <ul> <li>\u62bd\u8c61\u7c7b\u4e0d\u80fd\u88ab\u5b9e\u4f8b\u5316</li> <li>\u62bd\u8c61\u7c7b\u4e2d\u7684\u62bd\u8c61\u65b9\u6cd5\u4e0d\u80fd\u6709\u65b9\u6cd5\u4f53</li> <li>\u62bd\u8c61\u7c7b\u7684\u65b9\u6cd5\u5728\u5b50\u7c7b\u4e2d\u5fc5\u987b\u88ab\u8986\u76d6</li> <li>\u62bd\u8c61\u7c7b\u4e2d\u53ef\u4ee5\u5305\u542b\u975e\u62bd\u8c61\u65b9\u6cd5</li> <li>\u5f53\u4e00\u4e2a\u7c7b\u7ee7\u627f\u4e00\u4e2a\u62bd\u8c61\u7c7b\u7684\u65f6\u5019\uff0c\u8981\u4e48\u8fd9\u4e2a\u7c7b\u4e5f\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u8981\u4e48\u5b9e\u73b0\u7236\u7c7b\u4e2d\u7684\u6240\u6709\u62bd\u8c61\u65b9\u6cd5</li> </ul> <p>final \u5173\u952e\u5b57</p> <ul> <li>\u53ef\u4ee5\u4fee\u9970\u7c7b\uff0c\u7c7b\u4e0d\u80fd\u88ab\u7ee7\u627f</li> <li>\u53ef\u4ee5\u4fee\u9970\u65b9\u6cd5\uff0c \u65b9\u6cd5\u4e0d\u80fd\u88ab\u8986\u76d6</li> <li>\u53ef\u4ee5\u4fee\u9970\u672c\u5730\u53d8\u91cf\uff0c\u53d8\u91cf\u7684\u5f15\u7528\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u4f46\u662f\u53d8\u91cf\u7684\u5185\u5bb9\u53ef\u4ee5\u4fee\u6539\u3002</li> <li>\u53ef\u4ee5\u4fee\u9970\u53c2\u6570</li> </ul> <p>public, default, protected, private</p> <ul> <li>public - anywhere</li> <li>protected - same class, package and subclass in other package</li> <li>default - same class and package</li> <li>private - same class</li> </ul> <p>\u5982\u4f55\u5c06\u4e00\u4e2a\u53ef\u53d8\u7c7b\u8f6c\u5316\u4e3a\u4e0d\u53ef\u53d8\u7684\u7c7b</p> <ul> <li>\u53bb\u6389\u6240\u6709\u7684setter\u65b9\u6cd5</li> <li>\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u7528 private final \u4fee\u9970</li> <li>\u7c7b\u540d\u7528final\u4fee\u9970</li> </ul> <p>Interface VS Abstract Class</p> <p>An interface is similar to an abstract class, except that:</p> <ul> <li>Methods are implicitly abstract(except default methods)</li> <li>A class does not extend it, but implements it</li> <li>A class may implement more than one interface</li> </ul> <p>All abstract methods from the interface must be implemented by the class.</p> <p>Exception VS Error</p> <p>Exception are subclasses of Throwable. There are three main types of Throwable\uff1a</p> <ul> <li> <p>Error</p> <ul> <li>Typically an unrecoverable external error </li> <li>Unchecked</li> </ul> </li> <li> <p>RuntimeException</p> <ul> <li>Typically caused by a programming mistake</li> <li>Unchecked</li> </ul> </li> <li> <p>Exception</p> <ul> <li>Recoverable error</li> <li>Checked (Must be caught or thrown)</li> </ul> </li> </ul>"},{"location":"Java/2018-02-22-basicknowledge-java/#best-practices","title":"Best Practices","text":"<ul> <li>Catch the actual exception thrown, not the superclass type. </li> <li>Examine the exception to find out the exact problem so you can recover cleanly.</li> <li> <p>You do not need to catch every exception.</p> <ul> <li>A programming mistake should not be handled. It must be fixed.</li> <li>Ask yourself, \"Does this exception represent behavior I want the program to recover from?\"</li> </ul> </li> </ul> <p>Synchronized\u539f\u7406  </p> <ul> <li>\u4fee\u9970\u666e\u901a\u65b9\u6cd5 \u901a\u8fc7 ACC_SYNCHRONIZED\u6807\u8bc6\uff0c\u5982\u679c\u8bbe\u7f6e\u8be5\u6807\u8bc6\uff0c\u5219\u9700\u8981\u5148\u83b7\u53d6monitor\uff0c\u83b7\u53d6\u6210\u529f\u624d\u6267\u884c\u65b9\u6cd5\u3002\u65b9\u6cd5\u6267\u884c\u5b8c\u4e86\u91ca\u653emonitor\u3002  </li> <li>\u4fee\u9970\u9759\u6001\u65b9\u6cd5  </li> <li>\u4fee\u9970\u4ee3\u7801\u5757 JVM\u7684\u4e24\u4e2a\u6307\u4ee4monitorenter\u548cmonitorexit. Synchronized\u7684\u8bed\u4e49\u5e95\u5c42\u662f\u901a\u8fc7\u4e00\u4e2amonitor\u7684\u5bf9\u8c61\u6765\u5b8c\u6210\uff0c\u5176\u5b9ewait/notify\u7b49\u65b9\u6cd5\u4e5f\u4f9d\u8d56\u4e8emonitor\u5bf9\u8c61\uff0c\u53ea\u6709\u5728\u540c\u6b65\u7684\u5757\u6216\u8005\u65b9\u6cd5\u4e2d\u624d\u80fd\u8c03\u7528wait/notify\u7b49\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u629b\u51fajava.lang.IllegalMonitorStateException\u7684\u5f02\u5e38. </li> </ul> <p>Java \u4e2d\u7684Clone  </p> <p>\u514b\u9686\u5bf9\u8c61\u7684\u65f6\u5019\u5982\u679c\u9700\u8981\u6df1\u514b\u9686\uff0c\u90a3\u4e48\u8be5\u5bf9\u8c61\u4e2d\u7684\u5f15\u7528\u7c7b\u578b\u4e5f\u9700\u8981\u5b9e\u73b0Cloneable\u63a5\u53e3\u3002\u5982\u679c\u8be5\u7c7b\u4e2d\u7684\u5f15\u7528\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0Cloneable\u63a5\u53e3\uff0c\u90a3\u4e48\u514b\u9686\u7684\u5bf9\u8c61\u4e0e\u539f\u5bf9\u8c61\u62e5\u6709\u76f8\u540c\u7684\u5f15\u7528\u7c7b\u578b\u7684\u5b57\u6bb5\u3002\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u7684\u624b\u6bb5\u5b9e\u73b0\u5bf9\u8c61\u7684\u6df1\u5ea6\u514b\u9686\u3002   </p> <p>LinkedHashMap\u7684\u5e94\u7528   </p> <p>\u53ef\u4ee5\u4fdd\u8bc1\u904d\u5386\u65f6\u53d6\u6570\u636e\u7684\u987a\u5e8f\u548c\u63d2\u5165\u987a\u5e8f\u662f\u4e00\u81f4\u7684\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u904d\u5386\u7684\u6548\u7387\u6bd4Hashmap\u4f4e\u3002\u5f53Hashmap\u7684\u5bb9\u91cf\u5f88\u5927\uff0c\u5b9e\u9645\u5b58\u653e\u7684\u6570\u636e\u5f88\u5c11\u65f6\uff0c\u6548\u7387\u6bd4Hashmap\u9ad8\u3002  </p> <p>Java 8 \u4e2d\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b  </p> <p>byte, char, int, float, double, long ,short, boolean  </p> <p>Arrays.sort \u4e0e Collections.sort</p> <ul> <li>Arrays.sort\u53ef\u4ee5\u5bf9\u57fa\u672c\u7c7b\u578b\u7684\u6570\u7ec4\u8fdb\u884c\u6392\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u5b9e\u73b0Comparable\u63a5\u53e3\u7684\u96c6\u5408\u8fdb\u884c\u6392\u5e8f\u3002  <ul> <li>Arrays\u53ef\u4ee5\u4f7f\u7528sort\u65b9\u6cd5\u4ee5\u53caparallelSort\u65b9\u6cd5\u5bf9\u96c6\u5408\u8fdb\u884c\u6392\u5e8f\u3002\u4f7f\u7528DualPivotQuicksort(\u53cc\u8f74\u53cc\u5411)\u6392\u5e8f\uff0c\u57fa\u672c\u601d\u8def\u662f\u8bbe\u7f6e\u4e24\u4e2a\u53c2\u8003\u70b9pivot1\uff0cpivot2\uff0c\u5176\u4e2dpivot1\u4e00\u5b9a\u8981\u5c0f\u4e8epivot2\uff0c\u7136\u540e\u5c06\u5f85\u6392\u5e8f\u7684\u6570\u7ec4\u5206\u4e3a4\u90e8\u5206 [x&lt;=pivot1], [pivot1&lt;x=pivot2], [\u672a\u6392\u5e8f]\uff0c\u7136\u540e\u5bf9\u524d\u4e09\u4e2a\u533a\u95f4\u5206\u522b\u9012\u5f52\u6392\u5e8f\u3002   <li>Collections.sort\u53ea\u80fd\u5bf9\u5b9e\u73b0Comparable\u63a5\u53e3\u7684\u96c6\u5408\u8fdb\u884c\u6392\u5e8f\u3002  </li> <p>Java\u7684\u7c7b\u52a0\u8f7d\u673a\u5236  </p> <ul> <li>Bootstrap ClassLoader \u6700\u9876\u5c42\u7684\u52a0\u8f7d\u7c7b\uff0c\u4e3b\u8981\u52a0\u8f7d\u6838\u5fc3\u7c7b\u5e93\uff0c%JRE_HOME%\\lib\u4e0b\u7684rt.jar\u3001resources.jar\u3001charsets.jar\u548cclass\u7b49\u3002\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\u53ef\u4ee5\u901a\u8fc7\u542f\u52a8jvm\u65f6\u6307\u5b9a-Xbootclasspath\u548c\u8def\u5f84\u6765\u6539\u53d8Bootstrap ClassLoader\u7684\u52a0\u8f7d\u76ee\u5f55\u3002\u901a\u8fc7\u73af\u5883\u53d8\u91cfsun.boot.class.path\u67e5\u627e\u5bf9\u5e94\u7684\u6587\u4ef6\u3002  </li> <li>Extension ClassLoader \u6269\u5c55\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u52a0\u8f7d\u76ee\u5f55%JRE_HOME%\\lib\\ext\u76ee\u5f55\u4e0b\u7684jar\u5305\u548cclass\u6587\u4ef6\u3002\u8fd8\u53ef\u4ee5\u52a0\u8f7d-D java.ext.dirs\u9009\u9879\u6307\u5b9a\u7684\u76ee\u5f55\u3002\u901a\u8fc7\u73af\u5883\u53d8\u91cfsun.boot.class.path\u67e5\u627e\u5bf9\u5e94\u7684\u6587\u4ef6\u3002\u901a\u8fc7\u73af\u5883\u53d8\u91cfjava.ext.dirs \u67e5\u627e\u5bf9\u5e94\u7684\u6587\u4ef6\u3002  </li> <li>App ClassLoader \u4e5f\u79f0\u4e3aSystemAppClass \u8d1f\u8d23\u52a0\u8f7d\u5f53\u524d\u5e94\u7528\u7684classpath\u7684\u6240\u6709\u7c7b\u3002 \u901a\u8fc7\u73af\u5883\u53d8\u91cfjava.ext.dirs \u67e5\u627e\u5bf9\u5e94\u7684\u6587\u4ef6\u3002  </li> <li>Custom ClassLoader</li> </ul> <p>\u4e00\u770b\u4f60\u5c31\u61c2\uff0c\u8d85\u8be6\u7ec6java\u4e2d\u7684ClassLoader\u8be6\u89e3</p> <p>Java\u52a0\u8f7d\u7c7b\u7684\u65b9\u6cd5  </p> <ul> <li>\u4ece\u672c\u5730\u7cfb\u7edf\u76f4\u63a5\u83b7\u5f97  </li> <li>\u901a\u8fc7\u7f51\u7edc\u4e0b\u8f7d.class\u6587\u4ef6  </li> <li>\u4ecezip\uff0cjar\u4e2d\u52a0\u8f7d.class\u6587\u4ef6  </li> <li>\u4ece\u6570\u636e\u5e93\u4e2d\u63d0\u53d6.class\u6587\u4ef6  </li> <li>\u5c06java\u6e90\u7801\u52a8\u6001\u7f16\u8bd1\u4e3a.class\u6587\u4ef6  </li> <li>\u547d\u4ee4\u884c\u542f\u52a8\u5e94\u7528\u7684\u65f6\u5019\u7531JVM\u521d\u59cb\u5316\u52a0\u8f7d  </li> <li>\u901a\u8fc7Class.forName()  </li> <li>\u901a\u8fc7ClassLoader.loadClass()  </li> </ul> <p>Java\u7c7b\u4ec0\u4e48\u65f6\u5019\u4f1a\u88ab\u521d\u59cb\u5316  </p> <ul> <li>new \u8be5\u7c7b\u4e00\u4e2a\u5b9e\u4f8b  </li> <li>\u8bbf\u95ee\u67d0\u4e2a\u7c7b\u6216\u8005\u63a5\u53e3\u7684\u9759\u6001\u53d8\u91cf  </li> <li>\u8c03\u7528\u7c7b\u7684\u9759\u6001\u65b9\u6cd5  </li> <li>\u53cd\u5c04  </li> <li>\u521d\u59cb\u5316\u5b50\u7c7b  </li> <li>JVM\u542f\u52a8\u65f6\u6307\u660e\u7684\u542f\u52a8\u7c7b  </li> </ul> <p>\u5f3a\u5f15\u7528\uff0c\u8f6f\u5f15\u7528\uff0c\u5f31\u5f15\u7528\uff0c\u865a\u5f15\u7528  </p> <ul> <li>\u5f3a\u5f15\u7528\u7684\u5bf9\u8c61\u5982\u679c\u4e0d\u4e3anull\uff0c\u90a3\u4e48GC\u4e0d\u4f1a\u53bb\u56de\u6536\u6b64\u5bf9\u8c61  </li> <li>\u8f6f\u5f15\u7528\u7684\u5bf9\u8c61\u5f53jvm\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\uff0cGC\u4f1a\u53bb\u56de\u6536\u8fd9\u4e9b\u5bf9\u8c61  </li> <li>\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u65e0\u8bbajvm\u662f\u5426\u5145\u8db3\uff0c\u5728GC\u7684\u65f6\u5019\u5747\u4f1a\u88ab\u56de\u6536</li> <li>\u865a\u5f15\u7528\u4e5f\u79f0\u5e7d\u7075\u5f15\u7528\uff0c\u4e00\u4e2a\u5bf9\u8c61\u662f\u5426\u6709\u865a\u5f15\u7528\uff0c\u4e0d\u4f1a\u5bf9\u5176\u751f\u547d\u5468\u671f\u6709\u5f71\u54cd\u3002\u4e3a\u4e00\u4e2a\u5bf9\u8c61\u8bbe\u7f6e\u4e00\u4e2a\u865a\u5f15\u7528\u5173\u8054\u7684\u552f\u4e00\u76ee\u7684\u662f\u5e0c\u671b\u8be5\u5bf9\u8c61\u88ab\u6536\u96c6\u5668\u56de\u6536\u7684\u65f6\u5019\u6536\u5230\u4e00\u4e2a\u7cfb\u7edf\u901a\u77e5\u3002  </li> </ul> <p>final, finally\u4e0efinalize  </p> <ul> <li>final \u4fee\u9970\u7c7b\uff0c\u53d8\u91cf\uff0c\u65b9\u6cd5\u3002\u4fee\u9970\u7c7b\u7684\u65f6\u5019\uff0c\u8868\u660e\u8fd9\u4e2a\u7c7b\u4e0d\u5141\u8bb8\u88ab\u7ee7\u627f\uff0c\u4f8b\u5982String\u7c7b\u3002\u4fee\u9970\u65b9\u6cd5\u7684\u65f6\u5019\u8868\u793a\u5728\u5b50\u7c7b\u4e2d\u4e0d\u5141\u8bb8\u88ab\u8986\u5199\uff0cprivate\u5173\u952e\u5b57\u4fee\u9970\u7684\u65b9\u6cd5\u9ed8\u8ba4\u662ffinal\u7684\u3002\u4fee\u9970\u53d8\u91cf\u7684\u65f6\u5019\u5206\u4e24\u79cd\u60c5\u51b5\uff0c\u4fee\u9970\u57fa\u672c\u7c7b\u578b\u7684\u65f6\u5019\uff0c\u8868\u793a\u5176\u6570\u503c\u4e00\u65e6\u521d\u59cb\u5316\u5c31\u4e0d\u5141\u8bb8\u4fee\u6539\u3002\u4fee\u9970\u5f15\u7528\u7c7b\u578b\u7684\u65f6\u5019\uff0c\u8868\u793a\u5176\u521d\u59cb\u5316\u4e4b\u540e\u4e0d\u80fd\u518d\u6307\u5411\u53e6\u5916\u4e00\u4e2a\u5bf9\u8c61\u3002  </li> <li> <p>finally \u4e00\u822c\u4e0etry\uff0ccatch,finally \u505a\u5f02\u5e38\u5904\u7406\u3002\u4f46\u662ffinally\u5757\u4e2d\u7684\u8bed\u53e5\u4e0d\u4e00\u5b9a\u4f1a\u6267\u884c\u3002\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a  </p> <ul> <li>try\u4e2d\u7684\u4ee3\u7801\u8fd8\u672a\u6267\u884c\u5230\u7a0b\u5e8f\u5c31\u9000\u51fa\u3002  </li> <li>try\u4e2d\u7684\u4ee3\u7801\u6267\u884c\u4e4b\u540e\uff0c\u865a\u62df\u673a\u505c\u6b62\u3002\u4f8b\u5982\u8c03\u7528  <code>java  System.exit(0);</code> . </li> <li>\u7a0b\u5e8f\u6267\u884c\u5230try\u6216\u8005catch\u5757\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u6216\u8005\u7ec8\u6b62\u3002  </li> </ul> </li> <li> <p>finalize\u662fObject\u7684\u65b9\u6cd5, \u53ef\u4ee5\u5728\u5783\u573e\u6536\u96c6\u5668\u5bf9\u6b64\u5bf9\u8c61\u8fdb\u884c\u56de\u6536\u7684\u65f6\u5019\u505a\u4e00\u4e9b\u5904\u7406\u5de5\u4f5c\u3002  </p> </li> </ul> <pre><code>protected void finalize() throws Throwable { }\n</code></pre> <p>HashMap \u4e0e Hashtable  </p> <ul> <li>HashMap\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c HashMap\u7684key\u548cvalue\u90fd\u53ef\u4ee5\u662fnull\u3002  </li> </ul> <pre><code>/*\nParameters:\n    hash hash for key\n    key the key\n    value the value to put\n    onlyIfAbsent if true, don't change existing value\n    evict if false, the table is in creation mode.\nReturns:\n    previous value, or null if none\n*/\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) {\n    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;\n    // \u5982\u679ctable\u4e3a\u7a7a\uff0c\u6216\u8005\u8fd8\u6ca1\u6709\u5143\u7d20\u65f6\uff0c\u5219\u6269\u5bb9\n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    // \u5982\u679c\u9996\u7ed3\u70b9\u503c\u4e3a\u7a7a\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u9996\u7ed3\u70b9\u3002\n    // \u6ce8\u610f\uff1a(n - 1) &amp; hash\u624d\u662f\u771f\u6b63\u7684hash\u503c\uff0c\u4e5f\u5c31\u662f\u5b58\u50a8\u5728table\u4f4d\u7f6e\u7684index\u3002\u57281.6\u4e2d\u662f\u5c01\u88c5\u6210indexFor\u51fd\u6570\u3002\n    if ((p = tab[i = (n - 1) &amp; hash]) == null)\n        tab[i] = newNode(hash, key, value, null);\n    else {    // \u5230\u8fd9\u513f\u4e86\uff0c\u5c31\u8bf4\u660e\u78b0\u649e\u4e86\uff0c\u90a3\u4e48\u5c31\u8981\u5f00\u59cb\u5904\u7406\u78b0\u649e\u3002\n            Node&lt;K,V&gt; e; K k;\n            // \u5982\u679c\u5728\u9996\u7ed3\u70b9\u4e0e\u6211\u4eec\u5f85\u63d2\u5165\u7684\u5143\u7d20\u6709\u76f8\u540c\u7684hash\u548ckey\u503c\uff0c\u5219\u5148\u8bb0\u5f55\u3002\n            if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))\n                e = p;\n            else if (p instanceof TreeNode) // \u5982\u679c\u9996\u7ed3\u70b9\u7684\u7c7b\u578b\u662f\u7ea2\u9ed1\u6811\u7c7b\u578b\uff0c\u5219\u6309\u7167\u7ea2\u9ed1\u6811\u65b9\u6cd5\u6dfb\u52a0\u8be5\u5143\u7d20\n                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);\n            else {  // \u5230\u8fd9\u4e00\u6b65\uff0c\u8bf4\u660e\u9996\u7ed3\u70b9\u7c7b\u578b\u4e3a\u94fe\u8868\u7c7b\u578b\u3002\n                    for (int binCount = 0; ; ++binCount) {\n                        // \u5982\u679c\u904d\u5386\u5230\u672b\u5c3e\u65f6\uff0c\u5148\u5728\u5c3e\u90e8\u8ffd\u52a0\u8be5\u5143\u7d20\u7ed3\u70b9\u3002\n                        if ((e = p.next) == null) {\n                            p.next = newNode(hash, key, value, null);\n                            // \u5f53\u904d\u5386\u7684\u7ed3\u70b9\u6570\u76ee\u5927\u4e8e8\u65f6\uff0c\u5219\u91c7\u53d6\u6811\u5316\u7ed3\u6784\u3002\n                            if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                                treeifyBin(tab, hash);\n                                break;\n                        }\n                        // \u5982\u679c\u627e\u5230\u4e0e\u6211\u4eec\u5f85\u63d2\u5165\u7684\u5143\u7d20\u5177\u6709\u76f8\u540c\u7684hash\u548ckey\u503c\u7684\u7ed3\u70b9\uff0c\u5219\u505c\u6b62\u904d\u5386\u3002\u6b64\u65f6e\u5df2\u7ecf\u8bb0\u5f55\u4e86\u8be5\u7ed3\u70b9\n                        if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))\n                            break;\n                        p = e;\n                    }\n                }\n            // \u8868\u660e\uff0c\u8bb0\u5f55\u5230\u5177\u6709\u76f8\u540c\u5143\u7d20\u7684\u7ed3\u70b9\n            if (e != null) { // existing mapping for key\n                V oldValue = e.value;\n                if (!onlyIfAbsent || oldValue == null) //\u5224\u65ad\u662f\u5426\u7528\u65b0\u503c\u8986\u76d6\u65e7\u503c\n                    e.value = value;\n                afterNodeAccess(e);  // \u8fd9\u4e2a\u662f\u7a7a\u51fd\u6570\uff0c\u53ef\u4ee5\u7531\u7528\u6237\u6839\u636e\u9700\u8981\u8986\u76d6\n                return oldValue;\n            }\n        }\n    ++modCount;\n    // \u5f53\u7ed3\u70b9\u6570+1\u5927\u4e8ethreshold\u65f6\uff0c\u5219\u8fdb\u884c\u6269\u5bb9\n    if (++size &gt; threshold)\n        resize();\n    afterNodeInsertion(evict); // \u8fd9\u4e2a\u662f\u7a7a\u51fd\u6570\uff0c\u53ef\u4ee5\u7531\u7528\u6237\u6839\u636e\u9700\u8981\u8986\u76d6\n    return null;\n}\n</code></pre> <ul> <li>Hashtable \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0cHashtable\u7684key\u6216\u8005value\u4e0d\u80fd\u662fnull\u3002    </li> </ul> <pre><code>    /*\n    * \u6dfb\u52a0\u5143\u7d20\u7684\u65f6\u5019\u4f7f\u7528synchronized\u9501\n    * \u8fd4\u56de\u4e4b\u524d\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56denull\n    */\n    public synchronized V put(K key, V value) {\n        // Make sure the value is not null\n        if (value == null) {\n            throw new NullPointerException();\n        }\n\n        // Makes sure the key is not already in the hashtable.\n        Entry&lt;?,?&gt; tab[] = table;\n        int hash = key.hashCode();\n        int index = (hash &amp; 0x7FFFFFFF) % tab.length;\n        @SuppressWarnings(\"unchecked\")\n        Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index];\n        //\u904d\u5386\u6574\u4e2atable\uff0c\u770b\u662f\u5426\u5b58\u5728\n        for(; entry != null ; entry = entry.next) {\n            if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) {\n                V old = entry.value;\n                entry.value = value;\n                return old;\n            }\n        }\n        //\u4e0d\u5b58\u5728\u5219\u63d2\u5165\u5143\u7d20\n        addEntry(hash, key, value, index);\n        return null;\n    }\n</code></pre> <p>List\u4e0eSet\u7684\u533a\u522b  </p> <ul> <li>List\u4e2d\u7684\u5143\u7d20\u662f\u6709\u5e8f\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7index\u51c6\u786e\u7684\u67e5\u627e\u5185\u90e8\u7684\u5143\u7d20\u3002  </li> <li>List\u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u91cd\u590d\uff0cSet\u4e2d\u7684\u5143\u7d20\u4e0d\u80fd\u91cd\u590d\u3002List\u4e2d\u53ef\u4ee5\u5141\u8bb8\u6dfb\u52a0\u591a\u4e2anull\u5143\u7d20\u3002Set\u4e2d\u81f3\u591a\u53ef\u4ee5\u6709\u4e00\u4e2anull\u5143\u7d20\u3002      </li> <li>List\u63d0\u4f9b\u4e00\u4e2a\u7279\u6b8a\u7684\u8fed\u4ee3ListIterator\uff0c\u53ef\u4ee5\u63d2\u5165\uff0c\u4fee\u6539\uff0c\u4ee5\u53ca\u63d0\u4f9b\u53cc\u5411\u904d\u5386\u7684\u80fd\u529b\u3002  </li> </ul> <p>HashSet\u662f\u5982\u4f55\u4fdd\u8bc1\u4e0d\u91cd\u590d\u7684  </p> <ul> <li>HashSet\u7528HashMap\u5b58\u50a8\u5143\u7d20  </li> <li>\u5c06\u5143\u7d20\u4e2d\u4f5c\u4e3aHashMap\u7684key  </li> <li>\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684  </li> </ul> <pre><code>// Dummy value to associate with an Object in the backing Map\nprivate static final Object PRESENT = new Object();\n\npublic boolean add(E e) {\n    return map.put(e, PRESENT)==null;\n}\n</code></pre> <p>Use condition in ant script  </p> <pre><code>&lt;!-- Execute task by different operation system --&gt;\n&lt;project name=\"My Project\" default=\"package_designer_without_report_v3\" basedir=\".\"&gt;\n\n    &lt;condition property=\"isWindows\"&gt;\n        &lt;os family=\"windows\" /&gt;\n    &lt;/condition&gt;\n\n    &lt;condition property=\"isLinux\"&gt;\n        &lt;os family=\"unix\" /&gt;\n    &lt;/condition&gt;\n\n    &lt;target name=\"operateInWindows\" if=\"isWindows\"&gt;\n        &lt;echo message=\"operate in windows\" /&gt;\n    &lt;/target&gt;\n\n    &lt;target name=\"operateInLinux\" if=\"isLinux\"&gt;\n        &lt;echo message=\"operate in linux\" /&gt;\n    &lt;/target&gt;\n\n&lt;/project&gt;\n</code></pre> <p>Java\u4e2dequals()\u65b9\u6cd5\u4e0e\"==\"\u7684\u533a\u522b?  </p> <ul> <li>\"==\" \u5bf9\u4e8e\u5f15\u7528\u7c7b\u578b\uff0c\u6bd4\u8f83\u7684\u662f\u5bf9\u8c61\u7684\u5730\u5740\uff0c\u5bf9\u4e8e\u57fa\u672c\u7c7b\u578b\uff0c\u6bd4\u8f83\u7684\u662f\u5b57\u9762\u503c\u3002  </li> <li>equals\u65b9\u6cd5\u662fObject\u57fa\u7c7b\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u5b50\u7c7b\u6ca1\u6709\u8986\u5199\u8be5\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u7684\u662f\u6bd4\u8f83\u5bf9\u8c61\u7684\u5730\u5740\u3002\u4e00\u822c\u8986\u5199\u6b64\u65b9\u6cd5\u7684\u65f6\u5019\u540c\u65f6\u8986\u5199hashCode\u65b9\u6cd5\u3002</li> </ul> <p>Java\u62bd\u8c61\u7c7b\u53ef\u4ee5\u6709\u5b9e\u4f53\u65b9\u6cd5\u4e48\uff1f  </p> <p>\u53ef\u4ee5.  </p> <p>\u5217\u4e3eJava\u4e2d\u62bd\u8c61\u7c7b\u548c\u63a5\u53e3\u7684\u76f8\u540c\u70b9\uff1f  </p> <ul> <li>\u90fd\u662f\u4e0a\u5c42\u7684\u62bd\u8c61  </li> <li>\u90fd\u53ef\u4ee5\u5305\u542b\u62bd\u8c61\u65b9\u6cd5  </li> <li>\u90fd\u4e0d\u80fd\u88ab\u5b9e\u4f8b\u5316  </li> </ul> <p>\u5217\u4e3eJava\u4e2d\u62bd\u8c61\u7c7b\u548c\u63a5\u53e3\u7684\u4e0d\u540c\u70b9\uff1f  </p> <ul> <li>\u62bd\u8c61\u7c7b\u4e2d\u53ef\u4ee5\u5305\u542b\u62bd\u8c61\u65b9\u6cd5\u548c\u5b9e\u4f53\u65b9\u6cd5\uff0c\u63a5\u53e3\u4e2d\u53ea\u80fd\u5305\u542b\u62bd\u8c61\u65b9\u6cd5, \u4ecejdk1.8\u5f00\u59cb\uff0c\u63a5\u53e3\u4e2d\u4e5f\u53ef\u4ee5\u5305\u542bstatic\u548cdefault\u65b9\u6cd5  </li> </ul> <pre><code>public interface MyImpl {\n\n    /**\n     * by default, abstract\n     */\n    public void move();\n\n    public abstract void drink();\n\n    /**\n     * From jdk1.8\n     */\n    public static void say() {\n    }\n\n    /**\n     * From jdk1.8\n     */\n    public default void eat() {\n    }\n}\n</code></pre> <ul> <li>\u4e00\u4e2a\u7c7b\u53ea\u80fd\u7ee7\u627f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4f46\u662f\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u63a5\u53e3  </li> <li>\u5982\u679c\u4e00\u4e2a\u7c7b\u4e0d\u80fd\u5b9e\u73b0\u7236\u7c7b\u4e2d\u6240\u6709\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u90a3\u4e48\u5b83\u672c\u8eab\u5fc5\u987b\u662f\u62bd\u8c61\u7c7b  </li> <li>Java\u63a5\u53e3\u4e2d\u58f0\u660e\u7684\u53d8\u91cf\u9ed8\u8ba4\u90fd\u662ffinal\u7684\uff0c\u62bd\u8c61\u7c7b\u53ef\u4ee5\u5305\u542b\u975efinal\u7684\u53d8\u91cf  </li> <li>Java\u63a5\u53e3\u4e2d\u7684\u6210\u5458\u51fd\u6570\u9ed8\u8ba4\u662fpublic\u7684\uff0c\u62bd\u8c61\u7c7b\u7684\u6210\u5458\u51fd\u6570\u53ef\u4ee5\u662fprivate\uff0cprotected\u6216\u8005\u662fpublic  </li> </ul> <p>ArrayList\u548cLinkedlist\u7684\u533a\u522b\uff1f  </p> <ul> <li>ArrayList\u67e5\u627e\u901f\u5ea6\u5feb\uff0cLinked\u5728\u5217\u8868\u4e2d\u63d2\u5165\uff0c\u5220\u9664\u64cd\u4f5c\u901f\u5ea6\u5feb</li> <li>ArrayList\u5360\u636e\u7684\u7a7a\u95f4\u66f4\u5c11  </li> </ul> <p>Comparable\u548cComparator\u63a5\u53e3\u662f\u5e72\u4ec0\u4e48\u7684\uff1f  </p> <ul> <li>Comparable\u63a5\u53e3\u53ea\u63d0\u4f9b\u4e00\u4e2acompareTo\u65b9\u6cd5  </li> <li>Comparator\u63a5\u53e3\u63d0\u4f9bcompare\uff08\uff09\u548cequals\uff08\uff09\u4e24\u4e2a\u65b9\u6cd5  </li> </ul> <p>Thread.sleep()\u65b9\u6cd5\u548cThread.yield()\uff0cObject.wait()\u65b9\u6cd5\u7684\u76f8\u540c\u70b9\u548c\u533a\u522b\uff1f  </p> <ul> <li>\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528yield()\u65b9\u6cd5\u8868\u660e\u8fd9\u4e2a\u7ebf\u7a0b\u76ee\u524d\u6ca1\u6709\u7279\u522b\u91cd\u8981\u7684\u4e8b\u60c5\u505a\u4e86\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u9700\u8981\u8fd0\u884c\uff0c\u4f18\u5148\u4ed6\u4eec\u8fd0\u884c\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u9700\u8981\u8fd0\u884c\uff0c\u90a3\u4e48\u8c03\u7528yield()\u65b9\u6cd5\u7684\u7ebf\u7a0b\u5c31\u7ee7\u7eed\u8fd0\u884c\u3002  </li> <li>\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528sleep()\u65b9\u6cd5\u4f1a\u4f7f\u8be5\u7ebf\u7a0b\u4f11\u7720\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u5728\u6b64\u671f\u95f4\uff0c\u4e0d\u4f1a\u4e22\u5931\u4efb\u4f55\u76d1\u89c6\u5668(\u9501)\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u9700\u8981\u8fd0\u884c\uff0c\u4ed6\u4eec\u53ef\u4ee5\u83b7\u5f97\u7cfb\u7edf\u8d44\u6e90\u8fd0\u884c\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u4e48CPU\u6709\u53ef\u80fd\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u3002  </li> <li>\u5f53\u8c03\u7528wait()\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u4f1a\u4e22\u5f03\u5bf9\u8c61\u9501\uff0c\u8fdb\u5165\u8be5\u5bf9\u8c61\u6c60\u7684\u7b49\u5f85\u6c60\u4e2d\uff0c\u5f53\u5176\u4ed6\u7684\u7ebf\u7a0b\u8c03\u7528nofity()\u6216\u5219notifyAll()\u7684\u65f6\u5019\u91cd\u65b0\u53bb\u7ade\u4e89\u8be5\u5bf9\u8c61\u7684\u9501\u3002  </li> </ul> <p>notify()\u65b9\u6cd5\u548cnotifyAll()\u65b9\u6cd5\u7684\u533a\u522b  </p> <ul> <li>\u9501\u6c60\uff1a\u5047\u8bbe\u7ebf\u7a0bA\u5df2\u7ecf\u62e5\u6709\u67d0\u4e2a\u5bf9\u8c61\u7684\u9501\uff0c\u800c\u5176\u4ed6\u7ebf\u7a0b\u60f3\u8c03\u7528\u8be5\u5bf9\u8c61\u7684\u67d0\u4e2asynchronized\u65b9\u6cd5\uff0c\u90a3\u4e48\u5fc5\u987b\u5148\u83b7\u5f97\u8be5\u5bf9\u8c61\u7684\u9501\u624d\u53ef\u4ee5\uff0c\u7531\u4e8e\u6b64\u65f6\u9501\u5df2\u7ecf\u88ab\u7ebf\u7a0bA\u5360\u6709\uff0c\u6240\u4ee5\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u8fdb\u5165\u8be5\u5bf9\u8c61\u7684\u9501\u6c60\u4e2d\u3002  </li> <li>\u7b49\u5f85\u6c60: \u5047\u8bbe\u7ebf\u7a0bA\u8c03\u7528\u67d0\u4e2a\u5bf9\u8c61\u7684wait()\u65b9\u6cd5\uff0c\u7ebf\u7a0bA\u5c31\u4f1a\u91ca\u653e\u8be5\u5bf9\u8c61\u7684\u9501\uff0c\u8fdb\u5165\u5bf9\u8c61\u7684\u7b49\u5f85\u6c60\u3002\u7b49\u5f85\u6c60\u4e2d\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u53c2\u4e0e\u7ade\u4e89\u8be5\u5bf9\u8c61\u7684\u9501\u3002  </li> </ul> <p>notify()\u65b9\u6cd5\u53ea\u4f1a\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u9501\u6c60\uff0c\u5047\u5982\u6709\u591a\u4e2a\u7ebf\u7a0b\u90fd\u5728\u7b49\u5f85\u83b7\u53d6\u67d0\u4e2a\u5bf9\u8c61\u7684\u9501\uff0c\u90a3\u4e48\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u5b9e\u73b0\u6311\u9009\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5524\u9192\u3002\u800cnotifyAll()\u4f1a\u5524\u9192\u6240\u6709\u7684\u7b49\u5f85\u7ebf\u7a0b\u8fdb\u5165\u9501\u6c60\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4e4b\u95f4\u5f7c\u6b64\u7ade\u4e89\u53bb\u83b7\u53d6\u5bf9\u8c61\u4e0a\u7684\u9501\u3002notify()\u65b9\u6cd5\u4f1a\u5bfc\u81f4\u6b7b\u9501\uff0c\u800cnotifyAll()\u65b9\u6cd5\u4e0d\u4f1a\u3002</p> <pre><code>public void productFood() {\n    synchronized(this.lock) {\n        while(this.foodTotal == 5) {\n            try {\n                this.lock.wait();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        /*\n        * \u6b64\u65f6\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\uff0c\u5982\u679c\u73b0\u5728foodTotal = 4\uff0c\n        * \u6267\u884c\u8fc7\u4e0b\u4e00\u53e5\u540efoodTotal=5,\u5982\u679c\u4f7f\u7528notify\u65b9\u6cd5\u6b63\u597d\u5524\u9192\u7684\u662f\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528productFood()\u65b9\u6cd5\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u5c31\u4f1a\u8fdb\u5165wait()\u72b6\u6001\u3002\u6b64\u65f6\u6ca1\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u662frunning\u72b6\u6001\uff0c\u53ef\u4ee5\u8c03\u7528nofify()\u65b9\u6cd5\u5524\u9192\u5176\u4ed6\u7ebf\u7a0b\uff0c\u4e8e\u662f\u5c31\u53d1\u751f\u4e86\u6b7b\u9501\u3002\n        */\n        foodTotal = foodTotal + 1;\n\n        //this.lock.notifyAll();\n        this.lock.notify();\n    }\n}\n</code></pre> <p>\u8fde\u7eed\u8c03\u7528\u591a\u6b21Thread\u7684start()\u65b9\u6cd5\u4f1a\u600e\u4e48\u6837\uff1f  </p> <p>\u4f1a\u629b\u51faThread\u7684\u72b6\u6001\u5f02\u5e38  </p> <pre><code> public synchronized void start() {\n    /**\n    *A zero status value corresponds to state \"NEW\". \u65b0\u521b\u5efa\u7684Thread\u7684status==0\n    */\n    if (threadStatus != 0)\n            throw new IllegalThreadStateException();\n    ...\n }\n</code></pre>"},{"location":"Java/2018-02-22-basicknowledge-java/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<p>\u53c2\u8003\u94fe\u63a51</p>"},{"location":"Java/2018-02-22-designpattern-java/","title":"Java design pattern","text":"<p>Design Pattern</p>"},{"location":"Java/2018-03-22-concurrent-java/","title":"Java\u5e76\u53d1\u57fa\u7840","text":""},{"location":"Java/2018-03-22-concurrent-java/#1","title":"1. \u8ba1\u7b97\u673a\u786c\u4ef6\u67b6\u6784\u7684\u7b80\u5355\u56fe\u793a","text":"<p>\u4e00\u4e2a\u5178\u578b\u7684CPU\u67b6\u6784  </p> <p> </p> <p>\u7279\u70b9\u5982\u4e0b\uff1a  </p> <ul> <li>\u591a\u4e2aCPU  </li> <li>CPU\u5bc4\u5b58\u5668  </li> <li>\u9ad8\u901f\u7f13\u5b58Cache  </li> <li>\u5185\u5b58  </li> </ul> <p>\u7531\u4e8e\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u8bbe\u5907\u4e0e\u5904\u7406\u5668\u7684\u8fd0\u7b97\u80fd\u529b\u4e4b\u95f4\u6709\u51e0\u4e2a\u6570\u91cf\u7ea7\u7684\u5dee\u8ddd\uff0c\u6240\u4ee5\u73b0\u4ee3\u8ba1\u7b97\u673a\u7cfb\u7edf\u90fd\u4e0d\u5f97\u4e0d\u52a0\u5165\u4e00\u5c42\u8bfb\u5199\u901f\u5ea6\u5c3d\u53ef\u80fd\u63a5\u8fd1\u5904\u7406\u5668\u8fd0\u7b97\u901f\u5ea6\u7684\u9ad8\u901f\u7f13\u5b58(cache)\u6765\u4f5c\u4e3a\u5185\u5b58\u4e0e\u5904\u7406\u5668\u4e4b\u95f4\u7684\u7f13\u51b2\uff1a\u5c06\u8fd0\u7b97\u9700\u8981\u4f7f\u7528\u5230\u7684\u6570\u636e\u590d\u5236\u5230\u7f13\u5b58\u4e2d\uff0c\u8ba9\u8fd0\u7b97\u80fd\u5feb\u901f\u8fdb\u884c\uff0c\u5f53\u8fd0\u7b97\u7ed3\u675f\u540e\u518d\u4ece\u7f13\u5b58\u540c\u6b65\u56de\u5185\u5b58\u4e4b\u4e2d\uff0c\u8fd9\u6837\u5904\u7406\u5668\u5c31\u65e0\u9700\u7b49\u5f85\u7f13\u6162\u7684\u5185\u5b58\u8bfb\u5199\u4e86\u3002 \u57fa\u4e8e\u9ad8\u901f\u7f13\u5b58\u7684\u5b58\u50a8\u4ea4\u4e92\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u5904\u7406\u5668\u4e0e\u5185\u5b58\u7684\u901f\u5ea6\u77db\u76fe\uff0c\u4f46\u662f\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff1a\u7f13\u5b58\u4e00\u81f4\u6027\uff08Cache Coherence\uff09\u3002\u5728\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u5904\u7406\u5668\u90fd\u6709\u81ea\u5df1\u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u800c\u4ed6\u4eec\u53c8\u5171\u4eab\u540c\u4e00\u4e3b\u5b58\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\u591a\u4e2a\u5904\u7406\u5668\u8fd0\u7b97\u4efb\u52a1\u90fd\u6d89\u53ca\u540c\u4e00\u5757\u4e3b\u5b58\uff0c\u9700\u8981\u4e00\u79cd\u534f\u8bae\u53ef\u4ee5\u4fdd\u969c\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u8fd9\u7c7b\u534f\u8bae\u6709MSI\u3001MESI\u3001MOSI\u53caDragon Protocol\u7b49\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u4e3a\u4e86\u4f7f\u5f97\u5904\u7406\u5668\u5185\u90e8\u7684\u8fd0\u7b97\u5355\u5143\u80fd\u5c3d\u53ef\u80fd\u88ab\u5145\u5206\u5229\u7528\uff0c\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u5bf9\u8f93\u5165\u4ee3\u7801\u8fdb\u884c\u4e71\u5e8f\u6267\u884c\uff08Out-Of-Order Execution\uff09\u4f18\u5316\uff0c\u5904\u7406\u5668\u4f1a\u5728\u8ba1\u7b97\u4e4b\u540e\u5c06\u5bf9\u4e71\u5e8f\u6267\u884c\u7684\u4ee3\u7801\u8fdb\u884c\u7ed3\u679c\u91cd\u7ec4\uff0c\u4fdd\u8bc1\u7ed3\u679c\u51c6\u786e\u6027\u3002\u4e0e\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u4f18\u5316\u7c7b\u4f3c\uff0cJava\u865a\u62df\u673a\u7684\u5373\u65f6\u7f16\u8bd1\u5668\u4e2d\u4e5f\u6709\u7c7b\u4f3c\u7684\u6307\u4ee4\u91cd\u6392\u5e8f\uff08Instruction Recorder\uff09\u4f18\u5316\u3002</p>"},{"location":"Java/2018-03-22-concurrent-java/#2-javajava-memory-model-jmm","title":"2. Java\u5185\u5b58\u6a21\u578b(Java Memory Model, JMM)","text":"<p>Java\u865a\u62df\u673a\u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86Java\u5185\u5b58\u6a21\u578b(Java Memory Model\uff0cJMM),\u7528\u4e8e\u5c4f\u853d\u6389\u5404\u79cd\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u8bbf\u95ee\u5dee\u5f02\uff0c\u4ee5\u5b9e\u73b0\u8ba9Java\u7a0b\u5e8f\u5728\u5404\u79cd\u5e73\u53f0\u4e0b\u90fd\u80fd\u8fbe\u5230\u4e00\u81f4\u7684\u5e76\u53d1\u6548\u679c\uff0cJMM\u89c4\u8303\u4e86Java\u865a\u62df\u673a\u4e0e\u8ba1\u7b97\u673a\u5185\u5b58\u662f\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u7684\uff1a\u89c4\u5b9a\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u5982\u4f55\u548c\u4f55\u65f6\u53ef\u4ee5\u770b\u5230\u7531\u5176\u4ed6\u7ebf\u7a0b\u4fee\u6539\u8fc7\u540e\u7684\u5171\u4eab\u53d8\u91cf\u7684\u503c\uff0c\u4ee5\u53ca\u5728\u5fc5\u987b\u65f6\u5982\u4f55\u540c\u6b65\u7684\u8bbf\u95ee\u5171\u4eab\u53d8\u91cf.</p> <p> </p> <p>Java\u5185\u5b58\u6a21\u578b\u901a\u8fc7\u56fe\u4e2d\u7684\u516b\u79cd\u64cd\u4f5c\u6765\u5b8c\u6210\u53d8\u91cf\u4ece\u4e3b\u5185\u5b58\u52a0\u8f7d\u5230\u5de5\u4f5c\u5185\u5b58\uff0c\u7136\u540e\u4ece\u5de5\u4f5c\u5185\u5b58\u540c\u6b65\u5230\u4e3b\u5185\u5b58.  </p> <p>Lock \u2192 Read \u2192 Load \u2192 Use \u2192 Assign \u2192 Store \u2192 Write \u2192 Unlock    </p> <p>JMM \u8981\u6c42\u8fd9\u4e2a\u8fc7\u7a0b\u5fc5\u987b\u6309\u987a\u5e8f\u6267\u884c\uff0c\u4f46\u662f\u53ef\u4ee5\u4e0d\u5fc5\u8fde\u7eed\u6267\u884c\uff01\u4e3e\u4e2a\u6817\u5b50\uff1a\uff08Read A\uff0cRead B, Load B, Load A, Store B, Write B, Store A, Write A\uff09\u3002 \u6b64\u5916\uff0cJMM\u8fd8\u89c4\u5b9a\u4e86\u6267\u884c\u4e0a\u8ff08\u4e2a\u64cd\u4f5c\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u89c4\u5219\uff1a - \u4e0d\u5141\u8bb8read\u548cload\u3001store\u548cwrite\u64cd\u4f5c\u4e4b\u4e00\u5355\u72ec\u51fa\u73b0</p> <ul> <li> <p>\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u4e22\u5f03\u5b83\u7684\u6700\u8fd1assign\u7684\u64cd\u4f5c\uff0c\u5373\u53d8\u91cf\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u6539\u53d8\u4e86\u4e4b\u540e\u5fc5\u987b\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d</p> </li> <li> <p>\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u65e0\u539f\u56e0\u5730\uff08\u6ca1\u6709\u53d1\u751f\u8fc7\u4efb\u4f55assign\u64cd\u4f5c\uff09\u628a\u6570\u636e\u4ece\u5de5\u4f5c\u5185\u5b58\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d</p> </li> <li> <p>\u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\u53ea\u80fd\u5728\u4e3b\u5185\u5b58\u4e2d\u8bde\u751f\uff0c\u4e0d\u5141\u8bb8\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a\u672a\u88ab\u521d\u59cb\u5316\uff08load\u6216assign\uff09\u7684\u53d8\u91cf\u3002\u5373\u5c31\u662f\u5bf9\u4e00\u4e2a\u53d8\u91cf\u5b9e\u65bduse\u548cstore\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u6267\u884c\u8fc7\u4e86assign\u548cload\u64cd\u4f5c</p> </li> <li> <p>\u4e00\u4e2a\u53d8\u91cf\u5728\u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u6761\u7ebf\u7a0b\u5bf9\u5176\u8fdb\u884clock\u64cd\u4f5c\uff0clock\u548cunlock\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0</p> </li> <li> <p>\u5982\u679c\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884clock\u64cd\u4f5c\uff0c\u5c06\u4f1a\u6e05\u7a7a\u5de5\u4f5c\u5185\u5b58\u4e2d\u6b64\u53d8\u91cf\u7684\u503c\uff0c\u5728\u6267\u884c\u5f15\u64ce\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u524d\u9700\u8981\u91cd\u65b0\u6267\u884cload\u6216assign\u64cd\u4f5c\u521d\u59cb\u5316\u53d8\u91cf\u7684\u503c</p> </li> <li> <p>\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u4e8b\u5148\u6ca1\u6709\u88ablock\u64cd\u4f5c\u9501\u5b9a\uff0c\u5219\u4e0d\u5141\u8bb8\u5bf9\u5b83\u6267\u884cunlock\u64cd\u4f5c\uff1b\u4e5f\u4e0d\u5141\u8bb8\u53bbunlock\u4e00\u4e2a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a\u7684\u53d8\u91cf</p> </li> <li> <p>\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884cunlock\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u628a\u6b64\u53d8\u91cf\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\uff08\u6267\u884cstore\u548cwrite\u64cd\u4f5c\uff09  </p> </li> </ul> <p>JMM \u4f7f\u7528\u5148\u884c\u53d1\u751f\uff08happens-before\uff09\u539f\u5219\u6765\u786e\u5b9a\u4e00\u4e2a\u5185\u5b58\u8bbf\u95ee\u5728\u5e76\u53d1\u73af\u5883\u4e2d\u662f\u5426\u5b89\u5168</p>"},{"location":"Java/2018-03-22-concurrent-java/#21-happens-before","title":"2.1 \u5148\u884c\u53d1\u751f\uff08happens-before\uff09 \u6982\u5ff5","text":"<p>\u4e00\u53e5\u8bdd\u6982\u62ec\uff1a\u64cd\u4f5cA\u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cB\uff0c\u64cd\u4f5cA\u7684\u5f71\u54cd\u4f1a\u88ab\u64cd\u4f5cB\u89c2\u5bdf\u5230 \u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u60c5\u51b5:</p> <ul> <li> <p>\u7a0b\u5e8f\u6b21\u5e8f\u89c4\u5219(Program Order Rule)\uff1a \u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u6309\u7167\u7a0b\u5e8f\u4ee3\u7801\u987a\u5e8f\uff0c\u4e66\u5199\u5728\u524d\u9762\u7684\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u4e66\u5199\u5728\u540e\u9762\u7684\u64cd\u7eb5\u3002\u51c6\u786e\u7684\u8bf4\u662f\u7a0b\u5e8f\u7684\u63a7\u5236\u6d41\u987a\u5e8f\uff0c\u8003\u8651\u5206\u652f\u548c\u5faa\u73af\u7b49\u3002</p> </li> <li> <p>\u7ba1\u7406\u9501\u5b9a\u89c4\u5219(Monitor Lock Rule)\uff1a\u4e00\u4e2aunlock\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\uff08\u65f6\u95f4\u4e0a\u7684\u987a\u5e8f\uff09\u5bf9\u540c\u4e00\u4e2a\u9501\u7684lock\u64cd\u4f5c\u3002</p> </li> <li> <p>volatile\u53d8\u91cf\u89c4\u5219(Volatile Variable Rule)\uff1a\u5bf9\u4e00\u4e2avolatile\u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\uff08\u65f6\u95f4\u4e0a\u7684\u987a\u5e8f\uff09\u5bf9\u8be5\u53d8\u91cf\u7684\u8bfb\u64cd\u4f5c\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u542f\u52a8\u89c4\u5219(Thread Start Rule)\uff1aThread\u5bf9\u8c61\u7684start()\u65b9\u6cd5\u5148\u884c\u53d1\u751f\u4e8e\u6b64\u7ebf\u7a0b\u7684\u6bcf\u4e00\u4e2a\u52a8\u4f5c\u3002  </p> </li> <li> <p>\u7ebf\u7a0b\u7ec8\u6b62\u89c4\u5219(Thread Termination Rule)\uff1a\u7ebf\u7a0b\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u5148\u884c\u53d1\u751f\u4e8e\u5bf9\u6b64\u7ebf\u7a0b\u7684\u7ec8\u6b62\u68c0\u6d4b\uff0c\u53ef\u4ee5\u901a\u8fc7Thread.join()\u65b9\u6cd5\u7ed3\u675f\u3001Thread.isAlive()\u7684\u8fd4\u56de\u503c\u7b49\u624b\u6bb5\u68c0\u6d4b\u5230\u7ebf\u7a0b\u5df2\u7ecf\u7ec8\u6b62\u6267\u884c\u3002  </p> </li> <li> <p>\u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219(Thread Interruption Rule)\uff1a\u5bf9\u7ebf\u7a0binterrupt()\u65b9\u6cd5\u7684\u8c03\u7528\u5148\u884c\u53d1\u751f\u4e8e\u88ab\u4e2d\u65ad\u7ebf\u7a0b\u7684\u4ee3\u7801\u68c0\u6d4b\u5230\u4e2d\u65ad\u65f6\u4e8b\u4ef6\u7684\u53d1\u751f\u3002Thread.interrupted()\u53ef\u4ee5\u68c0\u6d4b\u662f\u5426\u6709\u4e2d\u65ad\u53d1\u751f\u3002  </p> </li> <li> <p>\u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219(Finilizer Rule)\uff1a\u4e00\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u5b8c\u6210\uff08\u6784\u9020\u51fd\u6570\u6267\u884c\u7ed3\u675f\uff09\u5148\u884c\u53d1\u751f\u4e8e\u5b83\u7684finalize()\u7684\u5f00\u59cb\u3002  </p> </li> <li> <p>\u4f20\u9012\u6027(Transitivity)\uff1a\u5982\u679c\u64cd\u4f5cA \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cB\uff0c\u64cd\u4f5cB \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cC\uff0c\u90a3\u4e48\u53ef\u4ee5\u5f97\u51faA \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cC\u3002  </p> </li> </ul> <p>\u4e0d\u540c\u64cd\u4f5c\u65f6\u95f4\u5148\u540e\u987a\u5e8f\u4e0e\u5148\u884c\u53d1\u751f\u539f\u5219\u4e4b\u95f4\u6ca1\u6709\u5173\u7cfb\uff0c\u4e8c\u8005\u4e0d\u80fd\u76f8\u4e92\u63a8\u65ad\uff0c\u8861\u91cf\u5e76\u53d1\u5b89\u5168\u95ee\u9898\u4e0d\u80fd\u53d7\u5230\u65f6\u95f4\u987a\u5e8f\u7684\u5e72\u6270\uff0c\u4e00\u5207\u90fd\u8981\u4ee5happens-before\u539f\u5219\u4e3a\u51c6.  </p>"},{"location":"Java/2018-03-22-concurrent-java/#22-volatile","title":"2.2 Volatile \u53d8\u91cf\u7684\u4e24\u79cd\u7279\u6027","text":"<ul> <li>\u4fdd\u6301\u53d8\u91cf\u7684\u53ef\u89c1\u6027  </li> <li>\u5c4f\u853d\u6307\u4ee4\u91cd\u6392\u5e8f  </li> </ul>"},{"location":"Java/2018-03-22-concurrent-java/#23-longdouble","title":"2.3 long/double\u975e\u539f\u5b50\u534f\u5b9a","text":"<p>\u5141\u8bb8\u865a\u62df\u673a\u5c06\u6ca1\u6709\u88abvolatile\u4fee\u9970\u768464\u4f4d\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\u5212\u5206\u4e3a2\u6b2132\u4f4d\u64cd\u4f5c\u8fdb\u884c  </p>"},{"location":"Java/2018-03-22-concurrent-java/#3-jmm","title":"3. JMM\u7684\u56db\u4e2a\u7279\u6027","text":""},{"location":"Java/2018-03-22-concurrent-java/#31","title":"3.1 \u539f\u5b50\u6027","text":"<p>JMM\u4fdd\u8bc1\u7684\u539f\u5b50\u6027\u53d8\u91cf\u64cd\u4f5c\u5305\u62ecread\u3001load\u3001use\u3001assign\u3001store\u3001write\uff0c\u800clong\u3001double\u975e\u539f\u5b50\u534f\u5b9a\u5bfc\u81f4\u7684\u975e\u539f\u5b50\u6027\u64cd\u4f5c\u57fa\u672c\u53ef\u4ee5\u5ffd\u7565\u3002  </p>"},{"location":"Java/2018-03-22-concurrent-java/#32","title":"3.2 \u53ef\u89c1\u6027","text":"<p>\u53ef\u89c1\u6027\u662f\u6307\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u5f97\u77e5\u8fd9\u4e2a\u4fee\u6539\u3002JMM\u5728\u53d8\u91cf\u4fee\u6539\u540e\u5c06\u65b0\u503c\u540c\u6b65\u56de\u4e3b\u5185\u5b58\uff0c\u4f9d\u8d56\u4e3b\u5185\u5b58\u4f5c\u4e3a\u5a92\u4ecb\uff0c\u5728\u53d8\u91cf\u88ab\u7ebf\u7a0b\u8bfb\u53d6\u524d\u4ece\u5185\u5b58\u5237\u65b0\u53d8\u91cf\u65b0\u503c\uff0c\u4fdd\u8bc1\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u3002\u666e\u901a\u53d8\u91cf\u548cvolatile\u53d8\u91cf\u90fd\u662f\u5982\u6b64\uff0c\u53ea\u4e0d\u8fc7volatile\u7684\u7279\u6b8a\u89c4\u5219\u4fdd\u8bc1\u4e86\u8fd9\u79cd\u53ef\u89c1\u6027\u662f\u7acb\u5373\u5f97\u77e5\u7684\uff0c\u800c\u666e\u901a\u53d8\u91cf\u5e76\u4e0d\u5177\u5907\u8fd9\u79cd\u4e25\u683c\u7684\u53ef\u89c1\u6027\u3002\u9664\u4e86volatile\u5916\uff0csynchronized\u548cfinal\u4e5f\u80fd\u4fdd\u8bc1\u53ef\u89c1\u6027\u3002  </p>"},{"location":"Java/2018-03-22-concurrent-java/#33","title":"3.3 \u6709\u5e8f\u6027","text":"<p>JVM\u7684\u6709\u5e8f\u6027\u8868\u73b0\u4e3a\uff1a\u5982\u679c\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u6709\u5e8f\u7684\uff1b\u5982\u679c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u89c2\u5bdf\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\u3002</p>"},{"location":"Java/2018-03-22-concurrent-java/#34","title":"3.4 \u91cd\u6392\u5e8f","text":"<p>\u5728\u6267\u884c\u7a0b\u5e8f\u65f6\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u7ecf\u5e38\u4f1a\u5bf9\u6307\u4ee4\u8fdb\u884c\u91cd\u6392\u5e8f\u3002\u4ece\u786c\u4ef6\u67b6\u6784\u4e0a\u6765\u8bf4\uff0c\u6307\u4ee4\u91cd\u6392\u5e8f\u662f\u6307CPU\u91c7\u7528\u4e86\u5141\u8bb8\u5c06\u591a\u6761\u6307\u4ee4\u4e0d\u6309\u7167\u7a0b\u5e8f\u89c4\u5b9a\u7684\u987a\u5e8f\uff0c\u5206\u5f00\u53d1\u9001\u7ed9\u5404\u4e2a\u76f8\u5e94\u7535\u8def\u5355\u5143\u5904\u7406\uff0c\u800c\u4e0d\u662f\u6307\u4ee4\u4efb\u610f\u91cd\u6392\u3002 - \u7f16\u8bd1\u5668\u4f18\u5316\u7684\u91cd\u6392\u5e8f - \u6307\u4ee4\u7ea7\u5e76\u884c\u7684\u91cd\u6392\u5e8f - \u5185\u5b58\u7cfb\u7edf\u7684\u91cd\u6392\u5e8f  </p> <p>\u6e90\u4ee3\u7801 \u2192 \u7f16\u8bd1\u5668\u4f18\u5316\u7684\u91cd\u6392\u5e8f \u2192 \u6307\u4ee4\u7ea7\u5e76\u884c\u7684\u91cd\u6392\u5e8f \u2192 \u5185\u5b58\u7cfb\u7edf\u7684\u91cd\u6392\u5e8f \u2192 \u6700\u7ec8\u6267\u884c</p>"},{"location":"Java/2018-03-22-concurrent-java/#4-javareentrantlock","title":"4. Java\u4e2d\u7684ReentrantLock","text":"<p>\u4e00\u4e2a\u7ebf\u7a0b\u5982\u679c\u5df2\u7ecf\u83b7\u5f97\u4e00\u4e2a\u5bf9\u8c61\u7684\u9501\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u5728\u6301\u6709\u9501\u7684\u671f\u95f4\u53ef\u4ee5\u91cd\u590d\u591a\u6b21\u83b7\u5f97\u6539\u5bf9\u8c61\u7684\u9501\u3002Java\u4e2d\u7684synchronized\u5757\u662f\u53ef\u4ee5\u88ab\u91cd\u5165\u7684\u3002\u5f53\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u6fc0\u70c8\u7ade\u4e89\u7684\u65f6\u5019\uff0c\u4f7fCPU\u51cf\u5c11\u9891\u7e41\u7684\u7ebf\u7a0b\u8c03\u5ea6\uff0c\u662f\u7ebf\u7a0b\u7684\u6267\u884c\u6548\u7387\u66f4\u9ad8\u3002 ReentrantLock\u6709\u4e24\u79cd\u5b9e\u73b0\uff0c\u4e00\u79cd\u662f\u516c\u5e73\u9501\uff0c\u53e6\u5916\u4e00\u79cd\u662f\u975e\u516c\u5e73\u9501\u3002\u516c\u5e73\u9501\u5c31\u662f\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u83b7\u53d6\u67d0\u4e2a\u9501\u7684\u65f6\u95f4\u6700\u957f\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u6700\u5148\u83b7\u5f97\u9501\u3002\u800c\u975e\u516c\u5e73\u9501\u5219\u4e0d\u4e00\u5b9a\u3002</p>"},{"location":"Java/2018-03-22-concurrent-java/#41","title":"4.1 \u5982\u4f55\u4f7f\u7528","text":"<pre><code>    //\u516c\u5e73\u9501new ReentrantLock(true),\u975e\u516c\u5e73\u9501new ReentrantLock(false)[\u63a8\u8350]\n    Lock lock = new ReentrantLock(false);   \n    lock.lock();  \n    try {   \n      //\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u64cd\u4f5c\n    }  \n    finally {  \n      lock.unlock();   \n    }  \n</code></pre>"},{"location":"Java/2018-03-22-concurrent-java/#42","title":"4.2 \u901a\u8fc7\u4ee3\u7801\u6765\u770b\u5982\u4f55\u5b9e\u73b0","text":"<pre><code>//\u975e\u516c\u5e73\u9501\nstatic final class NonfairSync extends Sync {\n        final void lock() {\n        //\u5982\u679cCAS\u6210\u529f\uff0c\u5c06\u5f53\u524d\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u8d44\u6e90\u7684\u6301\u6709\u8005\n            if (compareAndSetState(0, 1))\n                setExclusiveOwnerThread(Thread.currentThread());\n            else\n        //\u5426\u5219\uff0c\u5c1d\u8bd5\u7533\u8bf7\u8d44\u6e90\n                acquire(1);\n        }\n\n        protected final boolean tryAcquire(int acquires) {\n            //\u4f7f\u7528\u975e\u516c\u5e73\u9501\u7684\u673a\u5236\u53bb\u83b7\u53d6\u8d44\u6e90\n            return nonfairTryAcquire(acquires);\n        }\n    }\n\n    final boolean nonfairTryAcquire(int acquires) {\n            final Thread current = Thread.currentThread();\n            int c = getState();\n            //\u5982\u679c\u5177\u5907\u83b7\u53d6\u8d44\u6e90\u7684\u6761\u4ef6\uff0c\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e3a\u8d44\u6e90\u7684\u6301\u6709\u8005\uff0c\u8fd4\u56de\n            if (c == 0) {\n                if (compareAndSetState(0, acquires)) {\n                    setExclusiveOwnerThread(current);\n                    return true;\n                }\n            }\n            //\u5982\u679c\u53d1\u73b0\u7533\u8bf7\u8d44\u6e90\u7684\u7ebf\u7a0b\u662f\u6301\u6709\u8be5\u8d44\u6e90\u7ebf\u7a0b\u672c\u8eab\uff0c\u5219\u5c06\u72b6\u6001\u52a01,\u8fd4\u56de\n            else if (current == getExclusiveOwnerThread()) {\n                int nextc = c + acquires;\n                if (nextc &lt; 0) // overflow\n                    throw new Error(\"Maximum lock count exceeded\");\n                setState(nextc);\n                return true;\n            }\n            return false;\n        }\n\n\n//\u516c\u5e73\u9501\nstatic final class FairSync extends Sync {\n        private static final long serialVersionUID = -3000897897090466540L;\n\n        final void lock() {\n            acquire(1);\n        }\n\n        /**\n         * Fair version of tryAcquire.  Don't grant access unless\n         * recursive call or no waiters or is first.\n         */\n        protected final boolean tryAcquire(int acquires) {\n            final Thread current = Thread.currentThread();\n            int c = getState();\n            if (c == 0) {\n                //\u6b64\u5904\u591a\u4e00\u4e2a\u6761\u4ef6\uff0c\u8be5\u7ebf\u7a0b\u524d\u9762\u6ca1\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u5728\u7b49\u5f85\u83b7\u53d6\u5171\u4eab\u8d44\u6e90\u7684\u9501\n                if (!hasQueuedPredecessors() &amp;&amp;\n                    compareAndSetState(0, acquires)) {\n                    setExclusiveOwnerThread(current);\n                    return true;\n                }\n            }\n            else if (current == getExclusiveOwnerThread()) {\n                int nextc = c + acquires;\n                if (nextc &lt; 0)\n                    throw new Error(\"Maximum lock count exceeded\");\n                setState(nextc);\n                return true;\n            }\n            return false;\n        }\n    }\n</code></pre>"},{"location":"Java/2018-03-22-concurrent-java/#5-read-write-locks","title":"5. Read / Write Locks","text":"<p>ReentrantReadWriteLock\u662fReadWriteLock\u7684\u4e00\u79cd\u5b9e\u73b0\uff0c\u8be5\u7c7b\u5305\u542b\u4e24\u4e2a\u9501\uff0c\u4e00\u4e2a\u662f\u8bfb\u9501\uff0c\u4e00\u4e2a\u662f\u5199\u9501\u3002 <pre><code>public ReentrantReadWriteLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n    //\u8bfb\u9501\n    readerLock = new ReadLock(this);\n    //\u5199\u9501\n    writerLock = new WriteLock(this);\n    }\n</code></pre> \u5199\u9501\u7684\u7533\u8bf7\u6761\u4ef6: <pre><code>/**\n * \u7533\u8bf7\u5199\u9501.\n *\n * 1.\u8be5\u7ebf\u7a0b\u7533\u8bf7\u7684\u65f6\u523b\u6ca1\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6301\u6709\u8bfb\u9501\u6216\u8005\u5199\u9501\uff0c\u7533\u8bf7\u6210\u529f\u540e\u5c06\u5199\u9501\u7684\u6301\u6709\u6570\u76ee\u66f4\u65b0\u4e3a1.  \n * 2.\u5982\u679c\u8be5\u7ebf\u7a0b\u7533\u8bf7\u7684\u65f6\u523b\u5df2\u7ecf\u6301\u6709\u5199\u9501\uff0c\u4ec5\u4ec5\u5c06\u6301\u6709\u7684\u6570\u76ee+1.  \n * 3.\u8be5\u7ebf\u7a0b\u7533\u8bf7\u7684\u65f6\u523b\u5982\u679c\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6b63\u5728\u6301\u6709\u5199\u9501\uff0c\u5219\u5f53\u524d\u7684\u7ebf\u7a0b\u5c06\u4e0d\u4f1a\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u5668\u8c03\u5ea6\u5c06\u4f1a\u8fdb\u5165lies dormant\u72b6\u6001\uff0c\u53ea\u81f3\u8be5\u7ebf\u7a0b\u83b7\u5f97\u5199\u9501.  \n * \u6210\u529f\u540e\u5c06\u5199\u9501\u7684\u6301\u6709\u6570\u76ee\u66f4\u65b0\u4e3a1.\n */\npublic void lock() {\n    sync.acquire(1);\n} \n/**\n    * \u7533\u8bf7\u8bfb\u9501.\n    *\n    * 1.\u8be5\u7ebf\u7a0b\u7533\u8bf7\u65f6\u523b\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u6301\u6709\u5199\u9501\u3002  \n    * 2.\u8be5\u7ebf\u7a0b\u7533\u8bf7\u7684\u65f6\u523b\u5982\u679c\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6b63\u5728\u6301\u6709\u5199\u9501\uff0c\u5219\u5f53\u524d\u7684\u7ebf\u7a0b\u5c06\u4e0d\u4f1a\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u5668\u8c03\u5ea6\u5c06\u4f1a\u8fdb\u5165lies dormant\u72b6\u6001\uff0c\u53ea\u81f3\u8be5\u7ebf\u7a0b\u83b7\u5f97\u8bfb\u9501.\n    */\npublic void lock() {\n    sync.acquireShared(1);\n}\n</code></pre></p>"},{"location":"Java/2018-03-22-concurrent-java/#6-executorservice","title":"6. ExecutorService","text":"<pre><code>ExecutorService fixedThreadPool =Executors.newFixedThreadPool(9);\n    fixedThreadPool.execute(new Thread() {public void run() {\n        //operation\n    }});\nExecutorService singleThreadPool =Executors.newSingleThreadExecutor();\nExecutorService cachedThreadPool =Executors.newCachedThreadPool();\n</code></pre>"},{"location":"Java/2018-03-22-concurrent-java/#7-countdownlatch","title":"7. CountDownLatch","text":"<p>\u4e00\u822c\u7528\u4e8e\u4e3b\u7ebf\u7a0b\u6267\u884c\u67d0\u4e9b\u6307\u4ee4\u4e4b\u524d\uff0c\u9700\u8981\u7b49\u5f85\u5176\u4ed6\u7684\u51e0\u4e2a\u7ebf\u7a0b\u5168\u90e8\u5b8c\u6210.</p> <pre><code>public class Test {\n    public static void main(String[] args) {\n        //\u4e3b\u7ebf\u7a0b\u4e2d\u521b\u5efa\u4e00\u4e2aCountDownLatch\u5bf9\u8c61,\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u8868\u793a\u7ebf\u7a0b\u7684\u6570\u76ee\n        CountDownLatch countDownLatch = new CountDownLatch(5);\n        for (int i = 0; i &lt; 5; i++) {\n            Thread thread = new MyThread(countDownLatch);\n            thread.setName(\"Thread \" + i);\n            thread.start();\n        }\n        try {\n            //\u8c03\u7528await\u65b9\u6cd5\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5168\u90e8\u5b8c\u6210\n            countDownLatch.await();\n        } catch (InterruptedException e) {\n        }\n        System.out.println(\"All pre Job are done.\");\n    }\n}\n\nclass MyThread extends Thread {\n    private CountDownLatch countDownLatch;\n    public MyThread(CountDownLatch countDownLatch) {\n        this.countDownLatch = countDownLatch;\n    }\n    public void run() {\n        System.out.println(getName() + \" is Done!\");\n        //\u4f7f\u7528CountDownLatch\u5bf9\u8c61\u9012\u51cf\u5df2\u7ecf\u5b8c\u6210\u7684\u7ebf\u7a0b\u6570\u91cf\n        countDownLatch.countDown();\n    }\n}\n</code></pre>"},{"location":"Java/2018-03-22-concurrent-java/#8-future","title":"8. Future\u7c7b\u7684\u4f7f\u7528","text":"<p>Future \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u83b7\u5f97\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u7684\u8fd4\u56de\u503c. Future\u6ca1\u6709\u63d0\u4f9b\u7ebf\u7a0b\u5b8c\u6210\u901a\u77e5\u7684\u673a\u5236\uff0c\u53ea\u80fd\u901a\u8fc7\u8f6e\u8be2\u8c03\u7528isDone()\u65b9\u6cd5\u6216\u8005\u8c03\u7528get()\u65b9\u6cd5\u963b\u585e\u7ebf\u7a0b\u6765\u83b7\u5f97\u7ed3\u679c\u3002</p> <pre><code>boolean cancel(boolean mayInterruptIfRunning);\nboolean isCancelled();\nboolean isDone();\nV get() throws InterruptedException, ExecutionException;\nV get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n</code></pre> <p>Java8 \u63d0\u4f9b\u7684CompletableFuture\u53ef\u4ee5\u5f25\u8865Future\u7684\u4e0d\u8db3,\u8ba9Java\u62e5\u6709\u4e86\u5b8c\u6574\u7684\u975e\u963b\u585e\u7f16\u7a0b\u6a21\u578b.</p> <pre><code>public class CompletableFuture&lt;T&gt; implements Future&lt;T&gt;, CompletionStage&lt;T&gt; {}\n</code></pre>"},{"location":"Java/2018-03-22-concurrent-java/#9-javacas","title":"9. Java\u4e2d\u7684CAS","text":"<p>CAS\u662fcompare and swap \u7684\u7f29\u5199\u3002\u968f\u7740Java\u7684\u53d1\u5c55\uff0cJava\u672c\u5730\u65b9\u6cd5\u8c03\u7528(JNI)\u7684\u51fa\u73b0\uff0c\u4f7f\u5f97Java\u7a0b\u5e8f\u53ef\u4ee5\u8d8a\u8fc7JVM\u800c\u76f4\u63a5\u8c03\u7528\u672c\u5730\u65b9\u6cd5\uff0c\u8fd9\u4e3aJava\u5b9e\u73b0\u5e76\u53d1\u62d3\u5c55\u4e00\u6761\u65b0\u7684\u9014\u5f84\u3002CAS\u7406\u8bba\u662fjava concurrent\u5305\u7684\u7406\u8bba\u57fa\u77f3\u3002  </p> <p>Java\u53ef\u4ee5\u901a\u8fc7synchronized\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u540c\u6b65\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u6709\u4ee5\u4e0b\u5f0a\u7aef:  </p> <ul> <li> <p>\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\uff0c\u52a0\u9501\u548c\u91ca\u653e\u9501\uff0c\u6216\u5bfc\u81f4CPU\u6bd4\u8f83\u591a\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5f71\u54cd\u6027\u80fd\u3002</p> </li> <li> <p>\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u9501\uff0c\u4f1a\u5bfc\u81f4\u5176\u4ed6\u9700\u8981\u6b64\u9501\u7684\u7ebf\u7a0b\u6302\u8d77\u3002 </p> </li> <li> <p>\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u4f18\u5148\u7ea7\u9ad8\u7684\u53bb\u957f\u65f6\u95f4\u7b49\u5f85\u4f18\u5148\u7ea7\u6bd4\u8f83\u4f4e\u7684\u7ebf\u7a0b\u91ca\u653e\u9501\uff0c\u4e5f\u4f1a\u5f15\u8d77\u6027\u80fd\u98ce\u9669\u3002  </p> </li> </ul> <p>Synchronized\u5c31\u662f\u4e00\u79cd\u72ec\u5360\u9501\u6216\u8005\u662f\u60b2\u89c2\u9501\uff0c\u4e50\u89c2\u9501\u5c31\u662f\u6bcf\u6b21\u64cd\u4f5c\u90fd\u4e0d\u52a0\u9501\u800c\u662f\u5047\u8bbe\u8be5\u7ebf\u7a0b\u6ca1\u6709\u548c\u5176\u4ed6\u7ebf\u7a0b\u51b2\u7a81\uff0c\u5982\u679c\u6709\u51b2\u7a81\u5931\u8d25\u5c31\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff0c\u901a\u8fc7CAS\u53ef\u4ee5\u5b9e\u73b0\u4e50\u89c2\u9501\u3002  </p> <p>CAS\u5305\u542b\u4e09\u4e2a\u64cd\u4f5c\u6570:\u5185\u5b58\u4f4d\u7f6e(V), \u9884\u671f\u539f\u503c(A)\u548c\u65b0\u503c(B)\u3002\u5982\u679c\u5185\u5b58\u4f4d\u7f6e\u7684\u5f53\u524d\u503c\u4e0e\u9884\u671f\u539f\u503c\u4e00\u6837\uff0c\u90a3\u4e48\u5904\u7406\u5668\u5c31\u4f1a\u5c06\u65b0\u503c\u66f4\u65b0\u5185\u5b58\u4f4d\u7f6e(V)\u7684\u503c\u3002\u5426\u5219\uff0c\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u544a\u8bc9\u6211\u5185\u5b58\u4f4d\u7f6e(V)\u7684\u503c\u5c31\u597d\u4e86\u3002\u65e0\u8bba\u54ea\u79cd\u60c5\u51b5\uff0c\u5b83\u90fd\u4f1a\u5728 CAS\u6307\u4ee4\u4e4b\u524d\u8fd4\u56de\u8be5\u4f4d\u7f6e\u7684\u503c\u3002</p>"},{"location":"Java/2018-03-22-concurrent-java/#10-jvm-jdk18","title":"10. JVM\u5185\u5b58\u6a21\u578b (jdk1.8)","text":"<ul> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668 \u6bcf\u4e2aJVM\u7ebf\u7a0b\u90fd\u6709\u72ec\u81ea\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0cJVM\u7ebf\u7a0b\u6b63\u5728Running\u7684\u65b9\u6cd5\u79f0\u4e3acurrent method.\u5982\u679c\u8be5\u65b9\u6cd5\u4e0d\u662f\u4e00\u4e2anative\u65b9\u6cd5\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u6307\u5411\u6b63\u5728\u6267\u884c\u7684\u8bed\u53e5\u7684\u5730\u5740\uff0c\u5982\u679c\u8be5\u65b9\u6cd5\u662f\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5\uff0c\u90a3\u4e48\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u503c\u662fundefined.  </p> </li> <li> <p>Java\u865a\u62df\u673a\u6808 \u6bcf\u4e2aJVM\u7ebf\u7a0b\u90fd\u6709\u72ec\u81ea\u7684Java\u865a\u62df\u673a\u6808\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u521b\u5efa\u800c\u521b\u5efa\u3002\u6bcf\u4e2a\u65b9\u6cd5\u5728\u6267\u884c\u7684\u65f6\u5019\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u64cd\u4f5c\u6570\u6808\uff0c\u52a8\u6001\u94fe\u63a5\u548c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4fe1\u606f\u3002\u5c40\u90e8\u53d8\u91cf\u8868\u5b58\u653e\u4e86\u7f16\u8bd1\u671f\u53ef\u77e5\u7684\u5404\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b(boolean, byte, char, short, int, float, long, double),\u5bf9\u8c61\u5f15\u7528\u548creturnAddress\u7c7b\u578b\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5bf9Java\u865a\u62df\u673a\u6808\u76f4\u63a5\u64cd\u4f5c\uff0c\u9664\u4e86\u5bf9\u5e27\u8fdb\u884cpop\u548cpush\u64cd\u4f5c\uff0c\u56e0\u6b64\u8fd9\u5757\u5185\u5b58\u4e00\u822c\u4e0d\u662f\u8fde\u7eed\u7684\u3002 </p> </li> <li> <p>\u5806 \u5806\u88abJava\u865a\u62df\u673a\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\uff0c\u662f\u8fd0\u884c\u65f6\u7684\u6570\u636e\u533a\uff0c\u5b58\u653e\u7c7b\u7684\u5b9e\u4f8b\uff0c\u4ee5\u53ca\u5b58\u653e\u6570\u7ec4\u6570\u636e\u3002\u5806\u4e0a\u7684\u6570\u636e\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u6e05\u7406\u3002\u5806\u7684\u5927\u5c0f\u53ef\u4ee5\u662f\u56fa\u5b9a\u7684\u6216\u8005\u53ef\u4ee5\u88ab\u6269\u5c55\u3002\u5982\u679c\u7a0b\u5e8f\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u6240\u9700\u7684\u5806\u7684\u5927\u5c0f\u8d85\u51fa\u53ef\u63d0\u4f9b\u7684\u5bf9\u5927\u5c0f\uff0c\u5c06\u4f1a\u629b\u51faOOM\u5f02\u5e38\u3002 -Xmx \u548c -Xms\u8c03\u6574\u5927\u5c0f\u3002</p> </li> <li> <p>\u65b9\u6cd5\u533a\uff08\u903b\u8f91\u5806\uff09 \u5404\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u533a\u57df\uff0c\u5b58\u50a8\u5df2\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\uff0c\u5e38\u91cf\uff0c\u9759\u6001\u53d8\u91cf\uff0c\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7b49\u6570\u636e\u3002</p> </li> <li> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60 \u662f\u65b9\u6cd5\u533a\u7684\u4e00\u90e8\u5206\uff0c\u7528\u4e8e\u5b58\u653e\u7f16\u8bd1\u65f6\u671f\u751f\u6210\u7684\u5404\u79cd\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5c06\u5728\u7c7b\u52a0\u8f7d\u540e\u8fdb\u5165\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u5b58\u653e\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u533a Java\u865a\u62df\u673a\u53ef\u4ee5\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u8fd9\u4e9b\u672c\u5730\u65b9\u6cd5\u53ef\u80fd\u901a\u8fc7\u5176\u4ed6\u7684\u8bed\u8a00\u5b9e\u73b0\uff0c\u6bd4\u5982C\uff0cC++.\u672c\u5730\u65b9\u6cd5\u6808\u4e5f\u7528\u6765\u5b9e\u73b0\u4e00\u4e9b\u7528C\u8bed\u8a00\u5b9e\u73b0\u7684JVM\u6307\u4ee4\u3002\u672c\u5730\u65b9\u6cd5\u6808\u7684\u5927\u5c0f\u53ef\u4ee5\u662f\u56fa\u5b9a\u7684\uff0c\u4e5f\u53ef\u4ee5\u88ab\u52a8\u6001\u6269\u5c55\u3002</p> </li> <li> <p>\u5e27 \u5e27\u88ab\u5206\u914d\u5728\u6bcf\u4e2aJVM\u7ebf\u7a0b\u8fd0\u884c\u65f6\u7684Java\u865a\u62df\u673a\u6808\u4e0a\u3002\u968f\u7740\u65b9\u6cd5\u88ab\u8c03\u7528\u800c\u521b\u5efa\uff0c\u7528\u6765\u5b58\u653e\u65b9\u6cd5\u7684\u672c\u5730\u53d8\u91cf\uff0c\u90e8\u5206\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u6267\u884c\u52a8\u6001\u94fe\u63a5\uff0c\u6216\u8005\u5206\u53d1\u5f02\u5e38\u3002\u6bcf\u4e00\u4e2a\u5e27\u90fd\u62e5\u6709\u81ea\u5df1\u7684\u672c\u5730\u53d8\u91cf\u6570\u7ec4\uff0c\u64cd\u4f5c\u6808\uff0c\u4ee5\u53ca\u4e00\u4e2a\u5f53\u524d\u65b9\u6cd5\u7684\u5f15\u7528\uff0c\u8fd9\u4e2a\u5f15\u7528\u6307\u5411\u8fd0\u884c\u65f6\u7684\u5e38\u91cf\u6c60\u3002\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u51b3\u5b9a\u4e3a\u8be5\u65b9\u6cd5\u5206\u914d\u7684\u5e27\u5927\u5c0f\u3002\u5e27\u53ea\u80fd\u88ab\u521b\u5efa\u5b83\u7684\u7ebf\u7a0b\u4f7f\u7528\u3002\u4e0d\u80fd\u88ab\u5176\u4ed6\u7ebf\u7a0b\u5171\u4eab\u3002</p> </li> <li> <p>\u5143\u6570\u636e\u533a jdk1.8\u4e4b\u524d\u4f7f\u7528PermGen\u5b58\u653e\u7c7b\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5728jdk1.8\u4e2d\u7528\u5143\u6570\u636e\u533a\u5b58\u653e\u7c7b\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002\u5143\u6570\u636e\u533a\u662f\u5c5e\u4e8e\u7cfb\u7edf\u5185\u5b58\u7684\u4e00\u90e8\u5206\uff0c\u53ef\u4ee5\u6700\u5927\u53ef\u5229\u7528\u7a7a\u95f4\u662f\u6574\u4e2a\u7cfb\u7edf\u5185\u5b58\u7684\u53ef\u7528\u7a7a\u95f4\u3002  </p> <ul> <li>-XX:MetaspaceSize \u5143\u6570\u636e\u533a\u7684\u521d\u59cb\u7a7a\u95f4\u5927\u5c0f  </li> <li>-XX\uff1aMaxMetaspaceSize \u5143\u6570\u636e\u533a\u6700\u5927\u7a7a\u95f4\u5927\u5c0f  </li> <li>-XX\uff1aMinMetaspaceFreeRatio \u5728GC\u4e4b\u540e\uff0c\u6700\u5c0f\u7684Metaspace\u5269\u4f59\u7a7a\u95f4\u5bb9\u91cf\u7684\u767e\u5206\u6bd4\uff0c\u51cf\u5c11\u4e3aclass metadata\u5206\u914d\u7a7a\u95f4\u5bfc\u81f4\u7684\u5783\u573e\u6536\u96c6  </li> <li>-XX:MaxMetaspaceFreeRatio,\u5728GC\u4e4b\u540e\uff0c\u6700\u5927\u7684Metaspace\u5269\u4f59\u7a7a\u95f4\u5bb9\u91cf\u7684\u767e\u5206\u6bd4\uff0c\u51cf\u5c11\u4e3aclass metadata\u91ca\u653e\u7a7a\u95f4\u5bfc\u81f4\u7684\u5783\u573e\u6536\u96c6  </li> </ul> </li> <li> <p>java \u57fa\u672c\u6570\u636e\u7c7b\u578b\u6240\u5360\u5b57\u8282</p> </li> </ul> \u7c7b\u578b \u5b57\u8282\u6570 bit\u6570 \u53d6\u503c\u8303\u56f4 \u9ed8\u8ba4\u503c \u5305\u88c5\u7c7b byte 1 8 -2^7 ~ 2^7-1 0 Byte short 2 16 -2^15 ~ 2^15-1 0 Short char 2 16 no '0' Character int 4 32 -2^31 ~ 2^31-1 0 Integer float 4 32 -3.4e+38 \uff5e 3.4e+38 0.0f Float double 8 64 -1.7e+308 \uff5e 1.7e+308 0.0d Double long 8 64 -2^63 ~ 2^63-1 0 Long boolean \u215b 1 true false false Boolean"},{"location":"Java/2018-03-22-concurrent-java/#_1","title":"\u5f15\u7528","text":"<ul> <li>\u53c2\u8003\u94fe\u63a51</li> <li>\u53c2\u8003\u94fe\u63a52</li> <li>\u53c2\u8003\u94fe\u63a53</li> <li>\u53c2\u8003\u94fe\u63a54 </li> <li>\u53c2\u8003\u94fe\u63a55 </li> <li>Java Virtual Machine Specification </li> </ul>"},{"location":"Java/2018-04-02-liberty-java/","title":"Liberty Usage","text":""},{"location":"Java/2018-04-02-liberty-java/#download-and-install","title":"Download and install","text":"<ol> <li> <p>Download Liberty</p> </li> <li> <p>Unzip the file to the directory whatever you like.</p> </li> </ol>"},{"location":"Java/2018-04-02-liberty-java/#create-a-server","title":"Create a server","text":"<pre><code>cd path_to_liberty/wlp/bin\n\nserver create server_name  \n</code></pre>"},{"location":"Java/2018-04-02-liberty-java/#edit-the-serverxml","title":"Edit the server.xml","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;server description=\"new server\"&gt;\n\n    &lt;!-- Enable features --&gt;\n    &lt;featureManager&gt;\n        &lt;feature&gt;servlet-3.1&lt;/feature&gt;\n        &lt;feature&gt;ssl-1.0&lt;/feature&gt;\n        &lt;feature&gt;websocket-1.1&lt;/feature&gt;\n        &lt;feature&gt;jdbc-4.2&lt;/feature&gt;\n        &lt;feature&gt;jndi-1.0&lt;/feature&gt;\n    &lt;/featureManager&gt;\n\n    &lt;!-- This template enables security. To get the full use of all the capabilities, a keystore and user registry are required. --&gt;\n\n    &lt;!-- For the keystore, default keys are generated and stored in a keystore. To provide the keystore password, generate an \n         encoded password using bin/securityUtility encode and add it below in the password attribute of the keyStore element. \n         Then uncomment the keyStore element. --&gt;\n    &lt;!--\n    &lt;keyStore password=\"\"/&gt; \n    --&gt;\n    &lt;webContainer invokeFlushAfterService=\"false\"/&gt;\n\n    &lt;!--For a user registry configuration, configure your user registry. For example, configure a basic user registry using the\n        basicRegistry element. Specify your own user name below in the name attribute of the user element. For the password, \n        generate an encoded password using bin/securityUtility encode and add it in the password attribute of the user element. \n        Then uncomment the user element. --&gt;\n    &lt;basicRegistry id=\"basic\" realm=\"BasicRealm\"&gt; \n        &lt;!-- &lt;user name=\"yourUserName\" password=\"\" /&gt;  --&gt; \n    &lt;/basicRegistry&gt;\n\n    &lt;!-- To access this server from a remote client add a host attribute to the following element, e.g. host=\"*\" --&gt;\n    &lt;httpEndpoint id=\"defaultHttpEndpoint\"\n                  host=\"*\" httpPort=\"9080\" httpsPort=\"9443\" /&gt;\n\n    &lt;!-- Automatically expand WAR files and EAR files --&gt;\n    &lt;applicationManager autoExpand=\"true\" startTimeout=\"360s\" stopTimeout=\"120s\"/&gt; \n      &lt;application type=\"war\" id=\"helloworld\" name=\"helloworld\" location=\"${server.config.dir}/apps/helloworld.war\"&gt;\n          &lt;classloader delegation=\"parentLast\" /&gt;\n    &lt;/application&gt;\n\n    &lt;keyStore id=\"defaultKeyStore\" password=\"admin\" /&gt;\n\n  &lt;!-- Shared libraries\n    https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.wlp.doc/ae/cwlp_sharedlibrary.html \n    --&gt;\n  &lt;!-- JNDI data source confiduration --&gt;\n  &lt;!-- Define a shared library pointing to the location of the JDBC driver JAR or compressed files. For example:  --&gt;\n  &lt;library id=\"MySQLLib\"&gt;\n      &lt;fileset dir=\"${shared.config.dir}/lib/global\" includes=\"*.jar\"/&gt;\n  &lt;/library&gt;\n  &lt;!-- Configure attributes for the data source, such as JDBC vendor properties and connection pooling properties. For example:  --&gt;\n  &lt;dataSource jndiName=\"jdbc/mysql\" statementCacheSize=\"60\" id=\"DefaultDataSource\"\n          isolationLevel=\"TRANSACTION_READ_COMMITTED\" type=\"javax.sql.DataSource\" transactional=\"true\"&gt;\n    &lt;jdbcDriver libraryRef=\"MySQLLib\"/&gt;\n    &lt;properties databaseName=\"SAMPLEDB\" \n                serverName=\"localhost\" portNumber=\"3306\" \n                user=\"root\" password=\"mysqladmin\"/&gt;\n  &lt;/dataSource&gt;    \n\n&lt;/server&gt;\n</code></pre>"},{"location":"Java/2018-04-02-liberty-java/#startstop-the-server","title":"Start/Stop the server","text":"<pre><code>server start dev\nserver stop dev\n</code></pre>"},{"location":"Java/2019-02-22-algorithm-java/","title":"Common algorithm","text":"<p>\u6587\u4ef6\u5927\u5c0f\u4e3a2G\uff0c\u7edf\u8ba1\u6587\u4ef6\u4e2d\u51fa\u73b0\u6b21\u6570\u4e3atop100\u7684\u5355\u8bcd\uff0c\u5355\u8bcd\u4ee5\u7a7a\u683c\u5206\u5f00\u3002JVM\u9650\u5236\u4f7f\u75282M\uff0c\u6700\u540e\u8f93\u5165\u683c\u5f0f\u4ece\u5c0f\u5230\u5927\u6392\u5217\u6253\u5370\uff0c\u4f8b\u5982 hello: 100, world: 99, java: 98</p> <pre><code>public class CountWords {\n\nprivate static final int CHUNK_SIZE = 1024 * 1024; // 1MB chunk size\n    private static final int TOP_WORDS_LIMIT = 10000;\n    private static final int MEMORY_THRESHOLD = 500000; // Flush to disk after 500,000 unique words\n\n    public static void main(String[] args) throws IOException {\n        String filePath = \"C:\\\\Users\\\\xiao fei\\\\Desktop\\\\words.txt.txt\";\n        List&lt;File&gt; intermediateFiles = new ArrayList&lt;&gt;();\n        Map&lt;String, Integer&gt; wordCounts = new HashMap&lt;&gt;();\n\n        // Process the file in chunks\n        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {\n            char[] buffer = new char[CHUNK_SIZE];\n            int bytesRead;\n            StringBuilder leftover = new StringBuilder();\n\n            while ((bytesRead = reader.read(buffer)) != -1) {\n                String chunk = leftover + new String(buffer, 0, bytesRead);\n                int lastSpace = chunk.lastIndexOf(' ');\n                if (lastSpace == -1) {\n                    leftover.setLength(0);\n                    leftover.append(chunk);\n                    continue;\n                }\n\n                String processableChunk = chunk.substring(0, lastSpace);\n                leftover.setLength(0);\n                leftover.append(chunk.substring(lastSpace + 1));\n\n                // Count words in the current chunk\n                String[] words = processableChunk.split(\"\\\\s+\");\n                for (String word : words) {\n                    wordCounts.put(word, wordCounts.getOrDefault(word, 0) + 1);\n                }\n\n                // Flush to disk if memory threshold is reached\n                if (wordCounts.size() &gt;= MEMORY_THRESHOLD) {\n                    File tempFile = flushToDisk(wordCounts);\n                    intermediateFiles.add(tempFile);\n                    wordCounts.clear();\n                }\n            }\n\n            // Process the remaining leftover\n            if (leftover.length() &gt; 0) {\n                String[] words = leftover.toString().split(\"\\\\s+\");\n                for (String word : words) {\n                    wordCounts.put(word, wordCounts.getOrDefault(word, 0) + 1);\n                }\n            }\n\n            // Flush any remaining word counts to disk\n            if (!wordCounts.isEmpty()) {\n                File tempFile = flushToDisk(wordCounts);\n                intermediateFiles.add(tempFile);\n                wordCounts.clear();\n            }\n        }\n\n        // Merge intermediate files to get the top 10,000 words\n        Map&lt;String, Integer&gt; finalWordCounts = mergeIntermediateFiles(intermediateFiles);\n\n        // Find the top 10,000 words\n        PriorityQueue&lt;Map.Entry&lt;String, Integer&gt;&gt; topWords = new PriorityQueue&lt;&gt;(\n                Comparator.comparingInt(Map.Entry::getValue)\n        );\n\n        for (Map.Entry&lt;String, Integer&gt; entry : finalWordCounts.entrySet()) {\n            topWords.offer(entry);\n            if (topWords.size() &gt; TOP_WORDS_LIMIT) {\n                topWords.poll();\n            }\n        }\n\n        // Print the top 10,000 words\n        List&lt;Map.Entry&lt;String, Integer&gt;&gt; result = new ArrayList&lt;&gt;();\n        while (!topWords.isEmpty()) {\n            result.add(topWords.poll());\n        }\n        Collections.reverse(result);\n\n        for (Map.Entry&lt;String, Integer&gt; entry : result) {\n            System.out.println(entry.getKey() + \": \" + entry.getValue());\n        }\n\n        // Clean up intermediate files\n        for (File file : intermediateFiles) {\n            file.delete();\n        }\n    }\n\n    private static File flushToDisk(Map&lt;String, Integer&gt; wordCounts) throws IOException {\n        File tempFile = File.createTempFile(\"wordCounts\", \".txt\");\n        try (BufferedWriter writer = new BufferedWriter(new FileWriter(tempFile))) {\n            for (Map.Entry&lt;String, Integer&gt; entry : wordCounts.entrySet()) {\n                writer.write(entry.getKey() + \" \" + entry.getValue());\n                writer.newLine();\n            }\n        }\n        return tempFile;\n    }\n\n    private static Map&lt;String, Integer&gt; mergeIntermediateFiles(List&lt;File&gt; intermediateFiles) throws IOException {\n        Map&lt;String, Integer&gt; finalWordCounts = new HashMap&lt;&gt;();\n        for (File file : intermediateFiles) {\n            try (BufferedReader reader = new BufferedReader(new FileReader(file))) {\n                String line;\n                while ((line = reader.readLine()) != null) {\n                    String[] parts = line.split(\" \");\n                    String word = parts[0];\n                    int count = Integer.parseInt(parts[1]);\n                    finalWordCounts.put(word, finalWordCounts.getOrDefault(word, 0) + count);\n                }\n            }\n        }\n        return finalWordCounts;\n    }\n}\n</code></pre> <p>\u538b\u7f29\u7b97\u6cd5</p> <pre><code>  public static void unzip(File zipFile, String destPath) throws Exception {\n    File dest = new File(destPath);\n    if (!dest.exists()) {\n      dest.mkdirs();\n    }\n    if (!zipFile.exists()) {\n      return;\n    }\n    FileInputStream fileInputStream = new FileInputStream(zipFile);\n    ZipInputStream zipInputStream = new ZipInputStream(fileInputStream);\n    ZipEntry zipEntry = zipInputStream.getNextEntry();\n    byte[] buffer = new byte[8092];\n    while (zipEntry != null) {\n      String fileName = zipEntry.getName();\n      File newFile = new File(destPath + File.separator + fileName);\n      new File(newFile.getParent()).mkdirs();\n      FileOutputStream fileOutputStream = new FileOutputStream(newFile);\n      int len = 0;\n      while ((len = zipInputStream.read(buffer)) &gt; 0) {\n        fileOutputStream.write(buffer, 0, len);\n      }\n      fileOutputStream.close();\n      zipInputStream.closeEntry();\n      zipEntry = zipInputStream.getNextEntry();\n    }\n    zipInputStream.closeEntry();\n    zipInputStream.close();\n    fileInputStream.close();\n  }\n\n  public static void zipDir(File dir, String zipFilePath) throws Exception {\n    FileOutputStream fileOutputStream = new FileOutputStream(zipFilePath);\n    ZipOutputStream zipOutputStream = new ZipOutputStream(fileOutputStream);\n    compress(dir, zipOutputStream, \"\");\n    zipOutputStream.close();\n    fileOutputStream.close();\n  }\n\n  private static void compress(File file, ZipOutputStream zipOutputStream, String baseDir) {\n    if (file.isFile()) {\n      FileUtil.compressFile(file, zipOutputStream, baseDir);\n    } else {\n      if (file.exists()) {\n        File[] children = file.listFiles();\n        if (children != null &amp;&amp; children.length &gt; 0) {\n          Stream.of(children)\n              .forEach(child -&gt; {\n                FileUtil.compress(child, zipOutputStream,\n                    baseDir + file.getName() + File.separator);\n              });\n        }\n      }\n    }\n  }\n\n  private static void compressFile(File file, ZipOutputStream zipOutputStream, String basedir) {\n    if (!file.exists()) {\n      return;\n    }\n    int buffer = 8192;\n    try {\n      BufferedInputStream bufferedInputStream = new BufferedInputStream(\n          new FileInputStream(file));\n      ZipEntry entry = new ZipEntry(basedir + file.getName());\n      zipOutputStream.putNextEntry(entry);\n      int count;\n      byte data[] = new byte[buffer];\n      while ((count = bufferedInputStream.read(data, 0, buffer)) != -1) {\n        zipOutputStream.write(data, 0, count);\n      }\n      bufferedInputStream.close();\n\n    } catch (Exception e) {\n      logger.error(\"Compress File Error!\", e);\n    }\n  }\n</code></pre> <p>\u63d2\u5165\u6392\u5e8f</p> <pre><code>public static void insertSort(int[] arr) {\n    // \u4ece\u7b2c\u4e8c\u4e2a\u5143\u7d20\u5f00\u59cb\u6392\u5e8f\uff0c\u5047\u8bbe\u7b2c\u4e00\u4e2a\u5143\u7d20\u5df2\u6392\u5e8f\n    for (int i = 1; i &lt; arr.length; i++) {\n        int current = arr[i];\n        int lastSortPos = i - 1;\n        while (lastSortPos &gt;= 0 &amp;&amp; arr[lastSortPos] &gt; current) {\n            //\u5c06\u5927\u4e8ecurrent\u7684\u5143\u7d20\u53f3\u79fb\u4e00\u4f4d\n            arr[lastSortPos + 1] = arr[lastSortPos];\n            lastSortPos--;\n        }\n        // lastSortPos \u8bb0\u5f55\u7684\u662f\u6392\u5e8f\u597d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u6807\uff0c\u6240\u4ee5current\u7684\u4f4d\u7f6e\u662flastSortPos + 1\n        arr[lastSortPos + 1] = current;\n    }\n}\n</code></pre> <p>\u5f52\u5e76\u6392\u5e8f\u7b97\u6cd5</p> <pre><code>  public static void mergeSort(int array[], int start, int end) {\n      if (start == end) {\n          //\u5206\u89e3\u7684\u6700\u7ec8\u7ed3\u679c\uff0c\u6bcf\u4e2a\u6570\u7ec4\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\n          return;\n      }\n      int middle = start + ((end - start) &gt;&gt; 1);\n      mergeSort(array, start, middle);\n      mergeSort(array, middle + 1, end);\n      merge(array, start, middle, end);\n  }\n\n\n  /**\n    *\n    * @param array\n    * @param start\n    * @param middle\n    * @param end\n    *\n    */\n  private static void merge(int array[], int start, int middle, int end) {\n      int[] help = new int[end - start + 1];\n      int p1 = start;\n      int p2 = middle + 1;\n      int i = 0;\n      //\u53e6\u4e2a\u6570\u7ec4\u9010\u6b21\u6bd4\u8f83\uff0c\u5148\u5c06\u8f83\u5c0f\u7684\u6570\u5f52\u4f4d\u3002  \u4f8b\u5982\u4ea7\u751f\u7684\u9012\u589e\u7684\u4e2d\u95f4\u4ea7\u7269\u6570\u7ec4\uff0c[5, 10], [6,7]\uff0c\u7ecf\u8fc7\u8be5\u5faa\u73af\u540ehelp = {5, 6, 7}\n      while (p1 &lt;= middle &amp;&amp; p2 &lt;= end) {\n          help[i++] = array[p1] &lt; array[p2] ? array[p1++] : array[p2++];\n      }\n\n      //\u4ee5\u4e0b\u7684\u4e24\u4e2awhile\u53ea\u4f1a\u6267\u884c\u5176\u4e2d\u4e00\u4e2a\n      while (p1 &lt;= middle) {\n          help[i++] = array[p1++];\n      }\n      while (p2 &lt;= end) {\n          help[i++] = array[p2++];\n      }\n\n      for (int j = 0; j &lt; help.length; j++) {\n          //\u5c06\u6392\u5e8f\u4e86\u7684\u7ed3\u679c\u653e\u5165\u6570\u7ec4\n          array[start + j] = help[j];\n      }\n\n  }\n</code></pre> <p>\u5feb\u901f\u6392\u5e8f\u7b97\u6cd5</p> <pre><code>    public static void sort(int[] arr, int low, int high) {\n        if (arr == null | low &gt;= high) return;\n        if (high - low &lt; 16) {\n            insertSort(arr);\n            return;\n        }\n        int pos = partition(arr, low, high);\n        sort(arr, low, pos - 1);\n        sort(arr, pos + 1, high);\n    }\n\n    public static void insertSort(int[] arr) {\n        for (int i = 1; i &lt; arr.length; i++) {\n            int current = arr[i];\n            int lastSortedPos = i - 1;\n            while (lastSortedPos &gt;= 0 &amp;&amp; arr[lastSortedPos] &gt; current) {\n                arr[lastSortedPos + 1] = arr[lastSortedPos];\n                lastSortedPos--;\n            }\n            arr[lastSortedPos + 1] = current;\n        }\n    }\n\n    public static int partition(int[] arr, int low, int high) {\n        int key = arr[low];\n        int left = low;\n        int right = high;\n        while (left &lt; right) {\n            while (left &lt; right &amp;&amp; arr[right] &gt;= key) right--;\n            while (left &lt; right &amp;&amp; arr[left] &lt;= key) left++;\n            if (left &lt; right) {\n                swap(arr, left, right);\n            }\n        }\n        //left == right, return pos and swap key and arr[right]\n        swap(arr, low, right);\n        return right;\n    }\n\n    public static void swap(int[] arr, int i, int j) {\n        int tmp = arr[i];\n        arr[i] = arr[j];\n        arr[j] = tmp;\n    }\n</code></pre> <p>\u4e8c\u5206\u67e5\u627e\u7b97\u6cd5</p> <pre><code>//\u9012\u5f52\u5b9e\u73b0\nprivate int binarySearch(int arr[], int start, int end, int target) {\n    int middle = (start + end) / 2;   //\u7b97middle\u7684\u4f4d\u7f6e\u4e00\u5b9a\u8981\u662f(start + end)/2 , \u60f3\u60f3\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u662fend/2?\n    if (target == arr[middle]) {\n      return middle;\n    }\n    //middle &gt;=1 \u4fdd\u8bc1end\u7684\u6700\u5c0f\u503c\u662f0\n    if (target &lt; arr[middle] &amp;&amp; middle &gt;= 1) {\n      return binarySearch(arr, 0, middle - 1, target);\n      //middle + 1 &lt;=end \u4fdd\u8bc1\u8d77\u59cb\u4f4d\u7f6e\u5e94\u8be5&lt;=\u7ed3\u675f\u4f4d\u7f6e\n    } else if (middle + 1 &lt;= end) {\n      return binarySearch(arr, middle + 1, end, target);\n    } else {\n      return -1;\n    }\n  }\n\n //\u975e\u9012\u5f52\u5b9e\u73b0\n private int binarySearch(int[] arr, int target) {\n    int low = 0;\n    int hight = arr.length;\n    while (low &lt;= hight) {\n      int middle = (low + hight) / 2;\n      if (target == arr[middle]) {\n        return middle;\n      } else if (target &gt; arr[middle]) {\n        low = middle + 1;\n      } else {\n        hight = middle - 1;\n      }\n    }\n    return -1;\n  }\n</code></pre> <p>\u4e32\u7684\u67e5\u627e\u7b97\u6cd5</p> <pre><code>  public static int strMatch_1(char[] source, char[] target) {\n    int i = 0, j = 0;\n    int sourceLength = source.length;\n    int targetLength = target.length;\n    while (i &lt; sourceLength &amp;&amp; j &lt; targetLength) {\n      if (source[i] == target[j]) {\n        if (j == targetLength - 1) {\n          return i - j;\n        } else {\n          i++;\n          j++;\n        }\n      } else {\n        i = i - j + 1;\n        j = 0;\n      }\n    }\n    return -1;\n  }\n}\n    /**\n     * \u5b57\u7b26\u4e32\u5339\u914d\u8fd8\u6709KMP\u7b97\u6cd5\uff0cBM\u7b97\u6cd5\u4ee5\u53caSunday\u7b97\u6cd5\n     */\n</code></pre>"},{"location":"Java/2019-02-22-algorithm-java/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://leetcode.cn/problem-list/2cktkvj/</li> </ul>"},{"location":"Java/2019-05-10-JEE-java/","title":"JEE basic knowledge","text":"<p>JPA</p> <p>Entity Class Requirement</p> <ul> <li>Must be annotated with @Entity</li> <li>Must have a public or protected no-arg constructor</li> <li>Must be a top-level class</li> <li>The persistent state of an entity is represented by instance fields.</li> <li>Entities support inheritance and must not be final.</li> <li>If an entity instance is to be passed by value as a detached object, the entity class must implement the java.io.Serializable interface</li> </ul> <p>Why would you choose persistent properties over persistent filed?</p> <ul> <li>If you want to do additional processing in a getter/setter method.</li> </ul> <p>Elements belong to persistence unit in persistence.xml</p> <ul> <li>provider, jta-data-source</li> </ul> <p>DAO methos always throws SQLException</p> <p>Transaction Models - Nested</p> <ul> <li>If the main transaction failed, the nested transactions are also rolled back.</li> <li>A failure in a nested transaction doesn't necessarily roll back other nested transactions</li> </ul> <p>Transaction Models - Chained</p> <ul> <li>If the main transaction failed, the nested transactions are also rolled back.</li> <li>However, a failure in a nested transaction roll back only that transaction.</li> </ul> <p>Comparison of Programmatic and Declarative Transactions</p> N/A Programmatic(BMT) Declarative(CMT) Operation Use JTA calls to specify which operations form a single transaction (bean-managed) Specify the transaction properties in the deployment descriptor(container-managed) Available in Sevlets, JSP components, session beans, CDI beans, and messaging-driven bean Session bean, CDI beans, and messaging-driven bean <p>Bean-managed transaction usage</p> <ol> <li>Add TransactionManagement(BEAN) on class level.</li> <li>Inject UserTransaction resource</li> <li><code>ut.begin()  ut.commit() ut.rollback()</code></li> </ol> <p>EJB Container-managed transaction usage</p> <ol> <li>Add @TransactionAttribute(TransactionAttributeType.REQUIRED)</li> </ol> <p>Transaction Attributes</p> <ul> <li>REQUIRED The method becomes part of the caller's transaction. If the caller does not have a transaction, the method runs in its own transaction.</li> <li>REQUIRED_NEW The method always runs in its own transaction. Any existing transaction is suspended.</li> <li>NOT_SUPPORTED The method never runs in a transaction. Any existing transaction is suspended.</li> <li>SUPPORTS The method becomes part of the caller's transaction. If the caller does not have a transaction, the method doesn't runs in a transaction.</li> <li>MANDATORY It is an error to call this method outside of a transaction.</li> <li>NEVER It is an error to call this method in a transaction.</li> </ul> <p>JEE Concurrency Mechanisms</p> <ul> <li>Message-Driven Bean</li> <li>Get a ManagedExecutorService instance</li> </ul> <p>which Alternative Should You Use?</p> <ul> <li>Message-Driven Bean<ul> <li>Don't require a reference to the actual EJB</li> <li>Support fire and forget methods(not return value)</li> <li>Require server administration</li> </ul> </li> <li>Asynchronous EJBs<ul> <li>Require a reference to the actual EJB that can be injected by using CDI</li> <li>Support return values in methods</li> <li>Don't require server administration</li> </ul> </li> <li>Managed Executors<ul> <li>Provide maximum control over threads, and are the most native way of executing tasks</li> <li>Require server administration</li> </ul> </li> </ul> <p>ManageTaskListener events: taskAborted, taskStarting</p> <p>JSR-250 javax.annotaion.security</p> <ul> <li>@RunAs(\"admin\"), @RolesAllowed({\"user\", \"admin\"}), @PermitAll, @RolesAllowed, @DenyAll and they are only supported for JAX-WS EJB endpoints, JAX-RS EJB endpoints, JAX-RS POJO endpoints.   JAX-WS POJO is not supported.</li> <li>Security annotations can be placed session bean class and method</li> <li>Web service security extensions contains WS-Addressing, WS-Security</li> <li>ejb-jar.xml, @RolesAllowed can restrict resource access by user role.</li> <li>login-config section in XML is used to configured to allow user authentication with the application. </li> </ul> <p>JSR-352: Batch Applications</p> <ul> <li>API for defining long-running jobs</li> <li>Running batch processes on an Enterprise Server</li> <li>Execution controlled by application server</li> </ul> <p>A batch contains the following:</p> <ul> <li>Job, Step, JobOperator, JobRepository, Item Reader, Item Writer, Item Processor</li> </ul> <p>Timer Service</p> <ul> <li>The EJB timer service is a container-managed service that provides a way to allow method to be invoked at specific times or time intervals.</li> <li>The EJB timer may be set to invoke certain EJB method at a specific time, after a specific duration, or at specific recurring intervals.</li> <li>Timers can be created programmatically by interacting with TimerService or automatically through annotations.</li> <li>These Timer tasks apply to the following types of enterprise beans:<ul> <li>Stateless and singleton session beans</li> <li>Message-driven beans</li> </ul> </li> <li>Timers are intended for long-lived business processes and are by default persistent.</li> </ul> <p>Types of Timer</p> <ul> <li>Programmatic timers : Created by TimerService</li> <li>AUtomatic timers: created by java.ejb.Schedule and java.ejb.Schedules annotations.</li> </ul> <p>Calendar-Based Schedule Timers</p> <ul> <li>Seven attributes  can be used to define a Schedule<ul> <li>second</li> <li>minute</li> <li>hour</li> <li>dayOfMonth</li> <li>dayOfWeek</li> <li>month</li> <li>year</li> </ul> </li> </ul> <p>MDB (Messaging Driven Bean)</p> <p>Configuring the Message-Driven Bean</p> <ul> <li>Message-Driven Bean support configuration by:<ul> <li>Annotations</li> <li>Deployment descriptors</li> </ul> </li> <li>Annotaion-based configuration is performed by specifying a set of ActivationConfigProperty annotations for the activationConfig property of the @MessageDriven annotation.</li> <li>Every message-driven bean must be configured with a destination.</li> <li>Common configurations are:<ul> <li>Destination type</li> <li>Message acknowledgement</li> <li>Message selection</li> </ul> </li> </ul> <p>API for Topic Subscriptions</p> <ul> <li>For unshared durable subscriptions, the clientId must be set and is used to identify the subscription.</li> <li>For shared subscriptions, the clientID is optional. If it is set, it is used to identify the subscription.</li> </ul> <p>JMS support two types of messaging</p> <ul> <li>PTP (Point-to-point): Messaging by using queues</li> <li>Publish/sunscribe: Messaging by using topics</li> </ul> <p>Two types of Administered objects</p> <ul> <li>ConnectionFactory</li> <li>Destionation</li> </ul> <p>JMS Application is composed of the following parts</p> <ul> <li>JMS provider</li> <li>JMS clients</li> <li>Messages</li> <li>Administered objects</li> </ul> <p>JMS 2.0 New Features</p> <ul> <li> <p>Simplified API</p> <ul> <li>Injection of JMSContext object</li> <li>Creating JMS Desination using annotation</li> </ul> </li> <li> <p>Delivery Delay</p> </li> <li>Asynchronous Send</li> <li>Standardized Configurations</li> </ul> <p>CDI Interceptor can be used bellow lifecycle</p> <ul> <li>@AroundInvoke</li> <li>@PostConstruct</li> <li>@PreDestory</li> <li>@PrePassivate</li> <li>@PostActivate</li> </ul> <p>Create a qualifier</p> <pre><code>@Qualifier\n@Retention(RUNTIME)\n@Target({METHOD, FIELD, PARAMETER, TYPE})\npublic @interface YourQualifierName {}\n</code></pre> <p>CDI Context and Dependency Injection</p> <p>Limitations on CDI Beans</p> <ul> <li> <p>A bean cannot be:</p> <ul> <li>A non-static inner class</li> <li>Annotated with an EJB component-defining annotation or declared as an EJB bean class in ejb-jar.xml</li> </ul> </li> <li> <p>A bean must have an appropriate constructor</p> <ul> <li>The class has a constructor with no parameters</li> <li>The class declares a constructor annotated with @Inject</li> </ul> </li> </ul> <p>EJB 3.0</p> <ul> <li>Annotations</li> <li>Simplification of enterprise bean types</li> <li>Entity persistence through JPA</li> </ul> <p>EJB 3.1</p> <ul> <li>Singleton session bean</li> <li>Asynchronous session bean invocations</li> <li>EJB Timer Service</li> <li>Portable global JNDI names</li> <li>Embeddable EJB Container</li> <li>EJB 3.1 Lite</li> <li>Packaging and deployment of EJBs directory in a WAR file</li> </ul> <p>JSR-345 EJB 3.2 New Features</p> <ul> <li>Enhanced message-driven bean contract with no-method message listener interface</li> <li>Container-provide security role names \"**\"</li> <li>Local asynchronous session bean invocations and no-persistent EJB Timer Service included</li> <li>Support for transactions in SFSB lifecycle callbacks</li> <li>Ability to disable passivation of stateful session beans:</li> <li>Enhanced TimerService API to access all active timer in the EJB module with getAllTimer()</li> <li>Embeddable EJB Container to implement the AutoCloseable interface</li> <li>Removal of restrictions on the javax.ejb.Timer and javax.ejb.TimerHanlder references</li> <li>Relaxed default rules for a session bean to designate its implemented interfaces</li> </ul> <p>EJB Components</p> <ul> <li>Are managed by an EJB container</li> <li>Provide business and messaging function</li> <li>Are scalable, transactional, multiuser and secure</li> </ul> <p>EJB components types</p> <ul> <li> <p>Session Beans</p> <ul> <li>Stateless</li> <li>Stateful</li> <li>Singleton</li> </ul> </li> <li> <p>Message Driven Bean</p> </li> </ul> <p>JNDI -&gt; The Java Naming and Directory Interface is an API that provides naming and directory functionality to applications.</p> <ul> <li>Independent of any implementation</li> <li>Build on a service provider interface (SPI) </li> </ul> <p>JAX-WS JAVA API for XML Web Service</p> <p>WSDL Structure</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;definitions&gt;\n    &lt;types/&gt;\n    &lt;message/&gt;\n    &lt;portType/&gt;\n    &lt;binding/&gt;\n    &lt;service/&gt;\n&lt;/definitions&gt;\n</code></pre> <p>Vendor neutral and Component based </p> <p>[JCP] https://www.jcp.org/en/home/index</p> <p>A EAR file could contains JAR, WAR, RAR and so on. <pre><code>jar cvf myWebApp.war\n</code></pre> A java bean implements java.io.Serializable or java.io.Externalizable and using XMLEncoder and XMLDecoder make your application portable.</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/","title":"Understanding JVM - version 2","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter2-java","title":"Chapter2 Java\u5185\u5b58\u533a\u57df\u4e0e\u5185\u5b58\u6ea2\u51fa\u5f02\u5e38","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#21","title":"2.1 \u5bf9\u8c61\u7684\u521b\u5efa","text":"<p>1. \u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u6761new\u6307\u4ee4\u65f6\uff0c\u9996\u5148\u68c0\u67e5\u8fd9\u4e2a\u6307\u4ee4\u7684\u53c2\u6570\u662f\u5426\u80fd\u5728\u5e38\u91cf\u6c60\u4e2d\u5b9a\u4f4d\u5230\u4e00\u4e2a\u7c7b\u7b26\u53f7\u7684\u5f15\u7528\uff0c\u5e76\u68c0\u67e5\u8fd9\u4e2a\u7c7b\u662f\u5426\u88ab\u52a0\u8f7d\uff0c\u89e3\u6790\uff0c\u521d\u59cb\u5316\u3002\u5982\u679c\u6ca1\u6709\uff0c\u5fc5\u987b\u5148\u6267\u884c\u7c7b\u7684\u52a0\u8f7d\u3002</p> <p>2. \u5f53\u7c7b\u52a0\u8f7d\u68c0\u67e5\u901a\u8fc7\u540e\uff0c\u865a\u62df\u673a\u4e3a\u65b0\u7684\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u3002\u5bf9\u8c61\u6240\u9700\u8981\u7684\u5185\u5b58\u5927\u5c0f\u5728\u7c7b\u52a0\u8f7d\u5b8c\u6210\u4e4b\u540e\u4fbf\u53ef\u4ee5\u786e\u5b9a\u3002</p> <p>3. \u5185\u5b58\u5206\u914d\u5b8c\u6210\u4e4b\u540e\uff0c\u5c06\u5206\u914d\u7684\u5185\u5b58\u521d\u59cb\u5316\u96f6\u503c\uff0c\u9664\u4e86\u5bf9\u8c61\u5934\u7684\u90e8\u5206\u3002</p> <p>4. \u865a\u62df\u673a\u8bbe\u7f6e\u5bf9\u8c61\uff0c\u6807\u8bb0\u8fd9\u4e2a\u5bf9\u8c61\u662f\u54ea\u4e2a\u7c7b\u7684\u5b9e\u4f8b\uff0c\u5982\u4f55\u627e\u5230\u7c7b\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5bf9\u8c61\u7684hashcode\uff0c\u5bf9\u8c61\u7684GC\u5e74\u9f84\u7b49\u4fe1\u606f\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#22","title":"2.2 \u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u7684\u7ed3\u6784","text":"<ul> <li> <p>\u5bf9\u8c61\u5934(Header): \u5305\u542bHashCode\uff0cGC\u5206\u4ee3\u5e74\u9f84\uff0c\u9501\u72b6\u6001\u6807\u5fd7\uff0c\u7ebf\u7a0b\u6301\u6709\u7684\u9501\uff0c\u504f\u5411\u7ebf\u7a0bID\uff0c\u504f\u5411\u65f6\u95f4\u6233\uff0c\u7c7b\u578b\u6307\u9488\uff08\u6307\u5411\u7c7b\u5143\u6570\u636e\u7684\u6307\u9488\uff09\u3002</p> </li> <li> <p>\u5b9e\u4f8b\u6570\u636e(Instance data)</p> </li> <li> <p>\u5bf9\u9f50\u586b\u5145(Padding)</p> </li> </ul> <p>String.intern() </p> <p>\u8be5\u65b9\u6cd5\u662f\u4e00\u4e2anative\u65b9\u6cd5\u3002\u5b83\u7684\u4f5c\u7528\u662f\uff1a\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5df2\u7ecf\u5305\u542b\u4e00\u4e2a\u7b49\u4e8e\u6b64String\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u8fd4\u56de\u4ee3\u8868\u6c60\u4e2d\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684String\u5bf9\u8c61\uff1b\u5426\u5219\uff0c\u5c06\u6b64String\u5bf9\u8c61\u5305\u542b\u7684\u5b57\u7b26\u4e32\u6dfb\u52a0\u5230\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff0c\u5e76\u4e14\u8fd4\u56de\u6b64String\u5bf9\u8c61\u7684\u5f15\u7528\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#23","title":"2.3 \u5bf9\u8c61\u7684\u8bbf\u95ee\u65b9\u5f0f","text":"<p>Java\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u6808\u4e0a\u7684reference\u6570\u636e\u6765\u64cd\u4f5c\u5bf9\u4e0a\u7684\u5177\u4f53\u5bf9\u8c61\u3002</p> <ul> <li> <p>\u53e5\u67c4\uff1a\u5728Java\u7684\u5bf9\u4e0a\u5316\u5206\u4e00\u5757\u5185\u5b58\u4f5c\u4e3a\u53e5\u67c4\u6c60\uff0creference\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u5bf9\u8c61\u7684\u53e5\u67c4\u5730\u5740\uff0c\u53e5\u67c4\u4e2d\u5305\u542b\u4e86\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6570\u636e\u4e0e\u7c7b\u578b\u6570\u636e\u5404\u81ea\u7684\u5177\u4f53\u5730\u5740\u4fe1\u606f\u3002\u4f18\u70b9\u662f\u5728\u5bf9\u8c61\u88ab\u79fb\u52a8\u7684\u65f6\u5019\u53ea\u4f1a\u6539\u53d8\u53e5\u67c4\u4e2d\u7684\u5b9e\u4f8b\u6570\u636e\u7684\u6307\u9488\uff0creference\u672c\u8eab\u4e0d\u9700\u8981\u8981\u4fee\u6539\u3002</p> </li> <li> <p>\u6307\u9488\uff1areference\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u5bf9\u8c61\u7684\u5730\u5740\u3002\u4f18\u70b9\u662f\u8bbf\u95ee\u901f\u5ea6\u5feb\u3002</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter3","title":"Chapter3 \u5783\u573e\u6536\u96c6\u5668\u4e0e\u5185\u5b58\u5206\u914d\u7b56\u7565","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#31","title":"3.1 \u5224\u65ad\u5bf9\u8c61\u5df2\u6b7b\u7684\u7b97\u6cd5","text":"\u540d\u79f0 \u4f18\u70b9 \u7f3a\u70b9 \u5f15\u7528\u8ba1\u6570\u7b97\u6cd5 \u5b9e\u73b0\u7b80\u5355\uff0c\u6548\u7387\u9ad8 \u65e0\u6cd5\u89e3\u51b3\u5bf9\u8c61\u4e4b\u95f4\u76f8\u4e92\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898 \u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5(GC Roots)"},{"location":"Java/2020-02-16-UnderstandingJVM/#32","title":"3.2 \u5f15\u7528\u7684\u7c7b\u578b","text":"<ul> <li> <p>\u5f3a\u5f15\u7528 \u5783\u573e\u56de\u6536\u5668\u6c38\u8fdc\u4e0d\u4f1a\u56de\u6536\u88ab\u5f3a\u5f15\u7528\u7684\u5bf9\u8c61</p> </li> <li> <p>\u8f6f\u5f15\u7528 \u5728\u7cfb\u7edf\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u8fd9\u90e8\u5206\u5bf9\u8c61\u5217\u5165\u7b2c\u4e8c\u6b21\u5783\u573e\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u7b2c\u4e8c\u6b21\u56de\u6536\u5185\u5b58\u8fd8\u4e0d\u591f\uff0c\u5219OOM\u3002</p> </li> <li> <p>\u5f31\u5f15\u7528 \u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u53ea\u80fd\u5b58\u6d3b\u5230\u4e0b\u6b21\u5783\u573e\u56de\u6536\u4e4b\u524d\u3002\u65e0\u8bba\u5185\u5b58\u662f\u5426\u591f\u7528\uff0c\u4e0b\u6b21\u5783\u573e\u56de\u6536\u4e00\u5b9a\u4f1a\u56de\u6536\u8fd9\u90e8\u5206\u5bf9\u8c61\u3002</p> </li> <li> <p>\u865a\u5f15\u7528 \u4e3a\u5bf9\u8c61\u8bbe\u7f6e\u865a\u5f15\u7528\u7684\u76ee\u7684\u5c31\u662f\u80fd\u5728\u8fd9\u4e2a\u5bf9\u8c61\u88ab\u56de\u6536\u5668\u56de\u6536\u65f6\u6536\u5230\u4e00\u4e2a\u901a\u77e5\u3002</p> </li> </ul> <p>\u5bf9\u8c61\u7684finalize()\u53ea\u4f1a\u88ab\u7cfb\u7edf\u81ea\u52a8\u8c03\u7528\u4e00\u6b21\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#33","title":"3.3 \u5783\u573e\u6536\u96c6\u7b97\u6cd5","text":"<ul> <li>\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5</li> </ul> <p>\u7f3a\u70b9\uff1a\u6548\u7387\u4f4e\uff0c\u5185\u5b58\u788e\u7247\u5316\u4e25\u91cd</p> <ul> <li> <p>\u590d\u5236\u7b97\u6cd5 \u5c06\u5185\u5b58\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5148\u7528\u4e00\u90e8\u5206\u3002\u9700\u8981\u56de\u6536\u7684\u65f6\u5019\u5c06\u5b58\u6d3b\u7684\u5bf9\u8c61\u590d\u5236\u5230\u53e6\u4e00\u90e8\u5206\u3002</p> </li> <li> <p>\u6807\u8bb0\u6574\u7406\u7b97\u6cd5</p> </li> <li> <p>\u5206\u4ee3\u6536\u96c6\u7b97\u6cd5  \u5bf9\u65b0\u751f\u4ee3\u4f7f\u7528\u590d\u5236\u7b97\u6cd5\uff0c\u5bf9\u8001\u5e74\u4ee3\u4f7f\u7528\u6807\u8bb0\u6574\u7406\u7b97\u6cd5</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#34","title":"3.4 \u5783\u573e\u56de\u6536\u5668\u7684\u5b9e\u73b0","text":"<ul> <li> <p>Serial\u6536\u96c6\u5668  Stop the Wolrd\uff0c\u7b80\u5355\u9ad8\u6548</p> </li> <li> <p>ParNew\u6536\u96c6\u5668 Serial\u6536\u96c6\u5668\u7684\u591a\u7ebf\u7a0b\u7248\u672c</p> </li> <li> <p>Parallel Scavenge\u6536\u96c6\u5668 \u662f\u4e00\u4e2a\u65b0\u751f\u4ee3\u6536\u96c6\u5668\uff0c\u590d\u5236\u6536\u96c6\u5668\uff0c\u5e76\u884c\u591a\u7ebf\u7a0b\u6536\u96c6\u5668\uff0c\u4e3b\u8981\u5173\u6ce8\u7684CPU\u7684\u541e\u5410\u91cf\u3002-XX:MaXGCPauseMillis\u63a7\u5236\u6700\u5927\u5783\u573e\u6536\u96c6\u505c\u987f\u65f6\u95f4 -XXMaxGCTimeRatio\u76f4\u63a5\u8bbe\u7f6e\u541e\u5410\u91cf\u5927\u5c0f\u3002 \u541e\u5410\u91cf=CPU\u8fd0\u884c\u5ba2\u6237\u4ee3\u7801\u7684\u65f6\u95f4/CPU\u8fd0\u884c\u5ba2\u6237\u4ee3\u7801\u7684\u65f6\u95f4+\u5783\u573e\u56de\u6536\u65f6\u95f4</p> </li> <li> <p>CMS\u6536\u96c6\u5668 \u4ee5\u83b7\u53d6\u6700\u77ed\u505c\u987f\u65f6\u95f4\uff0c\u5e76\u53d1\u6536\u96c6\uff0c\u4f4e\u505c\u987f</p> </li> <li> <p>G1\u6536\u96c6\u5668 \u5e76\u884c\u5e76\u53d1\uff0c\u5206\u4ee3\u6536\u96c6\uff0c\u6807\u8bb0\u6574\u7406\u6e05\u9664\uff0c\u53ef\u9884\u6d4b\u505c\u987f</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#35","title":"3.5 \u5185\u5b58\u5206\u914d\u4e0e\u56de\u6536\u7b56\u7565","text":"<ul> <li>\u65b0\u751f\u4ee3\u5728Eden\u4e0a\u5206\u914d</li> <li>\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u53bb\u8001\u751f\u4ee3</li> <li>\u957f\u4e45\u5b58\u6d3b\u7684\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3</li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter4-p124","title":"Chapter4 \u865a\u62df\u673a\u6027\u80fd\u76d1\u63a7\u4e0e\u6545\u969c\u5904\u7406\u5de5\u5177 p124","text":"<pre><code>jstat -gcutil [pid] [intervel] [count]\n\n# \u8f93\u51fa\u5982\u4e0b\uff1a\n\n# S0\uff1a\u5806\u4e0a Survivor space 0 \u533a\u5df2\u4f7f\u7528\u7a7a\u95f4\u7684\u767e\u5206\u6bd4\n# S1\uff1a\u5806\u4e0a Survivor space 1 \u533a\u5df2\u4f7f\u7528\u7a7a\u95f4\u7684\u767e\u5206\u6bd4\n# E\uff1a\u5806\u4e0a Eden \u533a\u5df2\u4f7f\u7528\u7a7a\u95f4\u7684\u767e\u5206\u6bd4\n# O\uff1a\u5806\u4e0a Old space \u533a\u5df2\u4f7f\u7528\u7a7a\u95f4\u7684\u767e\u5206\u6bd4\n# P\uff1a\u5806\u4e0a Perm space \u533a\u5df2\u4f7f\u7528\u7a7a\u95f4\u7684\u767e\u5206\u6bd4\n# YGC\uff1a\u4ece\u7a0b\u5e8f\u542f\u52a8\u5230\u91c7\u6837\u65f6\u53d1\u751f\u7684 Minor GC \u6b21\u6570\n# YGCT\uff1a\u4ece\u7a0b\u5e8f\u542f\u52a8\u5230\u91c7\u6837\u65f6 Minor GC \u6240\u7528\u7684\u65f6\u95f4\n# FGC\uff1a\u4ece\u7a0b\u5e8f\u542f\u52a8\u5230\u91c7\u6837\u65f6\u53d1\u751f\u7684 Full GC \u6b21\u6570\n# FGCT\uff1a\u4ece\u7a0b\u5e8f\u542f\u52a8\u5230\u91c7\u6837\u65f6 Full GC \u6240\u7528\u7684\u65f6\u95f4\n# GCT\uff1a\u4ece\u7a0b\u5e8f\u542f\u52a8\u5230\u91c7\u6837\u65f6 GC \u7684\u603b\u65f6\u95f4\n</code></pre>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter5-p155","title":"Chapter5 \u8c03\u4f18\u6848\u4f8b\u5206\u6790\u4e0e\u5b9e\u8df5 p155","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter6-p185","title":"Chapter6 \u7c7b\u6587\u4ef6\u7ed3\u6784 p185","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#61-magic-number-class","title":"6.1 Magic Number \u4e0eClass\u6587\u4ef6\u7684\u7248\u672c","text":"<p>Class\u6587\u4ef6\u7684\u524d4\u4e2a\u5b57\u8282\u6210\u4e3a\u9b54\u6570\uff0c\u552f\u4e00\u4f5c\u7528\u662f\u7528\u6765\u786e\u5b9a\u8fd9\u4e2a\u6587\u4ef6\u662f\u5426\u80fd\u88ab\u865a\u62df\u673a\u63a5\u53d7\u7684Class\u6587\u4ef6\u3002</p> <p>\u7b2c5\u4e2a\u5b57\u8282\u548c\u7b2c6\u4e2a\u5b57\u8282\u4ee3\u8868\u7248\u672c\u53f7</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#62","title":"6.2 \u5e38\u91cf\u6c60","text":"<p>\u5e38\u91cf\u6c60\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5e38\u91cf\u90fd\u5bf9\u5e94\u4e00\u5f20\u8868\u3002</p> <ul> <li>\u7c7b\u548c\u63a5\u53e3\u7684Fully Qualified Name</li> <li>\u5b57\u6bb5\u7684\u540d\u79f0\u548c\u63cf\u8ff0\u7b26</li> <li>\u65b9\u6cd5\u7684\u540d\u79f0\u548c\u9650\u5b9a\u7b26</li> </ul> <p>Class\u6587\u4ef6\u4e0d\u4fdd\u5b58\u65b9\u6cd5\uff0c\u5b57\u6bb5\u7684\u6700\u7ec8\u5185\u5b58\u5e03\u5c40\u4fe1\u606f\uff0c\u56e0\u6b64\u8fd9\u4e9b\u5b57\u6bb5\uff0c\u65b9\u6cd5\u7684\u7b26\u53f7\u5f15\u7528\u4e0d\u7ecf\u8fc7\u8fd0\u884c\u671f\u8f6c\u6362\u65e0\u6cd5\u83b7\u5f97\u771f\u6b63\u7684\u5185\u5b58\u5730\u5740\u3002\u56e0\u6b64\uff0c\u5f53\u865a\u62df\u673a\u8fd0\u884c\u65f6\uff0c\u9700\u8981\u5148\u4ece\u5e38\u91cf\u6c60\u83b7\u5f97\u5bf9\u5e94\u7684\u7b26\u53f7\u5f15\u7528\uff0c\u5728\u7c7b\u521b\u5efa\u6216\u8fd0\u884c\u65f6\u89e3\u6790\uff0c\u7ffb\u8bd1\u5230\u5177\u4f53\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>JDK/bin <code>javap -verbose xxx.class</code></p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#63-access_flag","title":"6.3 \u8bbf\u95ee\u6807\u5fd7 access_flag","text":"<p>\u6807\u5fd7\u4e00\u4e2aClass\u662f\u7c7b\u8fd8\u662f\u63a5\u53e3\uff0c\u662fpublic or private\uff0cfinal?</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#64","title":"6.4 \u7c7b\u7d22\u5f15\uff0c\u7236\u7c7b\u7d22\u5f15\u4e0e\u63a5\u53e3\u7d22\u5f15\u96c6\u5408","text":"<ul> <li>\u7c7b\u7d22\u5f15\u786e\u5b9a\u7c7b\u7684\u5168\u9650\u5b9a\u540d</li> <li>\u7236\u7c7b\u7d22\u5f15\u786e\u5b9a\u7236\u7c7b\u7684\u5168\u9650\u5b9a\u540d</li> <li>\u63a5\u53e3\u7d22\u5f15\u96c6\u5408\u786e\u5b9a\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u90a3\u4e9b\u63a5\u53e3</li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#65-field_info","title":"6.5 \u5b57\u6bb5\u8868\u96c6\u5408 field_info","text":"<p>\u7528\u6765\u63cf\u8ff0\u63a5\u53e3\u6216\u8005\u7c7b\u4e2d\u58f0\u660e\u7684\u53d8\u91cf\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#66","title":"6.6 \u65b9\u6cd5\u8868\u96c6\u5408","text":"<p>\u65b9\u6cd5\u7684\u7279\u5f81\u7b7e\u540d\u4e0d\u5305\u62ec\u8fd4\u56de\u503c\u7c7b\u578b\u3002\u6240\u4ee5\u5728Java\u4e2d\u91cd\u8f7d\u4e00\u4e2a\u65b9\u6cd5\u7684\u65f6\u5019\u9664\u4e86\u65b9\u6cd5\u540d\u8981\u4e00\u81f4\uff0c\u8fd8\u8981\u4fdd\u8bc1\u65b9\u6cd5\u7684\u53c2\u6570\u4e0d\u4e00\u6837\uff01</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#67","title":"6.7 \u5c5e\u6027\u8868\u96c6\u5408","text":"<p>Code\u5c5e\u6027 Java\u7a0b\u5e8f\u65b9\u6cd5\u4f53\u4e2d\u7684\u4ee3\u7801\u7ecf\u8fc7Javac\u7f16\u8bd1\u5668\u5904\u7406\u540e\uff0c\u6700\u7ec8\u53d8\u4e3a\u5b57\u8282\u7801\u6307\u5b9a\u5b58\u50a8\u5728Code\u5c5e\u6027\u5185\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#68","title":"6.8 \u540c\u6b65\u6307\u4ee4","text":"<p>Java\u865a\u62df\u673a\u652f\u6301\u65b9\u6cd5\u7ea7\u522b\u7684\u540c\u6b65\u548c\u4ee3\u7801\u5757\u7684\u540c\u6b65\u3002</p> <ul> <li>\u65b9\u6cd5\u7ea7\u7684\u540c\u6b65\u901a\u8fc7\u4ece\u65b9\u6cd5\u5e38\u91cf\u6c60\u7684\u65b9\u6cd5\u8868\u7ed3\u6784\u4e2d\u7684ACC_SYNCHRONIZED\u8bbf\u95ee\u6807\u5fd7\u5f97\u77e5\u4e00\u4e2a\u65b9\u6cd5\u662f\u5426\u4e3a\u540c\u6b65\u65b9\u6cd5\u3002</li> <li>\u540c\u6b65\u4ee3\u7801\u5757\u662f\u901a\u8fc7synchronized\u8bed\u53e5\u5757\u5b9e\u73b0\u7684\uff0cJava\u865a\u62df\u673a\u7684\u6307\u4ee4\u96c6\u4e2d\u6709monitorenter\u548cmonitorexit\u4e24\u6761\u6307\u4ee4\u3002</li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter7-p232","title":"Chapter7 \u865a\u62df\u673a\u7c7b\u52a0\u8f7d\u673a\u5236 p232","text":"<p>\u7c7b\u5728JVM\u4e2d\u7684\u751f\u547d\u5468\u671f\uff1a\u52a0\u8f7d(Loading)\uff0c\u9a8c\u8bc1(Verification)\uff0c\u51c6\u5907(Preparation)\uff0c\u89e3\u6790(Resolution)\uff0c\u521d\u59cb\u5316(Initalization)\uff0c\u4f7f\u7528(Using)\uff0c\u5378\u8f7d(Unloading)7\u4e2a\u9636\u6bb5\u3002  </p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#72","title":"7.2 \u7c7b\u52a0\u8f7d\u7684\u65f6\u673a","text":"<p>\u7c7b\u5fc5\u987b\u521d\u59cb\u5316\u7684\u76845\u4e2d\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u9047\u5230new, getstatic, putstatic, \u6216\u8005invokestatic\u8fd94\u6761\u5b57\u8282\u7801\u6307\u4ee4\u65f6\uff0c\u5982\u679c\u7c7b\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u5219\u5fc5\u987b\u521d\u59cb\u5316\u3002</p> </li> <li> <p>\u4f7f\u7528java.lang.reflect\u5305\u7684\u65b9\u6cd5\u5bf9\u7c7b\u8fdb\u884c\u53cd\u5c04\u8c03\u7528\u7684\u65f6\u5019\u3002</p> </li> <li> <p>\u5f53\u521d\u59cb\u5316\u4e00\u4e2a\u7c7b\u7684\u65f6\u5019\uff0c\u5982\u679c\u53d1\u73b0\u7236\u7c7b\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u5219\u7acb\u5373\u521d\u59cb\u5316\u7236\u7c7b\u3002\u4e00\u4e2a\u63a5\u53e3\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u8981\u6c42\u5176\u7236\u63a5\u53e3\u5168\u90e8\u90fd\u5b8c\u6210\u4e86\u521d\u59cb\u5316\uff0c\u53ea\u6709\u5728\u771f\u6b63\u4f7f\u7528\u5230\u7236\u63a5\u53e3\u7684\u65f6\u5019\u624d\u521d\u59cb\u5316\u3002</p> </li> <li> <p>\u5f53\u865a\u62df\u673a\u542f\u52a8\u65f6\uff0c\u7528\u6237\u6307\u5b9amain()\u65b9\u6cd5\u6240\u5728\u7684\u7c7b</p> </li> <li> <p>\u5f53\u4f7f\u7528JDK1.7\u7684\u52a8\u6001\u8bed\u8a00\u652f\u6301\u65f6\uff0c\u5982\u679c\u4e00\u4e2ajava.lang.invoke.MethodHandle\u5b9e\u4f8b\u6700\u540e\u7684\u89e3\u6790\u7ed3\u679c\u662fREF_getstatic,REF_putstatic,REF_invokestatic\u7684\u65b9\u6cd5\u53e5\u67c4\uff0c\u5e76\u4e14\u8fd9\u4e2a\u53e5\u67c4\u6240\u5bf9\u5e94\u7684\u7c7b\u6ca1\u6709\u8fdb\u884c\u8fc7\u521d\u59cb\u5316\u3002</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#73","title":"7.3 \u7c7b\u52a0\u8f7d\u7684\u8fc7\u7a0b","text":"<p>\u52a0\u8f7d\u7684\u8fc7\u7a0b\u9700\u8981\u5b8c\u62103\u4ef6\u4e8b\u60c5</p> <ul> <li> <p>\u901a\u8fc7\u4e00\u4e2a\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u83b7\u53d6\u6b64\u5b9a\u4e49\u6b64\u7c7b\u7684\u4e8c\u8fdb\u5236\u5b57\u8282\u6d41\u3002</p> </li> <li> <p>\u5c06\u8fd9\u4e2a\u5b57\u8282\u6d41\u6240\u4ee3\u8868\u7684\u9759\u6001\u5b58\u50a8\u7ed3\u6784\u8f6c\u5316\u4e3a\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u6570\u636e\u7ed3\u6784\u3002</p> </li> <li> <p>\u5728\u5185\u5b58\u4e2d\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u8fd9\u4e2a\u7c7b\u7684java.lang.Class\u5bf9\u8c61\u3002</p> </li> </ul> <p>\u6570\u7ec4\u4e0d\u901a\u8fc7\u7c7b\u52a0\u8f7d\u5668\u521b\u5efa\uff0c\u6570\u7ec4\u662f\u7531JVM\u76f4\u63a5\u521b\u5efa\u3002</p> <p>\u9a8c\u8bc1</p> <ul> <li> <p>\u6587\u4ef6\u683c\u5f0f\u9a8c\u8bc1</p> </li> <li> <p>\u5143\u6570\u636e\u9a8c\u8bc1</p> </li> <li> <p>\u5b57\u8282\u7801\u9a8c\u8bc1</p> </li> <li> <p>\u7b26\u53f7\u5f15\u7528\u9a8c\u8bc1</p> </li> </ul> <p>\u5bf9\u4e8e\u865a\u62df\u673a\u7684\u7c7b\u52a0\u8f7d\u673a\u5236\u6765\u8bf4\uff0c\u9a8c\u8bc1\u9636\u6bb5\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u4f46\u4e0d\u662f\u4e00\u5b9a\u5fc5\u8981\u7684\u9636\u6bb5\u3002 \u53ef\u4ee5\u901a\u8fc7-Xverify:none\u53c2\u6570\u6765\u5173\u95ed\u5927\u90e8\u5206\u7684\u7c7b\u9a8c\u8bc1\u63aa\u65bd\uff0c\u4ee5\u7f29\u77edJVM\u52a0\u8f7d\u7c7b\u7684\u65f6\u95f4\u3002</p> <p>\u51c6\u5907</p> <p>\u51c6\u5907\u9636\u6bb5\u662f\u6b63\u5f0f\u4e3a\u7c7b\u53d8\u91cf\u5206\u914d\u5185\u5b58\u5e76\u8bbe\u7f6e\u7c7b\u53d8\u91cf\u521d\u59cb\u503c\u7684\u9636\u6bb5\uff0c\u8fd9\u4e9b\u53d8\u91cf\u6240\u4f7f\u7528\u7684\u5185\u5b58\u90fd\u5c06\u5728\u65b9\u6cd5\u533a\u8fdb\u884c\u5206\u914d\u3002\u8fd9\u4e2a\u65f6\u5019\u8fdb\u884c\u5185\u5b58\u5206\u914d\u7684\u4ec5\u5305\u62ec\u88abstatic\u4fee\u9970\u7684\u53d8\u91cf\uff0c\u800c\u4e0d\u5305\u62ec\u5b9e\u4f8b\u53d8\u91cf\uff0c\u5b9e\u4f8b\u53d8\u91cf\u5c06\u4f1a\u5728\u5bf9\u8c61\u5b9e\u4f8b\u5316\u65f6\u968f\u7740\u5bf9\u8c61\u4e00\u8d77\u5206\u914d\u5728java\u7684\u5806\u4e2d\u3002</p> <p>\u89e3\u6790</p> <p>\u89e3\u6790\u9636\u6bb5\u662f\u865a\u62df\u673a\u5c06\u5e38\u91cf\u6c60\u5185\u7684\u7b26\u53f7\u5f15\u7528\u66ff\u6362\u4e3a\u76f4\u63a5\u5f15\u7528\u7684\u8fc7\u7a0b\u3002</p> <ul> <li> <p>\u7b26\u53f7\u5f15\u7528\uff1a\u7b26\u53f7\u5f15\u7528\u4ee5\u4e00\u7ec4\u7b26\u53f7\u6765\u63cf\u8ff0\u6240\u5f15\u7528\u7684\u76ee\u6807\uff0c\u7b26\u53f7\u5f15\u7528\u7684\u5b57\u9762\u91cf\u5f62\u5f0f\u660e\u786e\u5b9a\u4e49\u5728java\u865a\u62df\u673a\u89c4\u8303\u7684Class\u6587\u4ef6\u683c\u5f0f\u4e2d\u3002\u7b26\u53f7\u5f15\u7528\u4e0e\u865a\u62df\u673a\u5b9e\u73b0\u7684\u5185\u5b58\u5e03\u5c40\u65e0\u5173\uff0c\u5f15\u7528\u7684\u76ee\u6807\u5e76\u4e0d\u4e00\u5b9a\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u76f4\u63a5\u5f15\u7528\uff1a\u76f4\u63a5\u5f15\u7528\u53ef\u4ee5\u662f\u76f4\u63a5\u6307\u5411\u76ee\u6807\u7684\u6307\u9488\uff0c\u76f8\u5bf9\u504f\u79fb\u91cf\u6216\u662f\u4e00\u4e2a\u95f4\u63a5\u5b9a\u4f4d\u5230\u76ee\u6807\u7684\u53e5\u67c4\u3002\u4e0e\u865a\u62df\u673a\u5b9e\u73b0\u7684\u5185\u5b58\u5e03\u5c40\u6709\u5173\u3002</p> </li> </ul> <p>\u521d\u59cb\u5316</p> <p>\u5f00\u59cb\u6267\u884c\u7c7b\u4e2d\u5b9a\u4e49\u7684Java\u4ee3\u7801\u3002\u521d\u59cb\u5316\u9636\u6bb5\u662f\u6267\u884c\u7c7b\u6784\u9020\u5668()\u65b9\u6cd5\u7684\u8fc7\u7a0b\u3002 - <code>&lt;clinit&gt;()</code>\u65b9\u6cd5\u662f\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u6536\u96c6\u7c7b\u4e2d\u7684\u6240\u6709\u7c7b\u53d8\u91cf\u7684\u8d4b\u503c\u8bed\u53e5\u548c\u9759\u6001\u8bed\u53e5\u5757\u4e2d\u7684\u8bed\u53e5\u5408\u5e76\u4ea7\u751f\u7684\u3002 - \u9759\u6001\u8bed\u53e5\u5757\u4e2d\u53ea\u80fd\u8bbf\u95ee\u5230\u5b9a\u4e49\u5728\u9759\u6001\u8bed\u53e5\u5757\u4e4b\u524d\u7684\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u5b83\u4e4b\u540e\u7684\u53d8\u91cf\uff0c\u5728\u9759\u6001\u8bed\u53e5\u5757\u4e4b\u524d\u53ef\u4ee5\u8d4b\u503c\uff0c\u4f46\u662f\u4e0d\u80fd\u8bbf\u95ee\u3002"},{"location":"Java/2020-02-16-UnderstandingJVM/#74","title":"7.4 \u7c7b\u52a0\u8f7d\u5668","text":"<p>\u6bd4\u8f83\u4e24\u4e2a\u7c7b\u662f\u5426\u201c\u76f8\u7b49\u201d\uff0c\u53ea\u6709\u8fd9\u4e24\u4e2a\u7c7b\u662f\u7531\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u7684\u524d\u63d0\u4e0b\u624d\u6709\u610f\u4e49\uff01\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u7c7b\uff0c\u90fd\u9700\u8981\u7531\u52a0\u8f7d\u5b83\u7684\u7c7b\u52a0\u8f7d\u5668\u548c\u8fd9\u4e2a\u7c7b\u672c\u8eab\u4e00\u540c\u786e\u7acb\u5176\u5728java\u865a\u62df\u673a\u4e2d\u7684\u552f\u4e00\u6027\u3002</p> <p>\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b p252</p> <ul> <li> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff1a\u8d1f\u8d23\u5c06/lib \u76ee\u5f55\u4e2d\u7684\u7c7b\u6216\u8005\u88ab -Xbootclasspath\u53c2\u6570\u6240\u6307\u5b9a\u7684\u7684\u7c7b\u5e93\u52a0\u8f7d\u5230\u865a\u62df\u673a\u7684\u5185\u5b58\u4e2d\u3002\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u88abJava\u7a0b\u5e8f\u8c03\u7528\u3002 <li> <p>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff1a\u8d1f\u8d23\u5c06/lib/ext\u76ee\u5f55\u6216\u8005\u88abjava.ext.dirs\u7cfb\u7edf\u53d8\u91cf\u6240\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u6240\u6709\u7684\u7c7b\u5e93\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u3002 <li> <p>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff1a \u8d1f\u8d23\u52a0\u8f7d\u7528\u6237\u8def\u5f84\u4e0a\u6240\u6307\u5b9a\u7684\u7c7b\u5e93\uff0c\u9ed8\u8ba4\u7684\u7c7b\u52a0\u8f7d\u5668\u3002</p> </li> <p>\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u7684\u52a0\u8f7d\u8fc7\u7a0b\uff1a\u5982\u679c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u6536\u5230\u4e86\u7c7b\u52a0\u8f7d\u7684\u7533\u8bf7\uff0c\u5b83\u9996\u5148\u4e0d\u4f1a\u81ea\u5df1\u53bb\u5c1d\u8bd5\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\uff0c\u800c\u662f\u628a\u8fd9\u7c7b\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u7236\u7c7b\u7684\u52a0\u8f7d\u5668\u53bb\u52a0\u8f7d\u3002\u6bcf\u4e00\u4e2a\u5c42\u6b21\u7684\u7c7b\u52a0\u8f7d\u90fd\u662f\u5982\u6b64\u3002\u56e0\u6b64\u6240\u6709\u7684\u7c7b\u52a0\u8f7d\u7684\u8bf7\u6c42\u6700\u7ec8\u90fd\u4f1a\u4f20\u5230\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff0c\u53ea\u6709\u5f53\u7236\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u5b8c\u6210\u7c7b\u52a0\u8f7d\u8bf7\u6c42\uff0c\u5b50\u52a0\u8f7d\u5668\u624d\u4f1a\u5c1d\u8bd5\u53bb\u52a0\u8f7d\u3002</p> <p>\u7834\u574f\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff1a\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u7c7b\u52a0\u8f7d\u5668\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter8-p259","title":"Chapter8 \u865a\u62df\u673a\u5b57\u8282\u7801\u6267\u884c\u5f15\u64ce p259","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#81","title":"8.1 \u8fd0\u884c\u65f6\u6808\u5e27\u7ed3\u6784","text":"<p>\u6808\u5e27\u7684\u6982\u5ff5\u7ed3\u6784\uff1a </p> <ul> <li> <p>\u6808\u5e27\uff08Stack Frame\uff09\u662f\u865a\u62df\u673a\u8fdb\u884c\u65b9\u6cd5\u8c03\u7528\u548c\u65b9\u6cd5\u6267\u884c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u662f\u865a\u62df\u673a\u8fd0\u884c\u65f6\u6570\u636e\u533a\u4e2d\u7684\u865a\u62df\u673a\u6808\u7684\u6808\u5143\u7d20\u3002\u6808\u5e27\u5b58\u50a8\u4e86\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u64cd\u4f5c\u6570\u6808\uff0c\u52a8\u6001\u94fe\u63a5\u548c\u65b9\u6cd5\u8fd4\u56de\u5730\u5740\u7684\u4fe1\u606f\u3002</p> </li> <li> <p>\u5c40\u90e8\u53d8\u91cf\u8868\u7528\u4e8e\u5b58\u653e\u65b9\u6cd5\u7684\u53c2\u6570\u548c\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p> </li> <li> <p>\u64cd\u4f5c\u6570\u6808</p> </li> <li> <p>\u52a8\u6001\u94fe\u63a5</p> </li> <li> <p>\u65b9\u6cd5\u8fd4\u56de\u5730\u5740</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#82-p272","title":"8.2 \u65b9\u6cd5\u8c03\u7528 p272","text":"<p>\u91cd\u8f7d(Overload) \u5c5e\u4e8e\u9759\u6001\u5206\u6d3e </p> <pre><code>abstract class Human {}\n\nclass Man extends Human {}\n\npublic void sayHello (Human human) {\n  System.out.println(\"hello, guy!\");\n}\n\npublic void sayHello (Man man) {\n   System.out.println(\"hello, gentleman!\");\n}\n\nHuman human = new Human();\n\n//Human \u79f0\u4e3a\u53d8\u91cf\u7684\u9759\u6001\u7c7b\u578b\uff0cMan\u6210\u4e3a\u53d8\u91cf\u7684\u5b9e\u9645\u7c7b\u578b\uff0c\u9759\u6001\u7c7b\u578b\u662f\u7f16\u8bd1\u671f\u53ef\u77e5\uff0c\u5b9e\u9645\u7c7b\u578b\u5728\u8fd0\u884c\u65f6\u624d\u77e5\u9053\u3002\n//\u865a\u62df\u673a\u5728\u91cd\u8f7d\u65f6\u662f\u901a\u8fc7\u53c2\u6570\u7684\u9759\u6001\u7c7b\u578b\u4f5c\u4e3a\u5224\u5b9a\u4f9d\u636e\uff01\nHuman man = new Man();\n\nsayHello(human);  //hello, guy!\nsayHello(man);    //hello, guy!\n</code></pre> <p>\u8986\u76d6(Override) \u865a\u62df\u673a\u901a\u8fc7\u5728\u7c7b\u7684\u65b9\u6cd5\u53bb\u5efa\u7acb\u4e00\u4e2a\u865a\u62df\u65b9\u6cd5\u8868\u5b9e\u73b0\u52a8\u6001\u5206\u6d3e\u3002\u5982\u679c\u67d0\u4e2a\u65b9\u6cd5\u6ca1\u6709\u5728\u5b50\u7c7b\u4e2d\u88ab\u91cd\u5199\uff0c\u90a3\u5b50\u7c7b\u7684\u865a\u65b9\u6cd5\u8868\u91cc\u9762\u7684\u5730\u5740\u5165\u53e3\u548c\u7236\u7c7b\u76f8\u540c\u65b9\u6cd5\u7684\u5730\u5740\u5165\u53e3\u662f\u4e00\u81f4\u7684\uff0c\u90fd\u6307\u5411\u7236\u7c7b\u7684\u5b9e\u73b0\u5165\u53e3\u3002\u5982\u679c\u5b50\u7c7b\u4e2d\u91cd\u5199\u4e86\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5b50\u7c7b\u65b9\u6cd5\u8868\u4e2d\u7684\u5730\u5740\u5c06\u4f1a\u66ff\u6362\u4e3a\u6307\u5411\u5b50\u7c7b\u5b9e\u73b0\u7248\u672c\u7684\u5165\u53e3\u3002</p> <pre><code>abstract class Human {\n  protected abstract void sayHello();\n}\n\nclass Man extends Human {\n  @override\n  protected void sayHello() {\n    System.out.println(\"hello, gentleman!\");\n  }\n}\n</code></pre>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter9-p299","title":"Chapter9 \u7c7b\u52a0\u8f7d\u53ca\u6267\u884c\u5b50\u7cfb\u7edf\u7684\u6848\u4f8b\u4e0e\u5b9e\u8df5 p299","text":"<p>\u52a8\u6001\u4ee3\u7406</p> <pre><code>public class DynamicProxyTest {\n\n  interface IHello {\n    void sayHello();\n  }\n\n  static class Hello implements IHello {\n    @Override\n    public void sayHello() {\n      System.out.println(\"hello, world!\");\n    }\n  }\n\n  static class DynamicProxy implements InvocationHandler {\n    Object object;\n    Object bind(Object object) {\n      this.object = object;\n      return Proxy\n          .newProxyInstance(object.getClass().getClassLoader(), object.getClass().getInterfaces(),\n              DynamicProxy.this);\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n      return method.invoke(object, args);\n    }\n  }\n\n  public static void main(String[] args){\n    IHello iHello = (IHello)new DynamicProxy().bind(new Hello());\n    iHello.sayHello();\n  }\n}\n</code></pre>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter10-p325","title":"Chapter10 \u7f16\u8bd1\u5668\u4f18\u5316 p325","text":"<p>\u6cdb\u578b</p> <ul> <li>\u4e0d\u80fd\u901a\u8fc7\u7f16\u8bd1 <pre><code>public class GenericTypes {\n  public static void method(List&lt;String&gt; list) {\n    System.out.println(\"invoke method(List&lt;String&gt; list)\");\n  }\n\n  public static void method(List&lt;Integer&gt; list) {\n    System.out.println(\"invoke method(List&lt;Integer&gt; list)\");\n  }\n}\n</code></pre></li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter11-p352","title":"Chapter11 \u8fd0\u884c\u671f\u4f18\u5316 p352","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter12-java-p383","title":"Chapter12 Java\u5185\u5b58\u6a21\u578b\u4e0e\u7ebf\u7a0b p383","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#121-volatile","title":"12.1 Volatile","text":"<ul> <li>\u4fdd\u8bc1\u53d8\u91cf\u53ef\u89c1\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</li> <li>\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u4f18\u5316</li> </ul> <p>\u5f88\u9002\u5408volatile\u53d8\u91cf\u63a7\u5236\u5e76\u53d1\u7684\u573a\u666f</p> <pre><code>volatile boolean shutdownRequested;\n\npublic void shutdown() {\n  shutdownRequested = true;\n}\n\npublic void doWork() {\n  while(!shutdownRequested) {\n    // do stuff\n  }\n}\n</code></pre>"},{"location":"Java/2020-02-16-UnderstandingJVM/#122-java","title":"12.2 Java\u4e0e\u7ebf\u7a0b","text":"<p>\u7ebf\u7a0b\u7684\u5b9e\u73b0</p> <ul> <li>\u4f7f\u7528\u5185\u6838\u7ebf\u7a0b\u5b9e\u73b0</li> </ul> <p></p> <ul> <li>\u4f7f\u7528\u7528\u6237\u7ebf\u7a0b\u5b9e\u73b0</li> </ul> <p></p> <ul> <li>\u4f7f\u7528\u7528\u6237\u7ebf\u7a0b\u52a0\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u6df7\u5408\u5b9e\u73b0</li> </ul> <p></p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#123-java","title":"12.3 Java\u7ebf\u7a0b\u8c03\u5ea6","text":"<p>\u7ebf\u7a0b\u8c03\u5ea6\u662f\u6307\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u7ebf\u7a0b\u5206\u914d\u5904\u7406\u5668\u4f7f\u7528\u6743\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8981\u8c03\u5ea6\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u534f\u540c\u5f0f\u7ebf\u7a0b\u8c03\u5ea6\u548c\u62a2\u5360\u5f0f\u7ebf\u7a0b\u8c03\u5ea6\u3002Java\u4f7f\u7528\u62a2\u5360\u5f0f\u7ebf\u7a0b\u8c03\u5ea6\u3002</p>"},{"location":"Java/2020-02-16-UnderstandingJVM/#chapter13","title":"Chapter13 \u7ebf\u7a0b\u5b89\u5168\u4e0e\u9501\u4f18\u5316","text":""},{"location":"Java/2020-02-16-UnderstandingJVM/#131","title":"13.1 \u7ebf\u7a0b\u5b89\u5168\u7684\u5b9e\u73b0\u65b9\u6cd5","text":"<p>\u4e92\u65a5\u540c\u6b65</p> <ul> <li>\u540c\u6b65\u662f\u6307\u5728\u591a\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u65f6\uff0c\u4fdd\u8bc1\u5171\u4eab\u6570\u636e\u5728\u540c\u4e00\u65f6\u523b\u53ea\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u3002</li> <li>\u4e92\u65a5\u662f\u5b9e\u73b0\u540c\u6b65\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e34\u754c\u533a(Critical Section),\u4e92\u65a5\u91cf(Mutex)\u548c\u4fe1\u53f7\u91cf(Semaphore)\u90fd\u662f\u4e3b\u8981\u7684\u4e92\u65a5\u5b9e\u73b0\u65b9\u5f0f\u3002</li> </ul> <p>\u975e\u963b\u585e\u540c\u6b65</p> <ul> <li>CAS  \u4f1a\u5e26\u6765ABA\u7684\u95ee\u9898\uff0c\u4e00\u822c\u4f7f\u7528AtomicStampedReference</li> </ul> <p>\u65e0\u540c\u6b65\u65b9\u6848</p> <ul> <li> <p>\u53ef\u91cd\u5165\u4ee3\u7801\uff1a\u6240\u6709\u7684\u53ef\u91cd\u5165\u4ee3\u7801\u90fd\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4f46\u662f\u5e76\u975e\u6240\u6709\u7684\u7ebf\u7a0b\u5b89\u5168\u4ee3\u7801\u90fd\u662f\u53ef\u91cd\u5165\u7684\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8(Thread Local Storage)</p> </li> </ul>"},{"location":"Java/2020-02-16-UnderstandingJVM/#132","title":"13.2 \u9501\u4f18\u5316","text":"<p>\u81ea\u65cb\u9501\u4e0e\u81ea\u9002\u5e94\u9501</p> <ul> <li>\u81ea\u65cb\u9501\uff1a\u4e00\u822c\u60c5\u51b5\u4e0b\u5171\u4eab\u6570\u636e\u7684\u9501\u5b9a\u72b6\u6001\u53ea\u4f1a\u6301\u7eed\u5f88\u77ed\u4e00\u6bb5\u65f6\u95f4\uff0c\u4e3a\u4e86\u8fd9\u6bb5\u65f6\u95f4\u53bb\u6302\u8d77\u548c\u6062\u590d\u7ebf\u7a0b\u4e0d\u503c\u5f97\u3002\u5982\u679c\u7269\u7406\u673a\u5668\u4e0a\u6709\u4e00\u4e2a\u4ee5\u4e0a\u7684\u5904\u7406\u5668\uff0c\u80fd\u8ba9\u4e24\u4e2a\u6216\u4ee5\u4e0a\u7684\u7ebf\u7a0b\u540c\u65f6\u5e76\u884c\u6267\u884c\uff0c\u53ef\u4ee5\u8ba9\u540e\u9762\u8bf7\u6c42\u9501\u7684\u7ebf\u7a0b\u7a0d\u7b49\u4e00\u4e0b\uff0c\u4f46\u4e0d\u653e\u5f03\u5904\u7406\u5668\u7684\u65f6\u95f4\uff0c\u770b\u770b\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u662f\u5426\u5f88\u5feb\u5c31\u4f1a\u91ca\u653e\u9501\u3002\u4e3a\u4e86\u8ba9\u7ebf\u7a0b\u7b49\u5f85\uff0c\u6211\u4eec\u53ea\u9700\u8ba9\u7ebf\u7a0b\u6267\u884c\u4e00\u4e2a\u5fd9\u5faa\u73af\uff0c\u8fd9\u5c31\u662f\u81ea\u65cb\u9501\u3002</li> </ul> <p>\u8f7b\u91cf\u7ea7\u9501</p> <p>CAS \u4e3b\u8981\u662f\u901a\u8fc7\u5bf9\u8c61(Object Header)\u7684Mark Word(\u8bb0\u5f55\u6301\u6709\u8be5\u5bf9\u8c61\u9501\u7684\u7ebf\u7a0bID)\u5b57\u6bb5\u5b9e\u73b0\u3002\u8f7b\u91cf\u7ea7\u9501\u662f\u5728\u65e0\u7ade\u4e89\u60c5\u51b5\u4e0b\u4f7f\u7528CAS\u64cd\u4f5c\u53bb\u6d88\u9664\u540c\u6b65\u4f7f\u7528\u7684\u4e92\u65a5\u91cf\u3002</p> <p>\u504f\u5411\u9501</p> <p>\u504f\u5411\u9501\u5c31\u662f\u5728\u65e0\u7ade\u4e89\u7684\u60c5\u51b5\u4e0b\u628a\u6574\u4e2a\u540c\u6b65\u90fd\u6d88\u9664\u6389\uff0c\u8fdeCAS\u90fd\u4e0d\u505a\u3002\u5047\u5982\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u5f97\u67d0\u4e2a\u5bf9\u8c61\u7684\u504f\u5411\u9501\uff0c\u5728\u540e\u9762\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8be5\u9501\u6ca1\u6709\u88ab\u5176\u4ed6\u5bf9\u8c61\u83b7\u53d6\uff0c\u5219\u6301\u6709\u504f\u5411\u9501\u7684\u7ebf\u7a0b\u5c06\u6c38\u8fdc\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u540c\u6b65\u3002\u504f\u5411\u9501\u53ef\u4ee5\u63d0\u9ad8\u5e26\u6709\u540c\u6b65\u4f46\u65e0\u7ade\u4e89\u7684\u7a0b\u5e8f\u6027\u80fd\u3002</p>"},{"location":"Java/2020-07-05-clean-code/","title":"Refactoring","text":"<p>Any fool can write code that a computer can understand. Good programmers write code that humans can understand.</p> <ol> <li> <p>When you have to add a feature to a program but the code is not structured in a convenient way, first refactor the program to make it easy to add the feature, then add the feature.</p> </li> <li> <p>Before you start refactoring, make sure you have a solid suite of tests. These tests must be self-checking.</p> </li> <li> <p>Refactoring changes the programs in small steps, so if you make a mistake, it is easy to find where the bug is.</p> </li> <li> <p>When programming, follow the camping rule: Always leave the code base healthier than when you found it.</p> </li> <li> <p>You have to refactor when you run into ugly code\u2014but excellent code needs plenty of refactoring too.</p> </li> <li> <p>The whole purpose of refactoring is to make us program faster, producing more value with less effort.</p> </li> </ol>"},{"location":"Java/2020-07-05-clean-code/#bad-smells-in-code","title":"Bad Smells in Code","text":"<ol> <li> <p>Mysterious Name  </p> </li> <li> <p>Duplicated Code  </p> </li> <li> <p>Long Function  </p> </li> <li> <p>Long Parameter List  </p> </li> <li> <p>Global Data - Then, it\u2019s good to limit its scope as much as possible by moving it within a class or module where only that module\u2019s code can see it.</p> </li> <li> <p>Mutable Data -  Use Combine Functions into Class (144) or Combine Functions into Transform (149) to limit how much code needs to update a variable. </p> </li> <li> <p>Divergent Change</p> </li> <li> <p>Shotgun Surgery</p> </li> <li> <p>Comments - If you need a comment to explain what a block of code does, try Extract Function (106). If the method is already extracted but you still need a comment to explain what it does, use Change Function Declaration (124) to rename it. If you need to state some rules about the required state of the system, use Introduce Assertion (302).</p> </li> </ol>"},{"location":"Java/2020-07-05-clean-code/#clean-code","title":"Clean Code","text":""},{"location":"Java/2020-07-05-clean-code/#meaningful-names","title":"Meaningful Names","text":"<p>Say what you mean. Mean what you say.</p>"},{"location":"Java/2020-07-05-clean-code/#use-intention-revealing-names","title":"Use Intention-Revealing Names","text":"<pre><code>//bad\nint d; // elapsed time in days\n\n//good\nint daysSinceCreation;\nint daysSinceModification;\nint fileAgeInDays;\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#avoid-disinformation","title":"AVOID DISINFORMATION","text":"<pre><code>//bad\nint a = l;\nif ( O == l )\n  a = O1;\nelse\n  l = 01;\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#make-meaningful-distinctions","title":"MAKE MEANINGFUL DISTINCTIONS","text":"<pre><code>//bad Noise words are redundant.\n\ngetActiveAccount();\ngetActiveAccounts();\ngetActiveAccountInfo();\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#use-pronounceable-names","title":"USE PRONOUNCEABLE NAMES","text":"<pre><code>//bad\n\nclass DtaRcrd102 {\n  private Date genymdhms;\n  private Date modymdhms;\n  private final String pszqint = \u201d102\u201d;\n  /* \u2026 */\n};\n\n//good\n\nclass Customer {\n  private Date generationTimestamp;\n  private Date modificationTimestamp;;\n  private final String recordId = \u201d102\u201d;\n  /* \u2026 */\n};\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#pick-one-word-per-concept","title":"PICK ONE WORD PER CONCEPT","text":""},{"location":"Java/2020-07-05-clean-code/#function","title":"Function","text":""},{"location":"Java/2020-07-05-clean-code/#small","title":"Small","text":""},{"location":"Java/2020-07-05-clean-code/#do-one-thing","title":"DO one thing","text":""},{"location":"Java/2020-07-05-clean-code/#use-descriptive-names","title":"USE DESCRIPTIVE NAMES","text":"<p>The smaller and more focused a function is, the easier it is to choose a descriptive name.</p>"},{"location":"Java/2020-07-05-clean-code/#function-arguments","title":"FUNCTION ARGUMENTS","text":"<p>The ideal number of arguments for a function is zero (niladic). Next comes one (monadic), followed closely by two (dyadic). Three arguments (triadic) should be avoided where possible. More than three (polyadic) requires very special justification\u2014and then shouldn\u2019t be used anyway. Functions that take variable arguments can be monads, dyads, or even triads. But it would be a mistake to give them more arguments than that.</p> <pre><code>//It's ok\nvoid monad(Integer\u2026 args);\nvoid dyad(String name, Integer\u2026 args);\nvoid triad(String name, int count, Integer\u2026 args);\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#flag-arguments","title":"Flag Arguments","text":"<p>Flag arguments are ugly.</p>"},{"location":"Java/2020-07-05-clean-code/#argument-objects","title":"Argument Objects","text":"<p>When a function seems to need more than two or three arguments, it is likely that some of those arguments ought to be wrapped into a class of their own. </p>"},{"location":"Java/2020-07-05-clean-code/#output-arguments","title":"Output Arguments","text":"<p>In general output arguments should be avoided. If your function must change the state of something, have it change the state of its owning object.</p>"},{"location":"Java/2020-07-05-clean-code/#prefer-exceptions-to-returning-error-codes","title":"PREFER EXCEPTIONS TO RETURNING ERROR CODES","text":"<p>If you use exceptions instead of returned error codes, then the error processing code can be separated from the happy path code and can be simplified:  </p> <pre><code>try {\n  deletePage(page);\n  registry.deleteReference(page.name);\n  configKeys.deleteKey(page.name.makeKey());\n}\ncatch (Exception e) {\n  logger.log(e.getMessage());\n}\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#extract-trycatch-blocks","title":"Extract Try/Catch Blocks","text":"<pre><code>public void delete(Page page) {\n  try {\n    deletePageAndAllReferences(page);\n  }\n  catch (Exception e) {\n    logError(e);\n  }\n}\n\nprivate void deletePageAndAllReferences(Page page) throws Exception {\n  deletePage(page);\n  registry.deleteReference(page.name);\n  configKeys.deleteKey(page.name.makeKey());\n}\n</code></pre>"},{"location":"Java/2020-07-05-clean-code/#dont-return-null-dont-pass-null","title":"DON\u2019T RETURN NULL, DON\u2019T PASS NULL","text":"<p>Returning null from methods is bad, but passing null into methods is worse.</p>"},{"location":"Java/2020-07-05-clean-code/#error-handling","title":"Error Handling","text":""},{"location":"Java/2020-07-05-clean-code/#use-exceptions-rather-than-return-codes","title":"USE EXCEPTIONS RATHER THAN RETURN CODES","text":""},{"location":"Java/2020-07-05-clean-code/#classes","title":"Classes","text":""},{"location":"Java/2020-07-05-clean-code/#classes-should-be-small","title":"CLASSES SHOULD BE SMALL!","text":""},{"location":"Java/2020-07-05-clean-code/#organizing-for-change","title":"ORGANIZING FOR CHANGE","text":"<p>Isolating from Change Needs will change, therefore code will change. We learned in OO 101 that there are concrete classes, which contain implementation details (code), and abstract classes, which represent concepts only. A client class depending upon concrete details is at risk when those details change. We can introduce interfaces and abstract classes to help isolate the impact of those details.</p>"},{"location":"Java/2021-03-08/","title":"2021-Kickoff","text":""},{"location":"Java/2021-03-08/#common","title":"Common","text":"<p><code>transient</code> The transient keyword in Java is used to avoid serialization.</p>"},{"location":"Java/2021-03-08/#spring","title":"Spring","text":"<p>https://processon.com/signup?f=index</p>"},{"location":"Java/2021-03-08/#spring_1","title":"Spring\u7a0b\u5e8f\u662f\u5982\u4f55\u542f\u52a8\u7684\uff1f","text":"<ul> <li>Tomcat\u5bb9\u5668\u662f\u4ec0\u4e48\u65f6\u5019\u542f\u52a8\u7684\uff1f</li> </ul> <pre><code>SpringBootServletInitializer.onStartup() -&gt; createRootApplicationContext()\n</code></pre> <p>\u6838\u5fc3\uff1a DispatcherServlet <pre><code>public class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n    @Override\n    public void onStartup(ServletContext servletContext) {\n\n        // Load Spring web application configuration\n        AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();\n        context.register(AppConfig.class);\n\n        // Create and register the DispatcherServlet\n        DispatcherServlet servlet = new DispatcherServlet(context);\n        ServletRegistration.Dynamic registration = servletContext.addServlet(\"app\", servlet);\n        registration.setLoadOnStartup(1);\n        registration.addMapping(\"/app/*\");\n    }\n}\n</code></pre></p>"},{"location":"Java/2021-03-08/#spring_2","title":"Spring\u662f\u5982\u4f55\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\uff1f","text":""},{"location":"Java/2021-03-08/#beandefinitionreader","title":"BeanDefinitionReader","text":"<p>XMLBeanDefinitionReader  - \u8d1f\u8d23\u52a0\u8f7d\u57fa\u4e8eXMl\u7684bean ClassPathBeanDefinitionScanner - \u8d1f\u8d23\u52a0\u8f7d\u57fa\u4e8e\u6ce8\u89e3\u7684bean</p>"},{"location":"Java/2021-03-08/#beanfactory","title":"BeanFactory","text":""},{"location":"Java/2021-03-08/#springrefresh","title":"\u5f7b\u5e95\u641e\u5b9aSpring\u7684refresh\u65b9\u6cd5","text":""},{"location":"Java/2021-03-08/#beanpostprocessor","title":"BeanPostProcessor\u63a5\u53e3","text":"<pre><code>BeanFactoryPostProcessor --&gt; BeanDefinitionRegistryPostProcessor -&gt;  \nConfigurationClassPostProcessor --&gt; ConfigurationClassParser.doProcessConfigurationClass\n\n\u5206\u4ee5\u4e0b\u60c5\u51b5\uff1a\n@Configuration (@Component)\n@ComponentScan\n@PropertySource\n@Import\n@ImportResource\n@Bean\n</code></pre>"},{"location":"Java/2021-03-08/#beanfactorypostprocessor","title":"BeanFactoryPostProcessor\u63a5\u53e3","text":""},{"location":"Java/2021-03-08/#springbeanaware","title":"SpringBean\u6709\u6ca1\u6709\u5fc5\u8981\u5b9e\u73b0Aware\u63a5\u53e3","text":""},{"location":"Java/2021-03-08/#springbean","title":"\u5f7b\u5e95\u7406\u89e3SpringBean\u7684\u751f\u547d\u5468\u671f","text":""},{"location":"Java/2021-03-08/#_1","title":"\u5faa\u73af\u4f9d\u8d56\u95ee\u9898","text":""},{"location":"Java/2021-03-08/#factorybean","title":"FactoryBean\u63a5\u53e3\u7684\u4f5c\u7528","text":""},{"location":"Java/2021-03-08/#bean","title":"Bean\u7684\u521d\u59cb\u5316\u90fd\u7ecf\u5386\u4ec0\u4e48","text":""},{"location":"Java/2021-03-08/#cglibjdk","title":"cglib\u548cjdk\u52a8\u6001\u4ee3\u7406","text":""},{"location":"Java/2021-03-08/#aop","title":"Aop\u5982\u4f55\u5904\u7406\u7684","text":"<pre><code>@ControllerAdvice\n\nMethodInterceptor  CglibMethodInvocation-&gt; (advice method chain)\n\n@Transaction TransactionAspectSupport\n\n\n\n//Sample\n\n@Aspect\n@Component\npublic class AspectJLogUtil {\n\n  @Pointcut(\"execution(public com.sample.MyService.AddUser)\")\n  public void logPoint(){}\n\n\n  @Around(\"logPoint()\")\n  @Order(4)\n  //\u8fde\u63a5\u70b9 advice\u548cPointCut\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2aJoin point\n  public Object around(ProceedingJoinPoint proceedingJoinPoint ) {\n    //TODO\n    return new Object();\n  }\n}\n</code></pre>"},{"location":"Java/2021-03-08/#jvm-tunning","title":"JVM Tunning","text":"<p><pre><code>java -XX:+PringFlagsFinal\n\njava -Xms200M -Xmx200M -XX:+PrintGC \n</code></pre> http://www.oracle.com/technetwork/java/javase/documentation/index.html </p> <p>Garbage Collectors</p> <pre><code>&lt;Serial, SerialOld&gt;, &lt;ParNew, CMS&gt;, &lt;Parallel Scavenge, Parallel Old&gt; - G1\n\njdk1.8\u4f7f\u7528G1\u6ca1\u6709\u95ee\u9898\n</code></pre> <p>JVM tuning tool - alibaba arthas - JConsole - JProfile</p> <pre><code>jps\n\ntop -Hp &lt;processID&gt;\njmap histo &lt;ThreadID&gt; | head -20\ntrace ABC a\n\n#hot load class\nredefine \n</code></pre>"},{"location":"Java/2021-03-08/#cas","title":"CAS","text":"<p>\u6700\u5e95\u5c42\u662f\u4e00\u6761\u6c47\u7f16\u6307\u4ee4<code>lock cmpxchg</code></p>"},{"location":"Java/2021-03-08/#aqs","title":"AQS\uff1f","text":""},{"location":"Java/2021-03-08/#juc","title":"JUC","text":"<ol> <li>\u9ed8\u8ba4synchronized(o)</li> </ol> <p>00-&gt;\u8f7b\u91cf\u7ea7\u9501\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u504f\u5411\u9501\u7684\u5f00\u542f\u6709\u4e2a4\u79d2\u5ef6\u65f6\uff0c\u56e0\u4e3aJVM\u865a\u62df\u673a\u672c\u8eab\u6709\u4e00\u4e9b\u9ed8\u8ba4\u542f\u52a8\u7684\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4e4b\u95f4\u80af\u5b9a\u4f1a\u6709\u7ade\u4e89\uff0c\u5982\u679c\u4e0a\u6765\u5c31\u662f\u7528\u504f\u5411\u9501\uff0c\u5c31\u4f1a\u4e0d\u65ad\u7684\u9020\u6210\u9501\u64a4\u9500\uff0c\u9501\u5347\u7ea7\uff0c\u6548\u7387\u53d8\u4f4e\u3002</p> <pre><code>-XX:BiasedLockingStartupDelay=0\n</code></pre> <ol> <li>\u5982\u679c\u8bbe\u5b9a\u4e0a\u8ff0\u53c2\u6570</li> </ol> <p><code>new Object</code> -&gt; 101 \u504f\u5411\u9501 -&gt; \u7ebf\u7a0bID\u4e3a0 -&gt; Anonymous BiasedLock \u6253\u5f00\u504f\u5411\u9501\uff0cnew \u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u5c31\u662f\u4e00\u4e2a\u53ef\u504f\u533f\u540d\u5bf9\u8c61101</p> <ol> <li>\u5982\u679c\u7ebf\u7a0b\u4e0a\u6709\u9501</li> </ol> <p>\u4e0a\u504f\u5411\u9501\uff0c\u6307\u7684\u5c31\u662f\uff0c\u628amarkword\u7684\u7ebf\u7a0bID\u6539\u4e3a\u81ea\u5df1\u7ebf\u7a0bID\u7684\u8fc7\u7a0b\uff0c\u504f\u5411\u9501\u4e0d\u53ef\u91cd\u504f\u5411\uff0c\u6279\u91cf\u504f\u5411\uff0c\u6279\u91cf\u64a4\u9500</p> <ol> <li>\u5982\u679c\u6709\u7ebf\u7a0b\u7ade\u4e89</li> </ol> <p>\u64a4\u9500\u504f\u5411\u9501\uff0c\u5347\u7ea7\u8f7b\u91cf\u7ea7\u9501\uff0c\u7ebf\u7a0b\u5728\u81ea\u5df1\u7684\u7ebf\u7a0b\u6808\u751f\u6210LockRecord, \u7528CAS\u64cd\u4f5c\u5c06markword\u8bbe\u7f6e\u4e3a\u6307\u5411\u81ea\u5df1\u8fd9\u4e2a\u7ebf\u7a0b\u7684LR\u7684\u6307\u9488\uff0c\u8bbe\u7f6e\u6210\u529f\u8005\u83b7\u5f97\u9501</p> <ol> <li>\u5982\u679c\u7ade\u4e89\u52a0\u5267</li> </ol> <p>\u60c5\u51b51\uff1a\u6709\u7ebf\u7a0b\u8d85\u8fc710\u6b21\u81ea\u65cb\uff0c<code>-XX:PreBloackSpin</code>, \u540e\u8005\u81ea\u65cb\u7684\u7ebf\u7a0b\u6570\u8d85\u8fc7CPU\u6838\u6570\u7684\u4e00\u534a\uff0c1.6\u4e4b\u540e\uff0c\u52a0\u5165\u81ea\u9002\u5e94\u81ea\u65cbAdapative Self Spining\uff0cJVM\u81ea\u5df1\u63a7\u5236 \u60c5\u51b52\uff1a \u5347\u7ea7\u91cd\u91cf\u7ea7\u9501\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u8d44\u6e90\uff0c\u7ebf\u7a0b\u6302\u8d77\uff0c\u8fdb\u5165\u7b49\u5f85\u961f\u5217\uff0c\u7b49\u5f85\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6</p> <p>\u8f7b\u91cf\u7ea7\u9501\u91cd\u91cf\u7ea7\u9501\u7684hashcode\u5b58\u5728\u4ec0\u4e48\u5730\u65b9\uff1f</p> <p>\u7b54\u6848\uff1a\u7ebf\u7a0b\u6808\u4e2d\uff0c\u8f7b\u91cf\u7ea7\u9501\u7684LR\u79cd\uff0c\u6216\u8005\u4ee3\u8868\u91cd\u91cf\u7ea7\u9501\u7684ObjectMonitor\u7684\u6210\u5458\u4e2d</p> <p>\u4e3a\u4ec0\u4e48\u6709\u81ea\u65cb\u9501\u8fd8\u9700\u8981\u91cd\u91cf\u7ea7\u9501</p> <p>\u7b54\u6848\uff1a \u81ea\u65cb\u9501\u662f\u6d88\u8017CPU\u8d44\u6e90\u7684\uff0c\u5982\u679c\u7ebf\u7a0b\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u800c\u540c\u65f6\u7b49\u5f85\u7684\u7ebf\u7a0b\u6bd4\u8f83\u591a\uff0cCPU\u4f1a\u88ab\u5927\u91cf\u6d88\u8017\u5728\u7b49\u5f85\u4e0a\uff0c\u91cd\u91cf\u7ea7\u9501\u5982\u679c\u83b7\u53d6\u4e0d\u5230\uff0c\u5c31\u8fdb\u5165\u5230\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u4e0d\u4f1a\u6d88\u8017CPU</p> <p>\u504f\u5411\u9501\u4e00\u5b9a\u6bd4\u81ea\u65cb\u9501\u6548\u7387\u9ad8\u4e48\uff1f</p> <p>\u7b54\u6848\uff1a\u4e0d\u4e00\u5b9a\u3002\u5728\u660e\u77e5\u9053\u4f1a\u6709\u591a\u7ebf\u7a0b\u7ade\u4e89\u7684\u60c5\u51b5\u4e0b\uff0c\u504f\u5411\u9501\u4f1a\u6d89\u53ca\u9501\u64a4\u9500\uff0c\u5347\u7ea7\u4e3a\u8f7b\u91cf\u7ea7\u9501\u3002</p>"},{"location":"Java/2021-03-08/#_2","title":"\u7b97\u6cd5","text":"<ul> <li>\u5feb\u901f\u6392\u5e8f\uff0cj\u8868\u793a\u4ece\u53f3\u8fb9\u5f00\u59cb\u7684\u6e38\u6807\uff0cj\u6700\u540e\u9501\u542c\u7684\u4f4d\u7f6e\u5c31\u662f\u4ece\u53f3\u8fb9\u6570\u6700\u540e\u4e00\u4e2a\u6bd4base\u5c0f\u7684\u6570\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u548cbase\u4ea4\u6362\u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"Java/2021-03-08/#_3","title":"\u7ea2\u9ed1\u6811","text":"<ul> <li>\u6811\u4e0a\u7684\u8282\u70b9\u90fd\u6709\u989c\u8272\uff0c\u6216\u662f\u7ea2\uff0c\u6216\u8005\u662f\u9ed1, \u6839\u8282\u70b9\u4e00\u5b9a\u662f\u9ed1\u8272</li> <li>\u6240\u6709\u7684\u53f6\u5b50\u8282\u70b9\u90fd\u662f\u9ed1\u8272</li> <li>\u82e5\u4e00\u4e2a\u8282\u70b9\u7684\u989c\u8272\u662f\u7ea2\u8272\uff0c\u90a3\u4e48\u5176\u5b69\u5b50\u8282\u70b9\u90fd\u662f\u9ed1\u8272</li> <li>\u4ece\u4e00\u4e2a\u7ed3\u70b9\u51fa\u53d1\u5230\u5176\u540e\u4ee3\u8282\u70b9\u7684\u6240\u6709\u8def\u5f84\uff0c\u90fd\u5305\u542b\u76f8\u540c\u6570\u91cf\u7684\u9ed1\u8272\u8282\u70b9</li> </ul> <p>\u5bf9\u7ea2\u9ed1\u4e66\u7684\u64cd\u4f5c\uff1a</p> <ol> <li>\u67d3\u8272</li> <li>\u5de6\u65cb\uff1a\u4ee5\u8282\u70b9X\u5de6\u65cb\u5c31\u662f\u628a\u8be5\u8282\u70b9\u7684\u53f3\u8282\u70b9\uff0c\u53d8\u4e3a\u5176\u7236\u8282\u70b9\u3002\u53f3\u8282\u70b9\u7684\u5de6\u5b69\u5b50\u8282\u70b9\u53d8\u4e3a\u8282\u70b9X\u7684\u53f3\u5b69\u5b50\u8282\u70b9</li> <li>\u53f3\u65cb\uff1a\u4ee5\u8282\u70b9X\u53f3\u65cb\u5c31\u662f\u628a\u8be5\u8282\u70b9\u7684\u5de6\u8282\u70b9\uff0c\u53d8\u4e3a\u5176\u7236\u8282\u70b9\uff0c\u5de6\u8282\u70b9\u7684\u53f3\u5b69\u5b50\u8282\u70b9\u53d8\u4e3a\u8282\u70b9X\u7684\u5de6\u5b69\u5b50\u8282\u70b9</li> </ol>"},{"location":"Java/2021-03-08/#_4","title":"\u53cc\u5411\u94fe\u8868","text":"<ul> <li>\u5220\u9664\u64cd\u4f5c</li> </ul> <pre><code>           Remove\nP|0|N  &lt;-&gt; P|1|N &lt;-&gt; P|2|N\n           NodeX\n\nNode pre = NodeX.pre\nNode next = NodeX.next\n\npre.next = next;\nNodeX.pre = null\n\nnext.pre = pre;\nNodeX.next = null;\n</code></pre> <ul> <li>\u6dfb\u52a0\u64cd\u4f5c,\u9ed8\u8ba4\u6dfb\u52a0\u5230\u7ed3\u5c3e</li> </ul> <pre><code>P|last|N   &lt;-&gt; P|New|N\n\nNode l = last;\nNode newNode = new Node(l, e, null);\nlast = newNode;\n\nif (l==null) {\n  first = newNode;\n} else {\n  l.next = newNode;\n}\n</code></pre>"},{"location":"Java/2021-03-08/#_5","title":"\u56fe","text":"<ul> <li> <p>\u56fe\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\u7b97\u6cd5</p> </li> <li> <p>\u4ece\u56fe\u4e2d\u9009\u53d6\u4efb\u4e00\u8282\u70b9\u4f5c\u4e3a\u521d\u59cb\u8282\u70b9\u8bbf\u95ee\uff0c\u6807\u8bb0\u5176\u88ab\u8bbf\u95ee</p> </li> <li>\u4f9d\u6b21\u8bbf\u95ee\u8be5\u8282\u70b9\u7684\u76f8\u90bb\u8282\u70b9\uff0c\u6807\u8bb0\u88ab\u8bbf\u95ee\uff0c\u653e\u5165\u961f\u5217</li> <li>\u4ece\u961f\u5217\u4e2d\u4f9d\u6b21\u53d6\u51fa\u90bb\u63a5\u70b9\uff0c\u4e00\u4e00\u904d\u5386\uff0c\u76f4\u5230\u56fe\u4e2d\u6240\u6709\u5df2\u88ab\u8bbf\u95ee\u8fc7\u7684\u9876\u70b9\u7684\u90bb\u63a5\u70b9\u90fd\u88ab\u8bbf\u95ee\u3002</li> </ul>"},{"location":"Java/2021-03-08/#b-tree","title":"B Tree","text":"<ol> <li>\u53f6\u5b50\u8282\u70b9\u5177\u6709\u76f8\u540c\u7684\u6df1\u5ea6\uff0c\u53f6\u8282\u70b9\u7684\u6307\u9488\u4e3a\u7a7a</li> <li>\u6240\u6709\u7d22\u5f15\u5143\u7d20\u4e0d\u91cd\u590d</li> <li>\u8282\u70b9\u4e2d\u7684\u6570\u636e\u7d22\u5f15\u4ece\u5de6\u5230\u53f3\u9012\u589e\u6392\u5217</li> </ol>"},{"location":"Java/2021-03-08/#b-tree_1","title":"B+ tree","text":"<ol> <li>\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u50a8data\uff0c\u53ea\u5b58\u50a8\u7d22\u5f15\uff0c\u53ef\u4ee5\u653e\u66f4\u591a\u7684\u7d22\u5f15</li> <li>\u53f6\u5b50\u8282\u70b9\u5305\u542b\u6240\u6709\u7d22\u5f15\u5b57\u6bb5</li> <li>\u53f6\u5b50\u8282\u70b9\u4f7f\u7528\u6307\u9488\uff0c\u63d0\u9ad8\u533a\u95f4\u8bbf\u95ee\u7684\u6027\u80fd</li> </ol> <p>\u53f6\u5b50\u8282\u70b9\u5b58\u7d22\u5f15\u4ee5\u53ca\u7d22\u5f15\u6240\u5728\u884c\u5728\u78c1\u76d8\u4e0a\u7684\u5730\u5740\u6307\u9488\uff0c\u6216\u8005\u5b58\u521d\u4e86\u7d22\u5f15\u4ee5\u5916\u8be5\u884c\u5176\u4ed6\u6570\u636e\u7684\u5408\u96c6\u3002</p>"},{"location":"Java/2021-03-08/#_6","title":"\u5206\u5e03\u5f0f","text":"<ul> <li>TCP</li> <li>dubbo</li> <li>http</li> </ul>"},{"location":"Java/2021-03-08/#_7","title":"\u5206\u5e03\u5f0f\u9501","text":"<p>[redisson] (https://redisson.org/)</p> \u6846\u67b6 \u534f\u8bae \u4f18\u7f3a\u70b9 websocket tcp http soap dubbo tcp  dubbo \u4ea4\u6362\u7684\u6570\u636e\u653e\u5728\u6570\u7ec4\u4e2d\uff0c\u7a7a\u95f4\u4f7f\u7528\u7387\u5f88\u9ad8 springcloud tcp http json\u683c\u5f0f <p>\u5ba2\u6237\u7aef\u8c03\u7528\u670d\u52a1\u6240\u8003\u8651\u7684\u7ef4\u5ea6 </p> <ol> <li>\u533a\u57df/\u673a\u623f\u611f\u77e5</li> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>\u8f6e\u8be2\u7b97\u6cd5</li> <li>\u968f\u673a\u7b97\u6cd5</li> <li>\u6e90\u5730\u5740\u54c8\u5e0c</li> <li>\u52a0\u6743\u8f6e\u8be2</li> <li>\u6700\u5c0f\u94fe\u63a5\u6570</li> <li>\u5b9a\u5411\u5206\u53d1</li> <li>\u533a\u57df\u6743\u8861\u7b56\u7565</li> <li>\u53ef\u7528\u8fc7\u6ee4\u7b56\u7565</li> <li>\u54cd\u5e94\u65f6\u95f4\u52a0\u6743\u7b56\u7565</li> </ol> <p>\u7f13\u5b58\u6570\u636e \u2192 \u5b9a\u5411\u6d41\u91cf\u5206\u53d1</p> <p>SpringCloud \u914d\u7f6e\u6587\u4ef6\uff0c \u4e0d\u91cd\u542f\u9700\u6539\u914d\u7f6e @RefreshScope\uff0c \u4e00\u822c\u4f7f\u7528\u914d\u7f6e\u4e2d\u5fc3 SpringCloud Config \u914d\u7f6e\u4e2d\u5fc3 -&gt; \u6eaf\u6e90/\u5ba1\u8ba1 \u2192 Git/SVN  \u901a\u8fc7BUS\uff08\u6d88\u606f\u603b\u7ebf\uff09\u5e7f\u64ad\u6d88\u606f</p> <p>Alibaba Nacos\u6d88\u606f\u4e2d\u95f4\u4ef6/\u643a\u7a0b apllo</p> <p>SPI\uff1f</p> <p>\u670d\u52a1\u964d\u7ea7/  \u670d\u52a1\u9ed1\u540d\u5355  hystrix (\u4ee3\u7801\u4fb5\u5165\u6027\u5f3a)  Sentinel\u66ff\u6362Hystrix</p> <p>\u7194\u65ad\u4e09\u4e2a\u529f\u80fd  1.\u7194\u65ad\uff0c 2.\u670d\u52a1\u964d\u7ea7\uff0c 3.\u8d44\u6e90\u9694\u79bb\uff08\u670d\u52a1\u7684\u8c03\u7528\u65b9\uff09   - \u7ebf\u7a0b\u6c60\u9694\u79bb   - \u4fe1\u53f7\u91cf\u9694\u79bb(\u8ba1\u6570\u5668)</p> <p>CAP Consistency/Availability/Partition Tolerance</p> <p>\u5173\u4e8e\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff1a\u60f3\u8981\u9ad8\u4e00\u81f4\u6027\uff0c\u5c31\u505a\u96c6\u7fa4\uff0c\u60f3\u8981\u9ad8\u6027\u80fd\uff0c\u5c31\u4e0d\u8981\u96c6\u7fa4</p> <p>\u6ce8\u518c\u4e2d\u5fc3\u53ef\u4ee5\u4ee5\u670d\u52a1\u5316\u5206\uff0c\u540c\u4e00\u7c7b\u670d\u52a1\u6ce8\u518c\u5230\u4e00\u4e2a\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3 <pre><code>\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u7b97\u6cd5\u2014Paxos\n- raft\n- zab \n</code></pre></p> <p>SpringCloud Alibaba</p> \u4ea7\u54c11 \u4ea7\u54c12 \u4f18\u7f3a\u70b9 Sentinel Hystrix Hystrix\u57fa\u4e8e\u7ebf\u7a0b\u6c60\u505a\u8d44\u6e90\u9694\u79bb\uff0cSentinel\u4e3b\u8981\u652f\u6301\u4ee5QPS\u4e3a\u5355\u4f4d\u7684\u9650\u6d41 Nacos SpringCloudConfig\u3001Eureka RocketMQ Kafaka \u4e0d\u9700\u8981\u5199\u4ee3\u7801\uff0c\u652f\u6301\u987a\u5e8f\u6d88\u606f\uff0c\u4e8b\u52a1\u6d88\u606f\uff0cDashboard Dubbo Open feign springCloud \u57fa\u4e8ehttp\uff0cDubbo\u57fa\u4e8edubbo\uff0c\u4e0d\u80fd\u76f4\u63a5\u66ff\u6362 Seata Saga \u5206\u5e03\u5f0f\u4e8b\u52a1"},{"location":"Java/2021-03-08/#sentinel","title":"Sentinel","text":"<p>\u6ed1\u52a8\u4e8b\u4ef6\u7a97\u53e3 \u5b9e\u73b0\u601d\u8def\uff1a\u4e00\u5171\u6709120\u4e2a\u5bb9\u5668\uff0c\u5199\u5165\u6bcf500ms\u7684\u8bf7\u6c42\u91cf\uff0c\u7136\u540e\u8ba1\u7b97\u6bcf\u4e24\u4e2a\u5bb9\u5668\u4e2d\u8bf7\u6c42\u6570\u91cf\u7684\u548c\u3002</p> <p>\u4e00\u4e2a\u670d\u52a1\u597d\u597d\u7684\uff0c\u7a81\u7136\u53d8\u5f97\u54cd\u5e94\u5ef6\u8fdf\uff0c\u6709\u54ea\u4e9b\u539f\u56e0\uff1f</p> <ol> <li>\u7f51\u7edc\u963b\u585e</li> <li>CPU\u8ba1\u7b97\u80fd\u529b\u4e0d\u8db3</li> <li>\u9891\u7e41GC\uff08\u5bf9\u8c61\u751f\u547d\u5468\u671f\u95ee\u9898\uff09</li> </ol> <p>QPS - RT(\u76f8\u5e94\u5ef6\u8fdf)</p> <p>\u4e00\u79d2\u4e4b\u5185\u63a5\u53d7\u8bf7\u6c42\u7684\u6570\u91cf\u3002</p>"},{"location":"Java/2021-03-08/#_8","title":"\u6d88\u606f\u4e2d\u95f4\u4ef6","text":"\u540d\u79f0 \u9002\u5408\u7684\u573a\u666f \u7279\u70b9 Kafka Apache ActiveMQ gRPC RabbitMQ"},{"location":"Java/2021-03-08/#kafka","title":"Kafka","text":"<ul> <li> <p>Consumer Group (GP): \u7531\u591a\u4e2a\u6d88\u8d39\u8005\u6784\u6210\uff0c\u6d88\u8d39\u8005\u7ec4\u5185\u6bcf\u4e2a\u6d88\u8d39\u8005\u8d1f\u8d23\u6d88\u8d39\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\uff0c\u4e00\u4e2a\u5206\u533a\u53ea\u80fd\u7531\u4e00\u4e2a\u7ec4\u5185\u6d88\u8d39\u8005\u6d88\u8d39: \u6d88\u8d39\u8005\u7ec4\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\u3002\u6240\u6709\u7684\u6d88\u8d39\u8005\u90fd\u5c5e\u4e8e\u67d0\u4e2a\u6d88\u8d39\u8005\u7ec4\uff0c\u5373\u6d88\u8d39\u8005\u7ec4\u662f\u903b\u8f91\u4e0a\u7684\u4e00\u4e2a\u8ba2\u9605\u8005</p> </li> <li> <p>Broker: \u4e00\u53f0kafka\u670d\u52a1\u5668\u5c31\u662f\u4e00\u4e2abroker\uff0c\u4e00\u4e2abroker\u53ef\u4ee5\u5bb9\u7eb3\u591a\u4e2atopic</p> </li> <li> <p>Topic: \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u961f\u5217\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u90fd\u662f\u9762\u5411Topic</p> </li> <li> <p>Partition: \u4e3a\u4e86\u63d0\u9ad8\u9ad8\u5e76\u53d1\u6027\u80fd\uff0c \u4e00\u4e2a\u975e\u5e38\u5927\u7684topic\u53ef\u4ee5\u5206\u5e03\u5230\u591a\u4e2abroker\u670d\u52a1\u5668\u4e0a\uff0c\u4e00\u4e2atopic\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2apartition\uff0c\u6bcf\u4e2apartition\u90fd\u662f\u4e00\u4e2a\u6709\u5e8f\u961f\u5217</p> </li> <li> <p>Replica: \u526f\u672c\uff0c\u4e3a\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2a\u8282\u70b9\u53d1\u751f\u6545\u969c\u65f6\uff0c\u8be5\u8282\u70b9\u4e0a\u7684partition\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4e14kafka\u4ecd\u7136\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4e00\u4e2atopic\u7684\u6bcf\u4e2a\u5206\u533a\u90fd\u6709\u82e5\u5e72\u4e2a\u526f\u672c\uff0c\u4e00\u4e2aleader\u548c\u82e5\u5e72\u4e2afollower</p> </li> <li> <p>Leader: \u6bcf\u4e2a\u5206\u533a\u591a\u4e2a\u526f\u672c\u7684\u4e3b\u8282\u70b9\uff0c\u751f\u4ea7\u8005\u4e0e\u6d88\u8d39\u8005\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u90fd\u662f\u5728leader\u4e0a\u8fdb\u884c\u7684</p> </li> <li> <p>Follower: leader \u53d1\u751f\u6545\u969c\u65f6\uff0c\u6709\u53ef\u80fd\u6210\u4e3a\u65b0\u7684leader</p> </li> </ul>"},{"location":"Java/2021-03-08/#nio","title":"NIO","text":"<pre><code># $$\u4ee3\u8868\u5f53\u524d\u8fdb\u7a0bID\u53f7\uff0cfd\u4ee3\u8868\u6587\u4ef6\u63cf\u8ff0\u7b26\ncd /proc/$$/fd\npwd\nexec 8&lt;&gt; /dev/tcp/www.baidu.com/80\n# /\u4ee3\u8868\u8bf7\u6c42\u7684\u6839\u76ee\u5f55\uff0c \u91cd\u5b9a\u5411\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u5fc5\u987b\u52a0&amp;\necho -e \"GET / HTTP/1.0\\n\" &gt;&amp; 8\n#\u6807\u51c6\u8f93\u51650\u7684\u5185\u5bb9\u6765\u81ea 8\u53f7\u6587\u4ef6\u63cf\u8ff0\u7b26\ncat 0&lt;&amp; 8\n\n#\u5173\u6389\u6587\u4ef6\u63cf\u8ff0\u7b26\nexec 8&lt;&amp; -\n</code></pre> <p>tcpdump \u4f7f\u7528\u6293\u5305\u5de5\u5177\u770b\u6d41\u91cf\u5230\u5e95\u8d70\u7684\u662f\u90a3\u4e2a\u7f51\u5361</p> <pre><code>tcpdump -nn -i eth0 port 80\n\n\nnetstat -natp\n\n#\u67e5\u770b\u8def\u7531\u8868\nroute -n \n\n#\u67e5\u770b\u94fe\u8def\u8868\narp -an\n\narp -a \n\n\n\n#1. \u6253\u5f00\u76d1\u542c\ntcpdump -nn -i eth0 arp or port 80\n\n#2. \u67e5\u770barp\u548ctcp\u63e1\u624b\u7684\u8fc7\u7a0b\narp -d &lt;ip&gt; &amp;&amp; curl www.baidu.com\n</code></pre>"},{"location":"Java/2021-03-08/#netty","title":"Netty","text":"<ul> <li>\u95ee\u98981\uff1a \u804a\u804aselect()\u51fd\u6570</li> </ul> <p>\u7b54\u6848\uff1aselect \u51fd\u6570\u5728\u76d1\u542csocket\u6570\u91cf\u7684\u65f6\u5019\u6709\u9650\u5236\uff0c\u9ed8\u8ba4\u6700\u5927\u6570\u662f1024\uff0c\u56e0\u4e3a\u5176\u5185\u90e8\u662f\u901a\u8fc7\u4e00\u4e2afd_set, bitmap\u6765\u5b58\u653esocket\u7684fd\u5f15\u7528\u7684\u3002bitmap\u7684\u957f\u5ea6\u9ed8\u8ba4\u503c\u5c31\u662f1024\u3002\u76d1\u542c\u5230\u6709\u5c31\u7eea\u7684socket fd\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u505a\u4e2a\u6807\u8bb0\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u6709\u591a\u5c11\u4e2asocket fd\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u3002\u7136\u540e\u518d\u505a\u4e00\u4e2aSystem call,\u53bb\u68c0\u67e5fd_set\u96c6\u5408\u4e2d\u6bcf\u4e00\u4e2asocket\u7684\u72b6\u6001\u3002\u6bcf\u6b21\u7cfb\u7edf\u8c03\u7528\u90fd\u8981\u6d89\u53ca\u5185\u6838\u6001\u4e0e\u7528\u6237\u6001\u7684\u5207\u6362\uff0c\u5e76\u4e14\u6d89\u53ca\u5230\u53c2\u6570\u7684copy\uff0c\u5982\u679c\u6570\u91cf\u6bd4\u8f83\u5927\uff0c\u90a3\u4e48\u5c31\u4f1a\u5f71\u54cd\u6027\u80fd\u3002socket\u91cc\u9762\u6709\u4e09\u5757\u533a\u57df\uff0c\u8bfb\u7f13\u5b58\uff0c\u5199\u7f13\u5b58\uff0c\u8fd8\u6709\u7b49\u5f85\u961f\u5217\u3002</p> <ul> <li>\u95ee\u98982\uff1a \u804a\u804apoll()\u51fd\u6570</li> </ul> <p>\u7b54\u6848\uff1apoll\u89e3\u51b3\u4e0aselect\u4f20\u53c2\u7684\u95ee\u9898\uff0cpoll\u4f7f\u7528\u6570\u7ec4\uff0c\u6ca1\u67091024\u7684\u9650\u5236\u3002</p> <ul> <li>\u95ee\u98983\uff1a \u804a\u804aepoll()\u51fd\u6570</li> </ul> <p>\u7b54\u6848\uff1aselect\u548cpoll\u51fd\u6570\u90fd\u9700\u8981\u7528\u6237\u4f20\u9012\u7ed9\u5176\u9700\u8981\u76d1\u542c\u7684socket fd\u5217\u8868\uff0c\u5e76\u4e14\u662f\u6709\u4e00\u4e2a\u7ebf\u7a0b\u4e00\u76f4\u7684\u518d\u76d1\u542csocket fd\u7684\u72b6\u6001\uff0c\u6bd4\u8f83\u6d88\u8017CPU\u6027\u80fd\u3002\u5728\u5b9e\u9645\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u76d1\u542c\u7684socket\u96c6\u5408\uff0c\u6570\u636e\u53d8\u5316\u5e76\u4e0d\u5927\uff0c\u4f46\u662f\u5728\u8c03\u7528\u7684\u65f6\u5019\u9700\u8981\u628a\u6574\u4e2a\u9700\u8981\u76d1\u542c\u7684socket fd\u5217\u8868\u56de\u4f20\uff0c\u6570\u636e\u65e0\u610f\u4e49copy\u5f00\u9500\u5927\uff0c\u5e76\u4e14\u8fd9\u4e24\u4e2a\u51fd\u6570\u8fd4\u56de\u503c\u90fd\u662fint\uff0c\u53ea\u80fd\u4ee3\u8868\u6709\u51e0\u4e2asocket\u5c31\u7eea\u6216\u8005\u53d1\u751f\u4e86\u9519\u8bef\uff0c \u5e76\u4e0d\u8fd4\u56de\u5177\u4f53\u5c31\u7eea\u7684socket fd\u5217\u8868\uff0c\u8fd9\u6837\u5c31\u5bfc\u81f4\u7a0b\u5e8f\u8fd8\u9700\u8981\u65b0\u4e00\u8f6e\u7684system call\u53bb\u68c0\u67e5\u5177\u4f53\u5c31\u7eea\u7684socket fd\u3002</p> <p>epoll\u7684\u65b9\u6848\uff0c\u5728\u5185\u6838\u7a7a\u95f4\u521b\u5efaeventpoll\u5bf9\u8c61\uff0c\u901a\u8fc7epoll_create\uff08\uff09\u521b\u5efa\u8fd4\u56deepfd\uff0cepoll_ctl()\u53bb\u7ba1\u7406. EventPoll\u4e3b\u8981\u5305\u542b\u4e24\u5757\u533a\u57df\uff0c\u4e00\u5757\u662f\u9700\u8981\u76d1\u542c\u7684socketfd\uff0c\u53e6\u5916\u4e00\u5757\u662f\uff1a\u5c31\u7eea\u5217\u8868, \u91c7\u7528\u7ea2\u9ed1\u6811\u7684\u7ed3\u6784\u5b58\u50a8\uff0cO(logN)\u3002epoll_wait(epfdid), </p>"},{"location":"Java/2021-03-08/#mybatis","title":"Mybatis","text":"<pre><code>SqlSession -&gt; Executor -&gt; BaseExecutor -&gt; (SimpleExecutor ReuseExecutor BatchExecutor)\n</code></pre> <ul> <li> <p>\u4e00\u7ea7\u7f13\u5b58(Session\u7ea7\u522b)\u547d\u4e2d\u7684\u6761\u4ef6\uff1a</p> </li> <li> <p>\u540c\u4e00\u4e2asession</p> </li> <li>\u5fc5\u987b\u662f\u76f8\u540c\u7684statementId</li> <li>sql\u548c\u53c2\u6570\u5fc5\u987b\u4e00\u6837</li> <li>RowBounds\u76f8\u540c</li> <li>\u672a\u624b\u52a8\u6e05\u7a7a\u7f13\u5b58</li> <li>\u672a\u914d\u7f6eflushCache=true</li> <li>\u672a\u6267\u884cupdate\u8bed\u53e5</li> <li>\u7f13\u5b58\u4f5c\u7528\u57df\u4e0d\u662fSTATEMENT</li> <li>call sqlsession.commit()/rollback()</li> </ul> <p> </p>"},{"location":"Java/2021-03-08/#_9","title":"\u89c4\u5212\u5b66\u4e60","text":"<p>jdk-juc \u6e90\u7801\uff0cSpringIOC+AOP\u6e90\u7801\uff0cJvm\u7406\u8bba\u77e5\u8bc6\uff0cjmm\u7406\u8bba\u77e5\u8bc6  </p>"},{"location":"Java/2021-03-08/#questions","title":"Questions","text":"<p>Redis\u4e3a\u4ec0\u4e48\u5feb\uff1f</p> <p>\u7b54\u6848\uff1a 1. Redis\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6570\u636e\u90fd\u662f\u653e\u5728\u5185\u5b58 2. \u5355\u7ebf\u7a0b\u591a\u8fdb\u7a0b\u7684\u8bbe\u8ba1\uff0c\u51cf\u5c11\u4e0a\u4e0b\u6587\u4e4b\u95f4\u7684\u5207\u6362\uff0c\u907f\u514d\u4e0a\u9501\u89e3\u9501\u7684\u95ee\u9898\u30023.\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u6280\u672f\uff0c\u975e\u963b\u585eIO\u4f7f\u7528epoll\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u52a0\u4e0a\u81ea\u5df1\u5b9a\u4e49\u7684\u65f6\u95f4\u6846\u67b6\uff0c\u8bfb\uff0c\u5199\uff0c\u5173\u95ed\uff0c\u8fde\u63a5\u90fd\u8f6c\u5316\u6210\u4e8b\u4ef6\uff0c\u5927\u5927\u63d0\u9ad8IO\u6548\u7387\u3002</p> <p>Mysql\u6570\u636e\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff0c\u804a\u804aB\u548cB+\u6811\uff1f</p> <p>\u7b54\u6848\uff1a</p> <p>Mysql \u4f7f\u7528\u7f13\u5b58\u4e86\u4e48\uff1fMySQL\u7684\u7f13\u5b58\u89e3\u51b3\u65b9\u6848\uff1f</p> <p>\u7b54\u6848\uff1a</p> <p>ConrrentHashmap \u90fd\u9700\u8981\u52a0\u9501\u4e48\uff1f\u5982\u679c\u9700\u8981\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u7b54\u6848\uff1a\u8bfb\u4e0d\u52a0\u9501\u3002</p> <p>\u4e00\u4e2a2G\u7684\u6587\u4ef6\uff0cJVM\u7684size\u662f5M\uff0c\u600e\u4e48\u627e\u5230top 100\u7684\u5355\u8bcd\uff1f</p> <p>\u8bbe\u8ba1\u4e00\u4e2a\u670d\u52a1\u94fe\u8def\u8ffd\u8e2a\u7684\u7cfb\u7edf\uff0c\u8981\u8003\u8651\u90a3\u4e9b\uff1f</p> <p>\u7b54\u6848\uff1a \u53ea\u9700\u8981\u8bb0\u4f4f\u5f53\u524d\u8282\u70b9\u7684\u7236\u8282\u70b9</p>"},{"location":"Java/2021-03-08/#rmi","title":"RMI","text":"<pre><code>#server\nRmiServiceExporter\n#Client\nRmiProxyFactoryBean\n</code></pre>"},{"location":"Java/2022-05-13/","title":"Http vs Https","text":""},{"location":"Java/2022-05-13/#http-protocol","title":"Http protocol","text":"Type Desc URG: Urgent Pointer field significant ACK: Acknowledgment field significant PSH: Push Function RST: Reset the connection SYN: Synchronize sequence numbers FIN: No more data from sender"},{"location":"Java/2022-05-13/#requires-three-packets-to-be-transmitted-when-starting-a-tcp-connection","title":"Requires three packets to be transmitted when starting a TCP connection","text":""},{"location":"Java/2022-05-13/#requires-four-packets-to-be-transmitted-when-ending-a-tcp-connection","title":"Requires four packets to be transmitted when ending a TCP connection","text":""},{"location":"Java/2022-05-13/#https-protocol","title":"Https protocol","text":"<p>TLS \u63e1\u624b\u662f\u7531\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4ea4\u6362\u7684\u4e00\u7cfb\u5217\u6570\u636e\u62a5\u6216\u6d88\u606f\u3002TLS \u63e1\u624b\u6d89\u53ca\u591a\u4e2a\u6b65\u9aa4\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8981\u4ea4\u6362\u5b8c\u6210\u63e1\u624b\u548c\u8fdb\u884c\u8fdb\u4e00\u6b65\u5bf9\u8bdd\u6240\u9700\u7684\u4fe1\u606f\u3002</p> <p>TLS \u63e1\u624b\u7684\u786e\u5207\u6b65\u9aa4\u5c06\u6839\u636e\u6240\u4f7f\u7528\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u7684\u7c7b\u578b\u4ee5\u53ca\u53cc\u65b9\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\u800c\u6709\u6240\u4e0d\u540c\u3002RSA \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u6700\u4e3a\u5e38\u7528\u3002\u5177\u4f53\u5982\u4e0b\uff1a</p> <ol> <li>\u201c\u5ba2\u6237\u7aef\u95ee\u5019\uff08client hello\uff09\u201d \u6d88\u606f\uff1a \u5ba2\u6237\u7aef\u901a\u8fc7\u5411\u670d\u52a1\u5668\u53d1\u9001\u201c\u95ee\u5019\u201d\u6d88\u606f\u6765\u5f00\u59cb\u63e1\u624b\u3002\u8be5\u6d88\u606f\u5c06\u5305\u542b\u5ba2\u6237\u7aef\u652f\u6301\u7684 TLS \u7248\u672c\uff0c\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u4ee5\u53ca\u79f0\u4e3a\u4e00\u4e32\u79f0\u4e3a\u201c\u5ba2\u6237\u7aef\u968f\u673a\u6570\uff08client random\uff09\u201d\u7684\u968f\u673a\u5b57\u8282\u3002</li> <li>\u201c\u670d\u52a1\u5668\u95ee\u5019\uff08server hello\uff09\u201d\u6d88\u606f\uff1a \u4f5c\u4e3a\u5bf9 client hello \u6d88\u606f\u7684\u56de\u590d\uff0c\u670d\u52a1\u5668\u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u5185\u542b\u670d\u52a1\u5668\u7684 SSL \u8bc1\u4e66\u3001\u670d\u52a1\u5668\u9009\u62e9\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u4ee5\u53ca\u201c\u670d\u52a1\u5668\u968f\u673a\u6570\uff08server random\uff09\u201d\uff0c\u5373\u7531\u670d\u52a1\u5668\u751f\u6210\u7684\u53e6\u4e00\u4e32\u968f\u673a\u5b57\u8282\u3002</li> <li>\u8eab\u4efd\u9a8c\u8bc1\uff1a \u5ba2\u6237\u7aef\u4f7f\u7528\u9881\u53d1\u8be5\u8bc1\u4e66\u7684\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u9a8c\u8bc1\u670d\u52a1\u5668\u7684 SSL \u8bc1\u4e66\u3002\u6b64\u4e3e\u786e\u8ba4\u670d\u52a1\u5668\u662f\u5176\u58f0\u79f0\u7684\u8eab\u4efd\uff0c\u4e14\u5ba2\u6237\u7aef\u6b63\u5728\u4e0e\u8be5\u57df\u7684\u5b9e\u9645\u6240\u6709\u8005\u8fdb\u884c\u4ea4\u4e92\u3002</li> <li>\u9884\u4e3b\u5bc6\u94a5\uff1a \u5ba2\u6237\u7aef\u518d\u53d1\u9001\u4e00\u4e32\u968f\u673a\u5b57\u8282\uff0c\u5373\u201c\u9884\u4e3b\u5bc6\u94a5\uff08premaster secret\uff09\u201d\u3002\u9884\u4e3b\u5bc6\u94a5\u662f\u4f7f\u7528\u516c\u94a5\u52a0\u5bc6\u7684\uff0c\u53ea\u80fd\u4f7f\u7528\u670d\u52a1\u5668\u7684\u79c1\u94a5\u89e3\u5bc6\u3002\uff08\u5ba2\u6237\u7aef\u4ece\u670d\u52a1\u5668\u7684 SSL \u8bc1\u4e66\u4e2d\u83b7\u5f97\u516c\u94a5\u3002\uff09</li> <li>\u79c1\u94a5\u88ab\u4f7f\u7528\uff1a \u670d\u52a1\u5668\u5bf9\u9884\u4e3b\u5bc6\u94a5\u8fdb\u884c\u89e3\u5bc6\u3002</li> <li>\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\uff1a \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5747\u4f7f\u7528\u5ba2\u6237\u7aef\u968f\u673a\u6570\u3001\u670d\u52a1\u5668\u968f\u673a\u6570\u548c\u9884\u4e3b\u5bc6\u94a5\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\u3002\u53cc\u65b9\u5e94\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u679c\u3002</li> <li>\u5ba2\u6237\u7aef\u5c31\u7eea\uff1a \u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u6761\u201c\u5df2\u5b8c\u6210\u201d\u6d88\u606f\uff0c\u8be5\u6d88\u606f\u7528\u4f1a\u8bdd\u5bc6\u94a5\u52a0\u5bc6\u3002</li> <li>\u670d\u52a1\u5668\u5c31\u7eea\uff1a \u670d\u52a1\u5668\u53d1\u9001\u4e00\u6761\u201c\u5df2\u5b8c\u6210\u201d\u6d88\u606f\uff0c\u8be5\u6d88\u606f\u7528\u4f1a\u8bdd\u5bc6\u94a5\u52a0\u5bc6\u3002</li> <li>\u5b9e\u73b0\u5b89\u5168\u5bf9\u79f0\u52a0\u5bc6\uff1a \u5df2\u5b8c\u6210\u63e1\u624b\uff0c\u5e76\u4f7f\u7528\u4f1a\u8bdd\u5bc6\u94a5\u7ee7\u7eed\u8fdb\u884c\u901a\u4fe1\u3002</li> </ol> <p></p>"},{"location":"Java/2022-05-13/#references","title":"references","text":"<ul> <li>https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/three-way-handshake-via-tcpip</li> <li>https://howhttps.works/the-handshake/</li> <li>https://www.cloudflare.com/zh-cn/learning/ssl/what-happens-in-a-tls-handshake/</li> </ul>"},{"location":"Java/2024-11-26/","title":"Spring Security v6.3","text":""},{"location":"Java/2024-11-26/#custom-csrf-protection","title":"Custom CSRF protection","text":"<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n                http.csrf(csrf-&gt; \n                csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n                        .ignoringRequestMatchers(\"/public/*\")\n        );\n        return http.build();\n    }\n\n}\n\n@RestController\npublic class CsrfController {\n    @GetMapping(\"/api/csrf-token\")\n    public CsrfToken csrfToken(HttpServletRequest request) {\n        return (CsrfToken)request.getAttribute(CsrfToken.class.getName());\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#url-based-restrictions-prefer","title":"URL Based Restrictions (Prefer)","text":"<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http.authorizeHttpReuqests(auth-&gt; auth\n        .requestMatcher(\"/api/auth/**\").permitAll()\n        .requestMatcher(\"/admin/**\").hasRole(\"ADMIN\")\n        .requestMatcher(\"/images/**\").permitAll()\n        .anyRequest().authenticated())\n        .httpBasic();\n        return http.build();\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#method-level-security","title":"Method-Level Security","text":"<pre><code>@PreAuthorize('hasRole('ADMIN') or hasRole('User')') // Checks the given expression before entering the method\npublic void deleteDocument(Long documentId) {}\n\n@Secured // Simpler alternative to @PreAuthorize, used to specify roles directly\n\n@RolesAllowed({\"ROLE_USER\", \"ROLE_ADMIN\"}) // Specifies roles allowed to invoke the method\npublic void processOrder(Order order) {}\n\n@PostAuthorize(\"returnObject.owner == authentication.name\") // Checks the given expression after the method has been invoked\npublic Order getOrder(Long orderId) {}\n\n@PreFilter and @PostFilter // The annotations filter collections or arrays passed as method arguments or returned by the method\n@PreFilter(\"filterObject.owner == authentication.name\") // Checks the given expression after the method has been invoked\npublic Order getOrder(Long orderId) {}\n\n@Configuration\n@EnableWebSecurity\n@EnableMethodSecurity(prePostEnabled=true, securedEnabled=true, jsr250Enabled=true)\npublic class SecurityConfig {}\n</code></pre>"},{"location":"Java/2024-11-26/#core-classes-interfaces-for-user-management","title":"Core Classes &amp; Interfaces for User Management","text":"<pre><code>UserDetails user = User.withUsername(\"user\")\n        .password(\"{noop}password\")\n        .authorities(\"ROLE_READ\")\n        .build()\n</code></pre> <pre><code>public class JdbcUserDetailsManager extends JdbcDaoImpl implements UserDetailsManager, GroupManager {}\n\npublic interface UserDetailsManager extends UserDetailsService {\n    void createUser(UserDetails user);\n\n    void updateUser(UserDetails user);\n\n    void deleteUser(String username);\n\n    void changePassword(String oldPassword, String newPassword);\n\n    boolean userExists(String username);\n}\n\npublic interface UserDetailsService {\n    UserDetails loadUserByUsername(String username) throws UsernameNotFoundException;\n}\n\npublic interface UserDetails extends Serializable {\n    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();\n\n    String getPassword();\n\n    String getUsername();\n\n    default boolean isAccountNonExpired() {\n        return true;\n    }\n\n    default boolean isAccountNonLocked() {\n        return true;\n    }\n\n    default boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    default boolean isEnabled() {\n        return true;\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#authentication-providers","title":"Authentication Providers","text":"<p>which are components handle the actual verification of credentials provided by a user during the login process.</p> <ul> <li>Authenticate the user</li> <li>Create Authentication Token</li> </ul> <pre><code>DaoAuthenticationProvider\nInMemoryAuthenticationProvider\nLdapAuthenticationProvider\nActiveDirectoryLdapAuthenticationProvider\nPreAuthenticatedAuthenticationProvider #SSO\nOAuth2AuthenticationProvider\n</code></pre>"},{"location":"Java/2024-11-26/#key-filters","title":"Key Filters","text":"<ul> <li>SecurityContextPersistenceFilter  Manages the SecurityContext for each request.</li> <li>WebAsyncManagerIntegrationFilter  Integrates the SecurityContext with Spring's WebAsyncManager for asynchronous web requests.</li> <li> <p>HeaderWriterFilter Adds security-related HTTP headers to the response, such as X-Content-Type-Options, X-Frame-Options, and X-XSS-Protection.</p> </li> <li> <p>CorsFilter Handles Cross-Origin Resources Sharing(CORS) by allowing or denying requests from different origins based on configured policies</p> </li> <li> <p>CsrfFilter Enforces Cross-Site Request Forgery(CSRF) protection by generating and validation CSRF tokens for each request.</p> </li> <li>LogoutFilter</li> <li>UsernamePasswordAuthenticationFilter</li> <li>DefaultLoginPageGeneratingFilter</li> <li> <p>DefaultLogoutPageGeneratingFilter</p> </li> <li> <p>BasicAuthenticationFilter Handles HTTP Basic authentication by extracting credentials from the Authorization header and passing them to the Authentication manager.</p> </li> <li> <p>RequestCacheAwareFilter Ensure that the original requested URL is cached during authentication, so that the user can be redirected to it after successful authentication.</p> </li> <li> <p>SecurityContextHolderAwareRequestFilter Wraps the request to provide security-related methods that interact with the SecurityContext.</p> </li> <li>AnonymousAuthenticationFilter This is useful to apply security contraints even to unauthenticated users.</li> <li> <p>ExceptionTranslationFilter Translates authentication and access-related exceptions into appropriate HTTP responses, such as redirecting to the login page or sending a 403 Forbidden status.</p> </li> <li> <p>FilterSecurityInterceptor Enforces security policies(authorization checks) on secured HTTP requests. It makes final access control decisions based on the configured security metadata and the current Authentication.</p> </li> </ul>"},{"location":"Java/2024-11-26/#springboot-custom-authentication-provider-to-verify-bearer-token","title":"Springboot custom authentication provider to verify bearer token","text":""},{"location":"Java/2024-11-26/#environment","title":"Environment","text":"<ul> <li>Springboot\uff1a3.3.1 </li> <li>SpringSecurity: 6.3.1</li> <li>JDK 17+</li> </ul>"},{"location":"Java/2024-11-26/#1-custom-a-authentication-token","title":"1. Custom a authentication token","text":"<pre><code>public class CustomBearerToken extends AbstractAuthenticationToken {\n    private String principal;\n\n    // this is an authenticated token\n    public CustomBearerToken(String principal, Collection&lt;? extends GrantedAuthority&gt; authorities) {\n        super(authorities);\n        this.principal = principal;\n        setAuthenticated(true);\n    }\n    // this is not an authenticated token\n    public CustomBearerToken(String principal) {\n        super(null);\n        this.principal = principal;\n        setAuthenticated(false);\n    }\n\n    @Override\n    public Object getCredentials() {\n        return null;\n    }\n\n    @Override\n    public Object getPrincipal() {\n        return this.principal;\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#2-custom-an-authentication-provider-it-will-be-used-to-verify-a-authentication","title":"2. Custom an authentication provider, it will be used to verify a authentication","text":"<pre><code>@Component\npublic class CustomAuthenticationProvider implements AuthenticationProvider {\n    @Override\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n        //custom logic to verify this authentication\n        if (authentication != null) {\n            String principal = authentication.getPrincipal().toString();\n            if (\"admin\".equals(principal)) {\n                List&lt;SimpleGrantedAuthority&gt; roles = List.of();\n                // return a valid token\n                return new CustomBearerToken(\"admin\", roles);\n            } else {\n                return authentication;\n            }\n        }\n        return null;\n    }\n\n\n    // which type of authentication will be verified\n    @Override\n    public boolean supports(Class&lt;?&gt; authentication) {\n        return authentication.equals(CustomBearerToken.class);\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#3-create-a-new-filter-on-intercept-all-the-requests","title":"3. Create a new filter on intercept all the requests","text":"<pre><code>public class CustomWebFilter extends OncePerRequestFilter {\n    private final AuthenticationManager authenticationManager;\n\n    public CustomWebFilter(AuthenticationManager authenticationManager) {\n        this.authenticationManager = authenticationManager;\n    }\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {\n        String token = request.getHeader(\"Authentication\");\n        if (token != null) {\n            String encodedToken = new String(Base64.getUrlDecoder().decode(token.getBytes(StandardCharsets.UTF_8)));\n            Authentication authentication = new CustomBearerToken(encodedToken.split(\":\")[0]);\n            Authentication verifiedAuth = this.authenticationManager.authenticate(authentication);\n            //put the verifiedAuth by custom authentication provider into security context\n            SecurityContextHolder.getContext().setAuthentication(verifiedAuth);\n        }\n        filterChain.doFilter(request, response);\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#4-custom-web-security-config","title":"4. Custom web security config","text":"<pre><code>@Configuration\n@EnableWebSecurity\npublic class WebSecurityConfig {\n    @Autowired\n    private CustomAuthenticationProvider customAuthenticationProvider;\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http.csrf(AbstractHttpConfigurer::disable)\n                .authorizeHttpRequests((requests) -&gt; requests\n                        .requestMatchers(\"/public/*\").permitAll()\n                        .anyRequest().authenticated()\n                ).addFilterBefore(new CustomWebFilter(authManager()), LogoutFilter.class);\n        return http.build();\n    }\n    //This is important to create a AuthenticationManager to apply custom authentication provider\n    @Bean\n    public AuthenticationManager authManager() {\n        return new ProviderManager(customAuthenticationProvider);\n    }\n}\n</code></pre>"},{"location":"Java/2024-11-26/#5-verify","title":"5. Verify","text":"<pre><code># Access a public api\ncurl -i http://localhost:8080/public/stocks\nHTTP/1.1 200\n\n# Use a not admin user will hit 403 permission error\ncurl -i --header \"Authentication: dXNlcjp1c2Vy\" http://localhost:8080/private/stocks\nHTTP/1.1 403\n\n# Use an admin user will pass the authentication\n$ curl -i --header \"Authentication: YWRtaW46YWRtaW4=\" http://localhost:8080/private/stocks\nHTTP/1.1 200\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/","title":"Javascript handbook","text":""},{"location":"JavaScript/2018-01-21-jquery-javascript/#bootstrap","title":"Bootstrap","text":"<pre><code>//\u7981\u6b62bootstrap carousel \u81ea\u52a8\u64ad\u653e\n\n$('.carousel').carousel({\n  interval: false\n})\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#jquery-ui-autocomplete","title":"Jquery UI Autocomplete","text":"<pre><code>// \u5728bootstrap modal \u4e0a\u4e0d\u663e\u793a autocomplete dropdown\u7684\u5185\u5bb9\n\n$( \"#company\" ).autocomplete({       \n    source : availableTags ,\n    appendTo: \"#exportOrder\"  //\u8fd9\u91cc\u9700\u8981\u6307\u5b9amodal\u5143\u7d20\n});\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#jquery-ui-custom-tooltip","title":"Jquery UI Custom tooltip","text":"<pre><code>var buildCustomTooltip = function() {\n  $(\"i.statistic-tooltip\").each(function() {\n    $(this).tooltip({\n      items: $(this),\n      tooltipClass: \"statistic-tooltip\",\n      position: {\n        my: \"left bottom\",\n        at: \"right top\"\n      },\n      content: function() {\n        var total = $(this).attr(\"total\");\n        return \"&lt;ul class=\\\"list-group\\\"&gt;\" +\n                  \"&lt;li class=\\\"list-group-item\\\"&gt;&lt;span class=\\\"badge\\\"&gt;\" + total + \"&lt;/span&gt; Total of Executions: &lt;/li&gt;\" +\n                \"&lt;/ul&gt;\";\n      }\n    });\n  });\n  $(\"i.statistic-tooltip\").hover(function(){\n    $(this).tooltip('open');\n  }, function(){\n    $(this).tooltip('close');\n  });\n}\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#dropzone","title":"Dropzone","text":"<pre><code>$(\"#id\").dropzone({\n    autoProcessQueue: false, //\u8bbe\u7f6e\u662f\u5426\u6587\u4ef6\u62d6\u62fd\u4e0a\u53bb\u5c31\u6267\u884c\u4e0a\u4f20\n    maxFiles: 1, //\u8bbe\u7f6e\u4e00\u6b21\u4e0a\u4f20\u7684\u6700\u5927\u6587\u4ef6\u6570\n    ...\n\n    init: function() {\n      var uploadBtn = $(\"#uploadBtn\");\n      uploadBtn.on(\"click\", function() {\n          //\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\n          this.processQueue();\n      });\n\n      //\u5f53\u6587\u4ef6\u6570\u7b49\u4e8e\u8bbe\u7f6e\u7684maxFiles\u7684\u4e8b\u4ef6\n      //file \u6307\u7684\u662f\u5f53\u524d\u521a\u6dfb\u52a0\u7684\u6587\u4ef6\n      this.on(\"maxfilesexceeded\", function(file) {\n        if(this.files.length &gt; 1) {\n            //this.removeAllFiles();  //\u5220\u9664\u6240\u6709\u5df2\u4e0a\u4f20\u7684\u6587\u4ef6\n            //this.addFile(file);     //\u5220\u9664\u5f53\u524d\u6587\u4ef6\n            this.removeFile(file);    //\u6dfb\u52a0\u5f53\u524d\u6587\u4ef6\n        };\n      });\n      //\u6dfb\u52a0\u6587\u4ef6\u7684\u4e8b\u4ef6\n      this.on(\"addedfile\", function(file) {\n\n      });\n      //\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u7684\u4e8b\u4ef6\n      this.on(\"success\", function(file, resp) {\n\n      });\n\n\n    }\n});\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#jquery-unbind","title":"Jquery Unbind \u4e8b\u4ef6","text":"<pre><code>(\"#id\").unbind();\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#jquery-datatable","title":"Jquery DataTable","text":"<p>1.Multiple checkbox select</p> <pre><code>//Refresh sorting/filter information after dom change.\n//https://datatables.net/reference/api/cell().invalidate()\ntable.column(3).invalidate('dom').draw(false);\ntable.row(3).invalidate('dom').draw(false);\ntable.cell(3, 3).invalidate('dom').draw(false);\n\n//fetch selected rows number\ntable.rows('.selected').count();\n\ntable.row(3).data();\n\ntable.column(3).nodes();\n\n//fetch visible rows\ntable.rows({page: \"current\"});  \n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#codemirror","title":"CodeMirror \u83b7\u53d6\u5b9e\u4f8b","text":"<pre><code>//Get a reference to the CodeMirror editor\nvar editor = $('.CodeMirror')[0].CodeMirror;\n\n//You can then use it as you wish\neditor.setValue('lorem ipsum yada yada');\neditor.replaceSelection('this is a test');\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#checkbox-widget","title":"Checkbox widget","text":"<pre><code>//\u5224\u65ad\u662f\u5426\u9009\u4e2d\uff0c chrome \u9009\u4e2d\u8fd4\u56de\"checked\"\uff0c\u672a\u9009\u4e2d\u8fd4\u56deundefined\n$(\"#Checkbox2\").attr(\"checked\") \n//\u8bbe\u7f6eradio\u9009\u4e2d\n$(\"#Checkbox2\").attr(\"checked\", \"checked\")\n$(\"#Checkbox2\").prop(\"checked\", \"checked\");\n//\u89e6\u53d1onChanges\u4e8b\u4ef6\n$(\"#Checkbox2\").prop(\"checked\", \"checked\").change()\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#radio-widget","title":"Radio widget","text":"<pre><code>//\u8bbe\u7f6eradio\u9009\u4e2d\n$(\"#radio\").prop(\"checked\", \"checked\");\n//\u8bbe\u7f6eradio\u4e0d\u9009\u4e2d\n$(\"#radio\").prop(\"checked\", false);\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#select-widget","title":"Select widget","text":"<pre><code>//\u8bbe\u7f6eselect\u662fdisable \u4f46\u662f\u6b64\u72b6\u6001form\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u8be5\u5b57\u6bb5\u7684\u503c\u4e0d\u4f1a\u88ab\u63d0\u4ea4\n$(\"#select\").prop(\"disable\", false);\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#selec2-select","title":"Selec2 \u8bbe\u7f6eselect\u63a7\u4ef6\u53ea\u8bfb","text":"<pre><code>//version 4.x\n$(\"select#commandType\").prop(\"disabled\", true);\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#javascript","title":"Javascript\u5bf9\u8c61\u6216\u8005\u6570\u7ec4\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32","text":"<pre><code>//1. Javascript\u5bf9\u8c61\u6216\u8005\u6570\u7ec4\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\n\n/**\n* value: Javascript\u5bf9\u8c61\u6216\u8005\u6570\u7ec4\n* replacer[optional]: \u7528\u6765\u505a\u683c\u5f0f\u5316\u8f93\u51fa\n* space[optional]\uff1a\u503c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u8005\u6570\u5b57\uff0c\u7528\u6765\u66ff\u6362\u7a7a\u767d\u5b57\u7b26\n*/\nJSON.stringify(value[, replacer [, space]]);\ne.g:\nJSON.stringify(JSONObject, null , 2);\n\n//2. \u5b57\u7b26\u4e32\u8f6c\u5316\u4e3aJSON\u5bf9\u8c61\n\n/**\n* text: JSON\u5b57\u7b26\u4e32\n* reviver[optional]: \u53ef\u4ee5\u64cd\u4f5c\u8f6c\u5316\u7684\u7ed3\u679c\n*/\n\nJSON.parse(text[, reviver])\ne.g:\nJSON.parse('{\"p\": 5}', (key, value) =&gt;\n  typeof value === 'number'\n    ? value * 2 // return value * 2 for numbers\n    : value     // return everything else unchanged\n);\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#how-to-add-a-htmlevent-to-html-element","title":"How to add a HTMLEvent to Html element","text":"<pre><code>&lt;script type=\"text/javascript\"&gt;\n    var ele = document.getElementById(\"input_1\");\n    /**\n    *\u4e8b\u4ef6\u7c7b\u578b\n    *\u4e8b\u4ef6\u88ab\u89e6\u53d1\u540e\u6267\u884c\u7684\u56de\u8c03\u51fd\u6570\n    *useCapture https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener\n    **/\n    ele.addEventListener(\"input\", function(){console.log(this.value)}, false);\n    /**\n    *\u521b\u5efa\u4e00\u4e2aInputEvent https://developer.mozilla.org/en-US/docs/Web/Events\n    **/\n    var inputEvent = new InputEvent(\"input\");\n    //\u5206\u53d1\u4e8b\u4ef6 https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n    ele.dispatchEvent(inputEvent);\n\n\n    //\u89e6\u53d1built-in \u4e8b\u4ef6 https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events#Triggering_built-in_events\n&lt;/script&gt;\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#add-indicator-when-ajax-call","title":"Add indicator when ajax call","text":"<pre><code>$(document)\n      .ajaxStart(function () {\n        $loading.show();\n      })\n      .ajaxStop(function () {\n        $loading.hide();\n      });\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#html-iframe","title":"Html \u4e2d\u53d6\u5f97Iframe\u4e2d\u7684\u5143\u7d20","text":"<pre><code>var f = document.getElementById(\"#FrameId\");\nf.contentDocument.getElementById(\"#ElementId\").value;\n</code></pre>"},{"location":"JavaScript/2018-01-21-jquery-javascript/#entry","title":"\u963b\u6b62\u8868\u5355\u901a\u8fc7entry\u63d0\u4ea4","text":"<pre><code>$(document).on(\"keyup keypress\", \"form input\", function(e) {\n          if(e.which == 13) {\n            e.preventDefault();\n            return false;\n          }\n        });\n</code></pre>"},{"location":"JavaScript/2018-06-07-requirejs-javascript/","title":"Project Information","text":"<p>An quick start project with requirejs, bootstrap and codemirror.js</p>"},{"location":"JavaScript/2018-06-07-requirejs-javascript/#project-structure","title":"Project structure","text":"<ul> <li>www/<ul> <li>html<ul> <li>index.html</li> </ul> </li> <li>js/<ul> <li>lib/  <ul> <li>jquery.1.11.3.min.js  </li> <li>bootstrap.min.js  </li> <li>bootstrap.bundle.min.js  </li> <li>codemirror.js  </li> <li>javascript.js  </li> <li>scheme.js  </li> <li>require.js  </li> </ul> </li> <li> <p>app/  </p> <ul> <li>index.js</li> </ul> <p>require-common.js require-index.js     - css/         - bootstrap.min.css         - bootstrap-grid.min.css         - codemirror.css  </p> </li> </ul> </li> </ul> </li> </ul>"},{"location":"JavaScript/2018-06-07-requirejs-javascript/#requirejs-configuration","title":"Requirejs configuration","text":"<ul> <li>index.html  </li> </ul> <pre><code>&lt;script data-main=\"../js/require-index.js\" src=\"../js/lib/require.js\"&gt;&lt;/script&gt;\n</code></pre> <ul> <li>require-common.js  </li> </ul> <pre><code>require.config({\n    baseUrl: \"../js/lib\", //\u4eceindex.html\u9875\u9762\u5bfc\u822a\u5230js\u6587\u4ef6\u5939\n    \"paths\": {\n        \"jquery\": \"jquery.1.11.3.min\",\n        \"codemirror\": \"codemirror\",\n        \"javascript\": \"javascript\",\n        \"scheme\": \"scheme\"\n    },\n    \"shim\": {\n        \"jquery\": {\n            exports: \"jquery\"\n        },\n        \"codemirror\": {\n            exports: \"codemirror\"\n        },\n        \"javascript\": {\n            exports: \"javascript\"\n        },\n        \"scheme\": {\n            exports: \"scheme\"\n        }\n    }\n});\n</code></pre> <ul> <li>require-index.js  </li> </ul> <pre><code>require([\"./require-common\"], function(common) {\n    require([\"../js/app/index.js\"]); //\u4eceindex.html\u9875\u9762\u5f15\u7528index.js\u6587\u4ef6\u7684\u8def\u5f84\n})\n</code></pre> <ul> <li>index.js  </li> </ul> <pre><code>define([\"jquery\", \"codemirror\", \"javascript\", \"scheme\"], function($, CodeMirror, javascript, scheme) {\n    $(function() {\n\n        var ele = $(\"#tx1\")[0];\n        var editor = CodeMirror.fromTextArea(ele, {\n            mode: \"scheme\",\n            lineNumbers: true\n        });\n\n        var looksLikeScheme = function(code) {\n            return !/^\\s*\\(\\s*function\\b/.test(code) &amp;&amp; /^\\s*[;\\(]/.test(code);\n        };\n\n        var update = function() {\n            editor.setOption(\"mode\", looksLikeScheme(editor.getValue()) ? \"scheme\" : \"javascript\");\n        };\n\n        var pending;\n\n        editor.on(\"change\", function() {\n            clearTimeout(pending);\n            pending = setTimeout(update(), 400)\n        });\n\n    });\n\n});\n</code></pre>"},{"location":"JavaScript/2018-06-07-requirejs-javascript/#codemirror-configuration","title":"Codemirror configuration","text":"<p>Because I put the codemirror.js, javascript.js and scheme.js in the same folder. So I need so some customizations in javascript.js and scheme.js.  </p> <ul> <li>JavaScript.js  </li> </ul> <pre><code>(function(mod) {\n  if (typeof exports == \"object\" &amp;&amp; typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));   // (\"../../lib/codemirror\") -- &gt; (\"codemirror\") \u4fee\u6539\u76f8\u5bf9\u8def\u5f84\n  else if (typeof define == \"function\" &amp;&amp; define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod); // (\"../../lib/codemirror\") -- &gt; (\"codemirror\") \u4fee\u6539\u76f8\u5bf9\u8def\u5f84\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n</code></pre> <ul> <li>scheme.js  </li> </ul> <pre><code>(function(mod) {\n  if (typeof exports == \"object\" &amp;&amp; typeof module == \"object\") // CommonJS\n    mod(require(\"codemirror\"));  // (\"../../lib/codemirror\") -- &gt; (\"codemirror\") \u4fee\u6539\u76f8\u5bf9\u8def\u5f84\n  else if (typeof define == \"function\" &amp;&amp; define.amd) // AMD\n    define([\"codemirror\"], mod);  // (\"../../lib/codemirror\") -- &gt; (\"codemirror\") \u4fee\u6539\u76f8\u5bf9\u8def\u5f84\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n</code></pre> <p>Download</p>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/","title":"Details of the object model","text":"<p>JavaScript\u4e0d\u662f\u57fa\u4e8eclass\uff0c\u800c\u662f\u57fa\u4e8eobject\u7684\u8bed\u8a00\u3002\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u521b\u5efa\u4e00\u4e2a\u7ee7\u627f\u5173\u7cfb\u5c31\u53d8\u5f97\u4e0d\u662f\u7279\u522b\u663e\u800c\u6613\u89c1\u3002  </p>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#the-differences-between-class-based-and-object-based-languange","title":"The differences between class-based and object-based languange","text":"<ol> <li> <p>\u57fa\u4e8eclass\u7684\u8bed\u8a00\u6e05\u695a\u7684\u533a\u5206\u7c7b\u4e0e\u5b9e\u4f8b\u3002class \u5c31\u662f\u67d0\u4e00\u7c7b\u7269\u4f53\u7684\u62bd\u8c61\uff0c\u5305\u62ec\u5c5e\u6027\uff0c\u65b9\u6cd5\u3002instance \u5c31\u662f\u67d0\u4e2a\u7c7b\u4e00\u4e2a\u5177\u4f53\u7684\u5b9e\u4f8b\u3002</p> </li> <li> <p>\u57fa\u4e8eobject\u7684\u8bed\u8a00\uff0c\u4e0d\u533a\u5206 class \u4e0e instance , \u4f46\u662f\u6709\u539f\u578b\u5bf9\u8c61( prototypical object )\u7684\u6982\u5ff5\u3002\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u62e5\u6709\u81ea\u5df1\u7684\u5c5e\u6027\uff0c\u4e5f\u53ef\u4ee5\u5728runtime\u7684\u65f6\u5019\u521b\u5efa\u81ea\u5df1\u7684\u5c5e\u6027\u3002\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61A\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u53e6\u5916\u4e00\u4e2a\u5bf9\u8c61B\u7684prototype\uff0c\u5728B\u5bf9\u8c61\u4e2d\u53ef\u4ee5\u5171\u4eabA\u7684\u5c5e\u6027\u3002  </p> </li> <li> <p>JavaScript\u4f7f\u7528*Function*\u5173\u952e\u5b57\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u901a\u8fc7\u4f7f\u7528*new*\u5173\u952e\u5b57\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>Javascript\u4f7f\u7528*prototypical object* \u5b9e\u73b0\u7ee7\u627f\u3002</p> </li> <li> <p>\u57fa\u4e8e*class*\u7684\u8bed\u8a00\u5728\u521b\u5efa\u7c7b\u4e4b\u540e\u4e0d\u80fd\u6539\u53d8\u7c7b\u7684\u5c5e\u6027\u3002\u57fa\u4e8e*object*\u7684\u8bed\u8a00\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u4e3a\u4e00\u4e2a\u5bf9\u8c61\u6dfb\u52a0\u6216\u8005\u5220\u9664\u5c5e\u6027\u3002\u5982\u679c\u4e3a\u4e00\u4e2a\u7236\u7c7b\u6dfb\u52a0\u5c5e\u6027\uff0c\u5b50\u7c7b\u4e5f\u4f1a\u62e5\u6709\u76f8\u540c\u7684\u5c5e\u6027\u3002</p> </li> </ol>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#the-employee-example","title":"The employee example","text":""},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#simple-constructors","title":"Simple constructors","text":"<pre><code>//define Employee\n\nfunction Employee() {\n  this.name = '';\n  this.dept = 'general';\n};\n\n//define Manager\n\nfunction Manager() {\n  Employee.call(this);\n  //\u6216\u8005\u4f7f\u7528\u4ee5\u4e0b\u5f62\u5f0f\n  //this.base = Employee;\n  this.reports = [];\n  this.dept = \"sale\";\n  this.team = \"QQ\";\n};\nManager.prototype = Object.create(Employee.prototype);\n//\u6216\u8005\u4f7f\u7528\u4ee5\u4e0b\u5f62\u5f0f\n//Manager.prototype = new Employee;\n\nvar manager = new Manager;\n\nvar m = new Manager;\n\nconsole.log(m.dept);   //sale\nconsole.log(m.reports); // []\nconsole.log(m.team); // QQ\n</code></pre>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#more-flexible-constructors","title":"More flexible constructors","text":"<pre><code>function Employee(name, dept) {\n  this.name = name || '';\n  this.dept = dept || 'general';\n}\n\nfunction WorkerBee(name, dept, projs) {\n  //\u6307\u5b9a\u7236\u7c7b\n  this.base = Employee;\n  //\u8c03\u7528\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\n  this.base(name, dept);\n  this.projects = projs || [];\n}\nWorkerBee.prototype = new Employee;\n\nfunction Engineer(name, project, mach) {\n  this.base = WorkerBee;\n  this.base(name, 'engineering', project);\n  this.dept = 'engineering';\n  this.machine = mach || '';\n}\nEngineer.prototype = new WorkerBee;\n\nvar engine = new Engineer('Jack', ['python', 'perl'], 'belau');\n\nconsole.log(engine.name, engine.dept, engine.projects, engine.machine); //Jack engineering [ 'python', 'perl' ] belau\n</code></pre>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#prototype-chain","title":"Prototype Chain","text":"<pre><code>//\u539f\u578b\u94fe\u5c31\u662f\u5bf9\u8c61\u7684\u7ee7\u627f\u94fe\uff0c\u67e5\u627e\u5c5e\u6027\u7684\u65f6\u5019\u6cbf\u7740\u8fd9\u4e2a\u94fe\u6761\u5411\u4e0a\u67e5\u627e\nvar chris = new Engineer('Jack', ['python', 'perl'], 'belau');\n\n// engine\u7684\u539f\u578b\u94fe\u5982\u4e0b:\n\nchris.__proto__ == Engineer.prototype;\nchris.__proto__.__proto__ == WorkerBee.prototype;\nchris.__proto__.__proto__.__proto__ == Employee.prototype;\nchris.__proto__.__proto__.__proto__.__proto__ == Object.prototype;\nchris.__proto__.__proto__.__proto__.__proto__.__proto__ == null;\n\n//instance of \u51fd\u6570\n\nfunction instanceOf(object, constructor) {\n   object = object.__proto__;\n   while (object != null) {\n      if (object == constructor.prototype)\n         return true;\n      if (typeof object == 'xml') {\n        return constructor.prototype == XML.prototype;\n      }\n      object = object.__proto__;\n   }\n   return false;\n}\n\ninstanceOf(chris, Engineer); //true\ninstanceOf(chris, WorkerBee);//true\ninstanceOf(chris, Employee);//true\ninstanceOf(chris, Object);//true\n</code></pre>"},{"location":"JavaScript/2018-07-02-objectmodel-javascript/#local-or-inherited-values","title":"Local or Inherited values","text":"<p>\u5982\u679c\u9700\u8981\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u5e76\u4e14\u60f3\u8ba9\u8fd9\u4e2a\u4fee\u6539\u5f71\u54cd\u5230\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5b50\u7c7b\uff0c\u4f7f\u7528inherited \u7684\u503c\u3002\u53cd\u4e4b\uff0c\u4f7f\u7528local\u503c\u3002</p> <pre><code>function Employee(name, dept) {\n  // name and dept are local values\n  this.name = name || '';\n  this.dept = dept || 'general';\n}\n\n// type is a inherited value\nEmployee.prototype.type = 'none';\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/","title":"1. Minikube Installation","text":"<p>Environment: Ubuntu 16.04.4 LTS  X86_64bit  </p>"},{"location":"Kubernetes/2018-04-08-installation-istio/#11-install-kubectl","title":"1.1 Install Kubectl","text":"<p>version v1.10.0</p> <pre><code>curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.10.0/bin/linux/amd64/kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#12-install-minikube","title":"1.2 Install Minikube","text":"<p>version v0.25.2</p> <pre><code>curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.25.2/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#13-start-minikube","title":"1.3 Start Minikube","text":"<p>Runs the Kubernetes components on the host and not in a VM with --vm-driver=none</p> <pre><code>export MINIKUBE_WANTUPDATENOTIFICATION=false\nexport MINIKUBE_WANTREPORTERRORPROMPT=false\nexport MINIKUBE_HOME=$HOME\nexport CHANGE_MINIKUBE_NONE_USER=true\nmkdir $HOME/.kube || true\ntouch $HOME/.kube/config\nexport KUBECONFIG=$HOME/.kube/config\nminikube start --vm-driver=none \\\n--extra-config=controller-manager.ClusterSigningCertFile=\"/var/lib/localkube/certs/ca.crt\" \\\n--extra-config=controller-manager.ClusterSigningKeyFile=\"/var/lib/localkube/certs/ca.key\" \\\n--extra-config=apiserver.Admission.PluginNames=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota \\\n--kubernetes-version=v1.10.0\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#14-enabling-shell-autocompletion-optional","title":"1.4 Enabling shell autocompletion (optional)","text":"<pre><code>source &lt;(kubectl completion bash)\necho \"source &lt;(kubectl completion bash)\" &gt;&gt; ~/.bashrc\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#15-stop-minikube","title":"1.5 Stop Minikube","text":"<pre><code>rm -rf .minikube\nminiube status\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#2-istio-installation","title":"2. Istio Installation","text":""},{"location":"Kubernetes/2018-04-08-installation-istio/#21-download-istion","title":"2.1 Download istion","text":"<pre><code>curl -L https://git.io/getLatestIstio | sh -\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#22-add-the-istioctl-client-to-your-path","title":"2.2 Add the istioctl client to your PATH","text":"<pre><code>cd istio-0.7\nexport PATH=$PWD/bin:$PATH\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#23-install-istios-core-components","title":"2.3 Install Istio's core components.","text":"<pre><code>kubectl apply -f install/kubernetes/istio.yaml\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#24-verify-your-installation","title":"2.4 verify your installation","text":"<p>Note: If your cluster is running in an environment that does not support an external load balancer (e.g., minikube), the EXTERNAL-IP of istio-ingress says . You must access the application using the service NodePort, or use port-forwarding instead.   <pre><code>kubectl get svc -n istio-system \nkubectl get pods -n istio-system\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-istio/#reference","title":"Reference","text":"<p>Install Minikube Install Istio </p>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/","title":"k8s Single node installation with kubeadmin","text":""},{"location":"Kubernetes/2018-04-08-installation-kubernete/#install-kubeadmin","title":"Install kubeadmin","text":"<pre><code>apt-get update &amp;&amp; apt-get install -y apt-transport-https curl\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\ncat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list\ndeb https://apt.kubernetes.io/ kubernetes-xenial main\nEOF\napt-get update\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#setup-network-and-network-policy","title":"Setup network and network policy","text":"<pre><code># Setup calico\ncurl https://docs.projectcalico.org/v3.7/manifests/calico.yaml -O\nPOD_CIDR=\"&lt;your-pod-cidr&gt;\" \\\nsed -i -e \"s?192.168.0.0/16?$POD_CIDR?g\" calico.yaml\n\n# Init master\nkubeadm init --cri-socket /var/run/dockershim.sock\n\n# As regular user\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# As root\nexport KUBECONFIG=/etc/kubernetes/admin.conf\n\n# You should now deploy a pod network to the cluster.\nkubectl apply -f https://docs.projectcalico.org/v3.7/manifests/calico.yaml\n\n# Enable schedule pods on the master\nkubectl taint nodes --all node-role.kubernetes.io/master-\n\n# Enbale K8s Dashboard\n\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta1/aio/deploy/recommended.yaml\n\n# Accessing the Dashboard UI\n\nhttps://github.com/kubernetes/dashboard/wiki/Creating-sample-user\n\n# Get Token\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')\n\n\nhttp://9.30.246.163:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#enable-dashboard","title":"Enable Dashboard","text":"<pre><code>kubectl get svc -n kubernetes-dashboard\ntype [ClusterIP --&gt; NodePort]\n[Creating sample user] (https://github.com/kubernetes/dashboard/wiki/Creating-sample-user)\n\n1. Create Service Account\n2. Create ClusterRoleBinding\n3. Bearer Token\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#reset","title":"Reset","text":"<pre><code>kubectl drain aledo1.fyre.ibm.com --delete-local-data --force --ignore-daemonsets\nkubectl delete node aledo1.fyre.ibm.com\nkubeadm reset\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#restart","title":"Restart","text":"<pre><code>//\u67e5\u770bkubectl\u670d\u52a1\u72b6\u6001\nsystemctl status kubelet\n//\u5355\u8282\u70b9\u5b89\u88c5\uff0c\u5173\u95edswap\nswapoff -a\n//\u5237\u65b0\u670d\u52a1\nsystemctl daemon-reload\nsystemctl restart kubelet\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#install-istio-on-k8s","title":"Install Istio on k8s","text":"<p><pre><code>curl -L https://git.io/getLatestIstio | ISTIO_VERSION=1.1.7 sh -\ncd istio-1.1.7\nexport PATH=$PWD/bin:$PATH\n\nfor i in install/kubernetes/helm/istio-init/files/crd*yaml; do kubectl apply -f $i; done\nkubectl apply -f install/kubernetes/istio-demo.yaml\n</code></pre> Q&amp;A</p> Q A kubeadm [ERROR Swap]: running with swap on is not supported. Please disable swap <code>swapoff -a</code>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#minikube-installation","title":"Minikube Installation","text":"<p>Environment: Ubuntu 16.04.4 LTS  X86_64bit  </p>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#11-install-kubectl","title":"1.1 Install Kubectl","text":"<p>version v1.10.0</p> <pre><code>curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.10.0/bin/linux/amd64/kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#12-install-minikube","title":"1.2 Install Minikube","text":"<p>version v0.25.2</p> <pre><code>curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.25.2/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#13-start-minikube","title":"1.3 Start Minikube","text":"<p>Runs the Kubernetes components on the host and not in a VM with --vm-driver=none</p> <pre><code>export MINIKUBE_WANTUPDATENOTIFICATION=false\nexport MINIKUBE_WANTREPORTERRORPROMPT=false\nexport MINIKUBE_HOME=$HOME\nexport CHANGE_MINIKUBE_NONE_USER=true\nmkdir $HOME/.kube || true\ntouch $HOME/.kube/config\nexport KUBECONFIG=$HOME/.kube/config\n\nminikube start --vm-driver=none\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#14-enabling-shell-autocompletion-optional","title":"1.4 Enabling shell autocompletion (optional)","text":"<pre><code>source &lt;(kubectl completion bash)\necho \"source &lt;(kubectl completion bash)\" &gt;&gt; ~/.bashrc\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#15-stop-minikube","title":"1.5 Stop Minikube","text":"<pre><code>rm -rf .minikube\nminikube status\n</code></pre>"},{"location":"Kubernetes/2018-04-08-installation-kubernete/#reference","title":"Reference","text":"<p>Install Minikube Kubernete\u6280\u672f\u5165\u95e8\u4e0e\u5b9e\u8df5 </p>"},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/","title":"Kubernetes Memo","text":""},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#kubernetes-terminology","title":"Kubernetes Terminology","text":"Term Definition Node A server that hosts applications in a Kubernetes cluster. Master Node A node server that manages the control plane in a Kubernetes cluster. Master nodes provide basic cluster services such as APIs or controllers. Worker Node Also named Compute Node, worker nodes execute workloads for the cluster. Application pods are scheduled onto worker nodes. Resource Resources are any kind of component definition managed by Kubernetes. Resources contain the configuration of the managed component (for example, the role assigned to a node), and the current state of the component (for example, if the node is available). Controller A controller is a Kubernetes process that watches resources and makes changes attempting to move the current state towards the desired state. Label A key-value pair that can be assigned to any Kubernetes resource. Selectors use labels to filter eligible resources for scheduling and other operations. Namespace A scope for Kubernetes resources and processes, so that resources with the same name can be used in different boundaries."},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#switching","title":"Switching","text":""},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#routing","title":"Routing","text":""},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#gateway","title":"Gateway","text":""},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#namespace","title":"Namespace","text":""},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#using-secrets-as-environment-variables","title":"Using Secrets as environment variables","text":"<p>https://kubernetes.io/docs/concepts/configuration/secret/</p>"},{"location":"Kubernetes/2018-04-08-knowledge-kubernete/#init-containers","title":"init-containers","text":"<p>https://kubernetes.io/docs/concepts/workloads/pods/init-containers/#examples</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/","title":"Openshift Memo","text":""},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#adding-roles-to-users","title":"Adding roles to users","text":"<p>https://docs.openshift.com/container-platform/4.5/authentication/using-rbac.html</p> <pre><code>#local role\noc adm policy add-role-to-user &lt;role&gt; &lt;user&gt; -n &lt;project&gt;\n\n#For example, you can add the admin role to the alice user in joe project by running:\noc adm policy add-role-to-user admin alice -n joe\n\n#cluster role\noc adm policy add-cluster-role-to-user cluster-admin &lt;user&gt;\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#view-env-in-a-container","title":"View env in a container","text":"<pre><code>podman exec -it todoapi env\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#openshift-terminology","title":"OpenShift Terminology","text":"Term Definition Infra Node A node server containing infrastructure services like monitoring, logging, or external routing. Console A web UI provided by the RHOCP cluster that allows developers and administrators to interact with cluster resources. Project OpenShift's extension of Kubernetes' namespaces. Allows the definition of user access control (UAC) to resources."},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#cmd-and-entrypoint","title":"CMD and ENTRYPOINT","text":"<pre><code>ENTRYPOINT [\"command\", \"param1\", \"param2\"]\nCMD [\"param1\",\"param2\"]\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#saving-and-loading-images","title":"Saving and Loading Images","text":"<pre><code>sudo podman save [-o FILE_NAME] IMAGE_NAME[:TAG]\n\nsudo podman load -i mysql.tar\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#configuring-registries-in-podman","title":"Configuring Registries in Podman","text":"<pre><code>cat /etc/containers/registries.conf\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#build-kubernetes-operators-from-helm-charts-in-5-steps","title":"Build Kubernetes Operators from Helm Charts in 5 steps","text":"<p>https://www.openshift.com/blog/build-kubernetes-operators-from-helm-charts-in-5-steps</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#tutorial-for-helm-based-operators","title":"Tutorial for Helm-based Operators","text":"<p>https://sdk.operatorframework.io/docs/building-operators/helm/tutorial/</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#memcached-helm-operator","title":"Memcached Helm Operator","text":"<p>https://github.com/operator-framework/operator-sdk-samples/tree/master/helm</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#create-a-route","title":"Create a route","text":"<pre><code>oc create route passthrough --service $(oc get svc | grep &lt;Service_Name&gt; | awk '{print$1}')\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#allowing-pods-to-reference-images-across-projects","title":"Allowing Pods to reference images across projects","text":"<p>https://docs.openshift.com/container-platform/4.5/openshift_images/managing_images/using-image-pull-secrets.html#images-allow-pods-to-reference-images-across-projects_using-image-pull-secrets</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#managing-sccs-in-openshift","title":"Managing SCCs in OpenShift","text":"<p>https://www.openshift.com/blog/managing-sccs-in-openshift</p>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#use-podman-push-image-skip-tls-verify","title":"Use podman push image skip tls verify","text":"<pre><code>podman push --tls-verify=false &lt;Registry&gt;/&lt;project&gt;/&lt;Image&gt;:&lt;Tag&gt;\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#ssh-to-openshit-work-node","title":"ssh to openshit work node","text":"<pre><code>ssh core@hostname\n\n#View image registry info\ncat /etc/hosts\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#exposing-the-registry","title":"Exposing the registry","text":"<p>https://docs.openshift.com/container-platform/4.3/registry/securing-exposing-registry.html</p> <pre><code>oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{\"spec\":{\"defaultRoute\":true}}' --type=merge\n\nHOST=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')\npodman login -u $(oc whoami) -p $(oc whoami -t) --tls-verify=false $HOST\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#install-helm-on-openshift","title":"Install helm on openshift","text":""},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#1-update-environment-variable","title":"1. Update Environment Variable","text":"<pre><code>vi ~/.bash_profile\nexport TILLER_NAMESPACE=tiller\nsource ~/.bash_profile\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#2-create-a-new-project","title":"2. Create a new project","text":"<pre><code>oc new-project tiller\noc project tiller\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#3-init-helm","title":"3. Init helm","text":"<pre><code>wget https://get.helm.sh/helm-v2.14.2-linux-amd64.tar.gz\ntar xzvf helm-v2.14.2-linux-amd64.tar.gz\ncd linux-amd64\nchmod 755 helm\nrm -rf /usr/local/bin/helm\nmv helm /usr/local/bin/helm\nhelm init --client-only\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#4-create-tiller-by-openshift-template","title":"4. Create tiller by openshift template","text":"<pre><code>oc process -f https://github.com/openshift/origin/raw/master/examples/helm/tiller-template.yaml -p TILLER_NAMESPACE=\"tiller\" -p HELM_VERSION=v2.14.2 | oc create -f -\noc rollout status deployment tiller\nhelm version\n</code></pre>"},{"location":"Kubernetes/2020-10-05-knowledge-openshift4-3/#5-use-helm-in-your-project","title":"5. Use helm in your project","text":"<pre><code>oc new-project ida-helm\noc project ida-helm\n\n## bind role\noc adm policy add-role-to-user edit \"system:serviceaccount:tiller:tiller\"\n## get bind role info\noc describe rolebinding.rbac -n ida-helm\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/","title":"CKA","text":""},{"location":"Kubernetes/2022-01-09-cks/#core-concepts","title":"Core concepts","text":""},{"location":"Kubernetes/2022-01-09-cks/#pods-with-yaml","title":"PODs with yaml","text":"<pre><code>echo &gt; pod.yml &lt;&lt;-EOF\napiVersion: v1\nkind: POD\nmetadata: \n  name: myapp-pod\n  labels:\n    app: myapp\n        type: front-end\nspec:\n    containers:\n        - name: nginx-container\n            image: nginx\nEOF\n\n\nkubectl get pods -o wide\nkubectl describe pod/nginx | grep -C 4 Image\n\nkubectl run redis --image=redis123 --dry-run=client -o yaml &gt; redis.yaml\n\nkubectl edit pod/redis\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#replicaset","title":"Replicaset","text":"<pre><code>kubectl create -f replicaset-definition.yml\nkubectl get replicaset\nkubectl delete replicaset my-replicaset\nkubectl replace -f replicaset-definition.yml\nkubectl scale -replicas=6 -f eplicaset-definition.yml\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#deployment","title":"Deployment","text":"<p>Certification Tips! https://kubernetes.io/docs/reference/kubectl/conventions/</p> <pre><code># Generate POD Manifest YAML file (-o yaml). Don't create it (--dry-run)\n\nkubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml\n\n# Create a deployment. Don't create it (--dry-run)\nkubectl create deployment --image=nginx nginx --dry-run=client -o yaml &gt; deployment.yaml\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#namespace","title":"Namespace","text":"<pre><code>kubectl get pod --namespace=dev\nkubectl config set-context $(kubectl config current-context) --namespace=dev\nkubectl get pod --all-namespaces\nkubectl get ns --no-headers | wc -l\nkubectl -n research get pods --no-headers\n\n\necho &gt; resourcequota.yaml &lt;&lt;-EOF\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: compute-quota\n  namespace: dev\nspec:\n  hard:\n    pods: \"10\"\n    requests.cpu: \"4\"\n    requests.memory: 5Gi\n    limits.cpu: \"10\"\n    limits.memory: 10Gi\nEOF\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#service","title":"Service","text":"<p>ServiceTypes:</p> <p>NodePort - targetPort is the container port - port is the service port - nodeport is the node port (32767-30000) <pre><code>echo &gt; service &lt;&lt;-EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-service\nspec:\n  type: NodePort\n  selector:\n    app: myapp\n    type: front-end\n  ports:\n   - targetPort: 80\n     port: 80\n     nodePort: 30008\n</code></pre></p> <p>ClusterIP (default) <pre><code>echo &gt; service &lt;&lt;-EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-service\nspec:\n  type: ClusterIP\n  selector:\n    app: myapp\n    type: front-end\n  ports:\n   - targetPort: 80\n     port: 80\n</code></pre></p> <p>LoadBalancer</p> <pre><code>echo &gt; service &lt;&lt;-EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-service\nspec:\n  type: LoadBalancer\n  selector:\n    app: myapp\n    type: front-end\n  ports:\n   - targetPort: 80\n     port: 80\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#imperative-vs-declarative","title":"Imperative VS Declarative","text":"<p>Infrastructure as Code</p> <p>Imperative</p> <pre><code>1. Provision a VM by the name 'web-server'\n2. Install NGINX Software on it\n3. Edit configuration file to use port '8080'\n4. Edit configuration file to web path '/var/www/nginx'\n5. Load web pages to '/var/www/nginx' from GIT Repo - X\n6. Start NGINX server\n</code></pre> <p>Declarative</p> <pre><code>VM Name: web-server\nPackage: nginx\nPort: 8080\nPath: /var/www/nginx\nCode: GIT Repo - X\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#exam-tips","title":"Exam Tips","text":"<pre><code>kubectl run nginx --image=nginx --port 8080 --labels=tier=back-end --dry-run=client -o yaml\n\nkubectl create deployment nginx --image=nginx --namespace=dev-ns --dry-run=client -o yaml\n\nkubectl expose pod nginx --port=80 --name nginx-service --dry-run=client -o yaml\n\nkubectl expose deployment nginx --port 80\nkubectl edit deployment nginx\nkubectl scale deployment nginx --replicas=5\nkubectl set image deployment nginx nginx=nginx:1.18\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#scheduling","title":"Scheduling","text":""},{"location":"Kubernetes/2022-01-09-cks/#manually-specify-node","title":"Manually specify node","text":"<pre><code>kubectl get pods -n kube-system\n\necho &gt; nginx.yaml &lt;&lt;-EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  app: nginx\nspec:\n  containers:\n  -  image: nginx\n     name: nginx\n  nodeName: node01\nEOF\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#labels-and-selectors","title":"Labels and Selectors","text":"<p>Notes: The lables under metadata section is are the lables of the Kind itself. And the labels under template section are the labels of pods. </p> <pre><code>kubectl get pods --selector app=App1\nkubectl get pods --show-labels | grep env=dev | wc -l\nkubectl get pods -l env=dev --no-headers | wc -l\nkubectl get pods -l env=prod,bu=finance\n\nkubectl get all -l env=prod --no-headers | wc -l\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#taints-and-tolerations","title":"Taints and Tolerations","text":"<p>Notes: Trains are set on nodes and Tolerations are set on pods.</p> <p>Notes: Taints and Tolerations are only meant to restrict nodes from accepting certain pods! </p> <p>Notes: Tiants and Tolerations does not tell the pod to go to a particular node, instead it tells the node to only accept pods with certain toleration.</p> <pre><code>kubectl taint nodes node-name key=value:taint-effect\n\n# taint-effect\n  - NoSchedule\n  - PreferNoSchedule\n  - NoExecute\n\n# eg.\nkubectl taint nodes node1 app=blue:NoSchedule\n\n# eg. pod definition yaml\n\necho &gt; pod.yaml &lt;&lt;-EOF\napiVersion:v1\nkind: Pod\nmetadata:\n  name: myapp-pod\nspec:\n  containers:\n  - name: nginx-container\n    image: nginx\n  tolerations:\n  - key: \"app\"\n    operator: \"Equal\"\n    value: \"blue\"\n    effect: \"NoSchedule\"\nEOF\n\n\nkubectl describe node kubemaster | grep Taint\n\nkubectl run bee --image=nginx --dry-run=client --restart=Never -o yaml &gt; bee.yaml\n\nkubectl explain pod --recursive | less\nkubectl explain pod --recursive | grep -A5 tolerations\n\n# Remove taint from Node\nkubectl describe node controlplane | grep Taints\nkubectl taint nodes controlplane node-role.kubernetes.io/master:NoSchedule-\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#node-selector","title":"Node selector","text":"<pre><code>echo &gt; pod.yaml &lt;&lt;-EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp-pod\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n  nodeSelector:\n    size: large\nEOF\n\nkubectl label nodes &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#node-affinity","title":"Node Affinity","text":"<pre><code>echo &gt; pod.yaml &lt;&lt;-EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: disktype\n            operator: In\n            values:\n            - ssd            \n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\nEOF  \n</code></pre> <p>Node Affinitty Types</p> <ul> <li>requiredDuringSchedulingIgnoredDuringExecution</li> <li>preferredDuringSchedulingIgnoredDuringExecution</li> </ul> <pre><code>kubectl get node node01 --show-labels\n# Add a label\nkubectl label nodes nodde01 color=blue\n\nkubectl get deployment blue -o yaml &gt; blue.yaml\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#resource-requirements-and-limits","title":"Resource requirements and limits","text":"<ul> <li>1G(Gigabyte) = 1,000,000,000 bytes</li> <li>1M(Megabyte) = 1,000,000 bytes</li> <li> <p>1K(kilobyte) = 1,000 bytes</p> </li> <li> <p>1Gi(Gibibyte) = 1,073,741,824 bytes</p> </li> <li>1Mi(Mebibyte) = 1,048,576 bytes</li> <li>1Ki(Kibibyte) = 1,024 bytes</li> </ul> <pre><code>https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/\n\n# Set cpu default in a namespace\nhttps://kubernetes.io/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/\n# Set memory default in a namespace\nhttps://kubernetes.io/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/\n\nkubectl describe pod/elephant | grep -A4 Reason\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#daemonsets","title":"DaemonSets","text":"<p>A DaemonSet ensures that all (or some) Nodes run a copy of a Pod.  https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/</p> <pre><code>kubectl get ds --all-namespaces\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#static-pods","title":"Static Pods","text":"<p>Neat and Simple. jiandan, youya!</p> <pre><code># Count static pods in all namespces\nkubectl get pods --all-namespaces | grep \"master\"\netcd,kube-apiserver,kube-controller-manager,kube-scheduler\n\n\n# where is the pod definition files are located?\n/etc/kubernetes/manifests\n# What is the docker image used to deploy the kube-api server as a static pod?\ncat /etc/kubernetes/manifests/kube-apiserver.yaml\n\n\nps -ef | grep kubelet | grep \"\\--config\"\ncat /var/lib/kubelet/config.yaml | grep staticPodPath\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#multiple-schedulers","title":"Multiple Schedulers","text":"<pre><code>--leader-elect=false  // In not a HA cluser, which means there is one master node\n--scheduler-name=my-scheduler\n\n--leaser-elect=ture\n--scheduler-name=my-scheduler\n--lock-object-name=my-custom-scheduler\n\nkubectl get events\n\nkubectl get pod/kube-scheduler-controlplane -n kube-system -o yaml | grep image\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#networking","title":"Networking","text":""},{"location":"Kubernetes/2022-01-09-cks/#dn","title":"DN","text":"<pre><code>ip link\nip addr\nip addr add 192.168.1.10/24 dev eth0\nip route\nip route add 192.168.1.0/24 via 192.168.2.1\n\ncat /proc/sys/net/ipv4/ip_forward\n\nnslookup www.google.com\ndig www.google.com\n\n# Create a new network namespace\nip netns add red\nip netns add blue\nip netns\nip link\n\n\nip netns exec red ip link\narp\n\n# bring up the interface using the IP link between two network namespace\nip link add veth-red type veth peer name veth-blue\nip link set veth-red netns red\nip link set veth-blue netns blue\n\nip -n red addr add 192.168.15.1 dev veth-red\nip -n blue addr add 192.168.15.2 dev veth-blue\nip -n red link set veth-red up\nip -n blue link set veth-blue up\n\nip netns exec red ping 192.168.15.2\nip netns exec red arp\n\n\n# Linux bridge\n\nip link add v-net-0 type bridge\nip link\nip link set dev v-net-0 up\n\n# connect networkspace to switch\n\n# first deleting existing link\nip -n red link del veth-red\n\nip link add veth-red type veth peer name veth-red-br\nip link add veth-blue type veth peer name veth-blue-br\nip link set veth-red netns red\nip link set veth-red-br master v-net-0\n\nip link set veth-blue netns blue\nip link set veth-blue-br master v-net-0\nip -n red addr add 192.168.15.1 dev veth-red\nip -n blue addr add 192.168.15.2 dev veth-blue\nip -n red link set veth-red up\nip -n blue link set veth-blue up\n\n# from host to switch\nip addr add 192.168.15.5/24 dev v-net-0\n\n\n\n\niptables -t nat -A PREROUTING --dport 80 --to-destination 192.168.15.2:80 -j DNAT\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#cni-container-network-interface","title":"CNI (Container Network Interface)","text":"<ul> <li>Container Runtime must create network namespace</li> <li>Identify network the container must attach to</li> <li>Container Runtime to invoke Network Plugin(bridge) when container is ADDed.</li> <li>Container Runtime to invoke Network Plugin(bridge) when container is Deleted.</li> <li>JSON format of the Network Configuration</li> </ul> <pre><code>kubectl get node -o wide\n\nip a | grep -B2 &lt;INTERNAL-IP&gt; \n\n\nssh node01 ifconfig -a\n# View docker0 state\nssh node01 ip link\n\n# view default gateway\nnslookup www.google.com\n\nnetstat -natulp | grep etcd | grep LISTEN\n\n# View kubelet options\nps -aux | grep kubelet\n\n/etc/cni/bin\n./net-script.sh add &lt;container&gt; &lt;namespace&gt;\n\n# View all availbel cni plugins\nls /opt/cni/bin\n\n# What is the CNI plugin configured to be used on this kubernetes cluster\nls /etc/cni/net.d\n\ncat /etc/cni/net.d\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#networking-weave","title":"Networking Weave","text":"<pre><code># https://kubernetes.io/docs/tasks/administer-cluster/network-policy-provider/weave-network-policy/\n\nkubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')&amp;env.IPALLOC_RANGE=10.50.0.0/16\"\n\nip addr show weave\n\n# view gateway\nip r\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#service-networking","title":"Service Networking","text":"<pre><code># view service IP range\ncat /etc/kubernetes/manifests/kube-apiserver.yaml | grep cluster-ip-range\n\nkubectl get pod -n kube-system\nkubectl logs kube-proxy-xxxx -n kube-system\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#dns-in-kubernetes","title":"DNS in kubernetes","text":"<pre><code>kubectl get deployment -n kube-system\nkubectl get configmap -n kube-system\nkubectl describe configmap coredns -n kube-system \n\n# From the hr pod nslookupo the mysql service\nkubectl exec -it hr -- nslookup mysql.payroll &gt; nslookup.out\n</code></pre>"},{"location":"Kubernetes/2022-01-09-cks/#ingress","title":"Ingress","text":"<pre><code>kubectl get ingress\n\nhttps://kubernetes.io/docs/concepts/services-networking/ingress/\n\n\nkubectl expose deployment ingress-controller --type=NodePort --port=80 --name=ingress --dry-run=client -o yaml &gt; ingress.yaml\n\nkubectl create cm nginx-configuration -n ingress-space\nkubectl create sa ingress-serviceaccount -n ingress-space\n</code></pre> <pre><code>echo &gt; ingress-controller.yaml &lt;&lt;-EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: ingress-controller\n  namespace: ingress-space\nspec:\n  replicas: 1\n  selector:\n    matchlabels:\n      name: nginx-ingress\n  template:\n    metadatas:\n      labels:\n        name: nginx-ingress\n    spec:\n      serviceAccountName: ingress-serviceaccount\n      containers:\n        - name: nginx-ingress-controller\n          image: quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.21.0\n          args:\n            - /nginx-ingress-controller\n            - --configmap=$(POD_NAMESPACE)/nginx-configuration\n            - --default-backend-service=app-space/default-http-backend\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n          ports:\n            - name: http\n              containerPort: 80\n            - name: https\n              containerPort: 443\nEOF\n</code></pre>"},{"location":"Kubernetes/2022-03-09-operator/","title":"Hello, Operator!","text":""},{"location":"Kubernetes/2022-03-09-operator/#prerequisite","title":"Prerequisite","text":"<ul> <li>Install Go</li> <li>kubernetes-client</li> <li>sample-controller</li> <li>code-generator</li> <li>kubernetes-deep-dive-code-generation-customresources</li> </ul> <pre><code>#vscode\nexport GOPROXY=https://goproxy.io\ngo install -v github.com/stamblerre/gocode@latest\ngo install -v github.com/rogpeppe/godef@latest\ngo install -v golang.org/x/tools/gopls@latest\ngo install -v github.com/ramya-rao-a/go-outline@latest\ngo install -v golang.org/x/tools/cmd/goimports@latest\ngo install -v github.com/ramya-rao-a/go-outline@latest\n\ngo get k8s.io/code-generator@v0.22.1\ngo get k8s.io/client-go@v0.22.1\n\ngo mod vendor\nchmod +x \n\n\n# ubuntu set proxy\nexport ALL_PROXY=socks5://127.0.0.1:1080\n</code></pre>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/","title":"k8s basic concepts","text":""},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#what-is-cloud-native","title":"What is Cloud Native","text":""},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#pivotal-definition","title":"Pivotal definition","text":"<ul> <li>The Twelve-Factor App: A collection of cloud-native app architecture patterns</li> <li>Microservices: Independently deployable services that do one thing well</li> <li>Self-Service Agile Infrastructure: Platforms for rapid, repeatable, and consistent provisioning of app environments and backing services</li> <li>API-based Collaboration: Published and versioned APIs that allow interaction between services in a cloud-native app architecture</li> <li>Anti-Fragility: Systems that get stronger when subjected to stress</li> </ul>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#2015-cncf-definition","title":"2015 CNCF definition","text":"<ul> <li>Container-packaged</li> <li>Dynamically scheduled</li> <li>Micro services-oriented</li> </ul>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#2018-cncf-re-definition","title":"2018 CNCF re-definition","text":"<ul> <li>Cloud native technologies empower organizations to build and run scalable applications in modern, dynamic environments such as public, private, and hybrid clouds. Containers, service meshes, microservices, immutable infrastructure, and declarative APIs exemplify this approach.</li> </ul>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#what-is-kubernetes","title":"What is Kubernetes","text":"<p>Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications.</p> <p>It groups containers that make up an application into logical units for easy management and discovery. Kubernetes builds upon 15 years of experience of running production workloads at Google, combined with best-of-breed ideas and practices from the community.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kubernetes-cluster","title":"Kubernetes cluster","text":""},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kube-apiserver","title":"Kube-apiserver","text":"<p>The Kubernetes API is the front end of the Kubernetes control plane, handling internal and external requests. The API server determines if a request is valid and, if it is, processes it. You can access the API through REST calls, through the kubectl command-line interface, or through other command-line tools such as kubeadm.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kube-scheduler","title":"Kube-scheduler","text":"<p>The scheduler considers the resource needs of a pod, such as CPU or memory, along with the health of the cluster. Then it schedules the pod to an appropriate compute node.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kube-controller-manager","title":"Kube-controller-manager","text":"<p>Controllers take care of actually running the cluster, and the Kubernetes controller-manager contains several controller functions in one. One controller consults the scheduler and makes sure the correct number of pods is running. If a pod goes down, another controller notices and responds. A controller connects services to pods, so requests go to the right endpoints. And there are controllers for creating accounts and API access tokens.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#etcd","title":"etcd","text":"<p>Configuration data and information about the state of the cluster lives in etcd, a key-value store database. Fault-tolerant and distributed, etcd is designed to be the ultimate source of truth about your cluster.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#nodes","title":"Nodes","text":"<p>Pods are scheduled and orchestrated to run on nodes.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#pods","title":"Pods","text":"<p>A pod is the smallest and simplest unit in the Kubernetes object model. It represents a single instance of an application. Each pod is made up of a container or a series of tightly coupled containers, along with options that govern how the containers are run. Pods can be connected to persistent storage in order to run stateful applications.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kubelet","title":"kubelet","text":"<p>Each compute node contains a kubelet, a tiny application that communicates with the control plane. The kublet makes sure containers are running in a pod. When the control plane needs something to happen in a node, the kubelet executes the action.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#kube-proxy","title":"kube-proxy","text":"<p>Each compute node also contains kube-proxy, a network proxy for facilitating Kubernetes networking services. The kube-proxy handles network communications inside or outside of your cluster\u2014relying either on your operating system\u2019s packet filtering layer, or forwarding the traffic itself.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#persistent-storage","title":"Persistent storage","text":"<p>Beyond just managing the containers that run an application, Kubernetes can also manage the application data attached to a cluster. Kubernetes allows users to request storage resources without having to know the details of the underlying storage infrastructure. Persistent volumes are specific to a cluster, rather than a pod, and thus can outlive the life of a pod.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#container-registry","title":"Container registry","text":"<p>The container images that Kubernetes relies on are stored in a container registry. This can be a registry you configure, or a third party registry.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#underlying-infrastructure","title":"Underlying infrastructure","text":"<p>Where you run Kubernetes is up to you. This can be bare metal servers, virtual machines, public cloud providers, private clouds, and hybrid cloud environments. One of Kubernetes\u2019s key advantages is it works on many different kinds of infrastructure.</p>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#built-in-workloads","title":"Built in workloads","text":""},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#scheduling","title":"Scheduling","text":"<p>1. by nodeName</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    run: nginx\n  name: nginx\nspec:\n  containers:\n  - image: nginx\n    name: nginx\n  nodeName: node01\n</code></pre> <p>2. by binding api</p> <pre><code>apiVersion: v1\nkind: Binding\nmetadata:\n  name:nginx\ntarget:\n  apiVersion: v1\n  kind: Node\n  name: node01\n</code></pre> <pre><code>curl --header \"Content-type:application/yaml\" -X POST https://&lt;API_SERVER_HOST&gt;:8443/api/v1/namespaces/default/pods/$PODNAME/binding/ --data \n'\napiVersion: v1\nkind: Binding\nmetadata:\n  name:nginx\ntarget:\n  apiVersion: v1\n  kind: Node\n  name: node01\n'\n</code></pre> <p>3. by labels and selectors</p> <p><pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: nginx\n  name: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx  # Must be same with spec.template.metadata.labels\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n</code></pre> <pre><code>k get pod --selector run=nginx\n</code></pre></p> <p>4. by taints and tolerations</p> <ul> <li>https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</li> </ul> <p>Tains are set on nodes and tolerations set on by pods.</p> <p>taint-effect: NoSchedule, PerferNoSchedule, NoExecute</p> <pre><code>k taint nodes node1 key1=value1:NoSchedule\nk describe node node1 | grep Taint\n</code></pre> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    run: nginx\n  name: nginx\nspec:\n  containers:\n  - image: nginx\n    name: nginx\n  tolerations:\n    - key: \"key1\"\n      operator: \"Equal\"\n      value: \"value1\"\n      effect: \"NoSchedule\"\n</code></pre> 5. by nodeSelector</p> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    run: nginx\n  name: nginx\nspec:\n  containers:\n  - image: nginx\n    name: nginx\n  nodeSelector:\n    size: Large #this is node label value\n</code></pre> <pre><code>k label node node1 size=Large\nk get node node1 --show-labels\n</code></pre></p> <p>6. by nodeAffinity</p> <ul> <li>https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity</li> </ul> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    run: nginx\n  name: nginx\nspec:\n  containers:\n  - image: nginx\n    name: nginx\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: kubernetes.io/os\n            operator: In\n            values:\n            - linux\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 1\n        preference:\n          matchExpressions:\n          - key: label-1\n            operator: In\n            values:\n            - key-1\n      - weight: 50\n        preference:\n          matchExpressions:\n          - key: label-2\n            operator: In\n            values:\n            - key-2\n</code></pre> 7. by resource requirement and limits</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    run: nginx\n  name: nginx\nspec:\n  containers:\n  - image: nginx\n    name: nginx\n    resources:\n      requests:\n        memory: \"64Mi\"\n        cpu: \"250m\"\n      limits:\n        memory: \"128Mi\"\n        cpu: \"500m\"\n</code></pre>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#daemon-sets","title":"Daemon Sets","text":"<ul> <li>Monitoring Solution</li> <li>Logs viewer</li> <li>kube-proxy</li> <li>Networking e.g weave-net</li> </ul> <pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: nginx\n  name: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx  # Must be same with spec.template.metadata.labels\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n</code></pre>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#static-pods","title":"Static pods","text":"<ul> <li>https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/ <pre><code># place pod.yaml here, only create pod in this way! The kubelet work on pod level.\n# controller-manager.yaml, apiserver.yaml, etcd.yaml\n/etc/kubernetes/mainfests\n\nps -ef | grep kubelet\n</code></pre></li> </ul>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#multiple-scheduler","title":"Multiple Scheduler","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-custom-scheduler\n  namespace: kube-system\nspec:\n  containers:\n  - command:\n    - kube-scheduler\n    - --address=127.0.0.1\n    - --kubeconfig=/etc/kubenetes/scheduler.conf\n    - --leader-elect=true\n    - --scheduler-name=my-custom-scheduler\n    - --lock-object-name=my-custom-scheduler\n    image: nginx\n    name: nginx\n\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n    - image: nginx\n      name: nginx\n  schedulerName: my-custom-scheduler\n</code></pre> <pre><code>k -n default get events\n# view scheduler logs\n\nk logs my-custom-scheduler -n default\n</code></pre>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#useful-commands","title":"Useful commands","text":"<pre><code>alias k=kubectl\nexport do=\"--dry-run=client -o yaml\"\nexport now=\"--force --grace-period=0\"\n\nk api-versions\nk api-resources\nk explain &lt;api-resource&gt;\n# e.g\nk explain deployment\n</code></pre>"},{"location":"Kubernetes/2022-04-09-k8s-learning-01/#references","title":"References","text":"<ul> <li>https://docs.microsoft.com/en-us/dotnet/architecture/cloud-native/definition</li> <li>https://queue.acm.org/detail.cfm?id=2898444</li> <li>http://dockone.io/article/1153</li> <li>https://www.cncf.io/announcements/2015/06/21/new-cloud-native-computing-foundation-to-drive-alignment-among-container-technologies/</li> <li>https://jimmysong.io/book/</li> <li>https://wiki.opskumu.com/kubernetes/borg</li> <li>https://www.redhat.com/en/topics/containers/kubernetes-architecture</li> </ul>"},{"location":"Linux/2018-01-21-cmd-linux/","title":"Common Linux Command","text":""},{"location":"Linux/2018-01-21-cmd-linux/#linux-disk-use","title":"Linux disk use","text":"<pre><code>dh -h\n\ndu -sh ./games\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#linux-add-env-variable","title":"Linux add env variable","text":"<pre><code>/etc/profile\nsource /etc/profile\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#cpu","title":"\u67e5\u627eCPU\u4f7f\u7528\u6700\u9ad8\u7684\u7ebf\u7a0b\u53f7","text":"<pre><code>1. top \n2. shift+p \u627e\u5230pid\n3. top -H -p pid\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#rsync-command","title":"rsync Command","text":"<pre><code>// copy from source dir to target dir, but exclude dir1 and dir2\nrsync -av --progress ./source ~/target/ --exclude dir1 --exclude dir2\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#scp-command","title":"scp Command","text":"<pre><code>scp -r /var/mysql/pre_release_data ~/testdata root@0.0.0.0:/var/mysql/pre_release_data\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#lsof","title":"lsof  \u67e5\u770b\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5","text":"<pre><code>lsof -i: \u7aef\u53e3\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#screen","title":"Screen \u547d\u4ee4","text":"<pre><code># \u65b0\u5efa\u4e00\u4e2ascreen \u5e76\u4ee5screenName\u547d\u540d \nscreen -S screenName\n\n# Ctrl + a d \u9000\u51fa\u5f53\u524d\u7684screen\u4f1a\u8bdd\n\n# list screen\nscreen -ls\n\n# \u9000\u51fa\u4f1a\u8bdd\nexit\n\n# \u6062\u590d\u4f1a\u8bdd\n\nscreen -r screenId\n\n# \u5220\u9664dead\u4f1a\u8bdd\n\nscreen -wipe\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#vi","title":"Vi\u547d\u4ee4","text":""},{"location":"Linux/2018-01-21-cmd-linux/#_1","title":"\u79fb\u52a8\u5149\u6807","text":"\u6309\u952e \u79fb\u52a8\u5149\u6807 h\u6216\u8005\u2190 \u5411\u5de6\u79fb\u52a8\u4e00\u4e2a\u5b57\u7b26 j\u6216\u8005\u2193 \u5411\u4e0b\u79fb\u52a8\u4e00\u4e2a\u5b57\u7b26 k\u6216\u8005\u2191 \u5411\u4e0a\u79fb\u52a8\u4e00\u4e2a\u5b57\u7b26 l\u6216\u8005\u2192 \u5411\u53f3\u79fb\u52a8\u4e00\u4e2a\u5b57\u7b26 ^ \u79fb\u52a8\u5230\u5f53\u524d\u884c\u7684\u7b2c\u4e00\u4e2a\u975e\u7a7a\u5b57\u7b26 $ \u79fb\u52a8\u5230\u5f53\u524d\u884c\u7684\u672b\u5c3e Ctrl-f \u5411\u4e0b\u7ffb\u4e00\u9875 Ctrl-b \u5411\u4e0a\u7ffb\u4e00\u9875 numberG \u79fb\u52a8\u5230\u7b2c number \u884c"},{"location":"Linux/2018-01-21-cmd-linux/#_2","title":"\u57fa\u672c\u7f16\u8f91","text":"\u547d\u4ee4 \u6267\u884c\u7684\u64cd\u4f5c i \u5728\u5149\u6807\u6240\u5728\u5b57\u7b26\u7684\u524d\u9762\u5f00\u59cb\u63d2\u5165\u65b0\u5b57\u7b26 a \u5728\u5149\u6807\u6240\u5728\u5b57\u7b26\u7684\u540e\u9762\u5f00\u59cb\u63d2\u5165\u65b0\u5b57\u7b26 o \u5728\u5149\u6807\u6240\u5728\u884c\u7684\u4e0b\u9762\u63d2\u5165\u65b0\u884c O \u5728\u5149\u6807\u6240\u5728\u884c\u7684\u4e0a\u9762\u63d2\u5165\u65b0\u884c x \u5220\u9664\u5f53\u524d\u5b57\u7b26 3x \u5220\u9664\u5f53\u524d\u5b57\u7b26\u4ee5\u53ca\u540e\u9762\u7684\u4e24\u4e2a\u5b57\u7b26 dd \u5220\u9664\u5f53\u524d\u884c 3dd \u5220\u9664\u5f53\u524d\u884c\u4ee5\u53ca\u968f\u540e\u7684\u4e24\u884c d$ \u5220\u9664\u4ece\u5149\u6807\u4f4d\u7f6e\u5230\u884c\u672b\u7684\u6240\u6709\u5b57\u7b26 d0(zero) \u5220\u9664\u4ece\u5149\u6807\u4f4d\u7f6e\u5230\u884c\u9996\u7684\u6240\u6709\u5b57\u7b26 d^ \u5220\u9664\u4ece\u5149\u6807\u4f4d\u7f6e\u5230\u884c\u9996\u7684\u7b2c\u4e00\u4e2a\u975e\u7a7a\u5b57\u7b26 dG \u5220\u9664\u5f53\u524d\u884c\u5230\u6587\u4ef6\u7684\u672b\u5c3e d3G \u5220\u9664\u4ece\u5f53\u524d\u884c\u5230\u6587\u4ef6\u7684\u7b2c3\u884c yy \u590d\u5236\u5f53\u524d\u884c 3yy \u590d\u5236\u5f53\u524d\u884c\u4ee5\u53ca\u968f\u540e\u76842\u884c p \u5c06\u590d\u5236\u7684\u5185\u5bb9\u7c98\u8d34\u5230\u5f53\u524d\u884c\u7684\u4e0b\u9762 P \u5c06\u590d\u5236\u7684\u5185\u5bb9\u7c98\u8d34\u5230\u5f53\u524d\u884c\u7684\u4e0a\u9762"},{"location":"Linux/2018-01-21-cmd-linux/#_3","title":"\u67e5\u627e\u548c\u66ff\u6362","text":"\u547d\u4ee4 \u6267\u884c\u7684\u64cd\u4f5c : \u5192\u53f7\u5b57\u7b26\u8fd0\u884c\u4e00\u4e2a ex \u547d\u4ee4 % % \u662f\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u884c\u5230\u6700\u540e\u4e00\u884c, \u6216\u8005\u7528 1,$ \u6765\u4ee3\u66ff\uff0c\u610f\u601d\u662f\u4ece\u7b2c\u4e00\u884c\u5230\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c s \u6307\u5b9a\u64cd\u4f5c,\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u662f\uff0c\u66ff\u6362(\u67e5\u627e\u4e0e\u66ff\u4ee3) /old char/new char \u67e5\u627e\u7c7b\u578b\u4e0e\u66ff\u4ee3\u6587\u672c g \u5168\u5c40\u66ff\u6362\uff0c\u5982\u679c\u7701\u7565\uff0c\u5219\u53ea\u66ff\u6362\u6bcf\u4e2a\u6587\u672c\u884c\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26 <pre><code>//\u5c06\u7b2c1\u884c\u5230\u7b2c5\u884c\u4e2d\u7b2c\u4e00\u4e2a\u7684hello\u66ff\u6362\u4e3ahi\n1,5s/hello/hi\n\n//\u5c06\u6587\u4e2d\u6240\u6709\u7684hello\u66ff\u6362\u4e3ahi\n%s/hello/hi/g\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#_4","title":"\u641c\u7d22\u547d\u4ee4","text":""},{"location":"Linux/2018-01-21-cmd-linux/#locate","title":"locate \u67e5\u627e\u6587\u4ef6\u7684\u7b80\u5355\u65b9\u5f0f","text":"<p>locate \u7a0b\u5e8f\u4f1a\u6267\u884c\u4e00\u6b21\u5feb\u901f\u7684\u8def\u5f84\u540d\u6570\u636e\u5e93\u641c\u7d22\uff0c\u5e76\u4e14\u8f93\u51fa\u6bcf\u4e2a\u4e0e\u7ed9\u5b9a\u5b50\u5b57\u7b26\u4e32\u76f8\u5339\u914d\u7684\u8def\u5f84\u540d <pre><code>locate redis | grep download\n\n//\u5c06\u641c\u7d22\u7684\u7ed3\u679c\u91cd\u5b9a\u4f4d\u8f93\u51fa\u5230resut\u6587\u4ef6\nlocate redis | grep download &gt; result\n</code></pre></p>"},{"location":"Linux/2018-01-21-cmd-linux/#find","title":"find \u67e5\u627e\u6587\u4ef6\u7684\u590d\u6742\u65b9\u5f0f","text":"<pre><code>/**\u5728home\u76ee\u5f55\u4e2d\u67e5\u627e\u4ee5foo\u5f00\u5934\u7684\u6587\u4ef6\n* -type \u6307\u5b9a\u67e5\u627e\u6587\u4ef6\u7684\u7c7b\u578b  -f:\u666e\u901a\u6587\u4ef6 -d:\u76ee\u5f55 -l:\u7b26\u53f7\u94fe\u63a5 -b:\u5757\u7279\u6b8a\u8bbe\u5907\u6587\u4ef6 -c:\u5b57\u7b26\u7279\u6b8a\u8bbe\u5907\u6587\u4ef6\n*/\nfind ~ -type f -name 'foo*'\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#_5","title":"\u5f52\u6863\u4e0e\u5907\u4efd","text":""},{"location":"Linux/2018-01-21-cmd-linux/#gzip","title":"gzip\u547d\u4ee4","text":"<pre><code>//\u521b\u5efa\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\nls -l . | gzip &gt; test.txt.gz\n//\u89e3\u538b\u7f29\u4e00\u4e2a\u6587\u4ef6\ngzip -d test.txt.gz\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#tar","title":"tar\u547d\u4ee4","text":"<pre><code>//\u521b\u5efa\u4e00\u4e2atar\u6587\u4ef6\ntar cf xxx.tar playground\n//\u62bd\u53d6\u4e00\u4e2atar\u6587\u4ef6\ntar xf ../playground.tar\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#zip","title":"zip\u547d\u4ee4","text":"<pre><code>//\u521b\u5efa\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\n zip -r xxx.zip testfolder\n//\u89e3\u538b\u7f29\u6587\u4ef6\nunzip xxx.zip .\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#_6","title":"\u8fdb\u7a0b\u67e5\u770b\u547d\u4ee4","text":"<pre><code>//\u67e5\u770b\u6240\u6709\u7684java\u8fdb\u7a0b\nps -ef |grep java\n</code></pre>"},{"location":"Linux/2018-01-21-cmd-linux/#_7","title":"\u5f15\u7528","text":"<p>\u53c2\u8003\u94fe\u63a5</p>"},{"location":"Linux/2025-01-21-ubuntu-harden/","title":"Ubuntu 20.02 Harden","text":""},{"location":"Linux/2025-01-21-ubuntu-harden/#prerequisite","title":"Prerequisite","text":""},{"location":"Linux/2025-01-21-ubuntu-harden/#_1","title":"\u73af\u5883\u51c6\u5907","text":"<ol> <li>Apply AliYun Server</li> <li>Config security group, permitt 80,443,22 port</li> <li>Apply a domain </li> <li>\u5907\u6848</li> </ol>"},{"location":"Linux/2025-01-21-ubuntu-harden/#update-the-system","title":"Update the System","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y &amp;&amp; sudo apt dist-upgrade &amp;&amp; sudo apt autoremove\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#install-fail2ban","title":"Install Fail2Ban","text":"<pre><code>sudo apt install fail2ban -y\nsudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\nsudo vi /etc/fail2ban/jail.local\n\n## eidt\n[sshd]\nenabled = true\n\nsudo systemctl restart fail2ban\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#config-os-automatically-update","title":"Config OS automatically update","text":"<pre><code>sudo apt install unattended-upgrades -y\nsudo dpkg-reconfigure --priority=low unattended-upgrades\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#setup-apparmor","title":"Setup AppArmor","text":"<pre><code>sudo apt install apparmor apparmor-utils -y\nsudo aa-enforce /etc/apparmor.d/*\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#audit-optional","title":"Audit (Optional)","text":"<pre><code>sudo apt install lynis -y\nsudo lynis audit system\n\nsudo apt install rkhunter\nsudo rkhunter\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#disable-services-optional","title":"Disable services (Optional)","text":"<pre><code>sudo systemctl list-unit-files --type=service | grep enabled\n\nsudo systemctl disable servicename\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#configure-firewall-with-ufw","title":"Configure Firewall with UFW","text":"<pre><code>sudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow ssh\nsudo ufw allow 80/tcp \nsudo ufw deny 80/tcp ##deny 80\nsudo ufw allow 443/tcp\nsudo ufw enable\nsudo ufw status verbose\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#domain-is-not-reachable","title":"Domain is not reachable","text":"<pre><code>Please check security group contains ICMP(IPv4) protocal\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#create-nonroot-user","title":"Create nonroot user","text":"<pre><code>sudo adduser jiajia\nsudo usermod -aG sudo jiajia\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#create-no-login-user","title":"Create no-login user","text":"<pre><code>sudo useradd -M -s /usr/sbin/nologin sugar\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#config-ssh","title":"Config SSH","text":"<pre><code>sudo vi /etc/ssh/sshd_config\n\n## add below lines\nPort 22\nPermitRootLogin no\nPasswordAuthentication no\nAllowUsers jiajia\n\nsudo systemctl restart sshd\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#setup-jdk17","title":"Setup jdk17","text":"<pre><code>sudo apt install openjdk-17-jre\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#setup-nginx","title":"Setup Nginx","text":"<p><pre><code>sudo apt install nginx -y\nsudo systemctl status nginx\ncurl http://localhost\n\n## install ssl/tls cert########\n\nsudo apt install certbot python3-certbot-nginx -y\nsudo certbot --nginx -d yourdomain.com\n#optional test renew\nsudo certbot renew --dry-run\n###############################\n\n####use a self-certificated certs\n\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\\n-keyout /etc/letsencrypt/live/YOU_DOMAIN/self-key.pem \\\n-out /etc/letsencrypt/live/YOU_DOMAIN/self.crt\n\n\n# https://blog.csdn.net/hongchen006/article/details/135406416\nsudo certbot certonly -d YOU_DOMAIN --manual --preferred-challenges dns\n_acme-challenge.YOU_DOMAIN: Xh-RYYirtUKz7r9OR8hDBsg0e8pd7NLWmOVcyMyTPRY\n\n# Certificate is saved at: /etc/letsencrypt/live/YOU_DOMAIN/fullchain.pem\n# Key is saved at:         /etc/letsencrypt/live/YOU_DOMAIN/privkey.pem\n# This certificate expires on 2025-04-22.\n\n# nginx config\nsudo vi /etc/nginx/nginx.conf\n</code></pre> <pre><code>http {\n    # 1. \u5b9a\u4e49\u8fde\u63a5\u63a7\u5236\u533a\u57df (\u57fa\u4e8e IP \u5730\u5740\u7684\u9650\u5236)\n    limit_conn_zone $binary_remote_addr zone=addr:10m;\n\n    # 2. \u5b9a\u4e49\u8bf7\u6c42\u901f\u7387\u63a7\u5236\u533a\u57df (\u57fa\u4e8e IP \u5730\u5740\u7684\u9650\u5236)\n    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n}\n</code></pre></p>"},{"location":"Linux/2025-01-21-ubuntu-harden/#website-config","title":"website config","text":"<p>sudo vi /etc/nginx/sites-available/yourdomain.com <pre><code>server {\n    listen 80;\n    server_name YOU_DOMAIN YOU_DOMAIN;\n    return 301 https://$host$request_uri;\n    location ~* \\.(jpg|jpeg|png|gif|ico|css|js|woff2|woff|ttf|otf|svg)$ {\n        # \u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u4e3a30\u5929\n        expires 30d;\n        add_header Cache-Control \"public, no-transform\";\n\n        # \u53ef\u9009\uff1a\u5173\u95ed\u65e5\u5fd7\u8bb0\u5f55\u51cf\u5c11I/O\n        access_log off;\n    }\n}\nserver {\n    listen 443 ssl;\n    server_name YOU_DOMAIN YOU_DOMAIN;\n\n    # SSL\u8bc1\u4e66\u8def\u5f84\n    ssl_certificate /etc/letsencrypt/live/YOU_DOMAIN/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/YOU_DOMAIN/privkey.pem;\n\n    # \u542f\u7528\u5f3a\u52a0\u5bc6\u5957\u4ef6\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';\n    ssl_prefer_server_ciphers on;\n\n    # \u542f\u7528HSTS\uff08\u5f3a\u5236HTTPS\uff09\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n\n    # \u9632\u6b62\u70b9\u51fb\u52ab\u6301\n    add_header X-Frame-Options \"SAMEORIGIN\";\n\n    # \u9632\u6b62MIME\u7c7b\u578b\u55c5\u63a2\n    add_header X-Content-Type-Options \"nosniff\";\n\n    # \u9632\u6b62XSS\u653b\u51fb\n    add_header X-XSS-Protection \"1; mode=block\";\n\n    # \u7981\u7528\u670d\u52a1\u5668\u7248\u672c\u4fe1\u606f\n    server_tokens off;\n\n    # \u53cd\u5411\u4ee3\u7406\u5230Spring Boot\u5e94\u7528\n    location / {\n        # \u5e76\u53d1\u8fde\u63a5\u9650\u5236\uff0c\u6bcf\u4e2a IP \u540c\u65f6\u53ea\u80fd\u6709 10 \u4e2a\u8fde\u63a5\n        limit_conn addr 10;\n        # \u8bf7\u6c42\u901f\u7387\u9650\u5236\uff0c\u6bcf\u79d2\u5141\u8bb8 1 \u6b21\u8bf7\u6c42\uff0c\u7a81\u53d1\u961f\u5217\u957f\u5ea6\u4e3a 5\n        limit_req zone=one burst=5 nodelay;\n\n        proxy_pass http://127.0.0.1:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_connect_timeout 30s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 300s;\n    }\n\n    # \u7981\u6b62\u8bbf\u95ee\u9690\u85cf\u6587\u4ef6\n    location ~ /\\. {\n        deny all;\n    }\n\n    # \u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6\n    location ~* \\.(log|sql|bak|conf|ini)$ {\n        deny all;\n    }\n}\n</code></pre> <pre><code>sudo systemctl restart nginx\nsudo systemctl status nginx\nsudo tail -f /var/log/nginx/access.log\nsudo tail -f /var/log/nginx/error.log\n</code></pre></p>"},{"location":"Linux/2025-01-21-ubuntu-harden/#create-a-service-for-your-sprintboot-app","title":"Create a service for your sprintboot app","text":"<pre><code># sudo vi /home/jiajia/start.sh\n\n#!/bin/bash\nexport API_KEY=KEY\njava -jar /home/jiajia/app.jar\n</code></pre> <pre><code># sudo vi /etc/systemd/system/sugar.service\n\n[Unit]\nDescription=Sugar\nAfter=syslog.target\nAfter=network.target[Service]\nUser=jiajia\nType=simple\n\n[Service]\nExecStart=/home/jiajia/start.sh\nRestart=always\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=helloworld\n\n[Install]\nWantedBy=multi-user.target\n\n\n#verify\nsudo systemctl start sugar\nsudo systemctl status sugar\nsudo journalctl -u sugar -f\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#h2","title":"h2","text":"<pre><code>java -cp .\\h2-2.3.232.jar org.h2.tools.Shell\njava -cp .\\h2-2.3.232.jar org.h2.tools.Server -tcp -web\njava -cp .\\h2-2.3.232.jar org.h2.tools.Server -tcp -tcpPort 9081 -baseDir ~/sugar\n</code></pre> <pre><code>CREATE TABLE S_USERS(\n    id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    s_name VARCHAR(255),\n    s_key VARCHAR(255)\n);\n\n\nCREATE TABLE S_TOKEN(\n    id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    token VARCHAR(255),\n    s_name VARCHAR(255)\n);\nCREATE INDEX idx_token on s_token(token);\n\nCREATE TABLE s_audit (\n    id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    token VARCHAR(255),\n    s_name VARCHAR(255),\n    consumed_at Long,\n    s_type VARCHAR(15) \n);\nCREATE INDEX idx_audit_token on s_audit (s_name);\nCREATE INDEX idx_audit_consumed_at on s_audit (consumed_at);\n\nCREATE TABLE s_dict (\n    id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    s_name VARCHAR(255),\n    s_meaning VARCHAR(512),\n    s_type VARCHAR(15),\n    s_other VARCHAR(255)\n);\nCREATE INDEX idx_s_dict on s_dict (s_name);\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#ssh-key-gen","title":"ssh key-gen","text":"<pre><code>1. \u751f\u6210keys &lt;RAS/ED25519/ECDSA&gt;\n\nopenssl genrsa -out C:/keys/rsa_private_key.pem 2048\nopenssl pkcs8 -topk8 -nocrypt -inform PEM -in C:/keys/rsa_private_key.pem -outform PEM\nopenssl rsa -in C:/keys/rsa_private_key.pem -pubout -out C:/keys/rsa_public_key.pem\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#angular-build","title":"Angular build","text":"<pre><code>npm run build --prod\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#run-within-springboot","title":"Run within Springboot","text":"<ul> <li> <ol> <li>Copy dist/project_name/browser into resources/static/public/project_name/</li> </ol> </li> <li> <ol> <li>Edit index.html and set <code>&lt;base href=\".\"&gt;</code></li> </ol> </li> <li> <ol> <li>add addViewControllers</li> </ol> </li> </ul> <pre><code>@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addViewControllers(ViewControllerRegistry registry) {\n        registry.addViewController(\"/public/project_name/welcome\")\n                .setViewName(\"forward:/public/project_name/index.html\");\n    }\n}\n</code></pre>"},{"location":"Linux/2025-01-21-ubuntu-harden/#_2","title":"\u63d0\u53d6\u5b57\u4f53","text":"<pre><code>pip install fonttools\ngrep -rohP '[\\p{Han}]' ./pages | sort | uniq &gt; charset.txt\n\n## \u62bd\u53d6\u5e38\u7528\u5b57\u4f53\npyftsubset ./SourceHanSerifCN-Regular.otf --output-file=\"SourceHanSansCN-Subset.otf\" --unicodes=\"U+3000-303F, U+4E00-9FFF\" --layout-features='*' --flavor=\"woff2\" --with-zopfli\n\n## \u62bd\u53d6\u7528\u5230\u7684\u5b57\u4f53\npyftsubset ./SourceHanSerifCN-Regular.otf --output-file=\"SourceHanSansCN-Subset.ttf\" --text-file=charset.txt --layout-features='*' --flavor=\"woff2\" --with-zopfli\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/","title":"Ubuntu 22.04 Mysql8","text":""},{"location":"Linux/2025-08-22-mysql8/#install","title":"Install","text":"<pre><code>sudo apt update\nsudo apt upgrade\n\nsudo apt install mysql-server\nsudo systemctl status mysql\nsudo mysql_secure_installation\n\n# Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 1\n# Remove anonymous users? (Press y|Y for Yes, any other key for No) : y\n# Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y\n# Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y\n# Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#security-configuration","title":"Security configuration","text":""},{"location":"Linux/2025-08-22-mysql8/#_1","title":"\u914d\u7f6e\u9632\u706b\u5899","text":"<pre><code>sudo ufw status numbered\nsudo ufw delete 4\n</code></pre> <pre><code>sudo ss -tlnp | grep mysql\n\n#sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf #\u5141\u8bb8\u5185\u7f51\u5176\u4ed6\u670d\u52a1\u5668\u8bbf\u95ee\n\n# disable LOCAL INFILE\nsudo vim /etc/mysql/mysql.conf.d/mysqld.cnf\n\n###\n[mysqld]\n# ... \u5176\u4ed6\u914d\u7f6e ...\nlocal-infile = 0\n[mysqld]\n\n# ===== \u57fa\u7840\u8bbe\u7f6e =====\n# \u53ea\u76d1\u542c\u672c\u5730\u56de\u73af\u5730\u5740\uff0c\u589e\u5f3a\u5b89\u5168\u6027\nbind-address = 127.0.0.1\n# \u7981\u7528DNS\u53cd\u5411\u89e3\u6790\uff0c\u52a0\u901f\u8fde\u63a5\u5efa\u7acb\nskip_name_resolve = ON\n# \u9ed8\u8ba4\u5b57\u7b26\u96c6\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n# ===== \u5185\u5b58\u4f18\u5316 (\u6838\u5fc3\u90e8\u5206) =====\n# InnoDB\u7f13\u51b2\u6c60 - \u6700\u5173\u952e\u53c2\u6570\uff0c\u8bbe\u7f6e\u4e3a\u603b\u5185\u5b58\u768410-15%\ninnodb_buffer_pool_size = 200M\n# \u4f7f\u75281\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\uff08\u5c0f\u5185\u5b58\u73af\u5883\uff09\ninnodb_buffer_pool_instances = 1\n\n# \u6bcf\u4e2a\u8fde\u63a5\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff08\u4e25\u683c\u63a7\u5236\u9632\u6b62\u5185\u5b58\u6ea2\u51fa\uff09\nsort_buffer_size = 256K\nread_buffer_size = 128K\nread_rnd_buffer_size = 256K\njoin_buffer_size = 128K\ntmp_table_size = 16M\nmax_heap_table_size = 16M\n\n# \u8fde\u63a5\u9650\u5236\nmax_connections = 30\nthread_cache_size = 10\n# MySQL 8.0\u65b0\u589e\uff1a\u9650\u5236\u5355\u4e2a\u8fde\u63a5\u7684\u5185\u5b58\u4f7f\u7528\nconnection_memory_limit = 10M\n# \u8fde\u63a5\u8d85\u65f6\u8bbe\u7f6e\uff08\u5feb\u901f\u91ca\u653e\u7a7a\u95f2\u8fde\u63a5\uff09\nwait_timeout = 60\ninteractive_timeout = 60\n\n# ===== InnoDB \u4f18\u5316 =====\n# \u4e8b\u52a1\u65e5\u5fd7\u8bbe\u7f6e\uff08\u5e73\u8861\u6027\u80fd\u4e0e\u6301\u4e45\u6027\uff09\ninnodb_log_file_size = 48M\ninnodb_log_buffer_size = 4M\n# \u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f\uff1a2=\u6bcf\u79d2\u5237\u76d8\uff08\u6027\u80fd\u4e0e\u5b89\u5168\u5e73\u8861\uff09\ninnodb_flush_log_at_trx_commit = 2\n# \u5237\u65b0\u90bb\u63a5\u9875\uff08SSD\u53ef\u5173\u95ed\uff09\ninnodb_flush_neighbors = 0\n# \u6bcf\u8868\u72ec\u7acb\u8868\u7a7a\u95f4\ninnodb_file_per_table = ON\n# I/O\u5bb9\u91cf\u8bbe\u7f6e\uff08\u6839\u636e\u5b58\u50a8\u7c7b\u578b\u8c03\u6574\uff09\ninnodb_io_capacity = 200\ninnodb_io_capacity_max = 500\n\n# ===== \u529f\u80fd\u7981\u7528 (\u8282\u7701\u8d44\u6e90) =====\n# \u7981\u7528\u6027\u80fd\u6a21\u5f0f\uff08\u663e\u8457\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff09\nperformance_schema = OFF\n\n# ===== \u5176\u4ed6\u4f18\u5316 =====\n# \u8868\u5b9a\u4e49\u7f13\u5b58\ntable_definition_cache = 400\ntable_open_cache = 1000\n# \u6700\u5927\u6570\u636e\u5305\u5927\u5c0f\nmax_allowed_packet = 16M\n# \u4e34\u65f6\u76ee\u5f55\uff08\u786e\u4fdd\u6709\u8db3\u591f\u7a7a\u95f4\uff09\ntmpdir = /tmp\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#_2","title":"\u914d\u7f6e\u6743\u9650","text":"<pre><code>sudo chown -R mysql:mysql /var/lib/mysql\nsudo chmod -R 755 /var/lib/mysql\n# \u786e\u4fdd\u9519\u8bef\u65e5\u5fd7\u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u76ee\u5f55\u5b58\u5728\u4e14\u6709\u6b63\u786e\u6743\u9650\nsudo mkdir -p /var/log/mysql\nsudo chown -R mysql:adm /var/log/mysql\nsudo chmod -R 755 /var/log/mysql\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#_3","title":"\u521b\u5efa\u4ea4\u6362\u5206\u533a","text":"<pre><code>sudo swapon --show\n\n# \u5982\u679c\u6ca1\u6709\u6216\u9700\u8981\u589e\u52a0\uff0c\u521b\u5efa1GB\u4ea4\u6362\u6587\u4ef6\nsudo fallocate -l 1G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\n\n# \u6c38\u4e45\u751f\u6548\uff0c\u6dfb\u52a0\u5230/etc/fstab\necho '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab\n\n# \u8c03\u6574\u4ea4\u6362\u503e\u5411(0-100\uff0c\u503c\u8d8a\u4f4e\u8d8a\u5c11\u4f7f\u7528\u4ea4\u6362)\necho 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#_4","title":"\u91cd\u542f\u4f7f\u751f\u6548","text":"<pre><code>sudo systemctl restart mysql\n##\u68c0\u67e5\u542f\u52a8\u9519\u8bef\nsudo tail -n 50 /var/log/mysql/error.log\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#_5","title":"\u4f7f\u7528","text":"<pre><code>sudo mysql #go into command line\nCREATE DATABASE &lt;NAME&gt;_db;\nCREATE USER '&lt;NAME&gt;_user'@'&lt;IP_ADDR&gt;' IDENTIFIED BY '&lt;PWD';\nGRANT CREATE, SELECT, INSERT, UPDATE, DELETE ON &lt;NAME&gt;_db.* TO '&lt;NAME&gt;_user'@'&lt;IP_ADDR&gt;';\nFLUSH PRIVILEGES;\nEXIT;\n</code></pre>"},{"location":"Linux/2025-08-22-mysql8/#backup","title":"BackUp","text":"<pre><code># mysql&gt; SHOW VARIABLES LIKE 'datadir';\n# +---------------+-----------------+\n# | Variable_name | Value           |\n# +---------------+-----------------+\n# | datadir       | /var/lib/mysql/ |\n# +---------------+-----------------+\n# 1 row in set (0.04 sec)\n\n# MySQL \u7248\u672c\u5b8c\u5168\u4e00\u81f4\uff1a\u4e3b\u7248\u672c\u3001\u6b21\u7248\u672c\u751a\u81f3\u4fee\u8ba2\u7248\u672c\u53f7\u90fd\u5fc5\u987b\u5b8c\u5168\u76f8\u540c\uff08\u4f8b\u5982\uff0c\u90fd\u662f 8.0.36\uff09\u3002\u4efb\u4f55\u7ec6\u5fae\u7684\u7248\u672c\u5dee\u5f02\u90fd\u53ef\u80fd\u5bfc\u81f4\u5931\u8d25\u3002\n\n# \u64cd\u4f5c\u7cfb\u7edf\u548c\u67b6\u6784\u76f8\u540c\uff1a\u4f8b\u5982\uff0c\u90fd\u662f\u4ece Ubuntu 22.04 (x86_64) \u590d\u5236\u5230 Ubuntu 22.04 (x86_64)\u3002\n\n# \u914d\u7f6e\u6587\u4ef6\u76f8\u4f3c\uff1a\u7279\u522b\u662f\u4e0e InnoDB \u76f8\u5173\u7684\u6838\u5fc3\u914d\u7f6e\uff0c\u5982 innodb_page_size\u3001innodb_log_file_size \u7b49\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\u3002\n\n# \u6743\u9650\u5fc5\u987b\u6b63\u786e\uff1a\u590d\u5236\u5230\u65b0\u670d\u52a1\u5668\u540e\uff0c\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u5c5e\u4e3b\u548c\u5c5e\u7ec4\u5fc5\u987b\u662f mysql\n\nsudo systemctl stop mysql\nsudo chown -R mysql:mysql /var/lib/mysql\n\n## mysqldump \u63a8\u8350\n\n# \u5bfc\u51fa\u4e00\u4e2a\u540d\u4e3a myapp_db \u7684\u6570\u636e\u5e93\nsudo mysqldump -u root -p myapp_db &gt; myapp_db_backup.sql\n# \u5bfc\u51fa\u6240\u6709\u6570\u636e\u5e93\nsudo mysqldump -u root -p --all-databases &gt; all_databases_backup.sql\n\nscp myapp_db_backup.sql user@your_new_server_ip:/path/to/destination\n\n# \u767b\u5f55 MySQL\nsudo mysql -u root -p\n\n# \u5728 MySQL \u63d0\u793a\u7b26\u4e0b\u6267\u884c\nCREATE DATABASE myapp_db;\nEXIT;\n\nsudo mysql -u root -p myapp_db &lt; /path/to/destination/myapp_db_backup.sql\n</code></pre>"},{"location":"Python/2023-12-18-python-ml/","title":"Python Machine Learning List","text":"<ul> <li>NumPy</li> <li>Pandas</li> <li>Seaborn</li> <li>Matplotlib,</li> <li>Plotly</li> <li>Scikit-Learn</li> <li>Machine Learning</li> <li>Tensorflow</li> </ul> <p>python venv</p> <pre><code>python -m venv ml\nactivate ml\n# deactivate ml\n\npip install jupyterlab \n</code></pre>"},{"location":"Python/2024-12-21/","title":"Unit test","text":"<pre><code>class ValidationHelper:\n    @staticmethod\n    def validate_order(order_id):\n        print(\"complext validation logic\")\n        if order_id is None:\n            raise ValueError(\"order_id is None\")\n        return order_id\n\n\n# OrderService\nclass OrderService:\n    def __init__(self, order_id):\n        print(\"__init__\")\n        self.order_id = order_id\n\n    def process_order(self):\n        print(\"get_order\")\n        return self.order_id * 2 \n\n    def sanitize_order(self):\n        print(\"sanitize_order\")\n        return self.order_id * 3\n\n    def validate_order(self):\n        print(\"validate_order\")\n        order = self.process_order()\n        return ValidationHelper.validate_order(order)\n\n\n# Unit Tests \nclass TestOrderService(unittest.TestCase):\n\n    @mock.patch('app.order_service.OrderService.sanitize_order', return_value=444)\n    def test_sanitize_order(self, sanitize_orde):\n        order_service = OrderService(1)\n        # the return value of sanitize_order is mocked to 444\n        self.assertEqual(444, order_service.sanitize_order())\n\n    @mock.patch('app.validation_helper.ValidationHelper.validate_order', return_value=333)\n    def test_validate_order(self, mock_validate_order):\n        order_service = OrderService(1)\n        # the return value of validate_order is mocked to 333\n        self.assertEqual(333, order_service.validate_order())\n</code></pre>"}]}