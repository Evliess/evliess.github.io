---
layout: index
title: "GitHub Actions"
category: devops
date: 2025-09-12 12:17:55
---


## 1. 在云服务器上生成公钥与私钥
```bash
ssh-keygen -t rsa -f ./vmsshkey -P ''
cat vmsshkey.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```
## 2. 将私钥文件添加到Github的 Secret 中

## 3. 创建一个wrokflow

```yml
name: Run Long-Running Docker Container

on:
  workflow_dispatch: # 允许手动触发
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# 设置整个工作流的超时（可选，但建议）
# 它应该大于 job 的超时时间

jobs:
  run-docker-long-job:
    # 指定运行环境（根据情况选择）
    runs-on: ubuntu-latest # 使用 GitHub 托管的 Ubuntu 运行器
    # runs-on: self-hosted # 如果使用自托管运行器，使用这个标签

    # 为这个 job 设置 250 分钟（4小时10分钟）的超时
    timeout-minutes: 250

    steps:
      - name: Run long-running Docker container
        run: |
          ssh-keygen  -t rsa -f ./newsshkey -P ''
          mkdir -p  ~/.ssh
          cat newsshkey.pub >> ~/.ssh/authorized_keys
          chmod 600 ~/.ssh/authorized_keys
          ssh  -N -f -g -o ServerAliveInterval=60 -o "StrictHostKeyChecking=no" -o "UserKnownHostsFile=/dev/null" -i ./newsshkey -D 9999 localhost 
          echo "${{ secrets.VM_SSH }}" > ./vmsshkey
          chmod 400 ./vmsshkey
          ssh -p 22 -i ./vmsshkey  -N -f -g -o ServerAliveInterval=60 -o "StrictHostKeyChecking=no" -o "UserKnownHostsFile=/dev/null" -R 9999:localhost:9999  <user>@<IP>
          num=3600
          for i in `seq $num`
          do
            echo $i
            sleep 1
          done
          exit 0

      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3
        # 可以设置超时时间，避免忘记断开连接导致资源浪费
        timeout-minutes: 15
        with:
            detached: true
```

## 4. 在本地开启端口转发
```bash
ssh -N -f -g -o ServerAliveInterval=60  -L 9999:localhost:9999 <user>@<IP>
```
### References
- https://zhuanlan.zhihu.com/p/1907806046501729107